<!doctype html><html lang=fr-fr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><title>CQRS - Command Query Responsibility Segregation | DDD Adventure</title><meta name=robots content="noindex"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Découvrez CQRS, le pattern qui sépare les commandes des requêtes pour une architecture plus claire et performante"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=//localhost:1313/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=//localhost:1313/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=//localhost:1313/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=//localhost:1313/site.webmanifest><meta property="og:title" content="CQRS - Command Query Responsibility Segregation"><meta property="og:description" content="Découvrez CQRS, le pattern qui sépare les commandes des requêtes pour une architecture plus claire et performante"><meta property="og:type" content="article"><meta property="og:url" content="//localhost:1313/concept/cqrs/"><meta property="og:image" content="//localhost:1313/opengraph/card-base-2_hu_c282e123f6f1bcf1.png"><meta property="article:section" content="concept"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//localhost:1313/opengraph/card-base-2_hu_c282e123f6f1bcf1.png"><meta name=twitter:title content="CQRS - Command Query Responsibility Segregation"><meta name=twitter:description content="Découvrez CQRS, le pattern qui sépare les commandes des requêtes pour une architecture plus claire et performante"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=//localhost:1313/docs/js/flexsearch.bundle.js></script><link rel=stylesheet href=/docs/scss/style.css crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li class=current><a class=sidebar-root-link href=//localhost:1313/concept/cqrs/>CQRS - Command Query Responsibility Segregation</a></li><li><a class=sidebar-root-link href=//localhost:1313/concept/event-sourcing/>Event Sourcing - Stocker les Événements comme Source de Vérité</a></li><li><a class=sidebar-root-link href=//localhost:1313/concept/repositories/>Repositories - Patterns de Persistance</a></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/concept/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>CQRS - Command Query Responsibility Segregation</span>
<meta itemprop=position content='2'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-qu>🌟 <strong>Qu’est-ce que CQRS ?</strong></a><ul><li><a href=#le-principe-fondamental><strong>Le Principe Fondamental</strong></a></li></ul></li><li><a href=#-architecture-cqrs-dans-gyroscops>🏗️ <strong>Architecture CQRS dans Gyroscops</strong></a><ul><li><a href=#contexte-métier--gestion-des-paiements><strong>Contexte Métier : Gestion des Paiements</strong></a></li></ul></li><li><a href=#-avantages-de-cqrs>🎯 <strong>Avantages de CQRS</strong></a><ul><li><a href=#1-séparation-des-responsabilités><strong>1. Séparation des Responsabilités</strong></a></li><li><a href=#2-optimisation-indépendante><strong>2. Optimisation Indépendante</strong></a></li><li><a href=#3-scalabilité><strong>3. Scalabilité</strong></a></li><li><a href=#4-évolutivité><strong>4. Évolutivité</strong></a></li></ul></li><li><a href=#-implémentation-dans-gyroscops>🔧 <strong>Implémentation dans Gyroscops</strong></a><ul><li><a href=#structure-des-dossiers><strong>Structure des Dossiers</strong></a></li><li><a href=#exemple-concret--gestion-des-abonnements><strong>Exemple Concret : Gestion des Abonnements</strong></a></li></ul></li><li><a href=#-patterns-avancés-avec-cqrs>🚀 <strong>Patterns Avancés avec CQRS</strong></a><ul><li><a href=#1-event-sourcing--cqrs><strong>1. Event Sourcing + CQRS</strong></a></li><li><a href=#2-cqrs-avec-projections><strong>2. CQRS avec Projections</strong></a></li><li><a href=#3-cqrs-avec-api-platform><strong>3. CQRS avec API Platform</strong></a></li></ul></li><li><a href=#-performance-et-optimisation>⚡ <strong>Performance et Optimisation</strong></a><ul><li><a href=#optimisations-côté-lecture><strong>Optimisations Côté Lecture</strong></a></li><li><a href=#optimisations-côté-écriture><strong>Optimisations Côté Écriture</strong></a></li></ul></li><li><a href=#-quand-utiliser-cqrs->🎯 <strong>Quand Utiliser CQRS ?</strong></a><ul><li><a href=#-cas-d><strong>✅ Cas d’Usage Appropriés</strong></a></li><li><a href=#-cas-d-1><strong>❌ Cas d’Usage Inappropriés</strong></a></li></ul></li><li><a href=#-migration-vers-cqrs>🔄 <strong>Migration vers CQRS</strong></a><ul><li><a href=#étape-1--identifier-les-commandes><strong>Étape 1 : Identifier les Commandes</strong></a></li><li><a href=#étape-2--identifier-les-requêtes><strong>Étape 2 : Identifier les Requêtes</strong></a></li><li><a href=#étape-3--séparer-les-modèles><strong>Étape 3 : Séparer les Modèles</strong></a></li><li><a href=#étape-4--optimiser><strong>Étape 4 : Optimiser</strong></a></li></ul></li><li><a href=#-métriques-et-monitoring>📊 <strong>Métriques et Monitoring</strong></a><ul><li><a href=#métriques-côté-commande><strong>Métriques Côté Commande</strong></a></li><li><a href=#métriques-côté-requête><strong>Métriques Côté Requête</strong></a></li></ul></li><li><a href=#-prochaines-étapes>🎯 <strong>Prochaines Étapes</strong></a></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-qu>🌟 <strong>Qu’est-ce que CQRS ?</strong></a><ul><li><a href=#le-principe-fondamental><strong>Le Principe Fondamental</strong></a></li></ul></li><li><a href=#-architecture-cqrs-dans-gyroscops>🏗️ <strong>Architecture CQRS dans Gyroscops</strong></a><ul><li><a href=#contexte-métier--gestion-des-paiements><strong>Contexte Métier : Gestion des Paiements</strong></a></li></ul></li><li><a href=#-avantages-de-cqrs>🎯 <strong>Avantages de CQRS</strong></a><ul><li><a href=#1-séparation-des-responsabilités><strong>1. Séparation des Responsabilités</strong></a></li><li><a href=#2-optimisation-indépendante><strong>2. Optimisation Indépendante</strong></a></li><li><a href=#3-scalabilité><strong>3. Scalabilité</strong></a></li><li><a href=#4-évolutivité><strong>4. Évolutivité</strong></a></li></ul></li><li><a href=#-implémentation-dans-gyroscops>🔧 <strong>Implémentation dans Gyroscops</strong></a><ul><li><a href=#structure-des-dossiers><strong>Structure des Dossiers</strong></a></li><li><a href=#exemple-concret--gestion-des-abonnements><strong>Exemple Concret : Gestion des Abonnements</strong></a></li></ul></li><li><a href=#-patterns-avancés-avec-cqrs>🚀 <strong>Patterns Avancés avec CQRS</strong></a><ul><li><a href=#1-event-sourcing--cqrs><strong>1. Event Sourcing + CQRS</strong></a></li><li><a href=#2-cqrs-avec-projections><strong>2. CQRS avec Projections</strong></a></li><li><a href=#3-cqrs-avec-api-platform><strong>3. CQRS avec API Platform</strong></a></li></ul></li><li><a href=#-performance-et-optimisation>⚡ <strong>Performance et Optimisation</strong></a><ul><li><a href=#optimisations-côté-lecture><strong>Optimisations Côté Lecture</strong></a></li><li><a href=#optimisations-côté-écriture><strong>Optimisations Côté Écriture</strong></a></li></ul></li><li><a href=#-quand-utiliser-cqrs->🎯 <strong>Quand Utiliser CQRS ?</strong></a><ul><li><a href=#-cas-d><strong>✅ Cas d’Usage Appropriés</strong></a></li><li><a href=#-cas-d-1><strong>❌ Cas d’Usage Inappropriés</strong></a></li></ul></li><li><a href=#-migration-vers-cqrs>🔄 <strong>Migration vers CQRS</strong></a><ul><li><a href=#étape-1--identifier-les-commandes><strong>Étape 1 : Identifier les Commandes</strong></a></li><li><a href=#étape-2--identifier-les-requêtes><strong>Étape 2 : Identifier les Requêtes</strong></a></li><li><a href=#étape-3--séparer-les-modèles><strong>Étape 3 : Séparer les Modèles</strong></a></li><li><a href=#étape-4--optimiser><strong>Étape 4 : Optimiser</strong></a></li></ul></li><li><a href=#-métriques-et-monitoring>📊 <strong>Métriques et Monitoring</strong></a><ul><li><a href=#métriques-côté-commande><strong>Métriques Côté Commande</strong></a></li><li><a href=#métriques-côté-requête><strong>Métriques Côté Requête</strong></a></li></ul></li><li><a href=#-prochaines-étapes>🎯 <strong>Prochaines Étapes</strong></a></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">CQRS - Command Query Responsibility Segregation</h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h1 id=-cqrs---command-query-responsibility-segregation>🎯 CQRS - Command Query Responsibility Segregation <a href=#-cqrs---command-query-responsibility-segregation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h1><h2 id=-qu>🌟 <strong>Qu&rsquo;est-ce que CQRS ?</strong> <a href=#-qu class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><p><strong>CQRS</strong> (Command Query Responsibility Segregation) est un pattern architectural qui sépare clairement les opérations de <strong>lecture</strong> (Query) des opérations d&rsquo;<strong>écriture</strong> (Command) dans une application.</p><h3 id=le-principe-fondamental><strong>Le Principe Fondamental</strong> <a href=#le-principe-fondamental class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><blockquote><p><strong>&ldquo;Une méthode ne devrait jamais retourner de valeur et modifier l&rsquo;état de l&rsquo;objet&rdquo;</strong> - Bertrand Meyer</p></blockquote><p>CQRS pousse ce principe à l&rsquo;extrême en créant deux modèles distincts :</p><ul><li><strong>Modèle de Commande</strong> : Pour les opérations qui modifient l&rsquo;état</li><li><strong>Modèle de Requête</strong> : Pour les opérations qui lisent les données</li></ul><h2 id=-architecture-cqrs-dans-gyroscops>🏗️ <strong>Architecture CQRS dans Gyroscops</strong> <a href=#-architecture-cqrs-dans-gyroscops class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=contexte-métier--gestion-des-paiements><strong>Contexte Métier : Gestion des Paiements</strong> <a href=#contexte-m%c3%a9tier--gestion-des-paiements class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Dans Gyroscops, nous gérons des paiements avec des besoins très différents :</p><h4 id=côté-commande-write><strong>Côté Commande (Write)</strong> <a href=#c%c3%b4t%c3%a9-commande-write class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Commande : Créer un paiement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreatePaymentCommand</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentId</span> $paymentId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>Amount</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentMethod</span> $method,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>CustomerId</span> $customerId
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Handler : Traiter la commande
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreatePaymentHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(<span style=color:#a6e22e>CreatePaymentCommand</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> <span style=color:#a6e22e>Payment</span><span style=color:#f92672>::</span><span style=color:#a6e22e>create</span>(
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerId</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($payment);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventBus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentCreated</span>($payment));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h4 id=côté-requête-read><strong>Côté Requête (Read)</strong> <a href=#c%c3%b4t%c3%a9-requ%c3%aate-read class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Requête : Obtenir les paiements d&#39;un client
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetCustomerPaymentsQuery</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>CustomerId</span> $customerId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>DateRange</span> $dateRange <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Handler : Exécuter la requête
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetCustomerPaymentsHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(<span style=color:#a6e22e>GetCustomerPaymentsQuery</span> $query)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentQueryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByCustomer</span>(
</span></span><span style=display:flex><span>            $query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerId</span>,
</span></span><span style=display:flex><span>            $query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dateRange</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=-avantages-de-cqrs>🎯 <strong>Avantages de CQRS</strong> <a href=#-avantages-de-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-séparation-des-responsabilités><strong>1. Séparation des Responsabilités</strong> <a href=#1-s%c3%a9paration-des-responsabilit%c3%a9s class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Commandes</strong> : Focus sur la logique métier et la validation</li><li><strong>Requêtes</strong> : Focus sur l&rsquo;optimisation des performances de lecture</li></ul><h3 id=2-optimisation-indépendante><strong>2. Optimisation Indépendante</strong> <a href=#2-optimisation-ind%c3%a9pendante class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Write Model</strong> : Optimisé pour la cohérence et les invariants métier</li><li><strong>Read Model</strong> : Optimisé pour les performances et la flexibilité</li></ul><h3 id=3-scalabilité><strong>3. Scalabilité</strong> <a href=#3-scalabilit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Possibilité de scaler séparément les lectures et les écritures</li><li>Utilisation de technologies différentes pour chaque côté</li></ul><h3 id=4-évolutivité><strong>4. Évolutivité</strong> <a href=#4-%c3%a9volutivit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Modification des requêtes sans impact sur les commandes</li><li>Ajout de nouvelles vues sans affecter la logique métier</li></ul><h2 id=-implémentation-dans-gyroscops>🔧 <strong>Implémentation dans Gyroscops</strong> <a href=#-impl%c3%a9mentation-dans-gyroscops class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=structure-des-dossiers><strong>Structure des Dossiers</strong> <a href=#structure-des-dossiers class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><pre tabindex=0><code>src/Accounting/
├── Application/
│   ├── Command/
│   │   ├── CreatePayment/
│   │   │   ├── CreatePaymentCommand.php
│   │   │   ├── CreatePaymentHandler.php
│   │   │   └── CreatePaymentValidator.php
│   │   └── ProcessRefund/
│   └── Query/
│       ├── GetPaymentDetails/
│       │   ├── GetPaymentDetailsQuery.php
│       │   ├── GetPaymentDetailsHandler.php
│       │   └── PaymentDetailsView.php
│       └── ListCustomerPayments/
├── Domain/
│   ├── Payment.php (Write Model)
│   └── PaymentDetails.php (Read Model)
└── Infrastructure/
    ├── PaymentRepository.php (Write)
    └── PaymentQueryRepository.php (Read)</code></pre><h3 id=exemple-concret--gestion-des-abonnements><strong>Exemple Concret : Gestion des Abonnements</strong> <a href=#exemple-concret--gestion-des-abonnements class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><h4 id=commande--créer-un-abonnement><strong>Commande : Créer un Abonnement</strong> <a href=#commande--cr%c3%a9er-un-abonnement class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateSubscriptionCommand</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>SubscriptionId</span> $subscriptionId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PlanId</span> $planId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>CustomerId</span> $customerId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>BillingCycle</span> $billingCycle
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateSubscriptionHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(<span style=color:#a6e22e>CreateSubscriptionCommand</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Validation métier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validateSubscriptionCreation</span>($command);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Création de l&#39;agrégat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $subscription <span style=color:#f92672>=</span> <span style=color:#a6e22e>Subscription</span><span style=color:#f92672>::</span><span style=color:#a6e22e>create</span>(
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionId</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>planId</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerId</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>billingCycle</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Persistance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($subscription);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Événement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventBus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscriptionCreated</span>($subscription));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h4 id=requête--obtenir-les-détails-d><strong>Requête : Obtenir les Détails d&rsquo;un Abonnement</strong> <a href=#requ%c3%aate--obtenir-les-d%c3%a9tails-d class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetSubscriptionDetailsQuery</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>SubscriptionId</span> $subscriptionId
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetSubscriptionDetailsHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(<span style=color:#a6e22e>GetSubscriptionDetailsQuery</span> $query)<span style=color:#f92672>:</span> <span style=color:#a6e22e>SubscriptionDetailsView</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionQueryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findDetails</span>($query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionId</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SubscriptionDetailsView</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>SubscriptionId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $planName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>DateTime</span> $startDate,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>DateTime</span> $endDate,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>Amount</span> $monthlyPrice,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>array</span> $features
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=-patterns-avancés-avec-cqrs>🚀 <strong>Patterns Avancés avec CQRS</strong> <a href=#-patterns-avanc%c3%a9s-avec-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-event-sourcing--cqrs><strong>1. Event Sourcing + CQRS</strong> <a href=#1-event-sourcing--cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Les commandes génèrent des événements</li><li>Les requêtes lisent depuis les projections</li></ul><h3 id=2-cqrs-avec-projections><strong>2. CQRS avec Projections</strong> <a href=#2-cqrs-avec-projections class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Projections dénormalisées pour les requêtes</li><li>Mise à jour asynchrone des vues</li></ul><h3 id=3-cqrs-avec-api-platform><strong>3. CQRS avec API Platform</strong> <a href=#3-cqrs-avec-api-platform class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Ressources séparées pour Command et Query</li><li>Validation automatique des DTOs</li></ul><h2 id=-performance-et-optimisation>⚡ <strong>Performance et Optimisation</strong> <a href=#-performance-et-optimisation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=optimisations-côté-lecture><strong>Optimisations Côté Lecture</strong> <a href=#optimisations-c%c3%b4t%c3%a9-lecture class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Indexation</strong> : Index optimisés pour les requêtes fréquentes</li><li><strong>Cache</strong> : Mise en cache des vues fréquemment consultées</li><li><strong>Dénormalisation</strong> : Données pré-calculées pour éviter les jointures</li></ul><h3 id=optimisations-côté-écriture><strong>Optimisations Côté Écriture</strong> <a href=#optimisations-c%c3%b4t%c3%a9-%c3%a9criture class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Validation</strong> : Validation métier centralisée</li><li><strong>Transactions</strong> : Gestion des transactions optimisée</li><li><strong>Événements</strong> : Publication asynchrone des événements</li></ul><h2 id=-quand-utiliser-cqrs->🎯 <strong>Quand Utiliser CQRS ?</strong> <a href=#-quand-utiliser-cqrs- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=-cas-d><strong>✅ Cas d&rsquo;Usage Appropriés</strong> <a href=#-cas-d class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Complexité métier élevée</strong> : Beaucoup de règles métier</li><li><strong>Besoins de lecture/écriture différents</strong> : Requêtes complexes vs écritures simples</li><li><strong>Performance critique</strong> : Besoins de performance différents</li><li><strong>Équipes séparées</strong> : Équipes différentes pour read/write</li></ul><h3 id=-cas-d-1><strong>❌ Cas d&rsquo;Usage Inappropriés</strong> <a href=#-cas-d-1 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Applications simples</strong> : CRUD basique</li><li><strong>Cohérence forte requise</strong> : Besoin de cohérence immédiate</li><li><strong>Équipe unique</strong> : Une seule équipe pour tout</li><li><strong>Prototypage</strong> : Développement rapide</li></ul><h2 id=-migration-vers-cqrs>🔄 <strong>Migration vers CQRS</strong> <a href=#-migration-vers-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=étape-1--identifier-les-commandes><strong>Étape 1 : Identifier les Commandes</strong> <a href=#%c3%a9tape-1--identifier-les-commandes class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Lister toutes les opérations qui modifient l&rsquo;état</li><li>Grouper par contexte métier</li></ul><h3 id=étape-2--identifier-les-requêtes><strong>Étape 2 : Identifier les Requêtes</strong> <a href=#%c3%a9tape-2--identifier-les-requ%c3%aates class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Lister toutes les opérations de lecture</li><li>Analyser les patterns d&rsquo;accès</li></ul><h3 id=étape-3--séparer-les-modèles><strong>Étape 3 : Séparer les Modèles</strong> <a href=#%c3%a9tape-3--s%c3%a9parer-les-mod%c3%a8les class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Créer des modèles distincts</li><li>Migrer progressivement</li></ul><h3 id=étape-4--optimiser><strong>Étape 4 : Optimiser</strong> <a href=#%c3%a9tape-4--optimiser class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Optimiser chaque côté indépendamment</li><li>Mesurer les performances</li></ul><h2 id=-métriques-et-monitoring>📊 <strong>Métriques et Monitoring</strong> <a href=#-m%c3%a9triques-et-monitoring class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=métriques-côté-commande><strong>Métriques Côté Commande</strong> <a href=#m%c3%a9triques-c%c3%b4t%c3%a9-commande class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Nombre de commandes par seconde</li><li>Temps de traitement moyen</li><li>Taux d&rsquo;erreur</li></ul><h3 id=métriques-côté-requête><strong>Métriques Côté Requête</strong> <a href=#m%c3%a9triques-c%c3%b4t%c3%a9-requ%c3%aate class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Temps de réponse des requêtes</li><li>Utilisation du cache</li><li>Charge des projections</li></ul><h2 id=-prochaines-étapes>🎯 <strong>Prochaines Étapes</strong> <a href=#-prochaines-%c3%a9tapes class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><p>Maintenant que vous comprenez CQRS, explorez :</p><ol><li><strong><a href=/concept/event-sourcing/>Event Sourcing</a></strong> : Stocker les événements comme source de vérité</li><li><strong><a href=/concept/repositories/>Repositories</a></strong> : Patterns de persistance</li><li><strong><a href=/chapitres/optionnels/chapitre-13-architecture-cqrs/>Implémentation CQRS</a></strong> : Guide d&rsquo;implémentation complet</li></ol><hr><p><em>CQRS n&rsquo;est pas une solution universelle, mais un outil puissant pour les applications complexes. Dans Gyroscops, il nous a permis de gérer efficacement la complexité métier tout en optimisant les performances.</em></p></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap"><div class="col-sm-6 pt-2 doc-prev"><a class=ms-auto href=/concept/event-sourcing/><div class="card h-100 my-1 text-end"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0">Event Sourcing - Stocker les Événements comme Source de Vérité <i class="material-icons align-middle">navigate_next</i></p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>© 2025 Grégory Planchat. Tous droits réservés.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci à nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-2"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Kiboko</span></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Gyroscops</span></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.js defer></script><script type=text/javascript src=//localhost:1313/docs/js/bundle.js defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>