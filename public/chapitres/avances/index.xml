<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Chapitres Avanc√©s on DDD Adventure</title><link>http://localhost:1313/chapitres/avances/</link><description>Recent content in Chapitres Avanc√©s on DDD Adventure</description><generator>Hugo</generator><language>fr-fr</language><lastBuildDate>Thu, 19 Dec 2024 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/chapitres/avances/index.xml" rel="self" type="application/rss+xml"/><item><title>Chapitre 62 : S√©curit√© et Autorisation - Prot√©ger votre API Platform</title><link>http://localhost:1313/chapitres/avances/chapitre-62-securite-autorisation/</link><pubDate>Thu, 19 Dec 2024 00:00:00 +0000</pubDate><guid>http://localhost:1313/chapitres/avances/chapitre-62-securite-autorisation/</guid><description>&lt;h2 id="-objectif-de-ce-chapitre-mon-probl√®me--comment-s√©curiser-une-api-platform-complexe-voici-ce-qui-s--javais-une-api-platform-qui-fonctionnait-bien-mais-la-s√©curit√©-√©tait-un-vrai-casse-t√™te-comment-g√©rer-les-permissions--comment-s√©curiser-les-endpoints--comment-g√©rer-lauthentification-multi-tenant-mais-attendez-quand-jai-voulu-impl√©menter-une-s√©curit√©-robuste-j√©tais-perdu-oauth2-jwt-rbac-abac-keycloak-tellement-doptions--comment-choisir--comment-impl√©menter-soudain-je-r√©alisais-que-la-s√©curit√©-n-il-me-fallait-une-approche-structur√©e-et-compl√®te-la-s√©curit√©--mon-guide-completla-s√©curit√©-dans-une-api-platform-avec-ddd-ma-permis-de---prot√©ger-les-donn√©es-sensibles--contr√¥ler-lacc√®s-aux-ressources--g√©rer-les-permissions-granulaires--auditer-les-actions-utilisateurs-quest-ce-que-la-s√©curit√©-dans-une-api-platform--le-concept-fondamentalla-s√©curit√©-dans-une-api-platform-consiste-√†-prot√©ger-les-ressources-et-contr√¥ler-lacc√®s-l--chaque-requ√™te-doit-√™tre-authentifi√©e-et-autoris√©e-avant-dacc√©der-aux-donn√©esavec-gyroscops-voici-comment-j--les-4-piliers-de-la-s√©curit√©-1-authentification---qui-√™tes-vous-voici-comment-j-oauth2--jwt---tokens-jwt-pour-lauthentification--refresh-tokens-pour-la-s√©curit√©--expiration-automatique-des-tokenskeycloak---gestion-centralis√©e-des-utilisateurs--int√©gration-oauth2--gestion-des-r√¥les-et-permissions-2-autorisation---que-pouvez-vous-faire-voici-comment-j-rbac-role-based-access-control---r√¥les-d√©finis-par-domaine--permissions-granulaires--hi√©rarchie-des-r√¥lesabac-attribute-based-access-control---contr√¥le-bas√©-sur-les-attributs--r√®gles-m√©tier-complexes--contexte-dynamique-3-validation---les-donn√©es-sont-elles-valides-voici-comment-j-validation-des-entr√©es---validation-des-donn√©es-dentr√©e--sanitisation-des-donn√©es--gestion-des-erreursvalidation-des-permissions---v√©rification-des-permissions--contr√¥le-dacc√®s-aux-ressources--audit-des-actions-4-audit---que-sest-il-pass√©-voici-comment-j-logging-de-s√©curit√©---logs-dauthentification--logs-dautorisation--logs-dauditmonitoring---d√©tection-dintrusions--alertes-de-s√©curit√©--m√©triques-de-s√©curit√©-comment-impl√©menter-la-s√©curit√©-1-configuration-de-l--jai-configur√©-lauthentification-yamlsecurity----providers--------keycloak------------id-appsecuritykeycloakuserprovider----firewalls--------api------------pattern-api------------stateless-true------------jwt-----access_control-----------path-apiauth-roles-public_access------------path-api-roles-role_user-r√©sultat--authentification-jwt-configur√©e-2-impl√©mentation-de-l--jai-impl√©ment√©-lautorisation-phprouteapipayments-methods-getisgrantedpayment_read-subject-organizationpublic-function-getpaymentsorganization-organization-jsonresponse-----logique-m√©tierr√©sultat--autorisation-bas√©e-sur-les-permissions-3-gestion-des-permissions--jai-g√©r√©-les-permissions-phpfinal-class-paymentvoter-extends-voter----protected-function-supportsstring-attribute-mixed-subject-bool------------return-in_arrayattribute-payment_read-payment_write-payment_delete-------------subject-instanceof-payment------------protected-function-voteonattributestring-attribute-mixed-subject-tokeninterface-token-bool------------user--token-getuser----------------return-match-attribute-------------payment_read--this-canreaduser-subject------------payment_write--this-canwriteuser-subject------------payment_delete--this-candeleteuser-subject------------default--false------------r√©sultat--permissions-granulaires-et-flexibles-4-audit-et-monitoring--jai-impl√©ment√©-laudit-phpfinal-class-securityauditlogger----public-function-logauthenticationstring-userid-bool-success-void------------this-logger-infoauthentication-attempt-------------user_id--userid------------success--success------------timestamp--new-datetimeimmutable--------------------public-function-logauthorizationstring-userid-string-resource-string-action-bool-granted-void------------this-logger-infoauthorization-check-------------user_id--userid------------resource--resource------------action--action------------granted--granted------------timestamp--new-datetimeimmutable------------r√©sultat--audit-complet-des-actions-de-s√©curit√©-les-avantages-de-la-s√©curit√©-structur√©e-1-protection-des-donn√©es--la-s√©curit√©-structur√©e-prot√®ge-les-donn√©es---acc√®s-contr√¥l√©-aux-ressources--donn√©es-sensibles-prot√©g√©es--conformit√©-r√©glementairer√©sultat--donn√©es-s√©curis√©es-et-conformes-2-contr√¥le-d--la-s√©curit√©-structur√©e-permet-un-contr√¥le-granulaire---permissions-par-ressource--r√¥les-contextuels--r√®gles-m√©tier-complexesr√©sultat--contr√¥le-dacc√®s-pr√©cis-et-flexible-3-audit-et-conformit√©--la-s√©curit√©-structur√©e-facilite-laudit---logs-complets-des-actions--tra√ßabilit√©-des-acc√®s--conformit√©-r√©glementairer√©sultat--audit-complet-et-conformit√©-assur√©e-4-√©volutivit√©--la-s√©curit√©-structur√©e-est-√©volutive---ajout-facile-de-nouvelles-permissions--extension-des-r√¥les--adaptation-aux-besoins-m√©tierr√©sultat--s√©curit√©-√©volutive-et-maintenable-les-inconv√©nients-de-la-s√©curit√©-structur√©e-1-complexit√©-accrue--la-s√©curit√©-structur√©e-ajoute-de-la-complexit√©---configuration-complexe--gestion-des-permissions--debugging-plus-difficiler√©sultat--courbe-dapprentissage-plus-importante-2-performance--la-s√©curit√©-structur√©e-peut-impacter-les-performances---v√©rifications-dautorisation--validation-des-tokens--logs-dauditr√©sultat--performance-potentiellement-d√©grad√©e-3-maintenance--la-s√©curit√©-structur√©e-n√©cessite-de-la-maintenance---mise-√†-jour-des-permissions--gestion-des-r√¥les--monitoring-continur√©sultat--maintenance-plus-complexe-4-gestion-des-erreurs--la-s√©curit√©-structur√©e-complique-la-gestion-des-erreurs---erreurs-dauthentification--erreurs-dautorisation--messages-derreur-appropri√©sr√©sultat--gestion-derreurs-plus-complexe-les-pi√®ges-√†-√©viter-1-s√©curit√©-par-obscurit√©-mauvais--compter-sur-lobscurit√©-pour-la-s√©curit√©-bon--s√©curit√©-bas√©e-sur-des-standards-√©prouv√©spourquoi-c-lobscurit√©-nest-pas-une-s√©curit√©-2-permissions-trop-granulaires-mauvais--une-permission-pour-chaque-action-bon--permissions-par-domaine-m√©tierpourquoi-c-des-permissions-trop-granulaires-sont-difficiles-√†-g√©rer-3-ignorer-l-mauvais--pas-daudit-des-actions-de-s√©curit√©-bon--audit-complet-des-actionspourquoi-c-laudit-est-essentiel-pour-la-s√©curit√©-4-tokens-non-s√©curis√©s-mauvais--tokens-non-s√©curis√©s-ou-non-expir√©s-bon--tokens-s√©curis√©s-avec-expirationpourquoi-c-les-tokens-non-s√©curis√©s-sont-une-faille-de-s√©curit√©-l√©volution-vers-la-s√©curit√©-structur√©e-phase-1--authentification-basiqueavec-gyroscops--au-d√©but-javais-une-authentification-basique---loginpassword-simple--sessions-php--pas-dautorisationr√©sultat--d√©veloppement-rapide-s√©curit√©-faible-phase-2--introduction-de-lautorisationavec-gyroscops--jai-introduit-lautorisation---r√¥les-basiques--permissions-simples--contr√¥le-dacc√®sr√©sultat--s√©curit√©-am√©lior√©e-complexit√©-accrue-phase-3--s√©curit√©-compl√®teavec-gyroscops--maintenant-jai-une-s√©curit√©-compl√®te---oauth2--jwt--rbac--abac--audit-completr√©sultat--s√©curit√©-robuste-et-√©volutive--impl√©mentation-concr√®te-dans-le-projet-gyroscops-cloud-s√©curit√©-appliqu√©e-√†-gyroscops-cloudle-gyroscops-cloud-applique-concr√®tement-les-principes-de-s√©curit√©-√†-travers-son-architecture-et-ses-adr-architecture-decision-records-voici-comment--syst√®me-dauthentification-gyroscops-cloudphp--syst√®me-dauthentification-gyroscops-cloud-projet-gyroscops-cloudfinal-class-hiveauthenticationservice----public-function-__construct--------private-keycloakclient-keycloakclient--------private-jwttokenservice-jwtservice--------private-userrepositoryinterface-userrepository--------private-loggerinterface-logger-------------public-function-authenticatestring-email-string-password-authresult------------this-logger-infoauthentication-attempt-------------email--email------------timestamp--new-datetimeimmutable------------------------try-------------keycloakuser--this-keycloakclient-authenticateemail-password------------------------if-keycloakuser-----------------this-logger-warningauthentication-failed---------------------email--email--------------------reason--invalid-credentials------------------------------------------------return-authresultfailureinvalid-credentials------------------------------------user--this-userrepository-findbyemailnew-emailemail------------if-user-----------------this-logger-warninguser-not-found---------------------email--email------------------------------------------------return-authresultfailureuser-not-found------------------------------------token--this-jwtservice-generatetokenuser------------------------this-logger-infoauthentication-successful-----------------user_id--user-getid-tostring----------------email--email------------------------------------return-authresultsuccessuser-token---------------------catch-exception-e-------------this-logger-errorauthentication-error-----------------email--email----------------error--e-getmessage------------------------------------return-authresultfailureauthentication-failed--------------------public-function-refreshtokenstring-refreshtoken-authresult------------try-------------newtoken--this-jwtservice-refreshtokenrefreshtoken------------------------this-logger-infotoken-refreshed-successfully------------------------return-authresultsuccessnull-newtoken---------------------catch-exception-e-------------this-logger-errortoken-refresh-failed-----------------error--e-getmessage------------------------------------return-authresultfailuretoken-refresh-failed-------------syst√®me-dautorisation-gyroscops-cloudphp--syst√®me-dautorisation-gyroscops-cloud-projet-gyroscops-cloudfinal-class-hiveauthorizationservice----public-function-__construct--------private-permissionrepositoryinterface-permissionrepository--------private-rolerepositoryinterface-rolerepository--------private-loggerinterface-logger-------------public-function-haspermissionuser-user-string-resource-string-action-bool------------this-logger-infochecking-permission-------------user_id--user-getid-tostring------------resource--resource------------action--action------------------------try-------------userroles--this-rolerepository-findbyuseruser------------------------foreach-userroles-as-role-----------------permissions--this-permissionrepository-findbyrolerole--------------------------------foreach-permissions-as-permission---------------------if-permission-matchesresource-action-------------------------this-logger-infopermission-granted-----------------------------user_id--user-getid-tostring----------------------------resource--resource----------------------------action--action----------------------------role--role-getname------------------------------------------------------------------------return-true------------------------------------------------------------------------this-logger-warningpermission-denied-----------------user_id--user-getid-tostring----------------resource--resource----------------action--action------------------------------------return-false---------------------catch-exception-e-------------this-logger-errorauthorization-error-----------------user_id--user-getid-tostring----------------resource--resource----------------action--action----------------error--e-getmessage------------------------------------return-false--------------------public-function-checkresourceaccessuser-user-string-resource-string-action-mixed-subject-bool-------------v√©rification-des-permissions-de-base--------if-this-haspermissionuser-resource-action-------------return-false-------------------------v√©rification-des-permissions-contextuelles--------if-subject-instanceof-organizationaware-------------return-this-checkorganizationaccessuser-subject------------------------if-subject-instanceof-useraware-------------return-this-checkuseraccessuser-subject------------------------return-true------------private-function-checkorganizationaccessuser-user-organizationaware-subject-bool------------userorganizations--this-getuserorganizationsuser--------subjectorganization--subject-getorganizationid----------------return-in_arraysubjectorganization-userorganizations------------private-function-checkuseraccessuser-user-useraware-subject-bool------------return-user-getid-equalssubject-getuserid-----voters-de-s√©curit√©-gyroscops-cloudphp--voters-de-s√©curit√©-gyroscops-cloud-projet-gyroscops-cloudfinal-class-paymentvoter-extends-voter----public-function-__construct--------private-hiveauthorizationservice-authorizationservice--------private-loggerinterface-logger-------------protected-function-supportsstring-attribute-mixed-subject-bool------------return-in_arrayattribute-------------payment_read------------payment_write------------payment_delete------------payment_approve------------payment_refund----------subject-instanceof-payment------------protected-function-voteonattributestring-attribute-mixed-subject-tokeninterface-token-bool------------user--token-getuser----------------if-user-instanceof-user-------------return-false------------------------this-logger-infovoting-on-payment-permission-------------user_id--user-getid-tostring------------attribute--attribute------------payment_id--subject-getid-tostring------------------------result--match-attribute-------------payment_read--this-canreaduser-subject------------payment_write--this-canwriteuser-subject------------payment_delete--this-candeleteuser-subject------------payment_approve--this-canapproveuser-subject------------payment_refund--this-canrefunduser-subject------------default--false------------------------this-logger-infovote-result-------------user_id--user-getid-tostring------------attribute--attribute------------result--result------------------------return-result------------private-function-canreaduser-user-payment-payment-bool------------return-this-authorizationservice-checkresourceaccess------------user------------payment------------read------------payment--------------------private-function-canwriteuser-user-payment-payment-bool------------return-this-authorizationservice-checkresourceaccess------------user------------payment------------write------------payment--------------------private-function-candeleteuser-user-payment-payment-bool------------return-this-authorizationservice-checkresourceaccess------------user------------payment------------delete------------payment--------------------private-function-canapproveuser-user-payment-payment-bool------------return-this-authorizationservice-checkresourceaccess------------user------------payment------------approve------------payment--------------------private-function-canrefunduser-user-payment-payment-bool------------return-this-authorizationservice-checkresourceaccess------------user------------payment------------refund------------payment-------------audit-de-s√©curit√©-gyroscops-cloudphp--audit-de-s√©curit√©-gyroscops-cloud-projet-gyroscops-cloudfinal-class-hivesecurityauditservice----public-function-__construct--------private-loggerinterface-logger--------private-securityeventrepositoryinterface-eventrepository-------------public-function-logauthenticationeventstring-userid-bool-success-array-context---void------------event--new-securityevent------------securityeventtypeauthentication------------userid------------success------------context------------------------this-eventrepository-saveevent----------------this-logger-infoauthentication-event-logged-------------user_id--userid------------success--success------------context--context--------------------public-function-logauthorizationeventstring-userid-string-resource-string-action-bool-granted-array-context---void------------event--new-securityevent------------securityeventtypeauthorization------------userid------------granted------------array_mergecontext-----------------resource--resource----------------action--action------------------------------------this-eventrepository-saveevent----------------this-logger-infoauthorization-event-logged-------------user_id--userid------------resource--resource------------action--action------------granted--granted------------context--context--------------------public-function-logsecurityviolationstring-userid-string-violationtype-array-context---void------------event--new-securityevent------------securityeventtypeviolation------------userid------------false------------array_mergecontext-----------------violation_type--violationtype------------------------------------this-eventrepository-saveevent----------------this-logger-warningsecurity-violation-logged-------------user_id--userid------------violation_type--violationtype------------context--context-------------r√©f√©rences-aux-adr-du-projet-gyroscops-cloudce-chapitre-sappuie-sur-les-architecture-decision-records-adr-suivants-du-gyroscops-cloud---hive025--authorization-system---syst√®me-dautorisation--hive026--keycloak-resource-and-scope-management---gestion-des-ressources-et-scopes--hive040--enhanced-models-with-property-access-patterns---mod√®les-enrichis-pour-la-s√©curit√©--hive041--cross-cutting-concerns-architecture---architecture-des-pr√©occupations-transversaleshahahugoshortcode9s0hbhb"&gt;üéØ Objectif de ce Chapitre### Mon Probl√®me : Comment S√©curiser une API Platform Complexe ?&lt;strong&gt;Voici ce qui s&amp;rsquo;est pass√© avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;avais une API Platform qui fonctionnait bien, mais la s√©curit√© √©tait un vrai casse-t√™te. Comment g√©rer les permissions ? Comment s√©curiser les endpoints ? Comment g√©rer l&amp;rsquo;authentification multi-tenant ?&lt;strong&gt;Mais attendez&amp;hellip;&lt;/strong&gt; Quand j&amp;rsquo;ai voulu impl√©menter une s√©curit√© robuste, j&amp;rsquo;√©tais perdu. OAuth2, JWT, RBAC, ABAC, Keycloak&amp;hellip; Tellement d&amp;rsquo;options ! Comment choisir ? Comment impl√©menter ?&lt;strong&gt;Soudain, je r√©alisais que la s√©curit√© n&amp;rsquo;√©tait pas optionnelle !&lt;/strong&gt; Il me fallait une approche structur√©e et compl√®te.### La S√©curit√© : Mon Guide CompletLa s√©curit√© dans une API Platform avec DDD m&amp;rsquo;a permis de :- &lt;strong&gt;Prot√©ger&lt;/strong&gt; les donn√©es sensibles- &lt;strong&gt;Contr√¥ler&lt;/strong&gt; l&amp;rsquo;acc√®s aux ressources- &lt;strong&gt;G√©rer&lt;/strong&gt; les permissions granulaires- &lt;strong&gt;Auditer&lt;/strong&gt; les actions utilisateurs## Qu&amp;rsquo;est-ce que la S√©curit√© dans une API Platform ?### Le Concept FondamentalLa s√©curit√© dans une API Platform consiste √† prot√©ger les ressources et contr√¥ler l&amp;rsquo;acc√®s. &lt;strong&gt;L&amp;rsquo;id√©e&lt;/strong&gt; : Chaque requ√™te doit √™tre authentifi√©e et autoris√©e avant d&amp;rsquo;acc√©der aux donn√©es.&lt;strong&gt;Avec Gyroscops, voici comment j&amp;rsquo;ai structur√© la s√©curit√©&lt;/strong&gt; :### Les 4 Piliers de la S√©curit√©#### 1. &lt;strong&gt;Authentification&lt;/strong&gt; - Qui √™tes-vous ?&lt;strong&gt;Voici comment j&amp;rsquo;ai impl√©ment√© l&amp;rsquo;authentification avec Gyroscops&lt;/strong&gt; :&lt;strong&gt;OAuth2 + JWT&lt;/strong&gt; :- Tokens JWT pour l&amp;rsquo;authentification- Refresh tokens pour la s√©curit√©- Expiration automatique des tokens&lt;strong&gt;Keycloak&lt;/strong&gt; :- Gestion centralis√©e des utilisateurs- Int√©gration OAuth2- Gestion des r√¥les et permissions#### 2. &lt;strong&gt;Autorisation&lt;/strong&gt; - Que pouvez-vous faire ?&lt;strong&gt;Voici comment j&amp;rsquo;ai impl√©ment√© l&amp;rsquo;autorisation avec Gyroscops&lt;/strong&gt; :&lt;strong&gt;RBAC (Role-Based Access Control)&lt;/strong&gt; :- R√¥les d√©finis par domaine- Permissions granulaires- Hi√©rarchie des r√¥les&lt;strong&gt;ABAC (Attribute-Based Access Control)&lt;/strong&gt; :- Contr√¥le bas√© sur les attributs- R√®gles m√©tier complexes- Contexte dynamique#### 3. &lt;strong&gt;Validation&lt;/strong&gt; - Les donn√©es sont-elles valides ?&lt;strong&gt;Voici comment j&amp;rsquo;ai impl√©ment√© la validation avec Gyroscops&lt;/strong&gt; :&lt;strong&gt;Validation des Entr√©es&lt;/strong&gt; :- Validation des donn√©es d&amp;rsquo;entr√©e- Sanitisation des donn√©es- Gestion des erreurs&lt;strong&gt;Validation des Permissions&lt;/strong&gt; :- V√©rification des permissions- Contr√¥le d&amp;rsquo;acc√®s aux ressources- Audit des actions#### 4. &lt;strong&gt;Audit&lt;/strong&gt; - Que s&amp;rsquo;est-il pass√© ?&lt;strong&gt;Voici comment j&amp;rsquo;ai impl√©ment√© l&amp;rsquo;audit avec Gyroscops&lt;/strong&gt; :&lt;strong&gt;Logging de S√©curit√©&lt;/strong&gt; :- Logs d&amp;rsquo;authentification- Logs d&amp;rsquo;autorisation- Logs d&amp;rsquo;audit&lt;strong&gt;Monitoring&lt;/strong&gt; :- D√©tection d&amp;rsquo;intrusions- Alertes de s√©curit√©- M√©triques de s√©curit√©## Comment Impl√©menter la S√©curit√©### 1. &lt;strong&gt;Configuration de l&amp;rsquo;Authentification****Avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;ai configur√© l&amp;rsquo;authentification :&lt;code&gt;yamlsecurity: providers: keycloak: id: App\Security\KeycloakUserProvider firewalls: api: pattern: ^/api stateless: true jwt: ~ access_control: - { path: ^/api/auth, roles: PUBLIC_ACCESS } - { path: ^/api, roles: ROLE_USER }&lt;/code&gt;&lt;strong&gt;R√©sultat&lt;/strong&gt; : Authentification JWT configur√©e.### 2. &lt;strong&gt;Impl√©mentation de l&amp;rsquo;Autorisation****Avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;ai impl√©ment√© l&amp;rsquo;autorisation :&lt;code&gt;php#[Route('/api/payments', methods: ['GET'])]#[IsGranted('PAYMENT_READ', subject: 'organization')]public function getPayments(Organization $organization): JsonResponse{ // Logique m√©tier}&lt;/code&gt;&lt;strong&gt;R√©sultat&lt;/strong&gt; : Autorisation bas√©e sur les permissions.### 3. &lt;strong&gt;Gestion des Permissions****Avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;ai g√©r√© les permissions :&lt;code&gt;phpfinal class PaymentVoter extends Voter{ protected function supports(string $attribute, mixed $subject): bool { return in_array($attribute, ['PAYMENT_READ', 'PAYMENT_WRITE', 'PAYMENT_DELETE']) &amp;amp;&amp;amp; $subject instanceof Payment; } protected function voteOnAttribute(string $attribute, mixed $subject, TokenInterface $token): bool { $user = $token-&amp;gt;getUser(); return match ($attribute) { 'PAYMENT_READ' =&amp;gt; $this-&amp;gt;canRead($user, $subject), 'PAYMENT_WRITE' =&amp;gt; $this-&amp;gt;canWrite($user, $subject), 'PAYMENT_DELETE' =&amp;gt; $this-&amp;gt;canDelete($user, $subject), default =&amp;gt; false }; }}&lt;/code&gt;&lt;strong&gt;R√©sultat&lt;/strong&gt; : Permissions granulaires et flexibles.### 4. &lt;strong&gt;Audit et Monitoring****Avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;ai impl√©ment√© l&amp;rsquo;audit :&lt;code&gt;phpfinal class SecurityAuditLogger{ public function logAuthentication(string $userId, bool $success): void { $this-&amp;gt;logger-&amp;gt;info('Authentication attempt', [ 'user_id' =&amp;gt; $userId, 'success' =&amp;gt; $success, 'timestamp' =&amp;gt; new \DateTimeImmutable() ]); } public function logAuthorization(string $userId, string $resource, string $action, bool $granted): void { $this-&amp;gt;logger-&amp;gt;info('Authorization check', [ 'user_id' =&amp;gt; $userId, 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action, 'granted' =&amp;gt; $granted, 'timestamp' =&amp;gt; new \DateTimeImmutable() ]); }}&lt;/code&gt;&lt;strong&gt;R√©sultat&lt;/strong&gt; : Audit complet des actions de s√©curit√©.## Les Avantages de la S√©curit√© Structur√©e### 1. &lt;strong&gt;Protection des Donn√©es****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e prot√®ge les donn√©es :- Acc√®s contr√¥l√© aux ressources- Donn√©es sensibles prot√©g√©es- Conformit√© r√©glementaire&lt;strong&gt;R√©sultat&lt;/strong&gt; : Donn√©es s√©curis√©es et conformes.### 2. &lt;strong&gt;Contr√¥le d&amp;rsquo;Acc√®s Granulaire****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e permet un contr√¥le granulaire :- Permissions par ressource- R√¥les contextuels- R√®gles m√©tier complexes&lt;strong&gt;R√©sultat&lt;/strong&gt; : Contr√¥le d&amp;rsquo;acc√®s pr√©cis et flexible.### 3. &lt;strong&gt;Audit et Conformit√©****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e facilite l&amp;rsquo;audit :- Logs complets des actions- Tra√ßabilit√© des acc√®s- Conformit√© r√©glementaire&lt;strong&gt;R√©sultat&lt;/strong&gt; : Audit complet et conformit√© assur√©e.### 4. &lt;strong&gt;√âvolutivit√©****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e est √©volutive :- Ajout facile de nouvelles permissions- Extension des r√¥les- Adaptation aux besoins m√©tier&lt;strong&gt;R√©sultat&lt;/strong&gt; : S√©curit√© √©volutive et maintenable.## Les Inconv√©nients de la S√©curit√© Structur√©e### 1. &lt;strong&gt;Complexit√© Accrue****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e ajoute de la complexit√© :- Configuration complexe- Gestion des permissions- Debugging plus difficile&lt;strong&gt;R√©sultat&lt;/strong&gt; : Courbe d&amp;rsquo;apprentissage plus importante.### 2. &lt;strong&gt;Performance****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e peut impacter les performances :- V√©rifications d&amp;rsquo;autorisation- Validation des tokens- Logs d&amp;rsquo;audit&lt;strong&gt;R√©sultat&lt;/strong&gt; : Performance potentiellement d√©grad√©e.### 3. &lt;strong&gt;Maintenance****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e n√©cessite de la maintenance :- Mise √† jour des permissions- Gestion des r√¥les- Monitoring continu&lt;strong&gt;R√©sultat&lt;/strong&gt; : Maintenance plus complexe.### 4. &lt;strong&gt;Gestion des Erreurs****Avec Gyroscops&lt;/strong&gt; : La s√©curit√© structur√©e complique la gestion des erreurs :- Erreurs d&amp;rsquo;authentification- Erreurs d&amp;rsquo;autorisation- Messages d&amp;rsquo;erreur appropri√©s&lt;strong&gt;R√©sultat&lt;/strong&gt; : Gestion d&amp;rsquo;erreurs plus complexe.## Les Pi√®ges √† √âviter### 1. &lt;strong&gt;S√©curit√© par Obscurit√©&lt;/strong&gt;**‚ùå Mauvais** : Compter sur l&amp;rsquo;obscurit√© pour la s√©curit√©**‚úÖ Bon** : S√©curit√© bas√©e sur des standards √©prouv√©s&lt;strong&gt;Pourquoi c&amp;rsquo;est important ?&lt;/strong&gt; L&amp;rsquo;obscurit√© n&amp;rsquo;est pas une s√©curit√©.### 2. &lt;strong&gt;Permissions Trop Granulaires&lt;/strong&gt;**‚ùå Mauvais** : Une permission pour chaque action**‚úÖ Bon** : Permissions par domaine m√©tier&lt;strong&gt;Pourquoi c&amp;rsquo;est crucial ?&lt;/strong&gt; Des permissions trop granulaires sont difficiles √† g√©rer.### 3. &lt;strong&gt;Ignorer l&amp;rsquo;Audit&lt;/strong&gt;**‚ùå Mauvais** : Pas d&amp;rsquo;audit des actions de s√©curit√©**‚úÖ Bon** : Audit complet des actions&lt;strong&gt;Pourquoi c&amp;rsquo;est essentiel ?&lt;/strong&gt; L&amp;rsquo;audit est essentiel pour la s√©curit√©.### 4. &lt;strong&gt;Tokens Non S√©curis√©s&lt;/strong&gt;**‚ùå Mauvais** : Tokens non s√©curis√©s ou non expir√©s**‚úÖ Bon** : Tokens s√©curis√©s avec expiration&lt;strong&gt;Pourquoi c&amp;rsquo;est la cl√© ?&lt;/strong&gt; Les tokens non s√©curis√©s sont une faille de s√©curit√©.## L&amp;rsquo;√âvolution vers la S√©curit√© Structur√©e### Phase 1 : Authentification Basique&lt;strong&gt;Avec Gyroscops&lt;/strong&gt; : Au d√©but, j&amp;rsquo;avais une authentification basique :- Login/password simple- Sessions PHP- Pas d&amp;rsquo;autorisation&lt;strong&gt;R√©sultat&lt;/strong&gt; : D√©veloppement rapide, s√©curit√© faible.### Phase 2 : Introduction de l&amp;rsquo;Autorisation&lt;strong&gt;Avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;ai introduit l&amp;rsquo;autorisation :- R√¥les basiques- Permissions simples- Contr√¥le d&amp;rsquo;acc√®s&lt;strong&gt;R√©sultat&lt;/strong&gt; : S√©curit√© am√©lior√©e, complexit√© accrue.### Phase 3 : S√©curit√© Compl√®te&lt;strong&gt;Avec Gyroscops&lt;/strong&gt; : Maintenant, j&amp;rsquo;ai une s√©curit√© compl√®te :- OAuth2 + JWT- RBAC + ABAC- Audit complet&lt;strong&gt;R√©sultat&lt;/strong&gt; : S√©curit√© robuste et √©volutive.## üèóÔ∏è Impl√©mentation Concr√®te dans le Projet Gyroscops Cloud### S√©curit√© Appliqu√©e √† Gyroscops CloudLe Gyroscops Cloud applique concr√®tement les principes de s√©curit√© √† travers son architecture et ses ADR (Architecture Decision Records). Voici comment :#### Syst√®me d&amp;rsquo;Authentification Gyroscops Cloud&lt;code&gt;php// ‚úÖ Syst√®me d'Authentification Gyroscops Cloud (Projet Gyroscops Cloud)final class HiveAuthenticationService{ public function __construct( private KeycloakClient $keycloakClient, private JwtTokenService $jwtService, private UserRepositoryInterface $userRepository, private LoggerInterface $logger ) {} public function authenticate(string $email, string $password): AuthResult { $this-&amp;gt;logger-&amp;gt;info('Authentication attempt', [ 'email' =&amp;gt; $email, 'timestamp' =&amp;gt; new \DateTimeImmutable() ]); try { $keycloakUser = $this-&amp;gt;keycloakClient-&amp;gt;authenticate($email, $password); if (!$keycloakUser) { $this-&amp;gt;logger-&amp;gt;warning('Authentication failed', [ 'email' =&amp;gt; $email, 'reason' =&amp;gt; 'Invalid credentials' ]); return AuthResult::failure('Invalid credentials'); } $user = $this-&amp;gt;userRepository-&amp;gt;findByEmail(new Email($email)); if (!$user) { $this-&amp;gt;logger-&amp;gt;warning('User not found', [ 'email' =&amp;gt; $email ]); return AuthResult::failure('User not found'); } $token = $this-&amp;gt;jwtService-&amp;gt;generateToken($user); $this-&amp;gt;logger-&amp;gt;info('Authentication successful', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'email' =&amp;gt; $email ]); return AuthResult::success($user, $token); } catch (\Exception $e) { $this-&amp;gt;logger-&amp;gt;error('Authentication error', [ 'email' =&amp;gt; $email, 'error' =&amp;gt; $e-&amp;gt;getMessage() ]); return AuthResult::failure('Authentication failed'); } } public function refreshToken(string $refreshToken): AuthResult { try { $newToken = $this-&amp;gt;jwtService-&amp;gt;refreshToken($refreshToken); $this-&amp;gt;logger-&amp;gt;info('Token refreshed successfully'); return AuthResult::success(null, $newToken); } catch (\Exception $e) { $this-&amp;gt;logger-&amp;gt;error('Token refresh failed', [ 'error' =&amp;gt; $e-&amp;gt;getMessage() ]); return AuthResult::failure('Token refresh failed'); } }}&lt;/code&gt;#### Syst√®me d&amp;rsquo;Autorisation Gyroscops Cloud&lt;code&gt;php// ‚úÖ Syst√®me d'Autorisation Gyroscops Cloud (Projet Gyroscops Cloud)final class HiveAuthorizationService{ public function __construct( private PermissionRepositoryInterface $permissionRepository, private RoleRepositoryInterface $roleRepository, private LoggerInterface $logger ) {} public function hasPermission(User $user, string $resource, string $action): bool { $this-&amp;gt;logger-&amp;gt;info('Checking permission', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action ]); try { $userRoles = $this-&amp;gt;roleRepository-&amp;gt;findByUser($user); foreach ($userRoles as $role) { $permissions = $this-&amp;gt;permissionRepository-&amp;gt;findByRole($role); foreach ($permissions as $permission) { if ($permission-&amp;gt;matches($resource, $action)) { $this-&amp;gt;logger-&amp;gt;info('Permission granted', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action, 'role' =&amp;gt; $role-&amp;gt;getName() ]); return true; } } } $this-&amp;gt;logger-&amp;gt;warning('Permission denied', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action ]); return false; } catch (\Exception $e) { $this-&amp;gt;logger-&amp;gt;error('Authorization error', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action, 'error' =&amp;gt; $e-&amp;gt;getMessage() ]); return false; } } public function checkResourceAccess(User $user, string $resource, string $action, mixed $subject): bool { // V√©rification des permissions de base if (!$this-&amp;gt;hasPermission($user, $resource, $action)) { return false; } // V√©rification des permissions contextuelles if ($subject instanceof OrganizationAware) { return $this-&amp;gt;checkOrganizationAccess($user, $subject); } if ($subject instanceof UserAware) { return $this-&amp;gt;checkUserAccess($user, $subject); } return true; } private function checkOrganizationAccess(User $user, OrganizationAware $subject): bool { $userOrganizations = $this-&amp;gt;getUserOrganizations($user); $subjectOrganization = $subject-&amp;gt;getOrganizationId(); return in_array($subjectOrganization, $userOrganizations); } private function checkUserAccess(User $user, UserAware $subject): bool { return $user-&amp;gt;getId()-&amp;gt;equals($subject-&amp;gt;getUserId()); }}&lt;/code&gt;#### Voters de S√©curit√© Gyroscops Cloud&lt;code&gt;php// ‚úÖ Voters de S√©curit√© Gyroscops Cloud (Projet Gyroscops Cloud)final class PaymentVoter extends Voter{ public function __construct( private HiveAuthorizationService $authorizationService, private LoggerInterface $logger ) {} protected function supports(string $attribute, mixed $subject): bool { return in_array($attribute, [ 'PAYMENT_READ', 'PAYMENT_WRITE', 'PAYMENT_DELETE', 'PAYMENT_APPROVE', 'PAYMENT_REFUND' ]) &amp;amp;&amp;amp; $subject instanceof Payment; } protected function voteOnAttribute(string $attribute, mixed $subject, TokenInterface $token): bool { $user = $token-&amp;gt;getUser(); if (!$user instanceof User) { return false; } $this-&amp;gt;logger-&amp;gt;info('Voting on payment permission', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'attribute' =&amp;gt; $attribute, 'payment_id' =&amp;gt; $subject-&amp;gt;getId()-&amp;gt;toString() ]); $result = match ($attribute) { 'PAYMENT_READ' =&amp;gt; $this-&amp;gt;canRead($user, $subject), 'PAYMENT_WRITE' =&amp;gt; $this-&amp;gt;canWrite($user, $subject), 'PAYMENT_DELETE' =&amp;gt; $this-&amp;gt;canDelete($user, $subject), 'PAYMENT_APPROVE' =&amp;gt; $this-&amp;gt;canApprove($user, $subject), 'PAYMENT_REFUND' =&amp;gt; $this-&amp;gt;canRefund($user, $subject), default =&amp;gt; false }; $this-&amp;gt;logger-&amp;gt;info('Vote result', [ 'user_id' =&amp;gt; $user-&amp;gt;getId()-&amp;gt;toString(), 'attribute' =&amp;gt; $attribute, 'result' =&amp;gt; $result ]); return $result; } private function canRead(User $user, Payment $payment): bool { return $this-&amp;gt;authorizationService-&amp;gt;checkResourceAccess( $user, 'payment', 'read', $payment ); } private function canWrite(User $user, Payment $payment): bool { return $this-&amp;gt;authorizationService-&amp;gt;checkResourceAccess( $user, 'payment', 'write', $payment ); } private function canDelete(User $user, Payment $payment): bool { return $this-&amp;gt;authorizationService-&amp;gt;checkResourceAccess( $user, 'payment', 'delete', $payment ); } private function canApprove(User $user, Payment $payment): bool { return $this-&amp;gt;authorizationService-&amp;gt;checkResourceAccess( $user, 'payment', 'approve', $payment ); } private function canRefund(User $user, Payment $payment): bool { return $this-&amp;gt;authorizationService-&amp;gt;checkResourceAccess( $user, 'payment', 'refund', $payment ); }}&lt;/code&gt;#### Audit de S√©curit√© Gyroscops Cloud&lt;code&gt;php// ‚úÖ Audit de S√©curit√© Gyroscops Cloud (Projet Gyroscops Cloud)final class HiveSecurityAuditService{ public function __construct( private LoggerInterface $logger, private SecurityEventRepositoryInterface $eventRepository ) {} public function logAuthenticationEvent(string $userId, bool $success, array $context = []): void { $event = new SecurityEvent( SecurityEventType::AUTHENTICATION, $userId, $success, $context ); $this-&amp;gt;eventRepository-&amp;gt;save($event); $this-&amp;gt;logger-&amp;gt;info('Authentication event logged', [ 'user_id' =&amp;gt; $userId, 'success' =&amp;gt; $success, 'context' =&amp;gt; $context ]); } public function logAuthorizationEvent(string $userId, string $resource, string $action, bool $granted, array $context = []): void { $event = new SecurityEvent( SecurityEventType::AUTHORIZATION, $userId, $granted, array_merge($context, [ 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action ]) ); $this-&amp;gt;eventRepository-&amp;gt;save($event); $this-&amp;gt;logger-&amp;gt;info('Authorization event logged', [ 'user_id' =&amp;gt; $userId, 'resource' =&amp;gt; $resource, 'action' =&amp;gt; $action, 'granted' =&amp;gt; $granted, 'context' =&amp;gt; $context ]); } public function logSecurityViolation(string $userId, string $violationType, array $context = []): void { $event = new SecurityEvent( SecurityEventType::VIOLATION, $userId, false, array_merge($context, [ 'violation_type' =&amp;gt; $violationType ]) ); $this-&amp;gt;eventRepository-&amp;gt;save($event); $this-&amp;gt;logger-&amp;gt;warning('Security violation logged', [ 'user_id' =&amp;gt; $userId, 'violation_type' =&amp;gt; $violationType, 'context' =&amp;gt; $context ]); }}&lt;/code&gt;### R√©f√©rences aux ADR du Projet Gyroscops CloudCe chapitre s&amp;rsquo;appuie sur les Architecture Decision Records (ADR) suivants du Gyroscops Cloud :- &lt;strong&gt;HIVE025&lt;/strong&gt; : Authorization System - Syst√®me d&amp;rsquo;autorisation- &lt;strong&gt;HIVE026&lt;/strong&gt; : Keycloak Resource and Scope Management - Gestion des ressources et scopes- &lt;strong&gt;HIVE040&lt;/strong&gt; : Enhanced Models with Property Access Patterns - Mod√®les enrichis pour la s√©curit√©- &lt;strong&gt;HIVE041&lt;/strong&gt; : Cross-Cutting Concerns Architecture - Architecture des pr√©occupations transversales

&lt;div class="chapter-navigation"&gt;
 &lt;h2 class="chapter-nav-title"&gt;üéØ Votre Prochaine √âtape&lt;/h2&gt;
 &lt;p class="chapter-nav-subtitle"&gt;Maintenant que vous comprenez les concepts de base et que j'ai partag√© mon exp√©rience avec Gyroscops, quel est votre contexte ?&lt;/p&gt;</description></item><item><title>Chapitre 63 : Frontend et Int√©gration - Connecter votre Interface Utilisateur</title><link>http://localhost:1313/chapitres/avances/chapitre-63-frontend-integration/</link><pubDate>Thu, 19 Dec 2024 00:00:00 +0000</pubDate><guid>http://localhost:1313/chapitres/avances/chapitre-63-frontend-integration/</guid><description>&lt;h2 id="-objectif-de-ce-chapitre"&gt;üéØ Objectif de ce Chapitre &lt;a href="#-objectif-de-ce-chapitre" class="anchor" aria-hidden="true"&gt;&lt;i class="material-icons align-middle"&gt;link&lt;/i&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3 id="mon-probl√®me--comment-int√©grer-un-frontend-avec-une-api-platform-ddd-"&gt;Mon Probl√®me : Comment Int√©grer un Frontend avec une API Platform DDD ? &lt;a href="#mon-probl%c3%a8me--comment-int%c3%a9grer-un-frontend-avec-une-api-platform-ddd-" class="anchor" aria-hidden="true"&gt;&lt;i class="material-icons align-middle"&gt;link&lt;/i&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Voici ce qui s&amp;rsquo;est pass√© avec Gyroscops&lt;/strong&gt; : J&amp;rsquo;avais une API Platform qui fonctionnait bien, mais comment cr√©er une interface utilisateur ? Comment g√©rer l&amp;rsquo;authentification c√¥t√© frontend ? Comment optimiser les performances ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mais attendez&amp;hellip;&lt;/strong&gt; Quand j&amp;rsquo;ai voulu cr√©er le frontend, j&amp;rsquo;√©tais perdu. React, Vue, Angular ? Comment g√©rer l&amp;rsquo;√©tat ? Comment optimiser les requ√™tes ? Comment g√©rer les erreurs ?&lt;/p&gt;</description></item></channel></rss>