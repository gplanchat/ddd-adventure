<!DOCTYPE html>





    

    

    

    

<html lang="fr-fr"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=41733&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <title>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming | DDD Adventure</title>
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Découvrir le Domain-Driven Design d&#39;Eric Evans, l&#39;Event Storming et l&#39;Example Mapping pour révéler la complexité métier">
    <meta name="keywords" content="Documentation, Hugo, Hugo Theme, Bootstrap" />
    <meta name="author" content="Colin Wilson - Lotus Labs" />
    <meta name="email" content="support@aigis.uk" />
    <meta name="website" content="https://lotusdocs.dev" />
    <meta name="Version" content="v0.1.0" />
    
    <link rel="icon" href="//localhost:41733/favicon.ico" sizes="any">
<link rel="icon" type="image/svg+xml" href="//localhost:41733/favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="//localhost:41733/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="//localhost:41733/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="//localhost:41733/favicon-16x16.png">
<link rel="manifest" crossorigin="use-credentials" href="//localhost:41733/site.webmanifest">
<meta property="og:title" content="Chapitre 1 : Introduction au Domain-Driven Design et Event Storming" />
<meta property="og:description" content="Découvrir le Domain-Driven Design d&#39;Eric Evans, l&#39;Event Storming et l&#39;Example Mapping pour révéler la complexité métier" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:41733/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/" /><meta property="og:image" content="//localhost:41733/opengraph/card-base-2_hu_24199e2a69348535.png"/><meta property="article:section" content="chapitres" />
<meta property="article:published_time" content="2024-12-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-12-19T00:00:00+00:00" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="//localhost:41733/opengraph/card-base-2_hu_24199e2a69348535.png"/>
<meta name="twitter:title" content="Chapitre 1 : Introduction au Domain-Driven Design et Event Storming"/>
<meta name="twitter:description" content="Découvrir le Domain-Driven Design d&#39;Eric Evans, l&#39;Event Storming et l&#39;Example Mapping pour révéler la complexité métier"/>

    
        <link rel="alternate" type="application/atom+xml" title="Atom feed for DDD Adventure" href="/index.xml" />
    
    
    
            
                <script type="text/javascript" src="//localhost:41733/docs/js/flexsearch.bundle.js"></script>
            
        
    
    

    <link rel="stylesheet" href="/docs/scss/style.css" crossorigin="anonymous">
    
    
    </head>
<body>
        <div class="content">
            <div class="page-wrapper toggled">
<nav id="sidebar" class="sidebar-wrapper">
    <div class="sidebar-brand">
        <a href='/' aria-label="HomePage" alt="HomePage">
            
                <?xml version="1.0" encoding="UTF-8"?><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><path d="m143,39.5c-18,0-18,18-18,18,0,0,0-18-18-18H22c-2.76,0-5,2.24-5,5v143c0,2.76,2.24,5,5,5h76c7.2,0,8.64,11.52,8.93,16.13.07,1.05.95,1.87,2,1.87h32.14c1.06,0,1.94-.82,2-1.87.29-4.61,1.73-16.13,8.93-16.13h76c2.76,0,5-2.24,5-5V44.5c0-2.76-2.24-5-5-5h-85Zm63,123.5c0,1.38-1.12,2.5-2.5,2.5h-60.5c-18,0-18,18-18,18,0,0,0-18-18-18h-60.5c-1.38,0-2.5-1.12-2.5-2.5v-94c0-1.38,1.12-2.5,2.5-2.5h51.5c7.2,0,8.64,11.52,8.93,16.13.07,1.05.95,1.87,2,1.87h32.14c1.06,0,1.94-.82,2-1.87.29-4.61,1.73-16.13,8.93-16.13h51.5c1.38,0,2.5,1.12,2.5,2.5v94Z" style="fill:#06f;"/></svg>
            
        </a>
    </div>
    <div class="sidebar-content" style="height: calc(100% - 131px);">
        <ul class="sidebar-menu">
            
                
                
                    
                    
                        <li class="sidebar-dropdown no-icon current active">
                            <button class="btn">
                                Chapitres Fondamentaux
                            </button>
                            <div class="sidebar-submenu d-block">
                                <ul>
                                    
                                        
                                        
                                            <li class="current no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/">Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-02-impact-mapping/">Chapitre 2 : L&#39;Impact Mapping - Aligner le Produit sur les Objectifs Business</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-03-atelier-event-storming/">Chapitre 3 : L&#39;Atelier Event Storming - Guide Pratique</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-04-example-mapping/">Chapitre 4 : L&#39;Example Mapping - Détailer les Règles Métier</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-05-complexite-accidentelle-essentielle/">Chapitre 5 : Complexité Accidentelle vs Essentielle - Le Choix Architectural</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-06-granularite-choix-architecturaux/">Chapitre 6 : Granularité des Choix Architecturaux</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-07-modeles-riches-vs-anemiques/">Chapitre 7 : Modèles Riches vs Modèles Anémiques</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-08-architecture-evenementielle/">Chapitre 8 : Architecture Événementielle</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-09-repositories-persistance/">Chapitre 9 : Repositories et Persistance</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/fondamentaux/chapitre-10-choix-type-stockage/">Chapitre 15 : Choix du Type de Stockage</a></li>
                                        
                                    
                                </ul>
                            </div>
                        </li>
                    
                
                    
                    
                        <li class="sidebar-dropdown no-icon ">
                            <button class="btn">
                                Chapitres Optionnels
                            </button>
                            <div class="sidebar-submenu ">
                                <ul>
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/optionnels/chapitre-13-architecture-cqrs/">Chapitre 15 : Architecture CQRS avec API Platform</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/optionnels/chapitre-12-architecture-cqs/">Chapitre 15 : Architecture CQS - Command Query Separation</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/optionnels/chapitre-11-event-sourcing/">Chapitre 15 : Event Sourcing - La Source de Vérité</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/optionnels/chapitre-14-cqrs-event-sourcing-combines/">Chapitre 15 : CQRS &#43; Event Sourcing Combinés</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/optionnels/chapitre-15-projections-event-sourcing/">Chapitre 15 : Projections Event Sourcing</a></li>
                                        
                                    
                                </ul>
                            </div>
                        </li>
                    
                
                    
                    
                        <li class="sidebar-dropdown no-icon ">
                            <button class="btn">
                                Chapitres de Stockage
                            </button>
                            <div class="sidebar-submenu ">
                                <ul>
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage SQL
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/sql/chapitre-16-stockage-sql-classique/">Chapitre 16 : Stockage SQL - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/sql/chapitre-17-stockage-sql-cqs/">Chapitre 17 : Stockage SQL - Approche CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/sql/chapitre-18-stockage-sql-cqrs/">Chapitre 18 : Stockage SQL - Approche CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/sql/chapitre-19-stockage-sql-event-sourcing/">Chapitre 19 : Stockage SQL - Event Sourcing Seul</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/sql/chapitre-20-stockage-sql-event-sourcing-cqs/">Chapitre 58 : Stockage SQL - Event Sourcing &#43; CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/sql/chapitre-21-stockage-sql-event-sourcing-cqrs/">Chapitre 59 : Stockage SQL - Event Sourcing &#43; CQRS</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage API
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/api/chapitre-26-stockage-api-event-sourcing-cqs/">Chapitre 26 : Stockage API - Event Sourcing &#43; CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/api/chapitre-27-stockage-api-event-sourcing-cqrs/">Chapitre 27 : Stockage API - Event Sourcing &#43; CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/api/chapitre-22-stockage-api-classique/">Chapitre 60 : Stockage API - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/api/chapitre-23-stockage-api-cqs/">Chapitre 61 : Stockage API - Approche CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/api/chapitre-24-stockage-api-cqrs/">Chapitre 62 : Stockage API - Approche CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/api/chapitre-25-stockage-api-event-sourcing/">Chapitre 63 : Stockage API - Event Sourcing Seul</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage MongoDB
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/mongodb/chapitre-28-stockage-mongodb-classique/">Chapitre 28 : Stockage MongoDB - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/mongodb/chapitre-29-stockage-mongodb-cqs/">Chapitre 29 : Stockage MongoDB - Approche CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/mongodb/chapitre-30-stockage-mongodb-cqrs/">Chapitre 30 : Stockage MongoDB - Approche CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/mongodb/chapitre-31-stockage-mongodb-event-sourcing/">Chapitre 31 : Stockage MongoDB - Event Sourcing</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/mongodb/chapitre-32-stockage-mongodb-event-sourcing-cqs/">Stockage MongoDB - Event Sourcing &#43; CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/mongodb/chapitre-33-stockage-mongodb-event-sourcing-cqrs/">Stockage MongoDB - Event Sourcing &#43; CQRS</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage ElasticSearch
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/elasticsearch/chapitre-34-stockage-elasticsearch-classique/">Stockage ElasticSearch - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/elasticsearch/chapitre-35-stockage-elasticsearch-cqs/">Stockage ElasticSearch - CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/elasticsearch/chapitre-36-stockage-elasticsearch-cqrs/">Stockage ElasticSearch - CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/elasticsearch/chapitre-37-stockage-elasticsearch-event-sourcing/">Stockage ElasticSearch - Event Sourcing</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/elasticsearch/chapitre-38-stockage-elasticsearch-event-sourcing-cqs/">Stockage ElasticSearch - Event Sourcing &#43; CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/elasticsearch/chapitre-39-stockage-elasticsearch-event-sourcing-cqrs/">Stockage ElasticSearch - Event Sourcing &#43; CQRS</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage In-Memory
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/in-memory/chapitre-40-stockage-in-memory-classique/">Stockage In-Memory - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/in-memory/chapitre-41-stockage-in-memory-cqs/">Stockage In-Memory - CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/in-memory/chapitre-42-stockage-in-memory-cqrs/">Stockage In-Memory - CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/in-memory/chapitre-43-stockage-in-memory-event-sourcing/">Stockage In-Memory - Event Sourcing</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/in-memory/chapitre-44-stockage-in-memory-event-sourcing-cqs/">Stockage In-Memory - Event Sourcing &#43; CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/in-memory/chapitre-45-stockage-in-memory-event-sourcing-cqrs/">Stockage In-Memory - Event Sourcing &#43; CQRS</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage Composite piloté par Temporal
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/temporal/chapitre-46-stockage-temporal-classique/">Stockage Temporal - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/temporal/chapitre-47-stockage-temporal-cqs/">Stockage Temporal - CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/temporal/chapitre-48-stockage-temporal-cqrs/">Stockage Temporal - CQRS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/temporal/chapitre-49-stockage-temporal-event-sourcing/">Stockage Temporal - Event Sourcing</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/temporal/chapitre-50-stockage-temporal-event-sourcing-cqs/">Stockage Temporal - Event Sourcing &#43; CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/temporal/chapitre-51-stockage-temporal-event-sourcing-cqrs/">Stockage Temporal - Event Sourcing &#43; CQRS</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                        
                                        
                                            <li class="sidebar-dropdown nested no-icon ">
                                                <button class="btn">
                                                    Stockage Multi-sources
                                                </button>
                                                <div class="sidebar-submenu ">
                                                    <ul>
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/multi-sources/chapitre-52-stockage-multi-sources-classique/">Stockage Multi-sources - Approche Classique</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/multi-sources/chapitre-53-stockage-multi-sources-cqs/">Stockage Multi-sources - CQS</a></li>
                                                            
                                                        
                                                            
                                                            
                                                                <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/stockage/multi-sources/chapitre-54-stockage-multi-sources-cqrs/">Stockage Multi-sources - CQRS</a></li>
                                                            
                                                        
                                                    </ul>
                                                </div>
                                            </li>
                                        
                                    
                                </ul>
                            </div>
                        </li>
                    
                
                    
                    
                        <li class="sidebar-dropdown no-icon ">
                            <button class="btn">
                                Chapitres Techniques
                            </button>
                            <div class="sidebar-submenu ">
                                <ul>
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/techniques/chapitre-58-gestion-donnees-validation/">Chapitre 58 : Gestion des Données et Validation</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/techniques/chapitre-59-pagination-performance/">Chapitre 59 : Pagination et Performance</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/techniques/chapitre-60-gestion-erreurs-observabilite/">Chapitre 60 : Gestion d&#39;Erreurs et Observabilité</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/techniques/chapitre-61-tests-qualite/">Chapitre 61 : Tests et Qualité</a></li>
                                        
                                    
                                </ul>
                            </div>
                        </li>
                    
                
                    
                    
                        <li class="sidebar-dropdown no-icon ">
                            <button class="btn">
                                Chapitres Avancés
                            </button>
                            <div class="sidebar-submenu ">
                                <ul>
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/avances/chapitre-62-securite-autorisation/">Chapitre 62 : Sécurité et Autorisation - Protéger votre API Platform</a></li>
                                        
                                    
                                        
                                        
                                            <li class=" no-icon"><a class="sidebar-nested-link" href="//localhost:41733/chapitres/avances/chapitre-63-frontend-integration/">Chapitre 63 : Frontend et Intégration - Connecter votre Interface Utilisateur</a></li>
                                        
                                    
                                </ul>
                            </div>
                        </li>
                    
                
            
        </ul>
        
    </div>
    
        <ul class="sidebar-footer list-unstyled mb-0">
            
        </ul>
    
</nav>

                    <main class="page-content bg-transparent">
                        
<div id="top-header" class="top-header d-print-none">
    <div class="header-bar d-flex justify-content-between">
        <div class="d-flex align-items-center">
            <a href='/' class="logo-icon me-3" aria-label="HomePage" alt="HomePage">
                <div class="small">
                    
                            <?xml version="1.0" encoding="UTF-8"?><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><path d="m143,39.5c-18,0-18,18-18,18,0,0,0-18-18-18H22c-2.76,0-5,2.24-5,5v143c0,2.76,2.24,5,5,5h76c7.2,0,8.64,11.52,8.93,16.13.07,1.05.95,1.87,2,1.87h32.14c1.06,0,1.94-.82,2-1.87.29-4.61,1.73-16.13,8.93-16.13h76c2.76,0,5-2.24,5-5V44.5c0-2.76-2.24-5-5-5h-85Zm63,123.5c0,1.38-1.12,2.5-2.5,2.5h-60.5c-18,0-18,18-18,18,0,0,0-18-18-18h-60.5c-1.38,0-2.5-1.12-2.5-2.5v-94c0-1.38,1.12-2.5,2.5-2.5h51.5c7.2,0,8.64,11.52,8.93,16.13.07,1.05.95,1.87,2,1.87h32.14c1.06,0,1.94-.82,2-1.87.29-4.61,1.73-16.13,8.93-16.13h51.5c1.38,0,2.5,1.12,2.5,2.5v94Z" style="fill:#06f;"/></svg>
                    
                </div>
                <div class="big">
                    
                            <?xml version="1.0" encoding="UTF-8"?><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><path d="m143,39.5c-18,0-18,18-18,18,0,0,0-18-18-18H22c-2.76,0-5,2.24-5,5v143c0,2.76,2.24,5,5,5h76c7.2,0,8.64,11.52,8.93,16.13.07,1.05.95,1.87,2,1.87h32.14c1.06,0,1.94-.82,2-1.87.29-4.61,1.73-16.13,8.93-16.13h76c2.76,0,5-2.24,5-5V44.5c0-2.76-2.24-5-5-5h-85Zm63,123.5c0,1.38-1.12,2.5-2.5,2.5h-60.5c-18,0-18,18-18,18,0,0,0-18-18-18h-60.5c-1.38,0-2.5-1.12-2.5-2.5v-94c0-1.38,1.12-2.5,2.5-2.5h51.5c7.2,0,8.64,11.52,8.93,16.13.07,1.05.95,1.87,2,1.87h32.14c1.06,0,1.94-.82,2-1.87.29-4.61,1.73-16.13,8.93-16.13h51.5c1.38,0,2.5,1.12,2.5,2.5v94Z" style="fill:#06f;"/></svg>
                    
                </div>
            </a>
            <button id="close-sidebar" class="btn btn-icon btn-soft">
                <span class="material-icons size-20 menu-icon align-middle">menu</span>
            </button>
            
            
                    
                    <button id="flexsearch-button" class="ms-3 btn btn-soft" data-bs-toggle="collapse" data-bs-target="#FlexSearchCollapse" aria-expanded="false" aria-controls="FlexSearchCollapse">
                        <span class="material-icons size-20 menu-icon align-middle">search</span>
                        <span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span>
                        <div class="d-none d-sm-block">
                            <span class="flexsearch-button-keys">
                                <kbd class="flexsearch-button-cmd-key">
                                    <svg width="44" height="15"><path d="M2.118,11.5A1.519,1.519,0,0,1,1,11.042,1.583,1.583,0,0,1,1,8.815a1.519,1.519,0,0,1,1.113-.458h.715V6.643H2.118A1.519,1.519,0,0,1,1,6.185,1.519,1.519,0,0,1,.547,5.071,1.519,1.519,0,0,1,1,3.958,1.519,1.519,0,0,1,2.118,3.5a1.519,1.519,0,0,1,1.114.458A1.519,1.519,0,0,1,3.69,5.071v.715H5.4V5.071A1.564,1.564,0,0,1,6.976,3.5,1.564,1.564,0,0,1,8.547,5.071,1.564,1.564,0,0,1,6.976,6.643H6.261V8.357h.715a1.575,1.575,0,0,1,1.113,2.685,1.583,1.583,0,0,1-2.227,0A1.519,1.519,0,0,1,5.4,9.929V9.214H3.69v.715a1.519,1.519,0,0,1-.458,1.113A1.519,1.519,0,0,1,2.118,11.5Zm0-.857a.714.714,0,0,0,.715-.714V9.214H2.118a.715.715,0,1,0,0,1.429Zm4.858,0a.715.715,0,1,0,0-1.429H6.261v.715a.714.714,0,0,0,.715.714ZM3.69,8.357H5.4V6.643H3.69ZM2.118,5.786h.715V5.071a.714.714,0,0,0-.715-.714.715.715,0,0,0-.5,1.22A.686.686,0,0,0,2.118,5.786Zm4.143,0h.715a.715.715,0,0,0,.5-1.22.715.715,0,0,0-1.22.5Z" fill="currentColor"></path><path d="M12.4,11.475H11.344l3.879-7.95h1.056Z" fill="currentColor"></path><path d="M25.073,5.384l-.864.576a2.121,2.121,0,0,0-1.786-.923,2.207,2.207,0,0,0-2.266,2.326,2.206,2.206,0,0,0,2.266,2.325,2.1,2.1,0,0,0,1.782-.918l.84.617a3.108,3.108,0,0,1-2.622,1.293,3.217,3.217,0,0,1-3.349-3.317,3.217,3.217,0,0,1,3.349-3.317A3.046,3.046,0,0,1,25.073,5.384Z" fill="currentColor"></path><path d="M30.993,5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172Z" fill="currentColor"></path><path d="M34.67,4.164c1.471,0,2.266.658,2.266,1.851,0,1.087-.832,1.809-2.134,1.855l2.107,2.691h-1.28L33.591,7.87H33.07v2.691H32.038v-6.4Zm-1.6.969v1.8h1.572c.832,0,1.22-.3,1.22-.918s-.411-.882-1.22-.882Z" fill="currentColor"></path><path d="M42.883,10.561H38.31v-6.4h1.033V9.583h3.54Z" fill="currentColor"></path></svg>
                                </kbd>
                                <kbd class="flexsearch-button-key">
                                    <svg width="15" height="15"><path d="M5.926,12.279H4.41L9.073,2.721H10.59Z" fill="currentColor"/></svg>
                                </kbd>
                            </span>
                        </div>
                    </button>
                
            </div>

        <div class="d-flex align-items-center">
            <ul class="list-unstyled mb-0">
                
            </ul>
            
        </div>
    </div>
    
    
            <div class="collapse" id="FlexSearchCollapse">
                <div class="flexsearch-container">
                    <div class="flexsearch-keymap">
                        <li>
                            <kbd class="flexsearch-button-cmd-key"><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8M10.5 8.5l-3 3-3-3"></path></g></svg></kbd>
                            <kbd class="flexsearch-button-cmd-key"><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8M10.5 6.5l-3-3-3 3"></path></g></svg></kbd>
                            <span class="flexsearch-key-label">to navigate</span>
                        </li>
                        <li>
                            <kbd class="flexsearch-button-cmd-key"><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4M7 11.53088l-3-3 3-3"></path></g></svg></kbd>
                            <span class="flexsearch-key-label">to select</span>
                        </li>
                        <li>
                            <kbd class="flexsearch-button-cmd-key"><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956"></path></g></svg></kbd>
                            <span class="flexsearch-key-label">to close</span>
                        </li>
                    </div>
                    <form class="flexsearch position-relative flex-grow-1 ms-2 me-2">
                        <div class="d-flex flex-row">
                            <input id="flexsearch" class="form-control" type="search" placeholder="Search" aria-label="Search" autocomplete="off">
                            <button id="hideFlexsearch" type="button" class="ms-2 btn btn-soft">
                                cancel
                            </button>
                        </div>
                        <div id="suggestions" class="shadow rounded-1 d-none"></div>
                    </form>
                </div>
            </div>
        
    
    
</div>


                            <div class="container-fluid">
                                <div class="layout-spacing">
                                    
                                        <div class="d-md-flex justify-content-between align-items-center"><nav aria-label="breadcrumb" class="d-inline-block pb-2 mt-1 mt-sm-0">
    <ul id="breadcrumbs" class="breadcrumb bg-transparent mb-0" itemscope itemtype="https://schema.org/BreadcrumbList">
        
            
                <li class="breadcrumb-item text-capitalize active" aria-current="page" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a itemprop="item" href="/chapitres/">
                        <i class="material-icons size-20 align-text-bottom" itemprop="name">Home</i>
                    </a>
                    <meta itemprop="position" content='1' />
                </li>
            
            
                <li class="breadcrumb-item text-capitalize" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a itemprop="item" href="/chapitres/fondamentaux/">
                        <span itemprop="name">Chapitres Fondamentaux</span>
                    </a>
                    <meta itemprop="position" content='2' />
                </li>
            
        
            <li class="breadcrumb-item text-capitalize active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <span itemprop="name">Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</span>
                <meta itemprop="position" content='3' />
            </li>
        
    </ul>
</nav></div>
                                    
                                    <div class="row flex-xl-nowrap">
                                        
                                        <div class="docs-toc col-xl-3    d-xl-block"><toc>
    <div class="fw-bold text-uppercase mb-2">On this page</div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#-objectif-de-ce-chapitre">🎯 Objectif de ce Chapitre</a>
      <ul>
        <li><a href="#un-récit-personnel">Un Récit Personnel</a></li>
        <li><a href="#la-complexité-qui-sinstalle">La Complexité qui s&rsquo;installe</a></li>
        <li><a href="#ce-chapitre-change-la-donne">Ce Chapitre Change la Donne</a></li>
        <li><a href="#savoir-bien-structurer-son-monolithe-modulaire">Savoir bien structurer son monolithe modulaire</a></li>
      </ul>
    </li>
    <li><a href="#le-domain-driven-design--une-approche-centrée-sur-le-métier">Le Domain-Driven Design : Une Approche Centrée sur le Métier</a>
      <ul>
        <li><a href="#les-fondements-selon-eric-evans">Les Fondements selon Eric Evans</a></li>
        <li><a href="#les-concepts-clés-du-ddd">Les Concepts Clés du DDD</a></li>
        <li><a href="#exemple-concret--un-système-de-paiement">Exemple Concret : Un Système de Paiement</a></li>
      </ul>
    </li>
    <li><a href="#pourquoi-le-crud-limite-vos-mouvements">Pourquoi le CRUD limite vos mouvements</a>
      <ul>
        <li><a href="#mon-piège--la-simplicité-apparente-du-crud">Mon Piège : La Simplicité Apparente du CRUD</a></li>
        <li><a href="#le-piège-du-crud">Le Piège du CRUD</a></li>
        <li><a href="#la-solution--des-commandes-métier">La Solution : Des Commandes Métier</a></li>
      </ul>
    </li>
    <li><a href="#pourquoi-les-modèles-anémiques-vous-empêchent-davancer-plus-vite">Pourquoi les modèles anémiques vous empêchent d&rsquo;avancer plus vite</a>
      <ul>
        <li><a href="#mon-illusion--la-séparation-des-responsabilités">Mon Illusion : La Séparation des Responsabilités</a></li>
        <li><a href="#mon-piège--les-modèles-anémiques">Mon Piège : Les Modèles Anémiques</a></li>
        <li><a href="#la-solution--des-modèles-riches">La Solution : Des Modèles Riches</a></li>
        <li><a href="#mapper-entre-agrégat-et-entité-doctrine"><strong>Mapper entre Agrégat et Entité Doctrine</strong></a></li>
      </ul>
    </li>
    <li><a href="#levent-storming--révéler-la-complexité-métier">L&rsquo;Event Storming : Révéler la Complexité Métier</a>
      <ul>
        <li><a href="#mon-problème--je-ne-voyais-que-la-pointe-de-liceberg">Mon Problème : Je Ne Voyais Que la Pointe de l&rsquo;Iceberg</a></li>
        <li><a href="#quest-ce-que-levent-storming-">Qu&rsquo;est-ce que l&rsquo;Event Storming ?</a></li>
        <li><a href="#pourquoi-levent-storming-">Pourquoi l&rsquo;Event Storming ?</a></li>
        <li><a href="#les-7-étapes-de-levent-storming">Les 7 Étapes de l&rsquo;Event Storming</a></li>
        <li><a href="#exemple-devent-storming--système-de-paiement">Exemple d&rsquo;Event Storming : Système de Paiement</a></li>
      </ul>
    </li>
    <li><a href="#lexample-mapping--détailer-les-règles-métier">L&rsquo;Example Mapping : Détailer les Règles Métier</a>
      <ul>
        <li><a href="#mon-problème--les-règles-métier-cachées">Mon Problème : Les Règles Métier Cachées</a></li>
        <li><a href="#quest-ce-que-lexample-mapping-">Qu&rsquo;est-ce que l&rsquo;Example Mapping ?</a></li>
        <li><a href="#pourquoi-lexample-mapping-">Pourquoi l&rsquo;Example Mapping ?</a></li>
        <li><a href="#les-4-types-de-cartes">Les 4 Types de Cartes</a></li>
        <li><a href="#exemple-dexample-mapping--traitement-dun-paiement">Exemple d&rsquo;Example Mapping : Traitement d&rsquo;un Paiement</a></li>
        <li><a href="#comment-utiliser-lexample-mapping">Comment Utiliser l&rsquo;Example Mapping</a></li>
        <li><a href="#exemple-concret--règles-de-paiement">Exemple Concret : Règles de Paiement</a></li>
        <li><a href="#avantages-de-lexample-mapping">Avantages de l&rsquo;Example Mapping</a></li>
      </ul>
    </li>
    <li><a href="#architecture-résultante">Architecture Résultante</a>
      <ul>
        <li><a href="#structure-par-bounded-context">Structure par Bounded Context</a></li>
        <li><a href="#le-monolithe-modulaire--la-vraie-solution">Le Monolithe Modulaire : La Vraie Solution</a></li>
        <li><a href="#références-aux-adr-du-projet-gyroscops-cloud">Références aux ADR du projet Gyroscops Cloud</a></li>
        <li><a href="#intégration-avec-api-platform">Intégration avec API Platform</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </toc></div>
                                        
                                        
                                        <div class="docs-toc-mobile    d-print-none d-xl-none">
                                            <button id="toc-dropdown-btn" class="btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" data-bs-offset="0,0" aria-expanded="false">
                                                Table of Contents
                                            </button>
<nav id="toc-mobile">
  <ul class="dropdown-menu">
    <li><a href="#-objectif-de-ce-chapitre">🎯 Objectif de ce Chapitre</a>
      <ul>
        <li><a href="#un-récit-personnel">Un Récit Personnel</a></li>
        <li><a href="#la-complexité-qui-sinstalle">La Complexité qui s&rsquo;installe</a></li>
        <li><a href="#ce-chapitre-change-la-donne">Ce Chapitre Change la Donne</a></li>
        <li><a href="#savoir-bien-structurer-son-monolithe-modulaire">Savoir bien structurer son monolithe modulaire</a></li>
      </ul>
    </li>
    <li><a href="#le-domain-driven-design--une-approche-centrée-sur-le-métier">Le Domain-Driven Design : Une Approche Centrée sur le Métier</a>
      <ul>
        <li><a href="#les-fondements-selon-eric-evans">Les Fondements selon Eric Evans</a></li>
        <li><a href="#les-concepts-clés-du-ddd">Les Concepts Clés du DDD</a></li>
        <li><a href="#exemple-concret--un-système-de-paiement">Exemple Concret : Un Système de Paiement</a></li>
      </ul>
    </li>
    <li><a href="#pourquoi-le-crud-limite-vos-mouvements">Pourquoi le CRUD limite vos mouvements</a>
      <ul>
        <li><a href="#mon-piège--la-simplicité-apparente-du-crud">Mon Piège : La Simplicité Apparente du CRUD</a></li>
        <li><a href="#le-piège-du-crud">Le Piège du CRUD</a></li>
        <li><a href="#la-solution--des-commandes-métier">La Solution : Des Commandes Métier</a></li>
      </ul>
    </li>
    <li><a href="#pourquoi-les-modèles-anémiques-vous-empêchent-davancer-plus-vite">Pourquoi les modèles anémiques vous empêchent d&rsquo;avancer plus vite</a>
      <ul>
        <li><a href="#mon-illusion--la-séparation-des-responsabilités">Mon Illusion : La Séparation des Responsabilités</a></li>
        <li><a href="#mon-piège--les-modèles-anémiques">Mon Piège : Les Modèles Anémiques</a></li>
        <li><a href="#la-solution--des-modèles-riches">La Solution : Des Modèles Riches</a></li>
        <li><a href="#mapper-entre-agrégat-et-entité-doctrine"><strong>Mapper entre Agrégat et Entité Doctrine</strong></a></li>
      </ul>
    </li>
    <li><a href="#levent-storming--révéler-la-complexité-métier">L&rsquo;Event Storming : Révéler la Complexité Métier</a>
      <ul>
        <li><a href="#mon-problème--je-ne-voyais-que-la-pointe-de-liceberg">Mon Problème : Je Ne Voyais Que la Pointe de l&rsquo;Iceberg</a></li>
        <li><a href="#quest-ce-que-levent-storming-">Qu&rsquo;est-ce que l&rsquo;Event Storming ?</a></li>
        <li><a href="#pourquoi-levent-storming-">Pourquoi l&rsquo;Event Storming ?</a></li>
        <li><a href="#les-7-étapes-de-levent-storming">Les 7 Étapes de l&rsquo;Event Storming</a></li>
        <li><a href="#exemple-devent-storming--système-de-paiement">Exemple d&rsquo;Event Storming : Système de Paiement</a></li>
      </ul>
    </li>
    <li><a href="#lexample-mapping--détailer-les-règles-métier">L&rsquo;Example Mapping : Détailer les Règles Métier</a>
      <ul>
        <li><a href="#mon-problème--les-règles-métier-cachées">Mon Problème : Les Règles Métier Cachées</a></li>
        <li><a href="#quest-ce-que-lexample-mapping-">Qu&rsquo;est-ce que l&rsquo;Example Mapping ?</a></li>
        <li><a href="#pourquoi-lexample-mapping-">Pourquoi l&rsquo;Example Mapping ?</a></li>
        <li><a href="#les-4-types-de-cartes">Les 4 Types de Cartes</a></li>
        <li><a href="#exemple-dexample-mapping--traitement-dun-paiement">Exemple d&rsquo;Example Mapping : Traitement d&rsquo;un Paiement</a></li>
        <li><a href="#comment-utiliser-lexample-mapping">Comment Utiliser l&rsquo;Example Mapping</a></li>
        <li><a href="#exemple-concret--règles-de-paiement">Exemple Concret : Règles de Paiement</a></li>
        <li><a href="#avantages-de-lexample-mapping">Avantages de l&rsquo;Example Mapping</a></li>
      </ul>
    </li>
    <li><a href="#architecture-résultante">Architecture Résultante</a>
      <ul>
        <li><a href="#structure-par-bounded-context">Structure par Bounded Context</a></li>
        <li><a href="#le-monolithe-modulaire--la-vraie-solution">Le Monolithe Modulaire : La Vraie Solution</a></li>
        <li><a href="#références-aux-adr-du-projet-gyroscops-cloud">Références aux ADR du projet Gyroscops Cloud</a></li>
        <li><a href="#intégration-avec-api-platform">Intégration avec API Platform</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
                                        <div class="docs-content col-12 col-xl-9 mt-0">
                                            <div class="mb-0 d-flex">
                                                
                                                <h1 class="content-title mb-0">
                                                    Chapitre 1 : Introduction au Domain-Driven Design et Event Storming
                                                    
                                                </h1>
                                            </div>
                                            
                                            <div id="content" class="main-content" >
                                                
    
    <div data-prismjs-copy="" data-prismjs-copy-success="" data-prismjs-copy-error="">
        <h2 id="-objectif-de-ce-chapitre">🎯 Objectif de ce Chapitre <a href="#-objectif-de-ce-chapitre" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="un-récit-personnel">Un Récit Personnel <a href="#un-r%c3%a9cit-personnel" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Il est 17h30, je viens de passer 3 heures dans xdebug pour un bug qui semblait simple. Le problème ? Une modification
dans une partie du code a cassé quelque chose dans une autre partie, à des kilomètres de là. Je me demande : &ldquo;Comment en
sommes-nous arrivés là ?&rdquo;</p>
<p><strong>Cette situation vous dit quelque chose ?</strong></p>
<p>Moi, je l&rsquo;ai vécue des dizaines de fois :</p>
<ul>
<li>J&rsquo;ajoute une fonctionnalité et 3 autres se cassent</li>
<li>Chaque modification nécessite de toucher à 5 fichiers différents</li>
<li>Je ne comprends plus pourquoi le code fait ce qu&rsquo;il fait</li>
<li>Les tests passent mais l&rsquo;application ne fonctionne pas comme attendu</li>
<li>J&rsquo;ai peur de modifier du code &ldquo;qui marche&rdquo;</li>
</ul>
<h3 id="la-complexité-qui-sinstalle">La Complexité qui s&rsquo;installe <a href="#la-complexit%c3%a9-qui-sinstalle" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Ce n&rsquo;était pas de ma faute. Mon projet Gyroscops a commencé avec de bonnes intentions : une architecture simple, du code
propre, des tests. Mais quelque part sur le chemin, la complexité s&rsquo;est installée insidieusement. Elle se cachait
derrière des noms de variables trompeurs ou simplistes, des méthodes qui faisaient trop de choses, des dépendances
cachées.</p>
<p><strong>Le problème fondamental ?</strong> J&rsquo;ai construit mon logiciel comme si le métier était simple. Lorsque l&rsquo;on démarre un
projet, on a une vision partielle de ce qui sera nécessaire. De fait, j&rsquo;ai essayé de forcer la réalité métier dans des
structures techniques rigides, et cela a fini par rendre la maintenance insoutenable. Pour ajouter à cette complexité
existante, nous avons voulu fournir notre service sous la forme de SaaS, ce qui a ajouté un niveau de complexité
technique supplémentaire.</p>
<p><strong>Le résultat ?</strong> J&rsquo;ai dû bloquer toutes les évolutions du produit pendant 2 mois pour remettre l&rsquo;application dans un
état qui soit plus facile à maintenir.</p>
<h3 id="ce-chapitre-change-la-donne">Ce Chapitre Change la Donne <a href="#ce-chapitre-change-la-donne" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Ce chapitre pose les fondations de l&rsquo;approche que l&rsquo;on a développée pour éviter de retomber dans ces pièges :</p>
<ul>
<li><strong>Les principes fondamentaux</strong> du Domain-Driven Design selon Eric Evans</li>
<li><strong>Pourquoi le CRUD limite vos mouvements</strong> et vous fait perdre du temps</li>
<li><strong>Pourquoi les modèles anémiques</strong> vous empêchent d&rsquo;avancer plus vite</li>
<li><strong>Comment l&rsquo;Impact Mapping</strong> aligne le produit sur les objectifs business</li>
<li><strong>Comment l&rsquo;Event Storming</strong> révèle la complexité métier cachée</li>
<li><strong>Comment l&rsquo;Example Mapping</strong> détaille les règles métier complexes</li>
</ul>
<h3 id="savoir-bien-structurer-son-monolithe-modulaire">Savoir bien structurer son monolithe modulaire <a href="#savoir-bien-structurer-son-monolithe-modulaire" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce que développer Gyroscops a révélé</strong> : Même quand on démarre un projet, il est important de construire un
monolithe modulaire bien structuré. Le sujet des Micro-services a toujours été exclu dans mon cas, mais je suis tombé
dans le piège de la complexité à cause de contraintes techniques que je n&rsquo;ai pas tout de suite séparé des contraintes
métiers.</p>
<p>Depuis 2008, j&rsquo;ai beaucoup travaillé dans le milieu de l&rsquo;e-commerce, souvent pour récupérer des projets en souffrance.
Quand on fait de l&rsquo;intégration d&rsquo;une solution existante, on est guidé, on peut rester dans les rails de ce que l&rsquo;éditeur
a prévu pour nous. Cependant, les projets qui échouent sont souvent ceux où l&rsquo;équipe de développement n&rsquo;a pas pris
suffisamment de temps pour réfléchir au besoin métier. J&rsquo;ai souvent vu des équipes exploser leur codebase en 15 services
&ldquo;indépendants&rdquo; qui finissent par dépendre les uns des autres. Je l&rsquo;ai probablement fait en début de carrière.</p>
<p><strong>Aujourd&rsquo;hui, je préfère un monolithe modulaire</strong> :</p>
<ul>
<li>Bien découpé en domaines fonctionnels clairs</li>
<li>Avec des interfaces internes bien définies</li>
<li>Testable, maintenable, lisible</li>
<li>Déployable en un clic</li>
</ul>
<p>Et le jour où un module deviendra vraiment trop gros ou trop critique, là je réfléchirais à la possibilité de l&rsquo;extraire
en microservice. Mais je pars du besoin, pas du dogme.</p>
<p><strong>Le microservice doit être un outil. Pas une posture.</strong></p>
<h2 id="le-domain-driven-design--une-approche-centrée-sur-le-métier">Le Domain-Driven Design : Une Approche Centrée sur le Métier <a href="#le-domain-driven-design--une-approche-centr%c3%a9e-sur-le-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="les-fondements-selon-eric-evans">Les Fondements selon Eric Evans <a href="#les-fondements-selon-eric-evans" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Le Domain-Driven Design (DDD) est une approche de développement logiciel qui place le domaine métier au cœur de la
conception. Eric Evans, dans son livre fondateur &ldquo;Domain-Driven Design: Tackling Complexity in the Heart of Software&rdquo;,
nous enseigne que :</p>
<blockquote>
<p>&ldquo;Le logiciel doit refléter le domaine métier, pas l&rsquo;inverse.&rdquo;</p></blockquote>
<h3 id="les-concepts-clés-du-ddd">Les Concepts Clés du DDD <a href="#les-concepts-cl%c3%a9s-du-ddd" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><h4 id="1-le-langage-ubiquitaire-ubiquitous-language">1. Le Langage Ubiquitaire (Ubiquitous Language) <a href="#1-le-langage-ubiquitaire-ubiquitous-language" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Le langage utilisé par l&rsquo;équipe de développement doit être le même que celui du domaine métier. Pas de traduction, pas
de jargon technique qui éloigne du métier. Pas de charge mentale pour se souvenir de chaque définition en fonction du
contexte.</p>
<h4 id="2-les-bounded-contexts">2. Les Bounded Contexts <a href="#2-les-bounded-contexts" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Chaque contexte métier a ses propres modèles, sa propre logique. Un &ldquo;Client&rdquo; dans le contexte &ldquo;Ventes&rdquo; n&rsquo;est pas le même
qu&rsquo;un &ldquo;Client&rdquo; dans le contexte &ldquo;Cloud&rdquo;.</p>
<h4 id="3-les-agrégats">3. Les Agrégats <a href="#3-les-agr%c3%a9gats" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Des grappes d&rsquo;objets métier qui sont traités comme une unité cohérente. L&rsquo;agrégat protège ses invariants métier.</p>
<h4 id="4-les-value-objects">4. Les Value Objects <a href="#4-les-value-objects" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Des objets immuables qui représentent des concepts métier par leur valeur, pas par leur identité.</p>
<p><strong>Exemple concret du projet Gyroscops Cloud</strong> :</p>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Assert\Assertion</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Brick\Math\BigDecimal</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ✅ Value Object - Price
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">final</span> <span style="color:#a6e22e">readonly</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Price</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">BigDecimal</span> $amount,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Currencies</span> $currency,
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Assertion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">true</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isGreaterThan</span>(<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">substract</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">minus</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>), $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">plus</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>), $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isGreaterThan</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isGreaterThan</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isGreaterThanOrEqualTo</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isGreaterThanOrEqualTo</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isLessThan</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isLessThan</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isLessThanOrEqualTo</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isLessThanOrEqualTo</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isEqualTo</span>(<span style="color:#a6e22e">self</span> $price)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span> <span style="color:#f92672">!==</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CurrencyMismatchException</span>(<span style="color:#e6db74">&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isEqualTo</span>($price<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isZero</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isZero</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">multipliedBy</span>(<span style="color:#a6e22e">BigNumber</span><span style="color:#f92672">|</span><span style="color:#a6e22e">string</span> $number)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>(
</span></span><span style="display:flex;"><span>            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">multipliedBy</span>($number),
</span></span><span style="display:flex;"><span>            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">currency</span>,
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Ce que cet exemple montre</strong> :</p>
<ul>
<li><strong>Immutabilité</strong> : <code>readonly</code> et constructeur privé empêchent la modification</li>
<li><strong>Validation</strong> : Le constructeur valide que le montant n&rsquo;est pas négatif</li>
<li><strong>Logique métier</strong> : Les opérations arithmétiques respectent les règles métier</li>
<li><strong>Comparaison par valeur</strong> : Deux <code>Price</code> avec le même montant et la même devise sont égaux</li>
<li><strong>Encapsulation</strong> : La logique de calcul des prix est centralisée dans le Value Object</li>
</ul>
<h3 id="exemple-concret--un-système-de-paiement">Exemple Concret : Un Système de Paiement <a href="#exemple-concret--un-syst%c3%a8me-de-paiement" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Voici un exemple réel tiré du projet Gyroscops Cloud, montrant comment l&rsquo;approche DDD guide la conception :</p>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Assert\Assertion</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ✅ Approche DDD - Le domaine métier guide la conception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Payment</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentId</span> $uuid,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">RealmId</span> $realmId,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">OrganizationId</span> $organizationId,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">SubscriptionId</span> $subscriptionId,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">\DateTimeInterface</span> $creationDate <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">\DateTimeInterface</span> $expirationDate <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">\DateTimeInterface</span> $completionDate <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Statuses</span> $status <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Gateways</span> $gateway <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Price</span> $subtotal <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Price</span> $discount <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Price</span> $taxes <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Price</span> $total <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">Price</span> $captured <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">array</span> $events <span style="color:#f92672">=</span> [],
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">int</span> $version <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">registerOnlinePayment</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentId</span> $uuid,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">RealmId</span> $realmId,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">OrganizationId</span> $organizationId,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SubscriptionId</span> $subscriptionId,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">\DateTimeInterface</span> $creationDate,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">\DateTimeInterface</span> $expirationDate,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">string</span> $customerName,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">string</span> $customerEmail,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Price</span> $subtotal,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Price</span> $discount,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Price</span> $vat,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Price</span> $total,
</span></span><span style="display:flex;"><span>    )<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span> {
</span></span><span style="display:flex;"><span>        $instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>($uuid, $realmId, $organizationId, $subscriptionId);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Assertion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">true</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">canTransitionTo</span>(<span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        $instance<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">recordThat</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RegisteredPaymentEvent</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">uuid</span><span style="color:#f92672">:</span> $uuid,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">realmId</span><span style="color:#f92672">:</span> $realmId,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">organizationId</span><span style="color:#f92672">:</span> $organizationId,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">subscriptionId</span><span style="color:#f92672">:</span> $subscriptionId,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">creationDate</span><span style="color:#f92672">:</span> $creationDate,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expirationDate</span><span style="color:#f92672">:</span> $expirationDate,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">customerName</span><span style="color:#f92672">:</span> $customerName,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">customerEmail</span><span style="color:#f92672">:</span> $customerEmail,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">subtotal</span><span style="color:#f92672">:</span> $subtotal,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">discount</span><span style="color:#f92672">:</span> $discount,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">taxes</span><span style="color:#f92672">:</span> $vat,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">total</span><span style="color:#f92672">:</span> $total,
</span></span><span style="display:flex;"><span>        ));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $instance;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">authorize</span>(<span style="color:#a6e22e">Gateways</span> $gateway, <span style="color:#a6e22e">Price</span> $amount, <span style="color:#a6e22e">\DateTimeInterface</span> $authorizationDate)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Assertion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">true</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">canTransitionTo</span>(<span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Authorized</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">recordThat</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CapturedEvent</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">uuid</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uuid</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">version</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">realmId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">realmId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">organizationId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">organizationId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">subscriptionId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">subscriptionId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Authorized</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gateway</span><span style="color:#f92672">:</span> $gateway,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">amount</span><span style="color:#f92672">:</span> $amount,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">authorizationDate</span><span style="color:#f92672">:</span> $authorizationDate,
</span></span><span style="display:flex;"><span>        ));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">capture</span>(<span style="color:#a6e22e">Gateways</span> $gateway, <span style="color:#a6e22e">Price</span> $amount, <span style="color:#a6e22e">\DateTimeInterface</span> $completionDate)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Assertion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">true</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">canTransitionTo</span>(<span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Completed</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">recordThat</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CapturedEvent</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">uuid</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uuid</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">version</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">realmId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">realmId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">organizationId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">organizationId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">subscriptionId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">subscriptionId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Completed</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gateway</span><span style="color:#f92672">:</span> $gateway,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">amount</span><span style="color:#f92672">:</span> $amount,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">completionDate</span><span style="color:#f92672">:</span> $completionDate,
</span></span><span style="display:flex;"><span>        ));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fail</span>(<span style="color:#a6e22e">Gateways</span> $gateway, <span style="color:#a6e22e">Price</span> $amount, <span style="color:#a6e22e">\DateTimeInterface</span> $failureDate, <span style="color:#a6e22e">string</span> $reason)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Assertion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">true</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">canTransitionTo</span>(<span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Failed</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">recordThat</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FailedEvent</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">uuid</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uuid</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">version</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">realmId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">realmId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">organizationId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">organizationId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">subscriptionId</span><span style="color:#f92672">:</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">subscriptionId</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Failed</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gateway</span><span style="color:#f92672">:</span> $gateway,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">amount</span><span style="color:#f92672">:</span> $amount,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">failureDate</span><span style="color:#f92672">:</span> $failureDate,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">reason</span><span style="color:#f92672">:</span> $reason,
</span></span><span style="display:flex;"><span>        ));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">canTransitionTo</span>(<span style="color:#a6e22e">Statuses</span> $status)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">match</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">match</span> ($status) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">null</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Authorized</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Completed</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Cancelled</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Failed</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Authorized</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">match</span> ($status) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Authorized</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Completed</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Cancelled</span>, <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Failed</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">default</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Completed</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">match</span> ($status) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Completed</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">default</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Cancelled</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">match</span> ($status) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Cancelled</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">default</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Failed</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">match</span> ($status) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Statuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Failed</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">default</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Ce que cet exemple montre</strong> :</p>
<ul>
<li><strong>Intention métier claire</strong> : <code>registerOnlinePayment()</code>, <code>capture()</code>, <code>authorize()</code>, <code>fail()</code> expriment clairement l&rsquo;intention</li>
<li><strong>Protection des invariants</strong> : <code>canTransitionTo()</code> protège les transitions d&rsquo;état valides</li>
<li><strong>Event Sourcing</strong> : Chaque changement d&rsquo;état est enregistré comme un événement</li>
<li><strong>Value Objects</strong> : <code>PaymentId</code>, <code>Price</code>, <code>Statuses</code> encapsulent les concepts métier</li>
<li><strong>Séparation des responsabilités</strong> : L&rsquo;agrégat se concentre sur la logique métier, pas sur la persistance</li>
</ul>
<h2 id="pourquoi-le-crud-limite-vos-mouvements">Pourquoi le CRUD limite vos mouvements <a href="#pourquoi-le-crud-limite-vos-mouvements" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="mon-piège--la-simplicité-apparente-du-crud">Mon Piège : La Simplicité Apparente du CRUD <a href="#mon-pi%c3%a8ge--la-simplicit%c3%a9-apparente-du-crud" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Le CRUD (Create, Read, Update, Delete) semblait être la solution parfaite : simple, direct, facile à comprendre. &ldquo;Pourquoi compliquer les choses ?&rdquo; me demandais-je. Et c&rsquo;est exactement là que le piège s&rsquo;est refermé.</p>
<p><strong>Voici ce qui s&rsquo;est passé avec Gyroscops</strong> : j&rsquo;avais un système de gestion d&rsquo;utilisateurs. Au début, c&rsquo;était simple : créer, lire, modifier, supprimer. Puis est arrivée la demande : &ldquo;On veut pouvoir suspendre un utilisateur&rdquo;. Facile, j&rsquo;ai ajouté un champ <code>status</code>. Puis : &ldquo;Un utilisateur suspendu ne peut pas se connecter&rdquo;. OK, j&rsquo;ai ajouté une vérification. Puis : &ldquo;Un utilisateur suspendu ne peut pas changer son email&rdquo;. Encore une vérification. Puis : &ldquo;Il faut notifier l&rsquo;utilisateur quand il est suspendu&rdquo;. Une autre vérification&hellip;</p>
<p><strong>Résultat</strong> : Mon code ressemblait à un champ de mines. Chaque modification pouvait faire exploser quelque chose d&rsquo;inattendu.</p>
<h3 id="le-piège-du-crud">Le Piège du CRUD <a href="#le-pi%c3%a8ge-du-crud" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Le CRUD est une approche technique qui réduit votre domaine métier à des opérations de base de données. Cette approche m&rsquo;a empêché de :</p>
<ol>
<li><strong>Comprendre vraiment mon métier</strong> - Je ne voyais que la technique, pas la logique</li>
<li><strong>Évoluer facilement</strong> - Chaque changement devenait un cauchemar</li>
<li><strong>Maintenir la cohérence</strong> - Rien n&rsquo;empêchait les états incohérents</li>
<li><strong>Conserver l&rsquo;intention utilisateur</strong> (le plus grave) - L&rsquo;intention se perdait dès le contrôleur</li>
</ol>
<h4 id="1-comprendre-vraiment-votre-métier">1. <strong>Comprendre Vraiment Votre Métier</strong> <a href="#1-comprendre-vraiment-votre-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ❌ Approche CRUD - Le métier disparaît
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PaymentController</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">create</span>(<span style="color:#a6e22e">Request</span> $request)<span style="color:#f92672">:</span> <span style="color:#a6e22e">Response</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $payment <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Payment</span>();
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAmount</span>($request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;amount&#39;</span>));
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setStatus</span>(<span style="color:#e6db74">&#39;pending&#39;</span>);
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">save</span>($payment);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Response</span>([<span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">=&gt;</span> $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getId</span>()]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">Request</span> $request, <span style="color:#a6e22e">string</span> $id)<span style="color:#f92672">:</span> <span style="color:#a6e22e">Response</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $payment <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">find</span>($id);
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAmount</span>($request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;amount&#39;</span>));
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setStatus</span>($request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;status&#39;</span>));
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">save</span>($payment);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Response</span>([<span style="color:#e6db74">&#39;success&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>La logique métier est saupoudrée au milieu de concepts techniques. Il est difficile d&rsquo;identifier qui valide les règles. Toute évolution est rendue complexe.</p>
<h4 id="2-évoluer-facilement">2. <strong>Évoluer Facilement</strong> <a href="#2-%c3%a9voluer-facilement" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Avec le CRUD, ajouter une nouvelle règle métier devient un un parcours d&rsquo;obstacles :</p>
<ol>
<li>Modifier le contrôleur</li>
<li>Modifier les services</li>
<li>Modifier les validations</li>
<li>Modifier les tests</li>
<li>Risque de régression</li>
</ol>
<h4 id="3-maintenir-la-cohérence">3. <strong>Maintenir la Cohérence</strong> <a href="#3-maintenir-la-coh%c3%a9rence" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Le CRUD ne protège pas les invariants métier. Rien n&rsquo;empêche de créer un paiement avec un montant négatif ou de modifier un paiement déjà traité.</p>
<h4 id="4-conserver-l">4. <strong>Conserver l&rsquo;Intention Utilisateur</strong> <a href="#4-conserver-l" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Le plus grave des pièges du CRUD est la <strong>perte de l&rsquo;intention utilisateur</strong>. Les méthodes <code>get</code> et <code>set</code> ne sont que le reflet d&rsquo;une fraction de l&rsquo;intention, parfois seulement des contraintes techniques.</p>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ❌ CRUD - L&#39;intention est perdue dès le contrôleur
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PaymentController</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processPayment</span>(<span style="color:#a6e22e">Request</span> $request)<span style="color:#f92672">:</span> <span style="color:#a6e22e">Response</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $payment <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">find</span>($request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;id&#39;</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// L&#39;intention &#34;traiter un paiement&#34; devient :
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setStatus</span>(<span style="color:#e6db74">&#39;processing&#39;</span>);  <span style="color:#75715e">// Contrainte technique
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setProcessedAt</span>(<span style="color:#a6e22e">now</span>());    <span style="color:#75715e">// Contrainte technique
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAmount</span>($request<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;amount&#39;</span>)); <span style="color:#75715e">// Donnée brute
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">save</span>($payment);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Response</span>([<span style="color:#e6db74">&#39;success&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Problème</strong> :</p>
<ul>
<li>L&rsquo;intention &ldquo;traiter un paiement&rdquo; disparaît dès les premiers instants</li>
<li>Impossible de savoir <strong>pourquoi</strong> le paiement a été traité</li>
<li>L&rsquo;intention ne peut être que reconstruite ou déduite a posteriori</li>
<li>Aucune trace de l&rsquo;intention d&rsquo;origine dans le code</li>
</ul>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ✅ DDD - L&#39;intention est préservée et explicite
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProcessPayment</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentId</span> $id,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">Money</span> $amount,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentMethod</span> $method
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Payment</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">ProcessPayment</span> $command)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// L&#39;intention &#34;process&#34; est claire et préservée
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">canBeProcessed</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PaymentCannotBeProcessedException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">PaymentStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Processing</span>;
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">processedAt</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">DateTimeImmutable</span>();
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span> <span style="color:#f92672">=</span> $command<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// L&#39;intention est conservée dans l&#39;événement
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">recordEvent</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PaymentProcessed</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span>, $command<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Avantage</strong> : L&rsquo;intention métier est <strong>explicite</strong>, <strong>préservée</strong> et <strong>traçable</strong> tout au long du cycle de vie de l&rsquo;objet.</p>
<h3 id="la-solution--des-commandes-métier">La Solution : Des Commandes Métier <a href="#la-solution--des-commandes-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ✅ Approche DDD - Le métier guide l&#39;évolution
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProcessPayment</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentId</span> $id,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">Money</span> $amount,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentMethod</span> $method
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[AsMessageHandler(&#39;command.bus&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProcessPaymentHandler</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__invoke</span>(<span style="color:#a6e22e">ProcessPayment</span> $command)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $payment <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">find</span>($command<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">process</span>($command<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">amount</span>);
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">paymentRepository</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">save</span>($payment);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Avantages</strong> :</p>
<ul>
<li>La logique métier est centralisée</li>
<li>L&rsquo;évolution est guidée par le métier</li>
<li>Les invariants sont protégés</li>
<li>Le code est plus expressif</li>
</ul>
<h2 id="pourquoi-les-modèles-anémiques-vous-empêchent-davancer-plus-vite">Pourquoi les modèles anémiques vous empêchent d&rsquo;avancer plus vite <a href="#pourquoi-les-mod%c3%a8les-an%c3%a9miques-vous-emp%c3%aachent-davancer-plus-vite" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="mon-illusion--la-séparation-des-responsabilités">Mon Illusion : La Séparation des Responsabilités <a href="#mon-illusion--la-s%c3%a9paration-des-responsabilit%c3%a9s" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Les modèles anémiques semblaient respecter le principe de séparation des responsabilités : &ldquo;Les entités stockent les données, les services contiennent la logique&rdquo;. C&rsquo;est logique, non ? <strong>Non, c&rsquo;est trompeur !</strong></p>
<p><strong>Le problème</strong> : Je séparais les données de leur logique. C&rsquo;est comme séparer le l&rsquo;autopilote de l&rsquo;avion : techniquement possible, mais pas très optimal.</p>
<p><strong>Voici ce qui s&rsquo;est passé avec Gyroscops</strong> : j&rsquo;avais un système de gestion d&rsquo;utilisateurs. Au début, c&rsquo;était simple : des entités avec des getters/setters, des services qui faisaient la logique. Puis est arrivée la demande : &ldquo;On veut pouvoir suspendre un utilisateur&rdquo;. Facile, j&rsquo;ai ajouté un champ <code>isSuspended</code> et une méthode dans le service. Puis : &ldquo;Un utilisateur suspendu ne peut pas se connecter&rdquo;. OK, j&rsquo;ai ajouté une vérification dans le service. Puis : &ldquo;Un utilisateur suspendu ne peut pas changer son email&rdquo;. Encore une vérification dans le service. Puis : &ldquo;Il faut notifier l&rsquo;utilisateur quand il est suspendu&rdquo;. Une autre vérification dans le service&hellip;</p>
<p>Je n&rsquo;ai pas encore évoqué les inter-dépendances entre les entités lors de l&rsquo;inscription.</p>
<p><strong>Résultat</strong> : Ma logique métier était éparpillée dans de multiples services différents. Chaque modification nécessitait de toucher à au moins 5 fichiers. Je ne savais plus où était quoi, mes collègues non plus.</p>
<h3 id="mon-piège--les-modèles-anémiques">Mon Piège : Les Modèles Anémiques <a href="#mon-pi%c3%a8ge--les-mod%c3%a8les-an%c3%a9miques" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Un modèle anémique est un modèle qui ne contient que des propriétés (getters/setters) sans logique métier. Cette approche a limité ma capacité à :</p>
<ol>
<li><strong>Exprimer l&rsquo;intention métier</strong> - Ma logique était éparpillée dans plusieurs services et la cohérence n&rsquo;était pas systématiquement maintenue</li>
<li><strong>Évoluer sans casser</strong> - Chaque changement impactait plusieurs services</li>
<li><strong>Tester efficacement</strong> - Mes tests devenaient fragiles et complexes</li>
</ol>
<h4 id="1-exprimer-l">1. <strong>Exprimer l&rsquo;Intention Métier</strong> <a href="#1-exprimer-l" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ❌ Modèle Anémique - L&#39;intention disparaît
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $id,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $email,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $firstName,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $lastName,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">bool</span> $isActive <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Seulement des getters/setters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getId</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getEmail</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setEmail</span>(<span style="color:#a6e22e">string</span> $email)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span> { $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> $email; }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... autres getters/setters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></div>
<p><strong>Problème</strong> : Comment savoir si un utilisateur peut se connecter ? Comment valider un email ? Comment gérer l&rsquo;activation ?</p>
<p><strong>Avec Gyroscops, j&rsquo;ai vécu cette situation</strong> : J&rsquo;avais un modèle <code>User</code> avec des getters/setters, et la logique était éparpillée dans 12 services différents. Quand j&rsquo;ai voulu ajouter la fonctionnalité &ldquo;suspendre un utilisateur&rdquo;, j&rsquo;ai dû :</p>
<p><strong>Services liés à l&rsquo;utilisateur</strong> :</p>
<ul>
<li>Modifier le service <code>UserService</code> pour la logique de suspension</li>
<li>Modifier le service <code>AuthService</code> pour vérifier le statut</li>
<li>Modifier le service <code>EmailService</code> pour les notifications</li>
</ul>
<p><strong>Services liés à l&rsquo;organisation</strong> :</p>
<ul>
<li>Modifier le service <code>OrganizationService</code> car l&rsquo;utilisateur appartient à une organisation</li>
<li>Modifier le service <code>BillingService</code> car l&rsquo;organisation est l&rsquo;entité facturée</li>
<li>Modifier le service <code>AuditService</code> pour l&rsquo;historique organisationnel</li>
</ul>
<p><strong>Services liés au workflow</strong> :</p>
<ul>
<li>Modifier le service <code>WorkflowService</code> car le workflow est l&rsquo;espace de travail</li>
<li>Modifier le service <code>CloudService</code> car le workflow est déployé dans une région cloud</li>
<li>Modifier le service <code>ResourceService</code> car le workflow comprend des ressources</li>
</ul>
<p><strong>Services transversaux</strong> :</p>
<ul>
<li>Modifier le service <code>NotificationService</code> pour les alertes</li>
<li>Modifier le service <code>ReportService</code> pour les statistiques</li>
<li>Modifier le service <code>CacheService</code> pour l&rsquo;invalidation</li>
</ul>
<p><strong>Résultat</strong> : 12 fichiers à modifier pour une seule fonctionnalité ! Et si j&rsquo;oubliais un service ? Et si les règles étaient incohérentes entre les services ? Et comment gérer les dépendances entre User → Organization → Workflow → Cloud Resources ?</p>
<p>La logique métier se retrouve éparpillée dans les services, mélangeant souvent <strong>règles métier</strong> et <strong>contraintes techniques</strong> :</p>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ❌ Entité Doctrine avec contraintes mélangées
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Doctrine\ORM\Mapping</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ORM</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\Validator\Constraints</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">Assert</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[ORM\Entity]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#[ORM\Table(name: &#39;users&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Id]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[ORM\GeneratedValue]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[ORM\Column(type: &#39;integer&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">int</span> $id <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 255)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Email(message: &#39;Email invalide&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Length(max: 255, maxMessage: &#39;Email trop long&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\NotBlank(message: &#39;Email obligatoire&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $email;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 50)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\NotBlank(message: &#39;Le prénom est obligatoire&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Length(min: 2, max: 50, minMessage: &#39;Prénom trop court&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $firstName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 50)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\NotBlank(message: &#39;Le nom est obligatoire&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Length(min: 2, max: 50, minMessage: &#39;Nom trop court&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $lastName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;boolean&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">bool</span> $isActive <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Seulement des getters/setters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getId</span>()<span style="color:#f92672">:</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">int</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getEmail</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setEmail</span>(<span style="color:#a6e22e">string</span> $email)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span> { $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> $email; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getFirstName</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">firstName</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setFirstName</span>(<span style="color:#a6e22e">string</span> $firstName)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span> { $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">firstName</span> <span style="color:#f92672">=</span> $firstName; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getLastName</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastName</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setLastName</span>(<span style="color:#a6e22e">string</span> $lastName)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span> { $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastName</span> <span style="color:#f92672">=</span> $lastName; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isActive</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span> { <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isActive</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setIsActive</span>(<span style="color:#a6e22e">bool</span> $isActive)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span> { $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isActive</span> <span style="color:#f92672">=</span> $isActive; }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ❌ Service avec logique métier mélangée
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserService</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">ValidatorInterface</span> $validator,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">UserRepository</span> $userRepository
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">validateUser</span>(<span style="color:#a6e22e">User</span> $user)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Règle métier : L&#39;utilisateur doit être actif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isActive</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Contrainte technique : Validation Symfony (déjà dans l&#39;entité)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $violations <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">validator</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">validate</span>($user);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">count</span>($violations) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Règle métier : L&#39;utilisateur ne doit pas être banni
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isUserBanned</span>($user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getId</span>())) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Problèmes</strong> :</p>
<ul>
<li><strong>Mélange de responsabilités</strong> : Contraintes techniques (Doctrine/Symfony) et règles métier dans la même entité</li>
<li><strong>Difficile à tester</strong> : Comment tester uniquement les règles métier sans les contraintes techniques ?</li>
<li><strong>Difficile à maintenir</strong> : Où modifier une règle métier spécifique sans impacter les contraintes ?</li>
<li><strong>Difficile à comprendre</strong> : Quelle est l&rsquo;intention réelle de cette validation ?</li>
<li><strong>Couplage fort</strong> : L&rsquo;entité est couplée à la base de données ET aux règles métier</li>
</ul>
<h4 id="2-évoluer-sans-casser">2. <strong>Évoluer Sans Casser</strong> <a href="#2-%c3%a9voluer-sans-casser" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Avec des modèles anémiques, changer une règle métier nécessite de :</p>
<ol>
<li>Modifier tous les services qui utilisent le modèle</li>
<li>Modifier tous les contrôleurs</li>
<li>Modifier tous les tests</li>
<li>Risque de régression élevé</li>
</ol>
<h4 id="3-tester-efficacement">3. <strong>Tester Efficacement</strong> <a href="#3-tester-efficacement" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>La logique métier est éparpillée dans les services, rendant les tests complexes et fragiles.</p>
<h3 id="la-solution--des-modèles-riches">La Solution : Des Modèles Riches <a href="#la-solution--des-mod%c3%a8les-riches" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ✅ Modèle Riche - L&#39;intention métier est claire
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">UserId</span> $id,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">Email</span> $email,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">FullName</span> $name,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">UserStatuses</span> $status
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">register</span>(<span style="color:#a6e22e">UserId</span> $id, <span style="color:#a6e22e">Email</span> $email, <span style="color:#a6e22e">FullName</span> $name)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>($id, $email, $name, <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">activate</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserCannotBeActivatedException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Active</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">canLogin</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Active</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">changeEmail</span>(<span style="color:#a6e22e">Email</span> $newEmail)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Suspended</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserCannotChangeEmailException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> $newEmail;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Avantages</strong> :</p>
<ul>
<li><strong>Séparation claire</strong> : Règles métier dans le modèle, contraintes techniques dans les Value Objects</li>
<li><strong>Intention métier explicite</strong> : <code>register</code>, <code>canLogin()</code>, <code>activate()</code>, <code>changeEmail()</code> expriment clairement l&rsquo;intention</li>
<li><strong>Évolution guidée par le métier</strong> : Les changements suivent la logique métier</li>
<li><strong>Tests plus simples</strong> : Chaque règle métier peut être testée indépendamment</li>
<li><strong>Cohérence garantie</strong> : Les invariants métier sont protégés</li>
</ul>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ✅ Agrégat racine séparé de l&#39;entité Doctrine
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">private</span>(<span style="color:#a6e22e">set</span>) <span style="color:#a6e22e">UserId</span> $id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">private</span>(<span style="color:#a6e22e">set</span>) <span style="color:#a6e22e">Email</span> $email;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">private</span>(<span style="color:#a6e22e">set</span>) <span style="color:#a6e22e">FullName</span> $name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">string</span> $firstName {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">get</span> <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">firstName</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">string</span> $lastName {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">get</span> <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastName</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">private</span>(<span style="color:#a6e22e">set</span>) <span style="color:#a6e22e">UserStatuses</span> $status;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">register</span>(<span style="color:#a6e22e">Email</span> $email, <span style="color:#a6e22e">FullName</span> $name)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $user <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>();
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UserId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>();
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> $email;
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> $name;
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $user;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">activate</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Pending</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserCannotBeActivatedException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Active</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">canLogin</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Active</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">changeName</span>(<span style="color:#a6e22e">FullName</span> $newName)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Suspended</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserCannotChangeNameException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> $newName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">changeEmail</span>(<span style="color:#a6e22e">Email</span> $newEmail)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Suspended</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserCannotChangeEmailException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> $newEmail;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">suspend</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Suspended</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserAlreadySuspendedException</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">Suspended</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ✅ Entité Doctrine séparée pour la persistance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Doctrine\ORM\Mapping</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ORM</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Symfony\Component\Validator\Constraints</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">Assert</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[ORM\Entity]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#[ORM\Table(name: &#39;users&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserEntity</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Id]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[ORM\GeneratedValue]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[ORM\Column]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">int</span> $id <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 255)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Email(message: &#39;Email invalide&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Length(max: 255, maxMessage: &#39;Email trop long&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\NotBlank(message: &#39;Email obligatoire&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $email;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 50)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\NotBlank(message: &#39;Le prénom est obligatoire&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Length(min: 2, max: 50, minMessage: &#39;Prénom trop court&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $firstName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 50)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\NotBlank(message: &#39;Le nom est obligatoire&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[Assert\Length(min: 2, max: 50, minMessage: &#39;Nom trop court&#39;)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $lastName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#[ORM\Column(type: &#39;string&#39;, length: 20)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $status <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;pending&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Getters et setters pour Doctrine
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getId</span>()<span style="color:#f92672">:</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">int</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getEmail</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setEmail</span>(<span style="color:#a6e22e">string</span> $email)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> $email;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getFirstName</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">firstName</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setFirstName</span>(<span style="color:#a6e22e">string</span> $firstName)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">firstName</span> <span style="color:#f92672">=</span> $firstName;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getLastName</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastName</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setLastName</span>(<span style="color:#a6e22e">string</span> $lastName)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastName</span> <span style="color:#f92672">=</span> $lastName;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getStatus</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setStatus</span>(<span style="color:#a6e22e">string</span> $status)<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> $status;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ✅ Value Objects pour les contraintes techniques
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">final</span> <span style="color:#a6e22e">readonly</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserId</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $value)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">empty</span>($value)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InvalidUserIdException</span>(<span style="color:#e6db74">&#39;ID utilisateur obligatoire&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generate</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">self</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">self</span>(<span style="color:#a6e22e">uniqid</span>(<span style="color:#e6db74">&#39;user_&#39;</span>, <span style="color:#66d9ef">true</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__toString</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#a6e22e">readonly</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Email</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $value)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">filter_var</span>($value, <span style="color:#a6e22e">FILTER_VALIDATE_EMAIL</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InvalidEmailException</span>(<span style="color:#e6db74">&#39;Email invalide&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strlen</span>($value) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">255</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InvalidEmailException</span>(<span style="color:#e6db74">&#39;Email trop long&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__toString</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#a6e22e">readonly</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FullName</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">string</span> $firstName,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">string</span> $lastName
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">empty</span>($firstName) <span style="color:#f92672">||</span> <span style="color:#66d9ef">empty</span>($lastName)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InvalidNameException</span>(<span style="color:#e6db74">&#39;Nom complet obligatoire&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="mapper-entre-agrégat-et-entité-doctrine"><strong>Mapper entre Agrégat et Entité Doctrine</strong> <a href="#mapper-entre-agr%c3%a9gat-et-entit%c3%a9-doctrine" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// ✅ Mapper pour convertir entre l&#39;agrégat et l&#39;entité Doctrine
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserMapper</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">toEntity</span>(<span style="color:#a6e22e">User</span> $user)<span style="color:#f92672">:</span> <span style="color:#a6e22e">UserEntity</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $entity <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserEntity</span>();
</span></span><span style="display:flex;"><span>        $entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setEmail</span>($user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getEmail</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">__toString</span>());
</span></span><span style="display:flex;"><span>        $entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setFirstName</span>($user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getFirstName</span>());
</span></span><span style="display:flex;"><span>        $entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setLastName</span>($user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getLastName</span>());
</span></span><span style="display:flex;"><span>        $entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setStatus</span>($user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getStatus</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $entity;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">toAggregate</span>(<span style="color:#a6e22e">UserEntity</span> $entity)<span style="color:#f92672">:</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $user <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">User</span>();
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">UserId</span>($entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Email</span>($entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getEmail</span>());
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">firstName</span> <span style="color:#f92672">=</span> $entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getFirstName</span>();
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastName</span> <span style="color:#f92672">=</span> $entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getLastName</span>();
</span></span><span style="display:flex;"><span>        $user<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">UserStatuses</span><span style="color:#f92672">::</span><span style="color:#a6e22e">from</span>($entity<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getStatus</span>());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> $user;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Résultat</strong> :</p>
<ul>
<li><strong>Séparation claire</strong> : Agrégat métier séparé de l&rsquo;entité de persistance</li>
<li><strong>Agrégat pur</strong> : Pas de dépendance à Doctrine dans le modèle métier</li>
<li><strong>Entité Doctrine</strong> : Gestion de la persistance avec validation Symfony</li>
<li><strong>Mapper dédié</strong> : Conversion explicite entre les deux représentations</li>
<li><strong>Testabilité</strong> : L&rsquo;agrégat peut être testé sans base de données</li>
<li><strong>Flexibilité</strong> : Possibilité de changer de stratégie de persistance</li>
</ul>
<h2 id="levent-storming--révéler-la-complexité-métier">L&rsquo;Event Storming : Révéler la Complexité Métier <a href="#levent-storming--r%c3%a9v%c3%a9ler-la-complexit%c3%a9-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="mon-problème--je-ne-voyais-que-la-pointe-de-liceberg">Mon Problème : Je Ne Voyais Que la Pointe de l&rsquo;Iceberg <a href="#mon-probl%c3%a8me--je-ne-voyais-que-la-pointe-de-liceberg" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce qui s&rsquo;est passé</strong> : J&rsquo;étais en réunion avec l&rsquo;équipe&rsquo;. On décrivait une nouvelle fonctionnalité : &ldquo;On veut pouvoir suspendre un utilisateur&rdquo;. Simple, non ? J&rsquo;ajoute un champ <code>isSuspended</code> et c&rsquo;est réglé.</p>
<p><strong>Mais attendez&hellip;</strong> Que se passe-t-il si l&rsquo;utilisateur a des paiements en cours ? Et ses abonnements ? Et ses données personnelles ? Et les notifications ? Et l&rsquo;audit ? Et la conformité RGPD ? Et les intégrations avec les systèmes externes ?</p>
<p><strong>Soudain, ce qui semblait simple devenait un cauchemar.</strong> Je réalisais que je ne comprenais pas vraiment le métier. Je ne voyais que la pointe de l&rsquo;iceberg.</p>
<h3 id="quest-ce-que-levent-storming-">Qu&rsquo;est-ce que l&rsquo;Event Storming ? <a href="#quest-ce-que-levent-storming-" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>L&rsquo;Event Storming est une méthode de conception collaborative qui permet de :</p>
<ol>
<li><strong>Découvrir le domaine métier</strong> - Voir l&rsquo;iceberg entier, pas juste la pointe</li>
<li><strong>Identifier les événements métier</strong> - Comprendre ce qui se passe vraiment</li>
<li><strong>Modéliser les processus</strong> - Voir comment tout s&rsquo;articule</li>
<li><strong>Concevoir l&rsquo;architecture</strong> - Construire sur des bases solides</li>
</ol>
<h3 id="pourquoi-levent-storming-">Pourquoi l&rsquo;Event Storming ? <a href="#pourquoi-levent-storming-" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><h4 id="1-révéler-la-vraie-complexité---mon-réveil-brutal">1. <strong>Révéler la Vraie Complexité</strong> - Mon Réveil Brutal <a href="#1-r%c3%a9v%c3%a9ler-la-vraie-complexit%c3%a9---mon-r%c3%a9veil-brutal" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>L&rsquo;Event Storming m&rsquo;a montré que mon domaine était plus complexe que je ne le pensais. Cette complexité existait, que je la modélise ou non. <strong>La question n&rsquo;était pas de savoir si elle existait, mais si je voulais la gérer ou la subir.</strong></p>
<p><strong>Exemple concret avec Gyroscops</strong> : Je pensais qu&rsquo;un &ldquo;paiement&rdquo; était simple. Puis l&rsquo;Event Storming a révélé :</p>
<ul>
<li>Paiement initié</li>
<li>Paiement en attente de validation</li>
<li>Paiement validé par la banque</li>
<li>Paiement traité par le système</li>
<li>Paiement notifié au client</li>
<li>Paiement enregistré pour l&rsquo;audit</li>
<li>Paiement synchronisé avec la comptabilité</li>
<li>Paiement affiché dans le tableau de bord</li>
<li>Paiement exporté pour les rapports</li>
<li>Paiement archivé pour la conformité</li>
</ul>
<p><strong>Soudain, j&rsquo;ai compris pourquoi mon code était si complexe !</strong></p>
<h4 id="2-alignement-de-l---la-fin-des-malentendus">2. <strong>Alignement de l&rsquo;Équipe</strong> - La Fin des Malentendus <a href="#2-alignement-de-l---la-fin-des-malentendus" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Toute l&rsquo;équipe (développeurs, product owners, experts métier) partage la même compréhension du domaine. <strong>Fini les &ldquo;Ah, je pensais que&hellip;&rdquo; et les &ldquo;Non, mais moi je croyais que&hellip;&rdquo;</strong></p>
<p><strong>Exemple concret avec Gyroscops</strong> : Pendant un Event Storming sur la gestion des utilisateurs. Voici ce qui est ressorti :</p>
<ul>
<li><strong>Moi (développeur)</strong> : &ldquo;Un utilisateur suspendu ne peut pas se connecter&rdquo;</li>
<li><strong>Le product owner</strong> : &ldquo;Non, il peut se connecter mais ne peut pas faire d&rsquo;achats&rdquo;</li>
<li><strong>L&rsquo;expert métier</strong> : &ldquo;Il peut se connecter et faire des achats mais ne peut pas changer son email&rdquo;</li>
<li><strong>Le responsable sécurité</strong> : &ldquo;Il ne peut pas accéder aux données sensibles&rdquo;</li>
<li><strong>Le responsable comptabilité</strong> : &ldquo;Il ne peut pas télécharger de factures&rdquo;</li>
<li><strong>Le responsable cloud</strong> : &ldquo;Il ne peut pas accéder aux workflows déployés&rdquo;</li>
<li><strong>Le responsable facturation</strong> : &ldquo;L&rsquo;organisation doit continuer à être facturée même si l&rsquo;utilisateur est suspendu&rdquo;</li>
</ul>
<p><strong>Résultat de l&rsquo;Event Storming</strong> : Nous avons découvert que &ldquo;suspendre un utilisateur&rdquo; n&rsquo;était pas un seul événement, mais plusieurs, avec des implications sur toute la chaîne :</p>
<p><strong>Événements liés à l&rsquo;utilisateur</strong> :</p>
<ul>
<li><code>UserSuspended</code> (accès restreint)</li>
<li><code>UserBillingSuspended</code> (pas d&rsquo;achats)</li>
<li><code>UserDataAccessSuspended</code> (pas de données sensibles)</li>
<li><code>UserEmailChangeSuspended</code> (pas de changement d&rsquo;email)</li>
</ul>
<p><strong>Événements liés à l&rsquo;organisation</strong> :</p>
<ul>
<li><code>OrganizationBillingMaintained</code> (l&rsquo;organisation continue d&rsquo;être facturée)</li>
<li><code>OrganizationAccessRestricted</code> (accès restreint aux données organisationnelles)</li>
</ul>
<p><strong>Événements liés au workflow</strong> :</p>
<ul>
<li><code>WorkflowAccessSuspended</code> (pas d&rsquo;accès aux workflows)</li>
<li><code>WorkflowResourcesMaintained</code> (les ressources restent actives)</li>
<li><code>WorkflowBillingMaintained</code> (la facturation du workflow continue)</li>
</ul>
<p><strong>Qui avait raison ?</strong> Tout le monde ! Chacun avait une vision partielle de la réalité métier, et nous avons découvert que suspendre un utilisateur avait des implications sur l&rsquo;organisation, le workflow, et même les ressources cloud.</p>
<h4 id="3-conception-collaborative---briser-les-silos">3. <strong>Conception Collaborative</strong> - Briser les Silos <a href="#3-conception-collaborative---briser-les-silos" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>L&rsquo;Event Storming brise les silos et permet une conception vraiment collaborative. <strong>Fini les &ldquo;spécifications&rdquo; écrites par les uns et interprétées par les autres.</strong></p>
<h3 id="les-7-étapes-de-levent-storming">Les 7 Étapes de l&rsquo;Event Storming <a href="#les-7-%c3%a9tapes-de-levent-storming" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><ol>
<li><strong>Identifier les Événements</strong> : Qu&rsquo;est-ce qui se passe dans le domaine ?</li>
<li><strong>Identifier les Acteurs</strong> : Qui déclenche ces événements ?</li>
<li><strong>Identifier les Commandes</strong> : Quelles actions déclenchent les événements ?</li>
<li><strong>Identifier les Agrégats</strong> : Quelles entités sont concernées ?</li>
<li><strong>Identifier les Systèmes Externes</strong> : Quelles intégrations sont nécessaires ?</li>
<li><strong>Identifier les Vues de Lecture</strong> : Quelles données sont nécessaires pour l&rsquo;affichage ?</li>
<li><strong>Concevoir l&rsquo;Architecture</strong> : Comment organiser le code ?</li>
</ol>
<h3 id="exemple-devent-storming--système-de-paiement">Exemple d&rsquo;Event Storming : Système de Paiement <a href="#exemple-devent-storming--syst%c3%a8me-de-paiement" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <pre tabindex="0"><code>Événements (Post-its Orange) :
- PaymentRequested
- PaymentProcessed
- PaymentFailed
- PaymentRefunded

Acteurs (Post-its Jaunes) :
- Customer
- PaymentGateway
- Admin

Commandes (Post-its Bleus) :
- ProcessPayment
- RefundPayment
- CancelPayment

Agrégats (Post-its Jaunes avec bordure) :
- Payment
- Customer
- Order</code></pre>
<h2 id="lexample-mapping--détailer-les-règles-métier">L&rsquo;Example Mapping : Détailer les Règles Métier <a href="#lexample-mapping--d%c3%a9tailer-les-r%c3%a8gles-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="mon-problème--les-règles-métier-cachées">Mon Problème : Les Règles Métier Cachées <a href="#mon-probl%c3%a8me--les-r%c3%a8gles-m%c3%a9tier-cach%c3%a9es" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce qui s&rsquo;est passé</strong> : Je venais de faire un Event Storming sur le système de paiement de Gyroscops. J&rsquo;avais identifié l&rsquo;événement &ldquo;Paiement traité&rdquo;. Parfait ! Je commençais à coder.</p>
<p><strong>Mais attendez&hellip;</strong> Qu&rsquo;est-ce qui détermine qu&rsquo;un paiement peut être traité ? Le montant ? La méthode de paiement ? L&rsquo;historique du client ? La disponibilité des fonds ? Les restrictions géographiques ? Les limites de sécurité ? Les règles de conformité ?</p>
<p><strong>Soudain, je réalisais que je ne connaissais pas les règles !</strong> J&rsquo;avais identifié l&rsquo;événement, mais pas les conditions qui le déclenchent.</p>
<h3 id="quest-ce-que-lexample-mapping-">Qu&rsquo;est-ce que l&rsquo;Example Mapping ? <a href="#quest-ce-que-lexample-mapping-" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>L&rsquo;Example Mapping est une méthode complémentaire à l&rsquo;Event Storming qui permet de détailler les règles métier découvertes. Créée par Matt Wynne, cette technique utilise des cartes colorées pour explorer les exemples concrets d&rsquo;une fonctionnalité.</p>
<p><strong>L&rsquo;idée</strong> : Au lieu de discuter de règles abstraites, vous discutez d&rsquo;exemples concrets. C&rsquo;est beaucoup plus facile !</p>
<h3 id="pourquoi-lexample-mapping-">Pourquoi l&rsquo;Example Mapping ? <a href="#pourquoi-lexample-mapping-" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><h4 id="1-révéler-les-règles-implicites---mon-détective-du-métier">1. <strong>Révéler les Règles Implicites</strong> - Mon Détective du Métier <a href="#1-r%c3%a9v%c3%a9ler-les-r%c3%a8gles-implicites---mon-d%c3%a9tective-du-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>L&rsquo;Event Storming révèle les événements, mais l&rsquo;Example Mapping révèle les règles métier complexes qui les gouvernent. <strong>C&rsquo;est comme passer d&rsquo;une photo floue à une photo nette.</strong></p>
<p><strong>Exemple concret avec Gyroscops</strong> : Je pensais qu&rsquo;un &ldquo;paiement&rdquo; était traité si le montant était positif. Puis l&rsquo;Example Mapping a révélé :</p>
<p><strong>Règles de paiement simples</strong> :</p>
<ul>
<li>Un paiement de 1€ est traité ✅</li>
<li>Un paiement de 1000€ est traité ✅</li>
<li>Un paiement de 10000€ nécessite une validation manuelle ❌</li>
<li>Un paiement de 100000€ nécessite une approbation du directeur ❌</li>
</ul>
<p><strong>Règles de paiement complexes</strong> :</p>
<ul>
<li>Un paiement avec une carte expirée est rejeté ❌</li>
<li>Un paiement avec une carte volée est rejeté ❌</li>
<li>Un paiement depuis un pays interdit est rejeté ❌</li>
<li>Un paiement d&rsquo;un client en défaut est rejeté ❌</li>
</ul>
<p><strong>Règles liées à l&rsquo;organisation</strong> :</p>
<ul>
<li>Un paiement pour une organisation suspendue est rejeté ❌</li>
<li>Un paiement pour une organisation en défaut de paiement est rejeté ❌</li>
<li>Un paiement pour une organisation sans workflow actif est rejeté ❌</li>
</ul>
<p><strong>Règles liées au workflow</strong> :</p>
<ul>
<li>Un paiement pour un workflow suspendu est rejeté ❌</li>
<li>Un paiement pour un workflow dans une région cloud indisponible est rejeté ❌</li>
<li>Un paiement pour un workflow avec des ressources insuffisantes est rejeté ❌</li>
</ul>
<p><strong>Soudain, j&rsquo;ai compris pourquoi ma logique de paiement était si complexe !</strong> Ce n&rsquo;était pas juste un paiement, c&rsquo;était un écosystème complet : User → Organization → Workflow → Cloud Resources → Billing.</p>
<h4 id="2-concrétiser-l---de-lidée-à-la-réalité">2. <strong>Concrétiser l&rsquo;Abstrait</strong> - De l&rsquo;Idée à la Réalité <a href="#2-concr%c3%a9tiser-l---de-lid%c3%a9e-%c3%a0-la-r%c3%a9alit%c3%a9" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Les exemples concrets rendent les règles métier tangibles et compréhensibles. <strong>Fini les &ldquo;On devrait peut-être&hellip;&rdquo; et les &ldquo;Il faudrait que&hellip;&rdquo;.</strong></p>
<p><strong>Exemple concret avec Gyroscops</strong> : Au lieu de dire &ldquo;Un paiement peut être traité&rdquo;, nous disions &ldquo;Un paiement de 100€ avec une carte Visa valide depuis la France peut être traité&rdquo;. <strong>C&rsquo;est beaucoup plus clair !</strong></p>
<p><strong>Voici comment l&rsquo;Example Mapping a transformé nos discussions</strong> :</p>
<p><strong>Avant</strong> (discussions abstraites) :</p>
<ul>
<li>&ldquo;Il faut valider les paiements&rdquo;</li>
<li>&ldquo;On doit gérer les cas d&rsquo;erreur&rdquo;</li>
<li>&ldquo;Il faut respecter les règles de sécurité&rdquo;</li>
<li>&ldquo;Il faut gérer les organisations&rdquo;</li>
<li>&ldquo;Il faut gérer les workflows&rdquo;</li>
<li>&ldquo;Il faut gérer les ressources cloud&rdquo;</li>
</ul>
<p><strong>Après</strong> (exemples concrets) :</p>
<ul>
<li>&ldquo;Un paiement de 50€ avec une carte Visa valide depuis la France pour une organisation active avec un workflow déployé en région Europe est traité automatiquement&rdquo;</li>
<li>&ldquo;Un paiement de 5000€ avec une carte Visa valide depuis la France pour une organisation active avec un workflow déployé en région Europe nécessite une validation manuelle&rdquo;</li>
<li>&ldquo;Un paiement de 50€ avec une carte expirée est rejeté avec le message &lsquo;Carte expirée&rsquo;&rdquo;</li>
<li>&ldquo;Un paiement de 50€ pour une organisation suspendue est rejeté avec le message &lsquo;Organisation suspendue&rsquo;&rdquo;</li>
<li>&ldquo;Un paiement de 50€ pour un workflow dans une région cloud indisponible est rejeté avec le message &lsquo;Région cloud indisponible&rsquo;&rdquo;</li>
<li>&ldquo;Un paiement de 50€ pour un workflow avec des ressources insuffisantes est rejeté avec le message &lsquo;Ressources insuffisantes&rsquo;&rdquo;</li>
</ul>
<p><strong>Résultat</strong> : Plus de malentendus, plus de discussions interminables, plus de &ldquo;Ah, je pensais que&hellip;&rdquo;. Tout le monde comprenait exactement ce qui devait être fait, et nous avons découvert que chaque paiement impliquait une chaîne complète : User → Organization → Workflow → Cloud Resources → Billing.</p>
<h4 id="3-faciliter-les-tests---de-lexemple-au-code">3. <strong>Faciliter les Tests</strong> - De l&rsquo;Exemple au Code <a href="#3-faciliter-les-tests---de-lexemple-au-code" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Les exemples deviennent naturellement des tests d&rsquo;acceptation. <strong>C&rsquo;est la magie de l&rsquo;Example Mapping !</strong></p>
<p><strong>Avec Gyroscops, voici ce qui s&rsquo;est passé</strong> : Après notre session d&rsquo;Example Mapping sur les paiements, j&rsquo;ai directement transformé les exemples en tests. Voici un exemple réel du projet Gyroscops Cloud :</p>


    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">itShouldHydrateInstanceWithValidData</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 🟢 EXEMPLE : Hydratation d&#39;un paiement avec des données valides (projet Gyroscops Cloud)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $paymentData <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">createValidPaymentData</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $result <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hydrator</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hydrate</span>($paymentData);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assertInstanceOf</span>(<span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>, $result);
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assertEquals</span>($paymentData[<span style="color:#e6db74">&#39;uuid&#39;</span>], $result<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">uuid</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assertEquals</span>($paymentData[<span style="color:#e6db74">&#39;status&#39;</span>], $result<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">status</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assertEquals</span>($paymentData[<span style="color:#e6db74">&#39;gateway&#39;</span>], $result<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">gateway</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">itShouldRejectInvalidPaymentData</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 🔴 EXEMPLE : Rejet de données de paiement invalides (projet Gyroscops Cloud)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectException</span>(<span style="color:#a6e22e">MultipleValidationException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $invalidData <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;uuid&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;invalid-uuid&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;status&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;invalid-status&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;gateway&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;invalid-gateway&#39;</span>,
</span></span><span style="display:flex;"><span>    ];
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hydrator</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hydrate</span>($invalidData);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">it_requires_manual_validation_for_large_payment</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 🟡 EXEMPLE : Paiement de 5000€ avec carte Visa valide depuis la France pour une organisation active avec un workflow déployé en région Europe
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $organization <span style="color:#f92672">=</span> <span style="color:#a6e22e">Organization</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(<span style="color:#e6db74">&#39;Acme Corp&#39;</span>, <span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span>    $workflow <span style="color:#f92672">=</span> <span style="color:#a6e22e">Workflow</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>($organization, <span style="color:#a6e22e">CloudRegion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">europe</span>(), <span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span>    $payment <span style="color:#f92672">=</span> <span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">5000</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentMethod</span><span style="color:#f92672">::</span><span style="color:#a6e22e">visa</span>(<span style="color:#e6db74">&#39;4111111111111111&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Country</span><span style="color:#f92672">::</span><span style="color:#a6e22e">france</span>(),
</span></span><span style="display:flex;"><span>        $organization,
</span></span><span style="display:flex;"><span>        $workflow
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">process</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assertEquals</span>(<span style="color:#a6e22e">PaymentStatus</span><span style="color:#f92672">::</span><span style="color:#a6e22e">PENDING_MANUAL_VALIDATION</span>, $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getStatus</span>());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">it_rejects_payment_for_suspended_organization</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 🔴 EXEMPLE : Paiement de 50€ pour une organisation suspendue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectException</span>(<span style="color:#a6e22e">SuspendedOrganizationException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectExceptionMessage</span>(<span style="color:#e6db74">&#39;Organisation suspendue&#39;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $organization <span style="color:#f92672">=</span> <span style="color:#a6e22e">Organization</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(<span style="color:#e6db74">&#39;Acme Corp&#39;</span>, <span style="color:#e6db74">&#39;suspended&#39;</span>);
</span></span><span style="display:flex;"><span>    $workflow <span style="color:#f92672">=</span> <span style="color:#a6e22e">Workflow</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>($organization, <span style="color:#a6e22e">CloudRegion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">europe</span>(), <span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentMethod</span><span style="color:#f92672">::</span><span style="color:#a6e22e">visa</span>(<span style="color:#e6db74">&#39;4111111111111111&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Country</span><span style="color:#f92672">::</span><span style="color:#a6e22e">france</span>(),
</span></span><span style="display:flex;"><span>        $organization,
</span></span><span style="display:flex;"><span>        $workflow
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">it_rejects_payment_for_workflow_in_unavailable_region</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 🔴 EXEMPLE : Paiement de 50€ pour un workflow dans une région cloud indisponible
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectException</span>(<span style="color:#a6e22e">UnavailableCloudRegionException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>    $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectExceptionMessage</span>(<span style="color:#e6db74">&#39;Région cloud indisponible&#39;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    $organization <span style="color:#f92672">=</span> <span style="color:#a6e22e">Organization</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(<span style="color:#e6db74">&#39;Acme Corp&#39;</span>, <span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span>    $workflow <span style="color:#f92672">=</span> <span style="color:#a6e22e">Workflow</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>($organization, <span style="color:#a6e22e">CloudRegion</span><span style="color:#f92672">::</span><span style="color:#a6e22e">asia</span>(), <span style="color:#e6db74">&#39;active&#39;</span>); <span style="color:#75715e">// Région indisponible
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">PaymentMethod</span><span style="color:#f92672">::</span><span style="color:#a6e22e">visa</span>(<span style="color:#e6db74">&#39;4111111111111111&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Country</span><span style="color:#f92672">::</span><span style="color:#a6e22e">france</span>(),
</span></span><span style="display:flex;"><span>        $organization,
</span></span><span style="display:flex;"><span>        $workflow
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Résultat</strong> : J&rsquo;ai écrit mes tests en 30 minutes au lieu de 3 heures ! Et mes tests couvraient exactement les cas métier identifiés par l&rsquo;équipe, incluant toute la chaîne : User → Organization → Workflow → Cloud Resources → Billing.</p>
<h3 id="les-4-types-de-cartes">Les 4 Types de Cartes <a href="#les-4-types-de-cartes" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><h4 id="-cartes-jaunes--règles-métier">🟡 Cartes Jaunes : Règles Métier <a href="#-cartes-jaunes--r%c3%a8gles-m%c3%a9tier" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Les règles qui gouvernent le comportement du système.</p>
<h4 id="-cartes-vertes--exemples">🟢 Cartes Vertes : Exemples <a href="#-cartes-vertes--exemples" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Les exemples concrets qui illustrent les règles.</p>
<h4 id="-cartes-rouges--questions">🔴 Cartes Rouges : Questions <a href="#-cartes-rouges--questions" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Les questions qui émergent lors de l&rsquo;exploration.</p>
<h4 id="-cartes-bleues--scénarios">🔵 Cartes Bleues : Scénarios <a href="#-cartes-bleues--sc%c3%a9narios" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Les scénarios d&rsquo;utilisation complets.</p>
<h3 id="exemple-dexample-mapping--traitement-dun-paiement">Exemple d&rsquo;Example Mapping : Traitement d&rsquo;un Paiement <a href="#exemple-dexample-mapping--traitement-dun-paiement" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <pre tabindex="0"><code>🟡 RÈGLE : Un paiement ne peut être traité que s&#39;il est en statut &#34;pending&#34;
🟡 RÈGLE : Le montant doit être positif
🟡 RÈGLE : Le montant ne peut pas dépasser la limite du compte
🟡 RÈGLE : Un paiement traité ne peut plus être modifié

🟢 EXEMPLE : Paiement de 100€ avec compte ayant une limite de 500€
   → Résultat : Paiement traité avec succès

🟢 EXEMPLE : Paiement de -50€
   → Résultat : Erreur &#34;Montant invalide&#34;

🟢 EXEMPLE : Paiement de 600€ avec compte ayant une limite de 500€
   → Résultat : Erreur &#34;Montant dépasse la limite&#34;

🟢 EXEMPLE : Tentative de traiter un paiement déjà traité
   → Résultat : Erreur &#34;Paiement déjà traité&#34;

🔴 QUESTION : Que se passe-t-il si le compte est suspendu ?
🔴 QUESTION : Y a-t-il une limite de temps pour traiter un paiement ?
🔴 QUESTION : Peut-on traiter un paiement partiellement ?

🔵 SCÉNARIO : Processus complet de paiement
   1. Client initie un paiement
   2. Système valide le montant
   3. Système vérifie la limite du compte
   4. Système traite le paiement
   5. Système envoie une confirmation</code></pre>
<h3 id="comment-utiliser-lexample-mapping">Comment Utiliser l&rsquo;Example Mapping <a href="#comment-utiliser-lexample-mapping" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><h4 id="1-après-l">1. <strong>Après l&rsquo;Event Storming</strong> <a href="#1-apr%c3%a8s-l" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Utilisez l&rsquo;Example Mapping pour détailler les événements les plus complexes découverts lors de l&rsquo;Event Storming.</p>
<h4 id="2-en-petite-équipe">2. <strong>En Petite Équipe</strong> <a href="#2-en-petite-%c3%a9quipe" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>3-5 personnes maximum : un expert métier, un développeur, un testeur.</p>
<h4 id="3-durée-limitée">3. <strong>Durée Limitée</strong> <a href="#3-dur%c3%a9e-limit%c3%a9e" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>30-45 minutes par fonctionnalité pour éviter l&rsquo;over-engineering.</p>
<h4 id="4-focus-sur-les-cas-limites">4. <strong>Focus sur les Cas Limites</strong> <a href="#4-focus-sur-les-cas-limites" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h4><p>Concentrez-vous sur les règles métier complexes et les cas d&rsquo;erreur.</p>
<h3 id="exemple-concret--règles-de-paiement">Exemple Concret : Règles de Paiement <a href="#exemple-concret--r%c3%a8gles-de-paiement" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// Les exemples de l&#39;Example Mapping deviennent des tests
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PaymentTest</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">TestCase</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">it_processes_a_valid_payment</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 🟢 EXEMPLE : Paiement de 100€ avec compte ayant une limite de 500€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $payment <span style="color:#f92672">=</span> <span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">PaymentId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $account <span style="color:#f92672">=</span> <span style="color:#a6e22e">Account</span><span style="color:#f92672">::</span><span style="color:#a6e22e">withLimit</span>(<span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">500</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">process</span>($account);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">assertEquals</span>(<span style="color:#a6e22e">PaymentStatus</span><span style="color:#f92672">::</span><span style="color:#a6e22e">PROCESSED</span>, $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getStatus</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">it_rejects_negative_amount</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 🟢 EXEMPLE : Paiement de -50€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectException</span>(<span style="color:#a6e22e">InvalidAmountException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">PaymentId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">/** @test */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">it_rejects_amount_exceeding_limit</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 🟢 EXEMPLE : Paiement de 600€ avec compte ayant une limite de 500€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $payment <span style="color:#f92672">=</span> <span style="color:#a6e22e">Payment</span><span style="color:#f92672">::</span><span style="color:#a6e22e">create</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">PaymentId</span><span style="color:#f92672">::</span><span style="color:#a6e22e">generate</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">600</span>)
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $account <span style="color:#f92672">=</span> <span style="color:#a6e22e">Account</span><span style="color:#f92672">::</span><span style="color:#a6e22e">withLimit</span>(<span style="color:#a6e22e">Money</span><span style="color:#f92672">::</span><span style="color:#a6e22e">euros</span>(<span style="color:#ae81ff">500</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">expectException</span>(<span style="color:#a6e22e">AmountExceedsLimitException</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        $payment<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">process</span>($account);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="avantages-de-lexample-mapping">Avantages de l&rsquo;Example Mapping <a href="#avantages-de-lexample-mapping" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><ol>
<li><strong>Clarté des Règles</strong> : Les exemples concrets clarifient les règles métier</li>
<li><strong>Tests Automatiques</strong> : Les exemples deviennent des tests d&rsquo;acceptation</li>
<li><strong>Communication</strong> : Toute l&rsquo;équipe comprend les mêmes règles</li>
<li><strong>Évolution</strong> : Facile d&rsquo;ajouter de nouveaux exemples quand les règles changent</li>
</ol>
<h2 id="architecture-résultante">Architecture Résultante <a href="#architecture-r%c3%a9sultante" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h2><h3 id="structure-par-bounded-context">Structure par Bounded Context <a href="#structure-par-bounded-context" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Voici la structure réelle du projet Gyroscops Cloud, organisée par Bounded Context :</p>


    
    <pre tabindex="0"><code>api/src/
├── Accounting/           # Contexte Comptabilité
│   ├── Domain/
│   │   ├── Payment/      # Agrégat Payment
│   │   │   ├── Command/  # Modèles de commande
│   │   │   └── Query/    # Modèles de requête
│   │   ├── Subscription/ # Agrégat Subscription
│   │   └── Offer/        # Agrégat Offer
│   └── Infrastructure/   # Implémentations techniques
├── Authentication/       # Contexte Authentification
│   ├── Domain/
│   │   ├── User/         # Agrégat User
│   │   ├── Organization/ # Agrégat Organization
│   │   ├── Role/         # Agrégat Role
│   │   └── Realm/        # Agrégat Realm
│   └── Infrastructure/
├── ...
└── Platform/             # Contexte Plateforme
    ├── Domain/
    │   └── FeatureRollout/ # Agrégat FeatureRollout
    └── Infrastructure/</code></pre>
<h3 id="le-monolithe-modulaire--la-vraie-solution">Le Monolithe Modulaire : La Vraie Solution <a href="#le-monolithe-modulaire--la-vraie-solution" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce que j&rsquo;ai appris avec Gyroscops</strong> : Dans 80% des cas, les microservices sont une réponse hors sujet. La vraie dette technique, ce n&rsquo;est pas le monolithe. C&rsquo;est un monolithe mal structuré.</p>
<p>J&rsquo;ai vu trop d&rsquo;équipes exploser leur codebase en 15 services &ldquo;indépendants&rdquo; qui finissent par dépendre les uns des autres, se synchroniser à coups de webhooks bancals, et mettre 40 minutes à déboguer un simple flux métier.</p>
<p><strong>Avec les Bounded Contexts, j&rsquo;ai créé un monolithe modulaire</strong> :</p>
<ul>
<li><strong>Bien découpé en domaines fonctionnels clairs</strong> : Chaque Bounded Context correspond à un domaine métier</li>
<li><strong>Avec des interfaces internes bien définies</strong> : Les UseCases exposent des interfaces claires</li>
<li><strong>Testable, maintenable, lisible</strong> : Chaque contexte peut être testé et maintenu indépendamment</li>
<li><strong>Déployable en un clic</strong> : Un seul déploiement pour toute l&rsquo;application</li>
</ul>
<p><strong>Le résultat</strong> : J&rsquo;ai évité le piège des microservices prématurés. J&rsquo;ai un système cohérent, maintenable, et évolutif. Et quand un module devient vraiment trop gros ou trop critique, là je peux l&rsquo;extraire en microservice. Mais je pars du besoin, pas du dogme.</p>
<p><strong>Comme le dit <a href="https://www.linkedin.com/posts/jeanvincentquilichini_je-ne-fais-presque-plus-de-microservices-activity-7375767071550423040-Kivq" rel="external" target="_blank">Jean-Vincent Quilichini<svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M14 5c-.552 0-1-.448-1-1s.448-1 1-1h6c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-3.586l-7.293 7.293c-.391.39-1.024.39-1.414 0-.391-.391-.391-1.024 0-1.414l7.293-7.293h-3.586zm-9 2c-.552 0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552 0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1v4.563c0 1.657-1.343 3-3 3h-11c-1.657 0-3-1.343-3-3v-11c0-1.657 1.343-3 3-3h4.563c.552 0 1 .448 1 1s-.448 1-1 1h-4.563z"/></svg></a> : &ldquo;Le microservice doit être un outil. Pas une posture.&rdquo;</strong></p>
<h3 id="références-aux-adr-du-projet-gyroscops-cloud">Références aux ADR du projet Gyroscops Cloud <a href="#r%c3%a9f%c3%a9rences-aux-adr-du-projet-gyroscops-cloud" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3><p>Cette architecture suit les principes définis dans les Architecture Decision Records (ADR) du projet Gyroscops Cloud :</p>
<ul>
<li><strong>HIVE040</strong> : Enhanced Models with Property Access Patterns - Utilisation de propriétés publiques en lecture seule</li>
<li><strong>HIVE041</strong> : Cross-Cutting Concerns Architecture - Séparation claire des responsabilités</li>
<li><strong>HIVE005</strong> : Common Identifier Model Interfaces - Interfaces standardisées pour les identifiants</li>
<li><strong>HIVE010</strong> : Repositories - Patterns de repository avec intégration Event Bus</li>
<li><strong>HIVE023</strong> : Repository Testing Strategies - Stratégies de test pour les repositories</li>
<li><strong>HIVE027</strong> : PHPUnit Testing Standards - Standards de test PHPUnit</li>
</ul>
<h3 id="intégration-avec-api-platform">Intégration avec API Platform <a href="#int%c3%a9gration-avec-api-platform" class="anchor" aria-hidden="true"><i class="material-icons align-middle">link</i></a></h3>

    
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// Exemple d&#39;intégration API Platform
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">ApiPlatform\Metadata\Get</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">ApiPlatform\Metadata\Post</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">ApiPlatform\Metadata\Put</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#a6e22e">ApiPlatform\Metadata\Delete</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[Get]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#[GetCollection]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#[Post]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#[Patch]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Payment</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentId</span> $id,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">Money</span> $amount,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentMethods</span> $method,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">PaymentStatus</span> $status,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">DateTime</span> $createdAt
</span></span><span style="display:flex;"><span>    ) {}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>


<div class="chapter-navigation">
  <h2 class="chapter-nav-title">🎯 Votre Prochaine Étape</h2>
  <p class="chapter-nav-subtitle">Maintenant que vous comprenez les concepts de base et que j'ai partagé mon expérience avec Gyroscops, quel est votre contexte ?</p>
  
  <div class="chapter-options">
    
  
  
  
  
  
  
  
  
  
  
  
    
    
    
    
      
      
      
      
        
      
    
    
    
    
      
      
      
      
      
        
      
    
  
  
  <div class="chapter-option" data-color="green" data-draft="true">
    <div class="chapter-option-header">
      <div class="chapter-option-letter">A</div>
      <div>
        <h3 class="chapter-option-title">Je veux aligner le produit sur les objectifs business avec l&#39;Impact Mapping</h3>
        <p class="chapter-option-subtitle">Vous voulez recentrer le périmètre du projet autour d&#39;objectifs business précis</p>
      </div>
    </div>
    
    <div class="chapter-option-content">
      
      <div class="chapter-option-criteria">
        <h4 class="chapter-option-criteria-title">Critères d'adoption :</h4>
        <ul class="chapter-option-criteria-list">
          
          <li>Objectifs business à clarifier</li>
          
          <li>Besoin d&#39;aligner business et technique</li>
          
          <li>Équipe avec business owners disponibles</li>
          
          <li>Temps pour la planification stratégique</li>
          
        </ul>
      </div>
      
      
      <div class="chapter-option-footer">
        <span class="chapter-option-time">⏱️ 2-3 heures</span>
        
        
          
          <span class="chapter-option-link chapter-option-link-disabled">
            L&#39;Impact Mapping - Aligner le Produit sur les Objectifs Business
            <span class="draft-indicator">📝</span>
          </span>
        
      </div>
    </div>
  </div>
  
  <style>
   
  .chapter-option-link-disabled {
    background: #9ca3af !important;
    color: #6b7280 !important;
    cursor: not-allowed !important;
    opacity: 0.7;
  }
  
  .chapter-option-link-disabled:hover {
    background: #9ca3af !important;
    color: #6b7280 !important;
    transform: none !important;
    box-shadow: none !important;
  }
  
  .chapter-option-link-disabled::after {
    display: none !important;
  }
  
   
  .chapter-option[data-draft="true"] {
    opacity: 0.8;
    border-style: dashed;
    border-color: #d1d5db;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-letter {
    background: #9ca3af;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-title {
    color: #6b7280;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-subtitle {
    color: #9ca3af;
  }
  
   
  .draft-indicator,
  .coming-soon-indicator {
    margin-left: 0.5rem;
    font-size: 0.875rem;
  }
  
   
  .chapter-option[data-draft="true"] {
    animation: draft-pulse 2s ease-in-out infinite;
  }
  
  @keyframes draft-pulse {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
    }
  }
  </style>
  
  
  
  
  
  
  
  
  
  
  
  
    
    
    
    
      
      
      
      
        
      
    
    
    
    
      
      
      
      
      
        
      
    
  
  
  <div class="chapter-option" data-color="yellow" data-draft="true">
    <div class="chapter-option-header">
      <div class="chapter-option-letter">B</div>
      <div>
        <h3 class="chapter-option-title">Je veux apprendre la méthode Event Storming</h3>
        <p class="chapter-option-subtitle">Vous voulez maîtriser la technique de conception collaborative</p>
      </div>
    </div>
    
    <div class="chapter-option-content">
      
      <div class="chapter-option-criteria">
        <h4 class="chapter-option-criteria-title">Critères d'adoption :</h4>
        <ul class="chapter-option-criteria-list">
          
          <li>Équipe de 3-8 personnes</li>
          
          <li>Besoin de conception collaborative</li>
          
          <li>Projet complexe à modéliser</li>
          
          <li>Temps disponible pour un atelier</li>
          
        </ul>
      </div>
      
      
      <div class="chapter-option-footer">
        <span class="chapter-option-time">⏱️ 30-45 minutes</span>
        
        
          
          <span class="chapter-option-link chapter-option-link-disabled">
            L&#39;Atelier Event Storming - Guide Pratique
            <span class="draft-indicator">📝</span>
          </span>
        
      </div>
    </div>
  </div>
  
  <style>
   
  .chapter-option-link-disabled {
    background: #9ca3af !important;
    color: #6b7280 !important;
    cursor: not-allowed !important;
    opacity: 0.7;
  }
  
  .chapter-option-link-disabled:hover {
    background: #9ca3af !important;
    color: #6b7280 !important;
    transform: none !important;
    box-shadow: none !important;
  }
  
  .chapter-option-link-disabled::after {
    display: none !important;
  }
  
   
  .chapter-option[data-draft="true"] {
    opacity: 0.8;
    border-style: dashed;
    border-color: #d1d5db;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-letter {
    background: #9ca3af;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-title {
    color: #6b7280;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-subtitle {
    color: #9ca3af;
  }
  
   
  .draft-indicator,
  .coming-soon-indicator {
    margin-left: 0.5rem;
    font-size: 0.875rem;
  }
  
   
  .chapter-option[data-draft="true"] {
    animation: draft-pulse 2s ease-in-out infinite;
  }
  
  @keyframes draft-pulse {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
    }
  }
  </style>
  
  
  
  
  
  
  
  
  
  
  
  
    
    
    
    
      
      
      
      
        
      
    
    
    
    
      
      
      
      
      
        
      
    
  
  
  <div class="chapter-option" data-color="red" data-draft="true">
    <div class="chapter-option-header">
      <div class="chapter-option-letter">C</div>
      <div>
        <h3 class="chapter-option-title">Je veux détailler les règles métier avec l&#39;Example Mapping</h3>
        <p class="chapter-option-subtitle">Vous voulez explorer les règles complexes découvertes lors de l&#39;Event Storming</p>
      </div>
    </div>
    
    <div class="chapter-option-content">
      
      <div class="chapter-option-criteria">
        <h4 class="chapter-option-criteria-title">Critères d'adoption :</h4>
        <ul class="chapter-option-criteria-list">
          
          <li>Règles métier complexes identifiées</li>
          
          <li>Besoin de clarifier les cas limites</li>
          
          <li>Équipe avec expert métier disponible</li>
          
          <li>Temps pour approfondir les détails</li>
          
        </ul>
      </div>
      
      
      <div class="chapter-option-footer">
        <span class="chapter-option-time">⏱️ 30-45 minutes</span>
        
        
          
          <span class="chapter-option-link chapter-option-link-disabled">
            L&#39;Example Mapping - Détailer les Règles Métier
            <span class="draft-indicator">📝</span>
          </span>
        
      </div>
    </div>
  </div>
  
  <style>
   
  .chapter-option-link-disabled {
    background: #9ca3af !important;
    color: #6b7280 !important;
    cursor: not-allowed !important;
    opacity: 0.7;
  }
  
  .chapter-option-link-disabled:hover {
    background: #9ca3af !important;
    color: #6b7280 !important;
    transform: none !important;
    box-shadow: none !important;
  }
  
  .chapter-option-link-disabled::after {
    display: none !important;
  }
  
   
  .chapter-option[data-draft="true"] {
    opacity: 0.8;
    border-style: dashed;
    border-color: #d1d5db;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-letter {
    background: #9ca3af;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-title {
    color: #6b7280;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-subtitle {
    color: #9ca3af;
  }
  
   
  .draft-indicator,
  .coming-soon-indicator {
    margin-left: 0.5rem;
    font-size: 0.875rem;
  }
  
   
  .chapter-option[data-draft="true"] {
    animation: draft-pulse 2s ease-in-out infinite;
  }
  
  @keyframes draft-pulse {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
    }
  }
  </style>
  
  
  
  
  
  
  
  
  
  
  
  
    
    
    
    
      
      
      
      
        
      
    
    
    
    
      
      
      
      
      
        
      
    
  
  
  <div class="chapter-option" data-color="blue" data-draft="true">
    <div class="chapter-option-header">
      <div class="chapter-option-letter">D</div>
      <div>
        <h3 class="chapter-option-title">Je veux comprendre la complexité architecturale</h3>
        <p class="chapter-option-subtitle">Vous voulez savoir quand utiliser quels patterns</p>
      </div>
    </div>
    
    <div class="chapter-option-content">
      
      <div class="chapter-option-criteria">
        <h4 class="chapter-option-criteria-title">Critères d'adoption :</h4>
        <ul class="chapter-option-criteria-list">
          
          <li>Équipe expérimentée</li>
          
          <li>Besoin de choisir une architecture</li>
          
          <li>Projet avec contraintes techniques</li>
          
          <li>Décision architecturale à prendre</li>
          
        </ul>
      </div>
      
      
      <div class="chapter-option-footer">
        <span class="chapter-option-time">⏱️ 20-30 minutes</span>
        
        
          
          <span class="chapter-option-link chapter-option-link-disabled">
            Complexité Accidentelle vs Essentielle
            <span class="draft-indicator">📝</span>
          </span>
        
      </div>
    </div>
  </div>
  
  <style>
   
  .chapter-option-link-disabled {
    background: #9ca3af !important;
    color: #6b7280 !important;
    cursor: not-allowed !important;
    opacity: 0.7;
  }
  
  .chapter-option-link-disabled:hover {
    background: #9ca3af !important;
    color: #6b7280 !important;
    transform: none !important;
    box-shadow: none !important;
  }
  
  .chapter-option-link-disabled::after {
    display: none !important;
  }
  
   
  .chapter-option[data-draft="true"] {
    opacity: 0.8;
    border-style: dashed;
    border-color: #d1d5db;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-letter {
    background: #9ca3af;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-title {
    color: #6b7280;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-subtitle {
    color: #9ca3af;
  }
  
   
  .draft-indicator,
  .coming-soon-indicator {
    margin-left: 0.5rem;
    font-size: 0.875rem;
  }
  
   
  .chapter-option[data-draft="true"] {
    animation: draft-pulse 2s ease-in-out infinite;
  }
  
  @keyframes draft-pulse {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
    }
  }
  </style>
  
  
  
  
  
  
  
  
  
  
  
  
    
    
    
    
      
      
      
      
        
      
    
    
    
    
      
      
      
      
      
        
      
    
  
  
  <div class="chapter-option" data-color="purple" data-draft="true">
    <div class="chapter-option-header">
      <div class="chapter-option-letter">E</div>
      <div>
        <h3 class="chapter-option-title">Je veux voir des exemples concrets de modèles</h3>
        <p class="chapter-option-subtitle">Vous voulez comprendre la différence entre modèles riches et anémiques</p>
      </div>
    </div>
    
    <div class="chapter-option-content">
      
      <div class="chapter-option-criteria">
        <h4 class="chapter-option-criteria-title">Critères d'adoption :</h4>
        <ul class="chapter-option-criteria-list">
          
          <li>Développeur avec expérience</li>
          
          <li>Besoin d&#39;exemples pratiques</li>
          
          <li>Compréhension des patterns de code</li>
          
          <li>Implémentation à faire</li>
          
        </ul>
      </div>
      
      
      <div class="chapter-option-footer">
        <span class="chapter-option-time">⏱️ 25-35 minutes</span>
        
        
          
          <span class="chapter-option-link chapter-option-link-disabled">
            Modèles Riches vs Modèles Anémiques
            <span class="draft-indicator">📝</span>
          </span>
        
      </div>
    </div>
  </div>
  
  <style>
   
  .chapter-option-link-disabled {
    background: #9ca3af !important;
    color: #6b7280 !important;
    cursor: not-allowed !important;
    opacity: 0.7;
  }
  
  .chapter-option-link-disabled:hover {
    background: #9ca3af !important;
    color: #6b7280 !important;
    transform: none !important;
    box-shadow: none !important;
  }
  
  .chapter-option-link-disabled::after {
    display: none !important;
  }
  
   
  .chapter-option[data-draft="true"] {
    opacity: 0.8;
    border-style: dashed;
    border-color: #d1d5db;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-letter {
    background: #9ca3af;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-title {
    color: #6b7280;
  }
  
  .chapter-option[data-draft="true"] .chapter-option-subtitle {
    color: #9ca3af;
  }
  
   
  .draft-indicator,
  .coming-soon-indicator {
    margin-left: 0.5rem;
    font-size: 0.875rem;
  }
  
   
  .chapter-option[data-draft="true"] {
    animation: draft-pulse 2s ease-in-out infinite;
  }
  
  @keyframes draft-pulse {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
    }
  }
  </style>

  </div>
</div>

<style>
.chapter-navigation {
  margin: 2rem 0;
  padding: 1.5rem;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border-radius: 12px;
  border-left: 4px solid #3b82f6;
}

.chapter-nav-title {
  margin: 0 0 0.5rem 0;
  font-size: 1.5rem;
  font-weight: 700;
  color: #1e293b;
}

.chapter-nav-subtitle {
  margin: 0 0 1.5rem 0;
  color: #64748b;
  font-size: 1rem;
  line-height: 1.6;
}

.chapter-options {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

 
.chapter-option {
  background: white;
  border-radius: 8px;
  padding: 1.25rem;
  border: 1px solid #e2e8f0;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.chapter-option:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: #3b82f6;
}

.chapter-option::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: var(--option-color, #6b7280);
  border-radius: 0 2px 2px 0;
}

.chapter-option-header {
  display: flex;
  align-items: center;
  margin-bottom: 0.75rem;
}

.chapter-option-letter {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  background: var(--option-color, #6b7280);
  color: white;
  font-weight: 700;
  font-size: 0.875rem;
  margin-right: 0.75rem;
  flex-shrink: 0;
}

.chapter-option-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0;
  line-height: 1.4;
}

.chapter-option-subtitle {
  font-size: 0.875rem;
  color: #64748b;
  font-style: italic;
  margin: 0.25rem 0 0 0;
  line-height: 1.4;
}

.chapter-option-content {
  margin-left: 2.75rem;
}

.chapter-option-criteria {
  margin-bottom: 0.75rem;
}

.chapter-option-criteria-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  margin: 0 0 0.5rem 0;
}

.chapter-option-criteria-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.chapter-option-criteria-list li {
  position: relative;
  padding-left: 1.25rem;
  margin-bottom: 0.25rem;
  font-size: 0.875rem;
  color: #4b5563;
  line-height: 1.4;
}

.chapter-option-criteria-list li::before {
  content: '✓';
  position: absolute;
  left: 0;
  color: #10b981;
  font-weight: 600;
}

.chapter-option-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
  padding-top: 0.75rem;
  border-top: 1px solid #e5e7eb;
}

.chapter-option-time {
  font-size: 0.875rem;
  color: #6b7280;
  font-weight: 500;
}

.chapter-option-link {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 1rem;
  background: var(--option-color, #6b7280);
  color: white !important;
  text-decoration: none !important;
  border-radius: 6px;
  font-weight: 600;
  font-size: 0.875rem;
  transition: all 0.2s ease;
  border: none;
  cursor: pointer;
}

.chapter-option-link:hover {
  background: var(--option-color-dark, #4b5563);
  color: white !important;
  text-decoration: none !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.chapter-option-link:visited {
  color: white !important;
  text-decoration: none !important;
}

.chapter-option-link:focus {
  color: white !important;
  text-decoration: none !important;
  outline: 2px solid rgba(255, 255, 255, 0.5);
  outline-offset: 2px;
}

.chapter-option-link:active {
  color: white !important;
  text-decoration: none !important;
}

.chapter-option-link::after {
  content: '→';
  margin-left: 0.5rem;
  transition: transform 0.2s ease;
  color: white !important;
}

.chapter-option-link:hover::after {
  transform: translateX(2px);
  color: white !important;
}

 
.chapter-navigation a {
  color: inherit;
  text-decoration: none;
}

.chapter-navigation a:hover {
  color: inherit;
  text-decoration: none;
}

.chapter-navigation a:visited {
  color: inherit;
  text-decoration: none;
}

.chapter-navigation a:focus {
  color: inherit;
  text-decoration: none;
}

.chapter-navigation a:active {
  color: inherit;
  text-decoration: none;
}

 
.chapter-option[data-color="green"] {
  --option-color: #10b981;
  --option-color-dark: #059669;
}

.chapter-option[data-color="yellow"] {
  --option-color: #f59e0b;
  --option-color-dark: #d97706;
}

.chapter-option[data-color="red"] {
  --option-color: #ef4444;
  --option-color-dark: #dc2626;
}

.chapter-option[data-color="blue"] {
  --option-color: #3b82f6;
  --option-color-dark: #2563eb;
}

.chapter-option[data-color="purple"] {
  --option-color: #8b5cf6;
  --option-color-dark: #7c3aed;
}

.chapter-option[data-color="orange"] {
  --option-color: #f97316;
  --option-color-dark: #ea580c;
}

.chapter-option[data-color="teal"] {
  --option-color: #14b8a6;
  --option-color-dark: #0d9488;
}

.chapter-option[data-color="indigo"] {
  --option-color: #6366f1;
  --option-color-dark: #4f46e5;
}

.chapter-option[data-color="pink"] {
  --option-color: #ec4899;
  --option-color-dark: #db2777;
}

.chapter-option[data-color="cyan"] {
  --option-color: #06b6d4;
  --option-color-dark: #0891b2;
}

 
@media (max-width: 768px) {
  .chapter-navigation {
    padding: 1rem;
  }
  
  .chapter-option {
    padding: 1rem;
  }
  
  .chapter-option-content {
    margin-left: 2.5rem;
  }
  
  .chapter-option-footer {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }
  
  .chapter-option-link {
    align-self: stretch;
    justify-content: center;
  }
}
</style>

<p><strong>💡 Conseil</strong> : Si vous n&rsquo;êtes pas sûr, choisissez l&rsquo;option A pour commencer par l&rsquo;Impact Mapping, puis continuez avec les autres chapitres dans l&rsquo;ordre.</p>
<p><strong>🔄 Alternative</strong> : Si vous voulez tout voir dans l&rsquo;ordre, commencez par le <a href="/chapitres/fondamentaux/chapitre-02-impact-mapping/">Chapitre 2</a>.</p>

    </div>

    

    
                                            </div>
                                            <div><hr class="doc-hr">
<div id="doc-nav" class="d-print-none">

	<div class="row flex-xl-nowrap flex-row-reverse">
	<div class="col-sm-6 pt-2 doc-prev">
		<a class="ms-auto" href="/chapitres/fondamentaux/chapitre-02-impact-mapping/">
			<div class="card h-100 my-1 text-end">
				<div class="card-body py-2">
                    <p class="card-title fs-5 fw-semibold lh-base mb-0">Chapitre 2 : L&#39;Impact Mapping - Aligner le Produit sur les Objectifs Business <i class="material-icons align-middle">navigate_next</i></p>
					
				</div>
			</div>
		</a>
        </div>
	</div>
</div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
<footer class="shadow py-3 d-print-none">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col">
                <div class="text-sm-start text-center mx-md-2">
                    <p class="mb-0">
                        
                        © 2025 Grégory Planchat. Tous droits réservés.
                    </p>
                </div>
            </div>
        </div>
        
        
        
        <div class="row mt-3 pt-3 border-top">
            <div class="col-12">
                <div class="text-center">
                    <h6 class="text-muted mb-2">Nos Sponsors</h6>
                    <p class="text-muted small mb-2">Merci à nos partenaires qui soutiennent cette initiative</p>
                    <div class="d-flex justify-content-center align-items-center flex-wrap gap-2">
                        
                        <div class="sponsor-item">
                            <a href="https://kiboko.fr" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
                                <span class="badge bg-light text-dark border px-2 py-1 small">Kiboko</span>
                            </a>
                        </div>
                        
                        <div class="sponsor-item">
                            <a href="https://gyroscops.com" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
                                <span class="badge bg-light text-dark border px-2 py-1 small">Gyroscops</span>
                            </a>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</footer>
</main>
            </div>
        </div>

        
        
        <button onclick="topFunction()" id="back-to-top" aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12,10.224l-6.3,6.3L4.32,15.152,12,7.472l7.68,7.68L18.3,16.528Z" style="fill:#fff"/></svg></button>
        
        

        
        




    
    
    






    <script src="/docs/js/bootstrap.js" defer></script>


    <script type="text/javascript" src="//localhost:41733/docs/js/bundle.js" defer></script>

        

        
        <script type="module">
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script>
        
    </body>
</html>
