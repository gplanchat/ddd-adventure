<!doctype html><html lang=fr-fr><head><meta charset=utf-8><title>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming | DDD Adventure</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="D√©couvrir le Domain-Driven Design d'Eric Evans, l'Event Storming et l'Example Mapping pour r√©v√©ler la complexit√© m√©tier"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=https://votre-domaine.fr/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=https://votre-domaine.fr/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=https://votre-domaine.fr/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://votre-domaine.fr/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://votre-domaine.fr/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://votre-domaine.fr/site.webmanifest><meta property="og:title" content="Chapitre 1 : Introduction au Domain-Driven Design et Event Storming"><meta property="og:description" content="D√©couvrir le Domain-Driven Design d'Eric Evans, l'Event Storming et l'Example Mapping pour r√©v√©ler la complexit√© m√©tier"><meta property="og:type" content="article"><meta property="og:url" content="https://votre-domaine.fr/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/"><meta property="og:image" content="https://votre-domaine.fr/opengraph/card-base-2_hu_24199e2a69348535.png"><meta property="article:section" content="chapitres"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://votre-domaine.fr/opengraph/card-base-2_hu_24199e2a69348535.png"><meta name=twitter:title content="Chapitre 1 : Introduction au Domain-Driven Design et Event Storming"><meta name=twitter:description content="D√©couvrir le Domain-Driven Design d'Eric Evans, l'Event Storming et l'Example Mapping pour r√©v√©ler la complexit√© m√©tier"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=https://votre-domaine.fr/docs/js/flexsearch.bundle.min.f5159d5a2151ffbb653996ec17eaff7da4e04c286bd879fc41839d36a5586f3f20eaead0b6089de48f9adc669cdee771.js integrity=sha384-9RWdWiFR/7tlOZbsF+r/faTgTChr2Hn8QYOdNqVYbz8g6urQtgid5I+a3Gac3udx crossorigin=anonymous></script><link rel=stylesheet href=/docs/scss/style.min.9f198180aa929b3c2276b402b796e74ed231639ad7ea837d05515b5be35ef385e0980b2bc2499d09dad5d011b90710cf.css integrity=sha384-nxmBgKqSmzwidrQCt5bnTtIxY5rX6oN9BVFbW+Ne84XgmAsrwkmdCdrV0BG5BxDP crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li class="sidebar-dropdown no-icon current active"><button class=btn>
Chapitres Fondamentaux</button><div class="sidebar-submenu d-block"><ul><li class="current no-icon"><a class=sidebar-nested-link href=https://votre-domaine.fr/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</a></li><li class=no-icon><a class=sidebar-nested-link href=https://votre-domaine.fr/chapitres/fondamentaux/chapitre-02-impact-mapping/>Chapitre 2 : L'Impact Mapping - Aligner le Produit sur les Objectifs Business</a></li></ul></div></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"><li class="list-inline-item mb-0"><a href=https://twitter.com/gplanchat alt=twitter rel="noopener noreferrer" target=_blank><div class="btn btn-icon btn-default border-0"><svg width="24" height="24" viewBox="0 0 24 24"><title>Twitter / X</title><path d="M.088.768l9.266 12.39L.029 23.231h2.1l8.163-8.819 6.6 8.819h7.142L14.242 10.145 22.921.768h-2.1L13.3 8.891 7.229.768zM3.174 2.314H6.455L20.942 21.685h-3.28z" fill="currentColor"/></svg></div></a></li></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/fondamentaux/><span itemprop=name>Chapitres Fondamentaux</span>
</a><meta itemprop=position content='2'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</span>
<meta itemprop=position content='3'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-objectif-de-ce-chapitre>üéØ Objectif de ce Chapitre</a><ul><li><a href=#un-r√©cit-personnel>Un R√©cit Personnel</a></li><li><a href=#la-complexit√©-qui-sinstalle>La Complexit√© qui s&rsquo;installe</a></li><li><a href=#ce-chapitre-change-la-donne>Ce Chapitre Change la Donne</a></li><li><a href=#les-trois-piliers-du-pilotage-de-projet>Les Trois Piliers du Pilotage de Projet</a></li><li><a href=#pourquoi-cette-d√©marche->Pourquoi cette D√©marche ?</a></li><li><a href=#savoir-bien-structurer-son-monolithe-modulaire>Savoir bien structurer son monolithe modulaire</a></li></ul></li><li><a href=#le-domain-driven-design--une-approche-centr√©e-sur-le-m√©tier>Le Domain-Driven Design : Une Approche Centr√©e sur le M√©tier</a><ul><li><a href=#les-fondements-selon-eric-evans>Les Fondements selon Eric Evans</a></li><li><a href=#les-concepts-cl√©s-du-ddd>Les Concepts Cl√©s du DDD</a></li><li><a href=#exemple-concret--un-syst√®me-de-paiement>Exemple Concret : Un Syst√®me de Paiement</a></li></ul></li><li><a href=#pourquoi-le-crud-limite-vos-mouvements>Pourquoi le CRUD limite vos mouvements</a><ul><li><a href=#mon-pi√®ge--la-simplicit√©-apparente-du-crud>Mon Pi√®ge : La Simplicit√© Apparente du CRUD</a></li><li><a href=#le-pi√®ge-du-crud>Le Pi√®ge du CRUD</a></li><li><a href=#la-solution--des-commandes-m√©tier>La Solution : Des Commandes M√©tier</a></li></ul></li><li><a href=#pourquoi-les-mod√®les-an√©miques-vous-emp√™chent-davancer-plus-vite>Pourquoi les mod√®les an√©miques vous emp√™chent d&rsquo;avancer plus vite</a><ul><li><a href=#mon-illusion--la-s√©paration-des-responsabilit√©s>Mon Illusion : La S√©paration des Responsabilit√©s</a></li><li><a href=#mon-pi√®ge--les-mod√®les-an√©miques>Mon Pi√®ge : Les Mod√®les An√©miques</a></li><li><a href=#la-solution--des-mod√®les-riches>La Solution : Des Mod√®les Riches</a></li><li><a href=#mapper-entre-agr√©gat-et-entit√©-doctrine><strong>Mapper entre Agr√©gat et Entit√© Doctrine</strong></a></li></ul></li><li><a href=#levent-storming--r√©v√©ler-la-complexit√©-m√©tier>L&rsquo;Event Storming : R√©v√©ler la Complexit√© M√©tier</a><ul><li><a href=#mon-probl√®me--je-ne-voyais-que-la-pointe-de-liceberg>Mon Probl√®me : Je Ne Voyais Que la Pointe de l&rsquo;Iceberg</a></li><li><a href=#quest-ce-que-levent-storming->Qu&rsquo;est-ce que l&rsquo;Event Storming ?</a></li><li><a href=#pourquoi-levent-storming->Pourquoi l&rsquo;Event Storming ?</a></li><li><a href=#les-7-√©tapes-de-levent-storming>Les 7 √âtapes de l&rsquo;Event Storming</a></li><li><a href=#exemple-devent-storming--syst√®me-de-paiement>Exemple d&rsquo;Event Storming : Syst√®me de Paiement</a></li></ul></li><li><a href=#architecture-r√©sultante>Architecture R√©sultante</a><ul><li><a href=#structure-par-bounded-context>Structure par Bounded Context</a></li><li><a href=#le-monolithe-modulaire--la-vraie-solution>Le Monolithe Modulaire : La Vraie Solution</a></li><li><a href=#r√©f√©rences-aux-adr-du-projet-gyroscops-cloud>R√©f√©rences aux ADR du projet Gyroscops Cloud</a></li><li><a href=#int√©gration-avec-api-platform>Int√©gration avec API Platform</a></li></ul></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-objectif-de-ce-chapitre>üéØ Objectif de ce Chapitre</a><ul><li><a href=#un-r√©cit-personnel>Un R√©cit Personnel</a></li><li><a href=#la-complexit√©-qui-sinstalle>La Complexit√© qui s&rsquo;installe</a></li><li><a href=#ce-chapitre-change-la-donne>Ce Chapitre Change la Donne</a></li><li><a href=#les-trois-piliers-du-pilotage-de-projet>Les Trois Piliers du Pilotage de Projet</a></li><li><a href=#pourquoi-cette-d√©marche->Pourquoi cette D√©marche ?</a></li><li><a href=#savoir-bien-structurer-son-monolithe-modulaire>Savoir bien structurer son monolithe modulaire</a></li></ul></li><li><a href=#le-domain-driven-design--une-approche-centr√©e-sur-le-m√©tier>Le Domain-Driven Design : Une Approche Centr√©e sur le M√©tier</a><ul><li><a href=#les-fondements-selon-eric-evans>Les Fondements selon Eric Evans</a></li><li><a href=#les-concepts-cl√©s-du-ddd>Les Concepts Cl√©s du DDD</a></li><li><a href=#exemple-concret--un-syst√®me-de-paiement>Exemple Concret : Un Syst√®me de Paiement</a></li></ul></li><li><a href=#pourquoi-le-crud-limite-vos-mouvements>Pourquoi le CRUD limite vos mouvements</a><ul><li><a href=#mon-pi√®ge--la-simplicit√©-apparente-du-crud>Mon Pi√®ge : La Simplicit√© Apparente du CRUD</a></li><li><a href=#le-pi√®ge-du-crud>Le Pi√®ge du CRUD</a></li><li><a href=#la-solution--des-commandes-m√©tier>La Solution : Des Commandes M√©tier</a></li></ul></li><li><a href=#pourquoi-les-mod√®les-an√©miques-vous-emp√™chent-davancer-plus-vite>Pourquoi les mod√®les an√©miques vous emp√™chent d&rsquo;avancer plus vite</a><ul><li><a href=#mon-illusion--la-s√©paration-des-responsabilit√©s>Mon Illusion : La S√©paration des Responsabilit√©s</a></li><li><a href=#mon-pi√®ge--les-mod√®les-an√©miques>Mon Pi√®ge : Les Mod√®les An√©miques</a></li><li><a href=#la-solution--des-mod√®les-riches>La Solution : Des Mod√®les Riches</a></li><li><a href=#mapper-entre-agr√©gat-et-entit√©-doctrine><strong>Mapper entre Agr√©gat et Entit√© Doctrine</strong></a></li></ul></li><li><a href=#levent-storming--r√©v√©ler-la-complexit√©-m√©tier>L&rsquo;Event Storming : R√©v√©ler la Complexit√© M√©tier</a><ul><li><a href=#mon-probl√®me--je-ne-voyais-que-la-pointe-de-liceberg>Mon Probl√®me : Je Ne Voyais Que la Pointe de l&rsquo;Iceberg</a></li><li><a href=#quest-ce-que-levent-storming->Qu&rsquo;est-ce que l&rsquo;Event Storming ?</a></li><li><a href=#pourquoi-levent-storming->Pourquoi l&rsquo;Event Storming ?</a></li><li><a href=#les-7-√©tapes-de-levent-storming>Les 7 √âtapes de l&rsquo;Event Storming</a></li><li><a href=#exemple-devent-storming--syst√®me-de-paiement>Exemple d&rsquo;Event Storming : Syst√®me de Paiement</a></li></ul></li><li><a href=#architecture-r√©sultante>Architecture R√©sultante</a><ul><li><a href=#structure-par-bounded-context>Structure par Bounded Context</a></li><li><a href=#le-monolithe-modulaire--la-vraie-solution>Le Monolithe Modulaire : La Vraie Solution</a></li><li><a href=#r√©f√©rences-aux-adr-du-projet-gyroscops-cloud>R√©f√©rences aux ADR du projet Gyroscops Cloud</a></li><li><a href=#int√©gration-avec-api-platform>Int√©gration avec API Platform</a></li></ul></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h2 id=-objectif-de-ce-chapitre>üéØ Objectif de ce Chapitre <a href=#-objectif-de-ce-chapitre class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=un-r√©cit-personnel>Un R√©cit Personnel <a href=#un-r%c3%a9cit-personnel class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Il est 17h30, je viens de passer 3 heures dans xdebug pour un bug qui semblait simple. Le probl√®me ? Une modification
dans une partie du code a cass√© quelque chose dans une autre partie, √† des kilom√®tres de l√†. Je me demande : &ldquo;Comment en
sommes-nous arriv√©s l√† ?&rdquo;</p><p><strong>Cette situation vous dit quelque chose ?</strong></p><p>Moi, je l&rsquo;ai v√©cue des dizaines de fois :</p><ul><li>J&rsquo;ajoute une fonctionnalit√© et 3 autres se cassent</li><li>Chaque modification n√©cessite de toucher √† 5 fichiers diff√©rents</li><li>Je ne comprends plus pourquoi le code fait ce qu&rsquo;il fait</li><li>Les tests passent mais l&rsquo;application ne fonctionne pas comme attendu</li><li>J&rsquo;ai peur de modifier du code &ldquo;qui marche&rdquo;</li></ul><h3 id=la-complexit√©-qui-sinstalle>La Complexit√© qui s&rsquo;installe <a href=#la-complexit%c3%a9-qui-sinstalle class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Ce n&rsquo;√©tait pas de ma faute. Mon projet Gyroscops a commenc√© avec de bonnes intentions : une architecture simple, du code
propre, des tests. Mais quelque part sur le chemin, la complexit√© s&rsquo;est install√©e insidieusement. Elle se cachait
derri√®re des noms de variables trompeurs ou simplistes, des m√©thodes qui faisaient trop de choses, des d√©pendances
cach√©es.</p><p><strong>Le probl√®me fondamental ?</strong> J&rsquo;ai construit mon logiciel comme si le m√©tier √©tait simple. Lorsque l&rsquo;on d√©marre un
projet, on a une vision partielle de ce qui sera n√©cessaire. De fait, j&rsquo;ai essay√© de forcer la r√©alit√© m√©tier dans des
structures techniques rigides, et cela a fini par rendre la maintenance insoutenable. Pour ajouter √† cette complexit√©
existante, j&rsquo;ai voulu fournir le service sous la forme de SaaS, ce qui a ajout√© un niveau de complexit√©
technique suppl√©mentaire.</p><p><strong>Le r√©sultat ?</strong> J&rsquo;ai d√ª bloquer toutes les √©volutions du produit pendant 2 mois pour remettre l&rsquo;application dans un
√©tat qui soit plus facile √† maintenir.</p><h3 id=ce-chapitre-change-la-donne>Ce Chapitre Change la Donne <a href=#ce-chapitre-change-la-donne class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Ce chapitre pose les fondations de l&rsquo;approche que l&rsquo;on a d√©velopp√©e pour √©viter de retomber dans ces pi√®ges :</p><ul><li><strong>Les principes fondamentaux</strong> du Domain-Driven Design selon Eric Evans</li><li><strong>Pourquoi le CRUD limite vos mouvements</strong> et vous fait perdre du temps</li><li><strong>Pourquoi les mod√®les an√©miques</strong> vous emp√™chent d&rsquo;avancer plus vite</li><li><strong>Comment l&rsquo;Impact Mapping</strong> aligne le produit sur les objectifs business</li><li><strong>Comment l&rsquo;Event Storming</strong> r√©v√®le la complexit√© m√©tier cach√©e</li><li><strong>Comment l&rsquo;Example Mapping</strong> d√©taille les r√®gles m√©tier complexes</li></ul><h3 id=les-trois-piliers-du-pilotage-de-projet>Les Trois Piliers du Pilotage de Projet <a href=#les-trois-piliers-du-pilotage-de-projet class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>L&rsquo;Impact Mapping, l&rsquo;Event Storming et l&rsquo;Example Mapping ne sont pas seulement des techniques de d√©veloppement.</strong> Ce sont les <strong>piliers fondamentaux de l&rsquo;aide √† la d√©cision strat√©gique</strong> dans le monde de l&rsquo;√©dition logicielle et des services de d√©veloppement.</p><p>Ces trois m√©thodes vous permettent d&rsquo;aller <strong>au-del√† du code, au-del√† de la technique</strong> pour vous concentrer sur ce qui compte vraiment :</p><h4 id=-l--la-boussole-strat√©gique>üéØ <strong>L&rsquo;Impact Mapping</strong> : La Boussole Strat√©gique <a href=#-l--la-boussole-strat%c3%a9gique class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><ul><li><strong>D√©cide QUOI</strong> d√©velopper en fonction des objectifs business</li><li><strong>Priorise</strong> les fonctionnalit√©s selon leur impact r√©el</li><li><strong>Aligne</strong> l&rsquo;√©quipe technique sur les enjeux m√©tier</li><li><strong>√âvite</strong> de construire des fonctionnalit√©s inutiles</li></ul><h4 id=-l--le-plan-architectural>üèóÔ∏è <strong>L&rsquo;Event Storming</strong> : Le Plan Architectural <a href=#-l--le-plan-architectural class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><ul><li><strong>D√©cide COMMENT</strong> structurer le syst√®me m√©tier</li><li><strong>R√©v√®le</strong> la complexit√© cach√©e du domaine</li><li><strong>Con√ßoit</strong> l&rsquo;architecture en collaboration avec les experts m√©tier</li><li><strong>√âvite</strong> les architectures techniques d√©connect√©es du m√©tier</li></ul><h4 id=-l--le-guide-dimpl√©mentation>üìã <strong>L&rsquo;Example Mapping</strong> : Le Guide d&rsquo;Impl√©mentation <a href=#-l--le-guide-dimpl%c3%a9mentation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><ul><li><strong>D√©cide QUAND</strong> et <strong>POURQUOI</strong> appliquer les r√®gles m√©tier</li><li><strong>D√©taille</strong> les cas limites et exceptions</li><li><strong>Transforme</strong> les r√®gles abstraites en exemples concrets</li><li><strong>√âvite</strong> les malentendus entre business et technique</li></ul><p><strong>Ensemble, ces trois m√©thodes constituent un syst√®me complet d&rsquo;aide √† la d√©cision</strong> qui vous guide de la strat√©gie business jusqu&rsquo;√† l&rsquo;impl√©mentation technique, en passant par la conception architecturale.</p><h3 id=pourquoi-cette-d√©marche->Pourquoi cette D√©marche ? <a href=#pourquoi-cette-d%c3%a9marche- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>L&rsquo;arriv√©e de la GenAI et de la programmation agentique transforme progressivement le m√©tier de d√©veloppeur.</strong> Cette √©volution change la fa√ßon dont nous concevons et d√©veloppons des logiciels.</p><p><strong>La nouvelle r√©alit√© :</strong> Ceux qui ma√Ætrisent l&rsquo;architecture m√©tier et savent <strong>orchestrer les outils IA</strong> sont plus efficaces.</p><p><strong>‚Üí <a href=/concept/mutation-metier-developpeur/>D√©couvrir pourquoi ces m√©thodes sont importantes dans l&rsquo;√®re de la GenAI</a></strong></p><h3 id=savoir-bien-structurer-son-monolithe-modulaire>Savoir bien structurer son monolithe modulaire <a href=#savoir-bien-structurer-son-monolithe-modulaire class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce que d√©velopper Gyroscops a r√©v√©l√©</strong> : M√™me quand on d√©marre un projet, il est important de construire un
monolithe modulaire bien structur√©. Le sujet des Micro-services a toujours √©t√© exclu dans mon cas, mais je suis tomb√©
dans le pi√®ge de la complexit√© √† cause de contraintes techniques que je n&rsquo;ai pas tout de suite s√©par√© des contraintes
m√©tiers.</p><p>Depuis 2008, j&rsquo;ai beaucoup travaill√© dans le milieu de l&rsquo;e-commerce, souvent pour r√©cup√©rer des projets en souffrance.
Quand on fait de l&rsquo;int√©gration d&rsquo;une solution existante, on est guid√©, on peut rester dans les rails de ce que l&rsquo;√©diteur
a pr√©vu pour nous. Cependant, les projets qui √©chouent sont souvent ceux o√π l&rsquo;√©quipe de d√©veloppement n&rsquo;a pas pris
suffisamment de temps pour r√©fl√©chir au besoin m√©tier. J&rsquo;ai souvent vu des √©quipes exploser leur codebase en 15 services
&ldquo;ind√©pendants&rdquo; qui finissent par d√©pendre les uns des autres. Je l&rsquo;ai probablement fait en d√©but de carri√®re.</p><p><strong>Aujourd&rsquo;hui, je pr√©f√®re un monolithe modulaire</strong> :</p><ul><li>Bien d√©coup√© en domaines fonctionnels clairs</li><li>Avec des interfaces internes bien d√©finies</li><li>Testable, maintenable, lisible</li><li>D√©ployable en un clic</li></ul><p>Et le jour o√π un module deviendra vraiment trop gros ou trop critique, l√† je r√©fl√©chirais √† la possibilit√© de l&rsquo;extraire
en microservice. Mais je pars du besoin, pas du dogme.</p><p><strong>Le microservice doit √™tre un outil. Pas une posture.</strong></p><h2 id=le-domain-driven-design--une-approche-centr√©e-sur-le-m√©tier>Le Domain-Driven Design : Une Approche Centr√©e sur le M√©tier <a href=#le-domain-driven-design--une-approche-centr%c3%a9e-sur-le-m%c3%a9tier class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=les-fondements-selon-eric-evans>Les Fondements selon Eric Evans <a href=#les-fondements-selon-eric-evans class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le Domain-Driven Design (DDD) est une approche de d√©veloppement logiciel qui place le domaine m√©tier au c≈ìur de la
conception. Eric Evans, dans son livre fondateur &ldquo;Domain-Driven Design: Tackling Complexity in the Heart of Software&rdquo;,
nous enseigne que :</p><blockquote><p>&ldquo;Le logiciel doit refl√©ter le domaine m√©tier, pas l&rsquo;inverse.&rdquo;</p></blockquote><h3 id=les-concepts-cl√©s-du-ddd>Les Concepts Cl√©s du DDD <a href=#les-concepts-cl%c3%a9s-du-ddd class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><h4 id=1-le-langage-ubiquitaire-ubiquitous-language>1. Le Langage Ubiquitaire (Ubiquitous Language) <a href=#1-le-langage-ubiquitaire-ubiquitous-language class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Le langage utilis√© par l&rsquo;√©quipe de d√©veloppement doit √™tre le m√™me que celui du domaine m√©tier. Pas de traduction, pas
de jargon technique qui √©loigne du m√©tier. Pas de charge mentale pour se souvenir de chaque d√©finition en fonction du
contexte.</p><h4 id=2-les-bounded-contexts>2. Les Bounded Contexts <a href=#2-les-bounded-contexts class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Chaque contexte m√©tier a ses propres mod√®les, sa propre logique. Un &ldquo;Client&rdquo; dans le contexte &ldquo;Ventes&rdquo; n&rsquo;est pas le m√™me
qu&rsquo;un &ldquo;Client&rdquo; dans le contexte &ldquo;Cloud&rdquo;.</p><h4 id=3-les-agr√©gats>3. Les Agr√©gats <a href=#3-les-agr%c3%a9gats class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Des grappes d&rsquo;objets m√©tier qui sont trait√©s comme une unit√© coh√©rente. L&rsquo;agr√©gat prot√®ge ses invariants m√©tier.</p><h4 id=4-les-value-objects>4. Les Value Objects <a href=#4-les-value-objects class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Des objets immuables qui repr√©sentent des concepts m√©tier par leur valeur, pas par leur identit√©.</p><p><strong>Exemple concret du projet Gyroscops Cloud</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Assert\Assertion</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Brick\Math\BigDecimal</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Value Object - Price
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Price</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>BigDecimal</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Currencies</span> $currency,
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>true</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isGreaterThan</span>(<span style=color:#ae81ff>0</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>inEuros</span>(<span style=color:#a6e22e>BigDecimal</span> $amount)<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>($amount, <span style=color:#a6e22e>Currencies</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Euro</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>plus</span>(<span style=color:#a6e22e>BigNumber</span><span style=color:#f92672>|</span><span style=color:#a6e22e>string</span> $number)<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>(
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>plus</span>($number),
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>multipliedBy</span>(<span style=color:#a6e22e>BigNumber</span><span style=color:#f92672>|</span><span style=color:#a6e22e>string</span> $number)<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>(
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>multipliedBy</span>($number),
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isGreaterThanOrEqualTo</span>(<span style=color:#a6e22e>self</span> $price)<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($price<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span> <span style=color:#f92672>!==</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CurrencyMismatchException</span>(<span style=color:#e6db74>&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isGreaterThanOrEqualTo</span>($price<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isEqualTo</span>(<span style=color:#a6e22e>self</span> $price)<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($price<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span> <span style=color:#f92672>!==</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CurrencyMismatchException</span>(<span style=color:#e6db74>&#39;Currency conversion is not supported&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isEqualTo</span>($price<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div><p><strong>Ce que cet exemple montre</strong> :</p><ul><li><strong>Immutabilit√©</strong> : <code>readonly</code> et constructeur priv√© emp√™chent la modification, chaque op√©ration de modification produit la cr√©ation d&rsquo;une nouvelle instance d&rsquo;objet modifi√©</li><li><strong>Validation</strong> : Le constructeur valide que le montant n&rsquo;est pas n√©gatif</li><li><strong>Logique m√©tier</strong> : Les op√©rations arithm√©tiques respectent les r√®gles m√©tier</li><li><strong>Comparaison par valeur</strong> : Deux <code>Price</code> avec le m√™me montant et la m√™me devise sont √©gaux</li><li><strong>Encapsulation</strong> : La logique de calcul des prix est centralis√©e dans le Value Object</li></ul><h3 id=exemple-concret--un-syst√®me-de-paiement>Exemple Concret : Un Syst√®me de Paiement <a href=#exemple-concret--un-syst%c3%a8me-de-paiement class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Voici un exemple r√©el tir√© du projet Gyroscops Cloud, montrant comment l&rsquo;approche DDD guide la conception :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Assert\Assertion</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Approche DDD - Le domaine m√©tier guide la conception
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Payment</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentId</span> $uuid,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>RealmId</span> $realmId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>OrganizationId</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>SubscriptionId</span> $subscriptionId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>\DateTimeInterface</span> $creationDate <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>\DateTimeInterface</span> $expirationDate <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>\DateTimeInterface</span> $completionDate <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Statuses</span> $status <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Gateways</span> $gateway <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Price</span> $subtotal <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Price</span> $discount <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Price</span> $taxes <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Price</span> $total <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Price</span> $captured <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>array</span> $events <span style=color:#f92672>=</span> [],
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>int</span> $version <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>registerOnlinePayment</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PaymentId</span> $uuid,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>RealmId</span> $realmId,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>OrganizationId</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>SubscriptionId</span> $subscriptionId,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>\DateTimeInterface</span> $creationDate,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>\DateTimeInterface</span> $expirationDate,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $customerEmail,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Price</span> $subtotal,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Price</span> $discount,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Price</span> $vat,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Price</span> $total,
</span></span><span style=display:flex><span>    )<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span> {
</span></span><span style=display:flex><span>        $instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>($uuid, $realmId, $organizationId, $subscriptionId);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logique m√©tier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>true</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>canTransitionTo</span>(<span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $instance<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>recordThat</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisteredPaymentEvent</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>uuid</span><span style=color:#f92672>:</span> $uuid,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>realmId</span><span style=color:#f92672>:</span> $realmId,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>organizationId</span><span style=color:#f92672>:</span> $organizationId,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>subscriptionId</span><span style=color:#f92672>:</span> $subscriptionId,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>creationDate</span><span style=color:#f92672>:</span> $creationDate,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>expirationDate</span><span style=color:#f92672>:</span> $expirationDate,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>customerName</span><span style=color:#f92672>:</span> $customerName,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>customerEmail</span><span style=color:#f92672>:</span> $customerEmail,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>subtotal</span><span style=color:#f92672>:</span> $subtotal,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>discount</span><span style=color:#f92672>:</span> $discount,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>taxes</span><span style=color:#f92672>:</span> $vat,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>total</span><span style=color:#f92672>:</span> $total,
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $instance;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyRegisteredPaymentEvent</span>(<span style=color:#a6e22e>RegisteredPaymentEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Changement de l&#39;√©tat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>authorize</span>(<span style=color:#a6e22e>Gateways</span> $gateway, <span style=color:#a6e22e>Price</span> $amount, <span style=color:#a6e22e>\DateTimeInterface</span> $authorizationDate)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logique m√©tier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>true</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>canTransitionTo</span>(<span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Authorized</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>recordThat</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AuthorizedEvent</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>uuid</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uuid</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>realmId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>realmId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>organizationId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>subscriptionId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Authorized</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>gateway</span><span style=color:#f92672>:</span> $gateway,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> $amount,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>authorizationDate</span><span style=color:#f92672>:</span> $authorizationDate,
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyAuthorizedEvent</span>(<span style=color:#a6e22e>AuthorizedEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Changement de l&#39;√©tat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>capture</span>(<span style=color:#a6e22e>Gateways</span> $gateway, <span style=color:#a6e22e>Price</span> $amount, <span style=color:#a6e22e>\DateTimeInterface</span> $completionDate)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logique m√©tier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>true</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>canTransitionTo</span>(<span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>recordThat</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CapturedEvent</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>uuid</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uuid</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>realmId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>realmId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>organizationId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>subscriptionId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>gateway</span><span style=color:#f92672>:</span> $gateway,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> $amount,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>completionDate</span><span style=color:#f92672>:</span> $completionDate,
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyCapturedEvent</span>(<span style=color:#a6e22e>CapturedEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Changement de l&#39;√©tat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fail</span>(<span style=color:#a6e22e>Gateways</span> $gateway, <span style=color:#a6e22e>Price</span> $amount, <span style=color:#a6e22e>\DateTimeInterface</span> $failureDate, <span style=color:#a6e22e>string</span> $reason)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logique m√©tier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>true</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>canTransitionTo</span>(<span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Failed</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>recordThat</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FailedEvent</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>uuid</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uuid</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>realmId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>realmId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>organizationId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>subscriptionId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Failed</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>gateway</span><span style=color:#f92672>:</span> $gateway,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> $amount,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>failureDate</span><span style=color:#f92672>:</span> $failureDate,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>reason</span><span style=color:#f92672>:</span> $reason,
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyFailedEvent</span>(<span style=color:#a6e22e>FailedEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Changement de l&#39;√©tat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>canTransitionTo</span>(<span style=color:#a6e22e>Statuses</span> $status)<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>match</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>match</span> ($status) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Authorized</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Cancelled</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Failed</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Authorized</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>match</span> ($status) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Authorized</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Cancelled</span>, <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Failed</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>match</span> ($status) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Cancelled</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>match</span> ($status) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Cancelled</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Failed</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>match</span> ($status) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Failed</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Ce que cet exemple montre</strong> :</p><ul><li><strong>Intention m√©tier claire</strong> : <code>registerOnlinePayment()</code>, <code>capture()</code>, <code>authorize()</code>, <code>fail()</code> expriment clairement l&rsquo;intention</li><li><strong>Protection des invariants</strong> : <code>canTransitionTo()</code> prot√®ge les transitions d&rsquo;√©tat valides</li><li><strong>Event Sourcing</strong> : Chaque changement d&rsquo;√©tat est enregistr√© comme un √©v√©nement, le changement d√©tat est organis√© dans des m√©thodes priv√©es <code>apply...()</code>.</li><li><strong>Value Objects</strong> : <code>PaymentId</code>, <code>Price</code>, <code>Statuses</code> encapsulent les concepts m√©tier</li><li><strong>S√©paration des responsabilit√©s</strong> : L&rsquo;agr√©gat se concentre sur la logique m√©tier, pas sur la persistance</li></ul><h2 id=pourquoi-le-crud-limite-vos-mouvements>Pourquoi le CRUD limite vos mouvements <a href=#pourquoi-le-crud-limite-vos-mouvements class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=mon-pi√®ge--la-simplicit√©-apparente-du-crud>Mon Pi√®ge : La Simplicit√© Apparente du CRUD <a href=#mon-pi%c3%a8ge--la-simplicit%c3%a9-apparente-du-crud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le CRUD (Create, Read, Update, Delete) semblait √™tre la solution parfaite : simple, direct, facile √† comprendre. &ldquo;Pourquoi compliquer les choses ?&rdquo; me demandais-je. Et c&rsquo;est exactement l√† que le pi√®ge s&rsquo;est referm√©.</p><p><strong>Voici ce qui s&rsquo;est pass√© avec Gyroscops</strong> : j&rsquo;avais un syst√®me de gestion d&rsquo;utilisateurs. Au d√©but, c&rsquo;√©tait simple : cr√©er, lire, modifier, supprimer. Puis est arriv√©e la demande : &ldquo;On veut pouvoir suspendre un utilisateur&rdquo;. Facile, j&rsquo;ai ajout√© un champ <code>status</code>. Puis : &ldquo;Un utilisateur suspendu ne peut pas se connecter&rdquo;. OK, j&rsquo;ai ajout√© une v√©rification. Puis : &ldquo;Un utilisateur suspendu ne peut pas changer son email&rdquo;. Encore une v√©rification. Puis : &ldquo;Il faut notifier l&rsquo;utilisateur quand il est suspendu&rdquo;. Une autre v√©rification&mldr;</p><p><strong>R√©sultat</strong> : Mon code ressemblait √† un champ de mines. Chaque modification pouvait faire exploser quelque chose d&rsquo;inattendu.</p><h3 id=le-pi√®ge-du-crud>Le Pi√®ge du CRUD <a href=#le-pi%c3%a8ge-du-crud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le CRUD est une approche technique qui r√©duit votre domaine m√©tier √† des op√©rations de base de donn√©es. Cette approche m&rsquo;a emp√™ch√© de :</p><ol><li><strong>Comprendre vraiment mon m√©tier</strong> - Je ne voyais que la technique, pas la logique</li><li><strong>√âvoluer facilement</strong> - Chaque changement devenait un cauchemar</li><li><strong>Maintenir la coh√©rence</strong> - Rien n&rsquo;emp√™chait les √©tats incoh√©rents</li><li><strong>Conserver l&rsquo;intention utilisateur</strong> (le plus grave) - L&rsquo;intention se perdait d√®s le contr√¥leur</li></ol><h4 id=1-comprendre-vraiment-votre-m√©tier>1. <strong>Comprendre Vraiment Votre M√©tier</strong> <a href=#1-comprendre-vraiment-votre-m%c3%a9tier class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚ùå Approche CRUD - Le m√©tier dispara√Æt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentController</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>Request</span> $request)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Response</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Payment</span>();
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAmount</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;amount&#39;</span>));
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setStatus</span>(<span style=color:#e6db74>&#39;pending&#39;</span>);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($payment);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>([<span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>Request</span> $request, <span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Response</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($id);
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAmount</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;amount&#39;</span>));
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setStatus</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;status&#39;</span>));
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($payment);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>([<span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>La logique m√©tier est saupoudr√©e au milieu de concepts techniques. Il est difficile d&rsquo;identifier qui valide les r√®gles. Toute √©volution est rendue complexe.</p><h4 id=2-√©voluer-facilement>2. <strong>√âvoluer Facilement</strong> <a href=#2-%c3%a9voluer-facilement class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Avec le CRUD, ajouter une nouvelle r√®gle m√©tier devient un un parcours d&rsquo;obstacles :</p><ol><li>Modifier le contr√¥leur</li><li>Modifier les services</li><li>Modifier les validations</li><li>Modifier les tests</li><li>Risque de r√©gression</li></ol><h4 id=3-maintenir-la-coh√©rence>3. <strong>Maintenir la Coh√©rence</strong> <a href=#3-maintenir-la-coh%c3%a9rence class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Le CRUD ne prot√®ge pas les invariants m√©tier. Rien n&rsquo;emp√™che de cr√©er un paiement avec un montant n√©gatif ou de modifier un paiement d√©j√† trait√©.</p><h4 id=4-conserver-l>4. <strong>Conserver l&rsquo;Intention Utilisateur</strong> <a href=#4-conserver-l class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Le plus grave des pi√®ges du CRUD est la <strong>perte de l&rsquo;intention utilisateur</strong>. Les m√©thodes <code>get</code> et <code>set</code> ne sont que le reflet d&rsquo;une fraction de l&rsquo;intention, parfois seulement des contraintes techniques.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚ùå CRUD - L&#39;intention est perdue d√®s le contr√¥leur
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentController</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processPayment</span>(<span style=color:#a6e22e>Request</span> $request)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Response</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;id&#39;</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// L&#39;intention &#34;traiter un paiement&#34; devient :
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setStatus</span>(<span style=color:#e6db74>&#39;processing&#39;</span>);  <span style=color:#75715e>// Contrainte technique
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setProcessedAt</span>(<span style=color:#a6e22e>now</span>());    <span style=color:#75715e>// Contrainte technique
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAmount</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;amount&#39;</span>)); <span style=color:#75715e>// Donn√©e brute
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($payment);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>([<span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Probl√®me</strong> :</p><ul><li>L&rsquo;intention &ldquo;traiter un paiement&rdquo; dispara√Æt d√®s les premiers instants</li><li>Impossible de savoir <strong>pourquoi</strong> le paiement a √©t√© trait√©</li><li>L&rsquo;intention ne peut √™tre que reconstruite ou d√©duite a posteriori</li><li>Aucune trace de l&rsquo;intention d&rsquo;origine dans le code</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ DDD - L&#39;intention est pr√©serv√©e et explicite
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Payment</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>capture</span>(<span style=color:#a6e22e>Gateways</span> $gateway, <span style=color:#a6e22e>Price</span> $amount, <span style=color:#a6e22e>\DateTimeInterface</span> $completionDate)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logique m√©tier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>true</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>canTransitionTo</span>(<span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>recordThat</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CapturedEvent</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>uuid</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uuid</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>realmId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>realmId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>organizationId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>subscriptionId</span><span style=color:#f92672>:</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>subscriptionId</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Completed</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>gateway</span><span style=color:#f92672>:</span> $gateway,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> $amount,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>completionDate</span><span style=color:#f92672>:</span> $completionDate,
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyCapturedEvent</span>(<span style=color:#a6e22e>CapturedEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Changement de l&#39;√©tat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>capured</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>captured</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>plus</span>($event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>gateway</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>gateway</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>completionDate</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>completionDate</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Avantage</strong> : L&rsquo;intention m√©tier est <strong>explicite</strong>, <strong>pr√©serv√©e</strong> et <strong>tra√ßable</strong> tout au long du cycle de vie de l&rsquo;objet.</p><h3 id=la-solution--des-commandes-m√©tier>La Solution : Des Commandes M√©tier <a href=#la-solution--des-commandes-m%c3%a9tier class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Approche DDD - Le m√©tier guide l&#39;√©volution
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProcessPayment</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>Price</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>Gateway</span> $gateway,
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[AsMessageHandler(&#39;command.bus&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProcessPaymentHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ClockInterface</span> $clock,
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__invoke</span>(<span style=color:#a6e22e>ProcessPayment</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>capture</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>gateway</span>, $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>clock</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($payment);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Avantages</strong> :</p><ul><li>La logique m√©tier est centralis√©e</li><li>L&rsquo;√©volution est guid√©e par le m√©tier</li><li>Les invariants sont prot√©g√©s</li><li>Le code est plus expressif</li></ul><h2 id=pourquoi-les-mod√®les-an√©miques-vous-emp√™chent-davancer-plus-vite>Pourquoi les mod√®les an√©miques vous emp√™chent d&rsquo;avancer plus vite <a href=#pourquoi-les-mod%c3%a8les-an%c3%a9miques-vous-emp%c3%aachent-davancer-plus-vite class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=mon-illusion--la-s√©paration-des-responsabilit√©s>Mon Illusion : La S√©paration des Responsabilit√©s <a href=#mon-illusion--la-s%c3%a9paration-des-responsabilit%c3%a9s class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Les mod√®les an√©miques semblaient respecter le principe de s√©paration des responsabilit√©s : &ldquo;Les entit√©s stockent les donn√©es, les services contiennent la logique&rdquo;. C&rsquo;est logique, non ? <strong>Non, c&rsquo;est trompeur !</strong>. C&rsquo;est m√™me en contradiction avec l&rsquo;intention initiale de la Programmation Orient√©e Objet.</p><p><strong>Le probl√®me</strong> : Je s√©parais les donn√©es de leur logique. C&rsquo;est comme s√©parer le l&rsquo;autopilote des commandes de l&rsquo;avion. C&rsquo;est techniquement possible, et c&rsquo;est justifi√© en disant &ldquo;au cas o√π un jour on veuille changer les commandes de l&rsquo;avion&rdquo;. <strong>√áa n&rsquo;arrivera jamais</strong>.</p><p><strong>Voici ce qui s&rsquo;est pass√© avec Gyroscops</strong> : j&rsquo;avais un syst√®me de gestion d&rsquo;utilisateurs. Au d√©but, c&rsquo;√©tait simple : des entit√©s avec des getters/setters, des services qui faisaient la logique. Puis est arriv√©e la demande : &ldquo;On veut pouvoir suspendre un utilisateur&rdquo;. Facile, j&rsquo;ai ajout√© un champ <code>isSuspended</code> et une m√©thode dans le service. Puis : &ldquo;Un utilisateur suspendu ne peut pas se connecter&rdquo;. OK, j&rsquo;ai ajout√© une v√©rification dans le service. Puis : &ldquo;Un utilisateur suspendu ne peut pas changer son email&rdquo;. Encore une v√©rification dans le service. Puis : &ldquo;Il faut notifier l&rsquo;utilisateur quand il est suspendu&rdquo;. Une autre v√©rification dans le service&mldr;</p><p>Je n&rsquo;ai pas encore √©voqu√© les inter-d√©pendances entre les entit√©s lors de l&rsquo;inscription : une organisation et un Workspace doivent √™tre cr√©√©s automatiquement pour que le compte soit fonctionnel.</p><p><strong>R√©sultat</strong> : Ma logique m√©tier √©tait √©parpill√©e dans de multiples services diff√©rents. Chaque modification n√©cessitait de toucher √† au moins 5 fichiers. si on prenait chaque service individuellement, le code √©tait propre. Mais je ne savais plus o√π √©tait quoi, quel service interagissait avec quel autre, et mes coll√®gues non plus.</p><h3 id=mon-pi√®ge--les-mod√®les-an√©miques>Mon Pi√®ge : Les Mod√®les An√©miques <a href=#mon-pi%c3%a8ge--les-mod%c3%a8les-an%c3%a9miques class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Un mod√®le an√©mique est un mod√®le qui ne contient que des propri√©t√©s (getters/setters) sans logique m√©tier. Cette approche a limit√© ma capacit√© √† :</p><ol><li><strong>Exprimer l&rsquo;intention m√©tier</strong> - Ma logique √©tait √©parpill√©e dans plusieurs services et la coh√©rence n&rsquo;√©tait pas syst√©matiquement maintenue</li><li><strong>√âvoluer sans casser</strong> - Chaque changement impactait plusieurs services</li><li><strong>Tester efficacement</strong> - Mes tests devenaient fragiles et complexes</li></ol><h4 id=1-exprimer-l>1. <strong>Exprimer l&rsquo;Intention M√©tier</strong> <a href=#1-exprimer-l class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚ùå Mod√®le An√©mique - L&#39;intention dispara√Æt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $email,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $firstName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $lastName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>bool</span> $isActive <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Seulement des getters/setters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEmail</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setEmail</span>(<span style=color:#a6e22e>string</span> $email)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> { $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $email; }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... autres getters/setters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div><p><strong>Probl√®me</strong> : Comment savoir si un utilisateur peut se connecter ? Comment valider un email ? Comment g√©rer l&rsquo;activation ?</p><p><strong>Avec Gyroscops, j&rsquo;ai v√©cu cette situation</strong> : J&rsquo;avais un mod√®le <code>User</code> avec des getters/setters, et la logique √©tait √©parpill√©e dans 12 services diff√©rents. Quand j&rsquo;ai voulu ajouter la fonctionnalit√© &ldquo;suspendre un utilisateur&rdquo;, j&rsquo;ai d√ª :</p><p><strong>Services li√©s √† l&rsquo;utilisateur</strong> :</p><ul><li>Modifier le service <code>UserService</code> pour la logique de suspension</li><li>Modifier le service <code>AuthenticationService</code> pour v√©rifier le statut</li><li>Modifier le service <code>EmailService</code> pour les notifications</li></ul><p><strong>Services li√©s √† l&rsquo;organisation</strong> :</p><ul><li>Modifier le service <code>OrganizationService</code> car l&rsquo;utilisateur appartient √† une organisation</li><li>Modifier le service <code>BillingService</code> car l&rsquo;organisation est l&rsquo;entit√© factur√©e</li><li>Modifier le service <code>AuditService</code> pour l&rsquo;historique organisationnel</li></ul><p><strong>Services li√©s au workflow</strong> :</p><ul><li>Modifier le service <code>WorkflowService</code> car le workflow est l&rsquo;espace de travail</li><li>Modifier le service <code>CloudService</code> car le workflow est d√©ploy√© dans une r√©gion cloud</li><li>Modifier le service <code>ResourceService</code> car le workflow comprend des ressources</li></ul><p><strong>Services transversaux</strong> :</p><ul><li>Modifier le service <code>NotificationService</code> pour les alertes</li><li>Modifier le service <code>ReportService</code> pour les statistiques</li><li>Modifier le service <code>CacheService</code> pour l&rsquo;invalidation</li></ul><p><strong>R√©sultat</strong> : 12 fichiers √† modifier pour une seule fonctionnalit√© ! Et si j&rsquo;oubliais un service ? Et si les r√®gles √©taient incoh√©rentes entre les services ? Et comment g√©rer les d√©pendances entre User ‚Üí Organization ‚Üí Workflow ‚Üí Resources Cloud ? Et si j&rsquo;oublie de d√©commissionner les ressources Cloud, je serai toujours factur√© par le fournisseur d&rsquo;infra.</p><p>La logique m√©tier se retrouve √©parpill√©e dans les services, m√©langeant souvent <strong>r√®gles m√©tier</strong> et <strong>contraintes techniques</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚ùå Entit√© Doctrine avec contraintes m√©lang√©es
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Doctrine\ORM\Mapping</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>ORM</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Validator\Constraints</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>Assert</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[ORM\Entity]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[ORM\Table(name: &#39;users&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[ORM\Id]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[ORM\GeneratedValue]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[ORM\Column(type: &#39;integer&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>int</span> $id <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[ORM\Column(type: &#39;string&#39;, length: 255)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\Email(message: &#39;Email invalide&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\Length(max: 255, maxMessage: &#39;Email trop long&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\NotBlank(message: &#39;Email obligatoire&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $email;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[ORM\Column(type: &#39;string&#39;, length: 50)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\NotBlank(message: &#39;Le pr√©nom est obligatoire&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\Length(min: 2, max: 50, minMessage: &#39;Pr√©nom trop court&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $firstName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[ORM\Column(type: &#39;string&#39;, length: 50)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\NotBlank(message: &#39;Le nom est obligatoire&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#[Assert\Length(min: 2, max: 50, minMessage: &#39;Nom trop court&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $lastName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[ORM\Column(type: &#39;boolean&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>bool</span> $isActive <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Seulement des getters/setters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getId</span>()<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>int</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEmail</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setEmail</span>(<span style=color:#a6e22e>string</span> $email)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> { $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $email; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFirstName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setFirstName</span>(<span style=color:#a6e22e>string</span> $firstName)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> { $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span> <span style=color:#f92672>=</span> $firstName; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getLastName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setLastName</span>(<span style=color:#a6e22e>string</span> $lastName)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> { $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span> <span style=color:#f92672>=</span> $lastName; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isActive</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isActive</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setIsActive</span>(<span style=color:#a6e22e>bool</span> $isActive)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> { $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isActive</span> <span style=color:#f92672>=</span> $isActive; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ‚ùå Service avec logique m√©tier m√©lang√©e
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ValidatorInterface</span> $validator,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>UserRepository</span> $userRepository
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validateUser</span>(<span style=color:#a6e22e>User</span> $user)<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// R√®gle m√©tier : L&#39;utilisateur doit √™tre actif
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isActive</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Contrainte technique : Validation Symfony (d√©j√† dans l&#39;entit√©)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $violations <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validator</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validate</span>($user);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>count</span>($violations) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// R√®gle m√©tier : L&#39;utilisateur ne doit pas √™tre banni
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isUserBanned</span>($user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>())) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Probl√®mes</strong> :</p><ul><li><strong>M√©lange de responsabilit√©s</strong> : Contraintes techniques (Doctrine/Symfony) et r√®gles m√©tier dans la m√™me entit√©</li><li><strong>Difficile √† tester</strong> : Comment tester uniquement les r√®gles m√©tier sans les contraintes techniques ?</li><li><strong>Difficile √† maintenir</strong> : O√π modifier une r√®gle m√©tier sp√©cifique sans impacter les contraintes ?</li><li><strong>Difficile √† comprendre</strong> : Quelle est l&rsquo;intention r√©elle de cette validation ?</li><li><strong>Couplage fort</strong> : L&rsquo;entit√© est coupl√©e √† la base de donn√©es ET aux r√®gles m√©tier, que se passe-t-il si je souhaite panacher mon stockage d&rsquo;entit√©s entre PostgreSQL et ElasticSearch ?</li></ul><h4 id=2-√©voluer-sans-casser>2. <strong>√âvoluer Sans Casser</strong> <a href=#2-%c3%a9voluer-sans-casser class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Avec des mod√®les an√©miques, changer une r√®gle m√©tier n√©cessite de :</p><ol><li>Modifier tous les services qui utilisent le mod√®le</li><li>Modifier tous les contr√¥leurs</li><li>Modifier tous les tests</li><li>Risque de r√©gression √©lev√©</li></ol><h4 id=3-tester-efficacement>3. <strong>Tester Efficacement</strong> <a href=#3-tester-efficacement class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>La logique m√©tier est √©parpill√©e dans les services, rendant les tests complexes et fragiles.</p><h3 id=la-solution--des-mod√®les-riches>La Solution : Des Mod√®les Riches <a href=#la-solution--des-mod%c3%a8les-riches class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Mod√®le Riche - L&#39;intention m√©tier est claire
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>UserId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Email</span> $email,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>FullName</span> $name,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>UserStatuses</span> $status
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>UserId</span> $id, <span style=color:#a6e22e>Email</span> $email, <span style=color:#a6e22e>FullName</span> $name)<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>($id, $email, $name, <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>restoreFromState</span>(<span style=color:#a6e22e>UserId</span> $id, <span style=color:#a6e22e>Email</span> $email, <span style=color:#a6e22e>FullName</span> $name, <span style=color:#a6e22e>Statuses</span> $status)<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>($id, $email, $name, $status);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>activate</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserCannotBeActivatedException</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Active</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>canLogin</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Active</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>changeEmail</span>(<span style=color:#a6e22e>Email</span> $newEmail)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Suspended</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserCannotChangeEmailException</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $newEmail;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Avantages</strong> :</p><ul><li><strong>S√©paration claire</strong> : R√®gles m√©tier dans le mod√®le et les Value Objects, contraintes techniques dans les services de stockage</li><li><strong>Intention m√©tier explicite</strong> : <code>register</code>, <code>canLogin()</code>, <code>activate()</code>, <code>changeEmail()</code> expriment clairement l&rsquo;intention</li><li><strong>√âvolution guid√©e par le m√©tier</strong> : Les changements suivent la logique m√©tier</li><li><strong>Tests plus simples</strong> : Chaque r√®gle m√©tier peut √™tre test√©e ind√©pendamment</li><li><strong>Coh√©rence garantie</strong> : Les invariants m√©tier sont prot√©g√©s</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Agr√©gat racine s√©par√© de l&#39;entit√© Doctrine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>private</span>(<span style=color:#a6e22e>set</span>) <span style=color:#a6e22e>UserId</span> $id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>private</span>(<span style=color:#a6e22e>set</span>) <span style=color:#a6e22e>Email</span> $email;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>private</span>(<span style=color:#a6e22e>set</span>) <span style=color:#a6e22e>FullName</span> $name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $firstName {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>get</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $lastName {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>get</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>private</span>(<span style=color:#a6e22e>set</span>) <span style=color:#a6e22e>UserStatuses</span> $status;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>Email</span> $email, <span style=color:#a6e22e>FullName</span> $name)<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>();
</span></span><span style=display:flex><span>        $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UserId</span><span style=color:#f92672>::</span><span style=color:#a6e22e>generate</span>();
</span></span><span style=display:flex><span>        $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $email;
</span></span><span style=display:flex><span>        $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> $name;
</span></span><span style=display:flex><span>        $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $user;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>activate</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserCannotBeActivatedException</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Active</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>canLogin</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Active</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>changeName</span>(<span style=color:#a6e22e>FullName</span> $newName)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Suspended</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserCannotChangeNameException</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> $newName;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>changeEmail</span>(<span style=color:#a6e22e>Email</span> $newEmail)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Suspended</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserCannotChangeEmailException</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $newEmail;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>suspend</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Suspended</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserAlreadySuspendedException</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UserStatuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Suspended</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Entit√© Doctrine s√©par√©e pour la persistance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Doctrine\ORM\Mapping</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>ORM</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Validator\Constraints</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>Assert</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[ORM\Entity]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[ORM\Table(name: &#39;users&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserEntity</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>FullName</span> $fullName {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>get</span> <span style=color:#f92672>=&gt;</span> ($this<span style=color:#f92672>-</span><span style=color:#a6e22e>firstName</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>?</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FullName</span>(
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>,
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span>,
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#75715e>#[Assert\Uuid]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[ORM\Id]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[ORM\Column(type: &#39;user_id&#39;, unique: true)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>UserId</span> $id <span style=color:#f92672>=</span> <span style=color:#a6e22e>UserId</span><span style=color:#f92672>::</span><span style=color:#a6e22e>generateRandom</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#[ORM\Column(type: &#39;string&#39;, length: 255)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\Email(message: &#39;Email invalide&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\Length(max: 255, maxMessage: &#39;Email trop long&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\NotBlank(message: &#39;Email obligatoire&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $email;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#[ORM\Column(length: 50)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\NotBlank(message: &#39;Le pr√©nom est obligatoire&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\Length(min: 2, max: 50, minMessage: &#39;Pr√©nom trop court&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $firstName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#[ORM\Column(length: 50)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\NotBlank(message: &#39;Le nom est obligatoire&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>#[Assert\Length(min: 2, max: 50, minMessage: &#39;Nom trop court&#39;)]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $lastName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#[ORM\Column()]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Statuses</span> $status <span style=color:#f92672>=</span> <span style=color:#a6e22e>Statuses</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Pending</span>;
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Value Objects pour les contraintes techniques
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Assert\Assertion</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Assert\AssertionFailedException</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserId</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $value)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>uuid</span>($value);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>AssertionFailedException</span> $exception) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidUserIdException</span>(<span style=color:#e6db74>&#39;ID utilisateur obligatoire&#39;</span>, <span style=color:#a6e22e>previous</span><span style=color:#f92672>:</span> $exception);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generate</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>(<span style=color:#a6e22e>uniqid</span>(<span style=color:#e6db74>&#39;user_&#39;</span>, <span style=color:#66d9ef>true</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Email</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $value)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>email</span>($value);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>AssertionFailedException</span> $exception) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidEmailException</span>(<span style=color:#e6db74>&#39;Email invalide&#39;</span>, <span style=color:#a6e22e>previous</span><span style=color:#f92672>:</span> $exception);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__toString</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FullName</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $firstName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $lastName
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>notEmpty</span>($firstName);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Assertion</span><span style=color:#f92672>::</span><span style=color:#a6e22e>notEmpty</span>($lastName);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>AssertionFailedException</span> $exception) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidNameException</span>(<span style=color:#e6db74>&#39;Nom complet obligatoire&#39;</span>, <span style=color:#a6e22e>previous</span><span style=color:#f92672>:</span> $exception);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=mapper-entre-agr√©gat-et-entit√©-doctrine><strong>Mapper entre Agr√©gat et Entit√© Doctrine</strong> <a href=#mapper-entre-agr%c3%a9gat-et-entit%c3%a9-doctrine class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Mapper pour convertir entre l&#39;agr√©gat et l&#39;entit√© Doctrine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserMapper</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>toEntity</span>(<span style=color:#a6e22e>User</span> $user)<span style=color:#f92672>:</span> <span style=color:#a6e22e>UserEntity</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserEntity</span>(
</span></span><span style=display:flex><span>            $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>,
</span></span><span style=display:flex><span>            $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>,
</span></span><span style=display:flex><span>            $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span>,
</span></span><span style=display:flex><span>            $user<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>toAggregate</span>(<span style=color:#a6e22e>UserEntity</span> $entity)<span style=color:#f92672>:</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>User</span><span style=color:#f92672>::</span><span style=color:#a6e22e>restoreFromState</span>(
</span></span><span style=display:flex><span>            $entity<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Email</span>($entity<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>),
</span></span><span style=display:flex><span>            $entity<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fullName</span>,
</span></span><span style=display:flex><span>            $entity<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>R√©sultat</strong> :</p><ul><li><strong>S√©paration claire</strong> : Agr√©gat m√©tier s√©par√© de l&rsquo;entit√© de persistance</li><li><strong>Agr√©gat pur</strong> : Pas de d√©pendance √† Doctrine dans le mod√®le m√©tier</li><li><strong>Entit√© Doctrine</strong> : Gestion de la persistance avec validation Symfony</li><li><strong>Mapper d√©di√©</strong> : Conversion explicite entre les deux repr√©sentations</li><li><strong>Testabilit√©</strong> : L&rsquo;agr√©gat peut √™tre test√© sans base de donn√©es</li><li><strong>Flexibilit√©</strong> : Possibilit√© de changer de strat√©gie de persistance</li></ul><h2 id=levent-storming--r√©v√©ler-la-complexit√©-m√©tier>L&rsquo;Event Storming : R√©v√©ler la Complexit√© M√©tier <a href=#levent-storming--r%c3%a9v%c3%a9ler-la-complexit%c3%a9-m%c3%a9tier class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><blockquote><p><strong>üìñ Note</strong> : Ce chapitre pr√©sente une introduction √† l&rsquo;Event Storming. Pour un guide pratique complet avec des ateliers pas-√†-pas, consultez le <a href=/chapitres/fondamentaux/chapitre-03-atelier-event-storming/>Chapitre 3 : L&rsquo;Atelier Event Storming - Guide Pratique</a>.</p></blockquote><h3 id=mon-probl√®me--je-ne-voyais-que-la-pointe-de-liceberg>Mon Probl√®me : Je Ne Voyais Que la Pointe de l&rsquo;Iceberg <a href=#mon-probl%c3%a8me--je-ne-voyais-que-la-pointe-de-liceberg class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce qui s&rsquo;est pass√©</strong> : J&rsquo;√©tais en r√©union avec l&rsquo;√©quipe&rsquo;. On d√©crivait une nouvelle fonctionnalit√© : &ldquo;On veut pouvoir suspendre un utilisateur&rdquo;. Simple, non ? J&rsquo;ajoute un champ <code>isSuspended</code> et c&rsquo;est r√©gl√©.</p><p><strong>Mais attendez&mldr;</strong> Que se passe-t-il si l&rsquo;utilisateur a des paiements en cours ? Et ses abonnements ? Et ses donn√©es personnelles ? Et les notifications ? Et l&rsquo;audit ? Et la conformit√© RGPD ? Et les int√©grations avec les syst√®mes externes ?</p><p><strong>Soudain, ce qui semblait simple devenait un cauchemar.</strong> Je r√©alisais que je ne comprenais pas vraiment le m√©tier. Je ne voyais que la pointe de l&rsquo;iceberg.</p><h3 id=quest-ce-que-levent-storming->Qu&rsquo;est-ce que l&rsquo;Event Storming ? <a href=#quest-ce-que-levent-storming- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>L&rsquo;Event Storming est une m√©thode de conception collaborative qui permet de :</p><ol><li><strong>D√©couvrir le domaine m√©tier</strong> - Voir l&rsquo;iceberg entier, pas juste la pointe</li><li><strong>Identifier les √©v√©nements m√©tier</strong> - Comprendre ce qui se passe vraiment</li><li><strong>Mod√©liser les processus</strong> - Voir comment tout s&rsquo;articule</li><li><strong>Concevoir l&rsquo;architecture</strong> - Construire sur des bases solides</li></ol><h3 id=pourquoi-levent-storming->Pourquoi l&rsquo;Event Storming ? <a href=#pourquoi-levent-storming- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><h4 id=1-r√©v√©ler-la-vraie-complexit√©---mon-r√©veil-brutal>1. <strong>R√©v√©ler la Vraie Complexit√©</strong> - Mon R√©veil Brutal <a href=#1-r%c3%a9v%c3%a9ler-la-vraie-complexit%c3%a9---mon-r%c3%a9veil-brutal class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>L&rsquo;Event Storming m&rsquo;a montr√© que mon domaine √©tait plus complexe que je ne le pensais. Cette complexit√© existait, que je la mod√©lise ou non. <strong>La question n&rsquo;√©tait pas de savoir si elle existait, mais si je voulais la g√©rer ou la subir.</strong></p><p><strong>Exemple concret avec Gyroscops</strong> : Je pensais qu&rsquo;un &ldquo;paiement&rdquo; √©tait simple. Puis l&rsquo;Event Storming a r√©v√©l√© :</p><ul><li>Paiement initi√©</li><li>Paiement en attente de validation</li><li>Paiement valid√© par la banque</li><li>Paiement trait√© par le syst√®me</li><li>Paiement notifi√© au client</li><li>Paiement enregistr√© pour l&rsquo;audit</li><li>Paiement synchronis√© avec la comptabilit√©</li><li>Paiement affich√© dans le tableau de bord</li><li>Paiement export√© pour les rapports</li><li>Paiement archiv√© pour la conformit√©</li></ul><p><strong>Soudain, j&rsquo;ai compris pourquoi mon code √©tait si complexe !</strong></p><h4 id=2-alignement-de-l---la-fin-des-malentendus>2. <strong>Alignement de l&rsquo;√âquipe</strong> - La Fin des Malentendus <a href=#2-alignement-de-l---la-fin-des-malentendus class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>Toute l&rsquo;√©quipe (d√©veloppeurs, product owners, experts m√©tier) partage la m√™me compr√©hension du domaine. <strong>Fini les &ldquo;Ah, je pensais que&mldr;&rdquo; et les &ldquo;Non, mais je te dis que c&rsquo;est √ßa qui&mldr;&rdquo;</strong></p><p><strong>Exemple concret avec Gyroscops</strong> : Pendant un Event Storming sur la gestion des utilisateurs. Voici ce qui est ressorti :</p><ul><li><strong>Moi (d√©veloppeur)</strong> : &ldquo;Un utilisateur suspendu ne peut pas se connecter&rdquo;</li><li><strong>Le product owner</strong> : &ldquo;Non, il peut se connecter mais ne peut pas faire d&rsquo;achats&rdquo;</li><li><strong>L&rsquo;expert m√©tier</strong> : &ldquo;Il peut se connecter et faire des achats mais ne peut pas changer son email&rdquo;</li><li><strong>Le responsable s√©curit√©</strong> : &ldquo;Il ne peut pas acc√©der aux donn√©es sensibles&rdquo;</li><li><strong>Le responsable comptabilit√©</strong> : &ldquo;Il ne peut pas t√©l√©charger de factures&rdquo;</li><li><strong>Le responsable cloud</strong> : &ldquo;Il ne peut pas acc√©der aux workflows d√©ploy√©s&rdquo;</li><li><strong>Le responsable facturation</strong> : &ldquo;L&rsquo;organisation doit continuer √† √™tre factur√©e m√™me si l&rsquo;utilisateur est suspendu&rdquo;</li></ul><p><strong>R√©sultat de l&rsquo;Event Storming</strong> : J&rsquo;ai d√©couvert que &ldquo;suspendre un utilisateur&rdquo; n&rsquo;√©tait pas un seul √©v√©nement, mais plusieurs, avec des implications sur toute la cha√Æne :</p><p><strong>√âv√©nements li√©s √† l&rsquo;utilisateur</strong> :</p><ul><li><code>UserSuspended</code> (acc√®s restreint)</li><li><code>UserBillingSuspended</code> (pas d&rsquo;achats)</li><li><code>UserDataAccessSuspended</code> (pas de donn√©es sensibles)</li><li><code>UserEmailChangeSuspended</code> (pas de changement d&rsquo;email)</li></ul><p><strong>√âv√©nements li√©s √† l&rsquo;organisation</strong> :</p><ul><li><code>OrganizationBillingMaintained</code> (l&rsquo;organisation continue d&rsquo;√™tre factur√©e)</li><li><code>OrganizationAccessRestricted</code> (acc√®s restreint aux donn√©es organisationnelles)</li></ul><p><strong>√âv√©nements li√©s au workflow</strong> :</p><ul><li><code>WorkflowAccessSuspended</code> (pas d&rsquo;acc√®s aux workflows)</li><li><code>WorkflowResourcesMaintained</code> (les ressources restent actives)</li><li><code>WorkflowBillingMaintained</code> (la facturation du workflow continue)</li></ul><p><strong>Qui avait raison ?</strong> Tout le monde ! Chacun avait une vision partielle de la r√©alit√© m√©tier, et j&rsquo;ai d√©couvert que suspendre un utilisateur avait des implications sur l&rsquo;organisation, le workflow, et m√™me les ressources cloud.</p><h4 id=3-conception-collaborative---briser-les-silos>3. <strong>Conception Collaborative</strong> - Briser les Silos <a href=#3-conception-collaborative---briser-les-silos class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p>L&rsquo;Event Storming brise les silos et permet une conception vraiment collaborative. <strong>Fini les &ldquo;sp√©cifications&rdquo; √©crites par les uns et interpr√©t√©es par les autres.</strong></p><h3 id=les-7-√©tapes-de-levent-storming>Les 7 √âtapes de l&rsquo;Event Storming <a href=#les-7-%c3%a9tapes-de-levent-storming class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ol><li><strong>Identifier les √âv√©nements</strong> : Qu&rsquo;est-ce qui se passe dans le domaine ?</li><li><strong>Identifier les Acteurs</strong> : Qui d√©clenche ces √©v√©nements ?</li><li><strong>Identifier les Commandes</strong> : Quelles actions d√©clenchent les √©v√©nements ?</li><li><strong>Identifier les Agr√©gats</strong> : Quelles entit√©s sont concern√©es ?</li><li><strong>Identifier les Syst√®mes Externes</strong> : Quelles int√©grations sont n√©cessaires ?</li><li><strong>Identifier les Vues de Lecture</strong> : Quelles donn√©es sont n√©cessaires pour l&rsquo;affichage ?</li><li><strong>Concevoir l&rsquo;Architecture</strong> : Comment organiser le code ?</li></ol><h3 id=exemple-devent-storming--syst√®me-de-paiement>Exemple d&rsquo;Event Storming : Syst√®me de Paiement <a href=#exemple-devent-storming--syst%c3%a8me-de-paiement class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Voici comment se pr√©sente un tableau d&rsquo;Event Storming pour un syst√®me de paiement, avec les diff√©rents types de post-its organis√©s de gauche √† droite selon le flux temporel :</p><figure class="figure-container figure-svg-zoomable"><div class=svg-zoom-wrapper><div class=svg-zoom-controls><button class="svg-zoom-btn svg-zoom-in" title=Zoomer aria-label=Zoomer>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
</button>
<button class="svg-zoom-btn svg-zoom-out" title=D√©zoomer aria-label=D√©zoomer>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
</button>
<button class="svg-zoom-btn svg-zoom-reset" title=R√©initialiser aria-label="R√©initialiser le zoom">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M23 20v-6h-6"/><path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4-4.64 4.36A9 9 0 013.51 15"/></svg>
</button>
<button class="svg-zoom-btn svg-zoom-fullscreen" title="Plein √©cran" aria-label="Basculer en plein √©cran">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5A2 2 0 003 5v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg></button></div><div class=svg-pan-container><img src=/images/event-storming/payment-system-flow.svg alt="Tableau Event Storming - Syst√®me de Paiement" class=svg-zoomable-image draggable=false></div></div><figcaption>Tableau Event Storming - Syst√®me de Paiement</figcaption></figure><script>(function(){document.querySelectorAll(".figure-svg-zoomable").forEach(function(e){const r=e.querySelector(".svg-pan-container"),i=e.querySelector(".svg-zoomable-image"),j=e.querySelector(".svg-zoom-in"),g=e.querySelector(".svg-zoom-out"),v=e.querySelector(".svg-zoom-reset"),b=e.querySelector(".svg-zoom-fullscreen");let t=1,n=0,s=0,o=!1,c=0,d=0;const h=.5,m=5,l=.2;function a(){i.style.transform=`translate(${n}px, ${s}px) scale(${t})`}function u(e){const o=Math.max(h,Math.min(m,t+e));if(o!==t){const e=r.getBoundingClientRect(),i=e.width/2,c=e.height/2,l=o/t;n=i-(i-n)*l,s=c-(c-s)*l,t=o,a()}}function y(){t=1,n=0,s=0,a()}function _(){const t=e.querySelector(".svg-zoom-wrapper");document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}j.addEventListener("click",function(){u(l)}),g.addEventListener("click",function(){u(-l)}),v.addEventListener("click",y),b.addEventListener("click",_),r.addEventListener("wheel",function(e){e.preventDefault();const t=e.deltaY>0?-l:l;u(t)},{passive:!1}),i.addEventListener("mousedown",function(e){t>1&&(o=!0,c=e.clientX-n,d=e.clientY-s,i.style.cursor="grabbing",e.preventDefault())}),document.addEventListener("mousemove",function(e){o&&(n=e.clientX-c,s=e.clientY-d,a())}),document.addEventListener("mouseup",function(){o&&(o=!1,i.style.cursor=t>1?"grab":"default")});let f=0,p=1;r.addEventListener("touchstart",function(e){if(e.touches.length===2){e.preventDefault();const n=e.touches[0].clientX-e.touches[1].clientX,s=e.touches[0].clientY-e.touches[1].clientY;f=Math.sqrt(n*n+s*s),p=t}else e.touches.length===1&&t>1&&(o=!0,c=e.touches[0].clientX-n,d=e.touches[0].clientY-s)},{passive:!1}),r.addEventListener("touchmove",function(e){if(e.touches.length===2){e.preventDefault();const n=e.touches[0].clientX-e.touches[1].clientX,s=e.touches[0].clientY-e.touches[1].clientY,o=Math.sqrt(n*n+s*s),i=Math.max(h,Math.min(m,p*(o/f)));t=i,a()}else e.touches.length===1&&o&&(e.preventDefault(),n=e.touches[0].clientX-c,s=e.touches[0].clientY-d,a())},{passive:!1}),r.addEventListener("touchend",function(e){e.touches.length===0&&(o=!1)}),i.style.cursor=t>1?"grab":"default"})})()</script><style>.figure-container{margin:2rem 0;text-align:center}.figure-svg-zoomable{position:relative;margin:2rem auto;max-width:100%}.svg-zoom-wrapper{position:relative;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;background:#f8f9fa;box-shadow:0 2px 8px rgba(0,0,0,.1)}.svg-zoom-wrapper:fullscreen{background:#1a1a1a}.svg-zoom-wrapper:-webkit-full-screen{background:#1a1a1a}.svg-zoom-wrapper:-moz-full-screen{background:#1a1a1a}.svg-zoom-wrapper:-ms-fullscreen{background:#1a1a1a}.svg-zoom-controls{position:absolute;top:1rem;right:1rem;z-index:10;display:flex;gap:.5rem;background:rgba(255,255,255,.95);padding:.5rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15)}.svg-zoom-wrapper:fullscreen .svg-zoom-controls,.svg-zoom-wrapper:-webkit-full-screen .svg-zoom-controls,.svg-zoom-wrapper:-moz-full-screen .svg-zoom-controls,.svg-zoom-wrapper:-ms-fullscreen .svg-zoom-controls{background:rgba(0,0,0,.8)}.svg-zoom-btn{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border:none;background:#f8f9fa;color:#334155;border-radius:6px;cursor:pointer;transition:all .2s ease;padding:0}.svg-zoom-btn:hover{background:#3b82f6;color:#fff;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.2)}.svg-zoom-btn:active{transform:translateY(0)}.svg-zoom-wrapper:fullscreen .svg-zoom-btn,.svg-zoom-wrapper:-webkit-full-screen .svg-zoom-btn,.svg-zoom-wrapper:-moz-full-screen .svg-zoom-btn,.svg-zoom-wrapper:-ms-fullscreen .svg-zoom-btn{background:rgba(255,255,255,.1);color:#fff}.svg-zoom-wrapper:fullscreen .svg-zoom-btn:hover,.svg-zoom-wrapper:-webkit-full-screen .svg-zoom-btn:hover,.svg-zoom-wrapper:-moz-full-screen .svg-zoom-btn:hover,.svg-zoom-wrapper:-ms-fullscreen .svg-zoom-btn:hover{background:rgba(59,130,246,.8)}.svg-pan-container{position:relative;width:100%;min-height:400px;overflow:hidden;touch-action:none;display:flex;align-items:center;justify-content:center}.svg-zoom-wrapper:fullscreen .svg-pan-container,.svg-zoom-wrapper:-webkit-full-screen .svg-pan-container,.svg-zoom-wrapper:-moz-full-screen .svg-pan-container,.svg-zoom-wrapper:-ms-fullscreen .svg-pan-container{height:100vh}.svg-zoomable-image{max-width:100%;height:auto;transition:transform .1s ease-out;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}figcaption{margin-top:.75rem;font-size:.9rem;color:#64748b;font-style:italic;padding:0 1rem}@media(max-width:768px){.svg-zoom-controls{top:.5rem;right:.5rem;padding:.25rem;gap:.25rem}.svg-zoom-btn{width:32px;height:32px}.svg-pan-container{min-height:300px}}.svg-pan-container::after{content:'Utilisez la molette de souris pour zoomer, cliquez et glissez pour d√©placer';position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);color:#fff;padding:.5rem 1rem;border-radius:6px;font-size:.8rem;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .3s ease}.svg-zoom-wrapper:hover .svg-pan-container::after{opacity:1}.svg-zoom-wrapper:fullscreen .svg-pan-container::after,.svg-zoom-wrapper:-webkit-full-screen .svg-pan-container::after,.svg-zoom-wrapper:-moz-full-screen .svg-pan-container::after,.svg-zoom-wrapper:-ms-fullscreen .svg-pan-container::after{display:none}@media(max-width:768px){.svg-pan-container::after{content:'Pincez pour zoomer';font-size:.75rem;padding:.4rem .8rem}}</style><p><strong>Ce que cette organisation r√©v√®le</strong> :</p><ul><li><strong>Le flux temporel</strong> : De gauche √† droite, on voit l&rsquo;ordre chronologique des √©v√©nements</li><li><strong>Les responsabilit√©s</strong> : Chaque acteur (Customer, Admin) d√©clenche des commandes sp√©cifiques</li><li><strong>Les d√©pendances</strong> : On voit clairement que Payment d√©pend de PaymentGateway (syst√®me externe)</li><li><strong>Les agr√©gats</strong> : Payment est l&rsquo;agr√©gat central, mais Order est aussi concern√©</li><li><strong>Les chemins alternatifs</strong> : PaymentProcessed ou PaymentFailed selon la r√©ponse de la gateway</li></ul><blockquote><p><strong>üí° Pour aller plus loin</strong> : Cette pr√©sentation simplifi√©e montre les concepts de base. Dans le <a href=/chapitres/fondamentaux/chapitre-03-atelier-event-storming/>Chapitre 3</a>, vous d√©couvrirez comment animer un atelier complet avec votre √©quipe, avec des exemples d√©taill√©s et des templates √† t√©l√©charger.</p></blockquote><h2 id=architecture-r√©sultante>Architecture R√©sultante <a href=#architecture-r%c3%a9sultante class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=structure-par-bounded-context>Structure par Bounded Context <a href=#structure-par-bounded-context class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Voici la structure r√©elle du projet Gyroscops Cloud, organis√©e par Bounded Context :</p><pre tabindex=0><code>api/src/
‚îú‚îÄ‚îÄ Accounting/           # Contexte Comptabilit√©
‚îÇ   ‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Payment/      # Agr√©gat Payment
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Command/  # Mod√®les de commande
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Query/    # Mod√®les de requ√™te
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Subscription/ # Agr√©gat Subscription
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Offer/        # Agr√©gat Offer
‚îÇ   ‚îî‚îÄ‚îÄ Infrastructure/   # Impl√©mentations techniques
‚îú‚îÄ‚îÄ Authentication/       # Contexte Authentification
‚îÇ   ‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User/         # Agr√©gat User
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Organization/ # Agr√©gat Organization
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Role/         # Agr√©gat Role
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Realm/        # Agr√©gat Realm
‚îÇ   ‚îî‚îÄ‚îÄ Infrastructure/
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ Platform/             # Contexte Plateforme
    ‚îú‚îÄ‚îÄ Domain/
    ‚îÇ   ‚îî‚îÄ‚îÄ FeatureRollout/ # Agr√©gat FeatureRollout
    ‚îî‚îÄ‚îÄ Infrastructure/</code></pre><h3 id=le-monolithe-modulaire--la-vraie-solution>Le Monolithe Modulaire : La Vraie Solution <a href=#le-monolithe-modulaire--la-vraie-solution class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce que j&rsquo;ai appris avec Gyroscops</strong> : Dans 80% des cas, les microservices sont une r√©ponse hors sujet. La vraie dette technique, ce n&rsquo;est pas le monolithe. C&rsquo;est un monolithe mal structur√©.</p><p>J&rsquo;ai vu trop d&rsquo;√©quipes exploser leur codebase en 15 services &ldquo;ind√©pendants&rdquo; qui finissent par d√©pendre les uns des autres, en justifiant qu&rsquo;un jour peut √™tre on supprimmera le module. Quand un probl√®me basique survient il faut mettre 40 minutes √† d√©boguer un simple flux m√©tier. Quand le jour de la suppression d&rsquo;un module arrive, on se rend compte que tous les modules ont des d√©pendances circulaires et qu&rsquo;il n&rsquo;y a, de fait, qu&rsquo;un seul module.</p><p><strong>Avec les Bounded Contexts, j&rsquo;ai cr√©√© un monolithe modulaire</strong> :</p><ul><li><strong>Bien d√©coup√© en domaines fonctionnels clairs</strong> : Chaque Bounded Context correspond √† un domaine m√©tier</li><li><strong>Avec des interfaces internes bien d√©finies</strong> : Les UseCases exposent des interfaces claires</li><li><strong>Testable, maintenable, lisible</strong> : Chaque contexte peut √™tre test√© et maintenu ind√©pendamment</li><li><strong>D√©ployable en un clic</strong> : Un seul d√©ploiement pour toute l&rsquo;application</li><li><strong>Des d√©pendances maris√©es</strong> : Seuls les objets d&rsquo;ID d&rsquo;un autre Bounded Context sont tol√©r√©s, sinon tout toit √™tre isol√© au Bounded context actuel</li></ul><p><strong>Le r√©sultat</strong> : J&rsquo;ai √©vit√© le pi√®ge des microservices pr√©matur√©s. J&rsquo;ai un syst√®me coh√©rent, maintenable, et √©volutif. Et quand un module devient vraiment trop gros ou trop critique et que toutes les pistes d&rsquo;optimisation ont √©t√© parcourues, l√† je peux r√©fl√©chir √† l&rsquo;extraire en microservice. Mais je pars du besoin, pas du dogme.</p><p><strong>Comme le dit <a href=https://www.linkedin.com/posts/jeanvincentquilichini_je-ne-fais-presque-plus-de-microservices-activity-7375767071550423040-Kivq rel=external target=_blank>Jean-Vincent Quilichini<svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M14 5c-.552.0-1-.448-1-1s.448-1 1-1h6c.552.0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1V6.414l-7.293 7.293c-.391.39-1.024.39-1.414.0-.391-.391-.391-1.024.0-1.414L17.586 5H14zM5 7c-.552.0-1 .448-1 1v11c0 .552.448 1 1 1h11c.552.0 1-.448 1-1v-4.563c0-.552.448-1 1-1s1 .448 1 1V19c0 1.657-1.343 3-3 3H5c-1.657.0-3-1.343-3-3V8c0-1.657 1.343-3 3-3h4.563c.552.0 1 .448 1 1s-.448 1-1 1H5z"/></svg></a> : &ldquo;Le microservice doit √™tre un outil. Pas une posture.&rdquo;</strong></p><h3 id=r√©f√©rences-aux-adr-du-projet-gyroscops-cloud>R√©f√©rences aux ADR du projet Gyroscops Cloud <a href=#r%c3%a9f%c3%a9rences-aux-adr-du-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Cette architecture suit les principes d√©finis dans les Architecture Decision Records (ADR) du projet Gyroscops Cloud :</p><ul><li><strong>HIVE040</strong> : Enhanced Models with Property Access Patterns - Utilisation de propri√©t√©s publiques en lecture seule</li><li><strong>HIVE041</strong> : Cross-Cutting Concerns Architecture - S√©paration claire des responsabilit√©s</li><li><strong>HIVE005</strong> : Common Identifier Model Interfaces - Interfaces standardis√©es pour les identifiants</li><li><strong>HIVE010</strong> : Repositories - Patterns de repository avec int√©gration Event Bus</li><li><strong>HIVE023</strong> : Repository Testing Strategies - Strat√©gies de test pour les repositories</li><li><strong>HIVE027</strong> : PHPUnit Testing Standards - Standards de test PHPUnit</li></ul><h3 id=int√©gration-avec-api-platform>Int√©gration avec API Platform <a href=#int%c3%a9gration-avec-api-platform class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Exemple d&#39;int√©gration API Platform
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Get</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\GetCollection</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Post</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Put</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Patch</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Delete</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[Get]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[GetCollection]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[Post]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[Put]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[Patch]
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[Delete]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Payment</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>Money</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentMethods</span> $method,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>PaymentStatus</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>DateTime</span> $createdAt
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}</span></span></code></pre></div><div class=chapter-navigation><h2 class=chapter-nav-title>üéØ Votre Prochaine √âtape</h2><p class=chapter-nav-subtitle>Maintenant que vous comprenez les concepts de base et que j'ai partag√© mon exp√©rience avec Gyroscops, quel est votre contexte ?</p><div class=chapter-options><div class=chapter-option data-color=green><div class=chapter-option-header><div class=chapter-option-letter>A</div><div><h3 class=chapter-option-title>Je veux aligner le produit sur les objectifs business avec l'Impact Mapping</h3><p class=chapter-option-subtitle>Vous voulez recentrer le p√©rim√®tre du projet autour d'objectifs business pr√©cis</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>Objectifs business √† clarifier</li><li>Besoin d'aligner business et technique</li><li>√âquipe avec business owners disponibles</li><li>Temps pour la planification strat√©gique</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 2-3 heures</span>
<a href=/chapitres/fondamentaux/chapitre-02-impact-mapping/ class=chapter-option-link>L'Impact Mapping - Aligner le Produit sur les Objectifs Business</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=yellow data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>B</div><div><h3 class=chapter-option-title>Je veux apprendre la m√©thode Event Storming</h3><p class=chapter-option-subtitle>Vous voulez ma√Ætriser la technique de conception collaborative</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>√âquipe de 3-8 personnes</li><li>Besoin de conception collaborative</li><li>Projet complexe √† mod√©liser</li><li>Temps disponible pour un atelier</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 30-45 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">L'Atelier Event Storming - Guide Pratique
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=red data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>C</div><div><h3 class=chapter-option-title>Je veux d√©tailler les r√®gles m√©tier avec l'Example Mapping</h3><p class=chapter-option-subtitle>Vous voulez explorer les r√®gles complexes d√©couvertes lors de l'Event Storming</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>R√®gles m√©tier complexes identifi√©es</li><li>Besoin de clarifier les cas limites</li><li>√âquipe avec expert m√©tier disponible</li><li>Temps pour approfondir les d√©tails</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 30-45 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">L'Example Mapping - D√©tailer les R√®gles M√©tier
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=blue data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>D</div><div><h3 class=chapter-option-title>Je veux comprendre la complexit√© architecturale</h3><p class=chapter-option-subtitle>Vous voulez savoir quand utiliser quels patterns</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>√âquipe exp√©riment√©e</li><li>Besoin de choisir une architecture</li><li>Projet avec contraintes techniques</li><li>D√©cision architecturale √† prendre</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 20-30 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Complexit√© Accidentelle vs Essentielle
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=purple data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>E</div><div><h3 class=chapter-option-title>Je veux voir des exemples concrets de mod√®les</h3><p class=chapter-option-subtitle>Vous voulez comprendre la diff√©rence entre mod√®les riches et an√©miques</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>D√©veloppeur avec exp√©rience</li><li>Besoin d'exemples pratiques</li><li>Compr√©hension des patterns de code</li><li>Impl√©mentation √† faire</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 25-35 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Mod√®les Riches vs Mod√®les An√©miques
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style></div></div><style>.chapter-navigation{margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;border-left:4px solid #3b82f6}.chapter-nav-title{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:#1e293b}.chapter-nav-subtitle{margin:0 0 1.5rem;color:#64748b;font-size:1rem;line-height:1.6}.chapter-options{display:flex;flex-direction:column;gap:1rem}.chapter-option{background:#fff;border-radius:8px;padding:1.25rem;border:1px solid #e2e8f0;transition:all .2s ease;position:relative;overflow:hidden}.chapter-option:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#3b82f6}.chapter-option::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--option-color,#6b7280);border-radius:0 2px 2px 0}.chapter-option-header{display:flex;align-items:center;margin-bottom:.75rem}.chapter-option-letter{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:50%;background:var(--option-color,#6b7280);color:#fff;font-weight:700;font-size:.875rem;margin-right:.75rem;flex-shrink:0}.chapter-option-title{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0;line-height:1.4}.chapter-option-subtitle{font-size:.875rem;color:#64748b;font-style:italic;margin:.25rem 0 0;line-height:1.4}.chapter-option-content{margin-left:2.75rem}.chapter-option-criteria{margin-bottom:.75rem}.chapter-option-criteria-title{font-size:.875rem;font-weight:600;color:#374151;margin:0 0 .5rem}.chapter-option-criteria-list{list-style:none;padding:0;margin:0}.chapter-option-criteria-list li{position:relative;padding-left:1.25rem;margin-bottom:.25rem;font-size:.875rem;color:#4b5563;line-height:1.4}.chapter-option-criteria-list li::before{content:'‚úì';position:absolute;left:0;color:#10b981;font-weight:600}.chapter-option-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1rem;padding-top:.75rem;border-top:1px solid #e5e7eb}.chapter-option-time{font-size:.875rem;color:#6b7280;font-weight:500}.chapter-option-link{display:inline-flex;align-items:center;padding:.5rem 1rem;background:var(--option-color,#6b7280);color:#fff!important;text-decoration:none!important;border-radius:6px;font-weight:600;font-size:.875rem;transition:all .2s ease;border:none;cursor:pointer}.chapter-option-link:hover{background:var(--option-color-dark,#4b5563);color:#fff!important;text-decoration:none!important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.chapter-option-link:visited{color:#fff!important;text-decoration:none!important}.chapter-option-link:focus{color:#fff!important;text-decoration:none!important;outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.chapter-option-link:active{color:#fff!important;text-decoration:none!important}.chapter-option-link::after{content:'‚Üí';margin-left:.5rem;transition:transform .2s ease;color:#fff!important}.chapter-option-link:hover::after{transform:translateX(2px);color:#fff!important}.chapter-navigation a{color:inherit;text-decoration:none}.chapter-navigation a:hover{color:inherit;text-decoration:none}.chapter-navigation a:visited{color:inherit;text-decoration:none}.chapter-navigation a:focus{color:inherit;text-decoration:none}.chapter-navigation a:active{color:inherit;text-decoration:none}.chapter-option[data-color=green]{--option-color:#10b981;--option-color-dark:#059669}.chapter-option[data-color=yellow]{--option-color:#f59e0b;--option-color-dark:#d97706}.chapter-option[data-color=red]{--option-color:#ef4444;--option-color-dark:#dc2626}.chapter-option[data-color=blue]{--option-color:#3b82f6;--option-color-dark:#2563eb}.chapter-option[data-color=purple]{--option-color:#8b5cf6;--option-color-dark:#7c3aed}.chapter-option[data-color=orange]{--option-color:#f97316;--option-color-dark:#ea580c}.chapter-option[data-color=teal]{--option-color:#14b8a6;--option-color-dark:#0d9488}.chapter-option[data-color=indigo]{--option-color:#6366f1;--option-color-dark:#4f46e5}.chapter-option[data-color=pink]{--option-color:#ec4899;--option-color-dark:#db2777}.chapter-option[data-color=cyan]{--option-color:#06b6d4;--option-color-dark:#0891b2}@media(max-width:768px){.chapter-navigation{padding:1rem}.chapter-option{padding:1rem}.chapter-option-content{margin-left:2.5rem}.chapter-option-footer{flex-direction:column;align-items:flex-start;gap:.75rem}.chapter-option-link{align-self:stretch;justify-content:center}}</style><p><strong>üí° Conseil</strong> : Si vous n&rsquo;√™tes pas s√ªr, choisissez l&rsquo;option A pour commencer par l&rsquo;Impact Mapping, puis continuez avec les autres chapitres dans l&rsquo;ordre.</p><p><strong>üîÑ Alternative</strong> : Si vous voulez tout voir dans l&rsquo;ordre, commencez par le <a href=/chapitres/fondamentaux/chapitre-02-impact-mapping/>Chapitre 2</a>.</p></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap flex-row-reverse"><div class="col-sm-6 pt-2 doc-prev"><a class=ms-auto href=/chapitres/fondamentaux/chapitre-02-impact-mapping/><div class="card h-100 my-1 text-end"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0">Chapitre 2 : L'Impact Mapping - Aligner le Produit sur les Objectifs Business <i class="material-icons align-middle">navigate_next</i></p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>¬© 2025 Gr√©gory Planchat. Tous droits r√©serv√©s.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci √† nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-3"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class="text-decoration-none d-inline-block"><img src=/logo-kiboko-fr.svg alt=Kiboko width=120 height=60 style=display:block;max-width:120px;height:auto></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class="text-decoration-none d-inline-block"><img src=/logo-gyroscops.svg alt=Gyroscops width=120 height=60 style=display:block;max-width:120px;height:auto></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.c7927bdd82eceb076739257add3f4b0e11379da037c07d5c7110daeb6de0e3edcb2de867604550f88815157e4ec4ddb7.js integrity=sha384-x5J73YLs6wdnOSV63T9LDhE3naA3wH1ccRDa623g4+3LLehnYEVQ+IgVFX5OxN23 defer></script><script type=text/javascript src=https://votre-domaine.fr/docs/js/bundle.min.a046e72674401a45bf99217648934a99ff03a7c46d105e47916156e66969388a0643f55a1e850acb495c9bd8be985171.js integrity=sha384-oEbnJnRAGkW/mSF2SJNKmf8Dp8RtEF5HkWFW5mlpOIoGQ/VaHoUKy0lcm9i+mFFx crossorigin=anonymous defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>