<!doctype html><html lang=fr-fr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><title>Chapitre 63 : Stockage API - Event Sourcing Seul | DDD Adventure</title><meta name=robots content="noindex"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Maîtriser le stockage via APIs externes avec Event Sourcing pour un audit trail complet"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=http://localhost:1313/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=http://localhost:1313/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=http://localhost:1313/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=http://localhost:1313/site.webmanifest><meta property="og:title" content="Chapitre 63 : Stockage API - Event Sourcing Seul"><meta property="og:description" content="Maîtriser le stockage via APIs externes avec Event Sourcing pour un audit trail complet"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/chapitres/stockage/api/chapitre-25-stockage-api-event-sourcing/"><meta property="og:image" content="http://localhost:1313/opengraph/card-base-2_hu_81f708e32dc34f41.png"><meta property="article:section" content="chapitres"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/opengraph/card-base-2_hu_81f708e32dc34f41.png"><meta name=twitter:title content="Chapitre 63 : Stockage API - Event Sourcing Seul"><meta name=twitter:description content="Maîtriser le stockage via APIs externes avec Event Sourcing pour un audit trail complet"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=http://localhost:1313/docs/js/flexsearch.bundle.js></script><link rel=stylesheet href=/docs/scss/style.css crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Fondamentaux</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-02-impact-mapping/>Chapitre 2 : L'Impact Mapping - Aligner le Produit sur les Objectifs Business</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-03-atelier-event-storming/>Chapitre 3 : L'Atelier Event Storming - Guide Pratique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-04-example-mapping/>Chapitre 4 : L'Example Mapping - Détailer les Règles Métier</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-05-complexite-accidentelle-essentielle/>Chapitre 5 : Complexité Accidentelle vs Essentielle - Le Choix Architectural</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-06-granularite-choix-architecturaux/>Chapitre 6 : Granularité des Choix Architecturaux</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-07-modeles-riches-vs-anemiques/>Chapitre 7 : Modèles Riches vs Modèles Anémiques</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-08-architecture-evenementielle/>Chapitre 8 : Architecture Événementielle</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-09-repositories-persistance/>Chapitre 9 : Repositories et Persistance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-10-choix-type-stockage/>Chapitre 15 : Choix du Type de Stockage</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Optionnels</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-13-architecture-cqrs/>Chapitre 15 : Architecture CQRS avec API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-12-architecture-cqs/>Chapitre 15 : Architecture CQS - Command Query Separation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-11-event-sourcing/>Chapitre 15 : Event Sourcing - La Source de Vérité</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-14-cqrs-event-sourcing-combines/>Chapitre 15 : CQRS + Event Sourcing Combinés</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-15-projections-event-sourcing/>Chapitre 15 : Projections Event Sourcing</a></li></ul></div></li><li class="sidebar-dropdown no-icon current active"><button class=btn>
Chapitres de Stockage</button><div class="sidebar-submenu d-block"><ul><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage SQL</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-16-stockage-sql-classique/>Chapitre 16 : Stockage SQL - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-17-stockage-sql-cqs/>Chapitre 17 : Stockage SQL - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-18-stockage-sql-cqrs/>Chapitre 18 : Stockage SQL - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-19-stockage-sql-event-sourcing/>Chapitre 19 : Stockage SQL - Event Sourcing Seul</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-20-stockage-sql-event-sourcing-cqs/>Chapitre 58 : Stockage SQL - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-21-stockage-sql-event-sourcing-cqrs/>Chapitre 59 : Stockage SQL - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon current active"><button class=btn>
Stockage API</button><div class="sidebar-submenu d-block"><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-26-stockage-api-event-sourcing-cqs/>Chapitre 26 : Stockage API - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-27-stockage-api-event-sourcing-cqrs/>Chapitre 27 : Stockage API - Event Sourcing + CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-22-stockage-api-classique/>Chapitre 60 : Stockage API - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-23-stockage-api-cqs/>Chapitre 61 : Stockage API - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-24-stockage-api-cqrs/>Chapitre 62 : Stockage API - Approche CQRS</a></li><li class="current no-icon"><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-25-stockage-api-event-sourcing/>Chapitre 63 : Stockage API - Event Sourcing Seul</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage MongoDB</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-28-stockage-mongodb-classique/>Chapitre 28 : Stockage MongoDB - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-29-stockage-mongodb-cqs/>Chapitre 29 : Stockage MongoDB - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-30-stockage-mongodb-cqrs/>Chapitre 30 : Stockage MongoDB - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-31-stockage-mongodb-event-sourcing/>Chapitre 31 : Stockage MongoDB - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-32-stockage-mongodb-event-sourcing-cqs/>Stockage MongoDB - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-33-stockage-mongodb-event-sourcing-cqrs/>Stockage MongoDB - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage ElasticSearch</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-34-stockage-elasticsearch-classique/>Stockage ElasticSearch - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-35-stockage-elasticsearch-cqs/>Stockage ElasticSearch - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-36-stockage-elasticsearch-cqrs/>Stockage ElasticSearch - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-37-stockage-elasticsearch-event-sourcing/>Stockage ElasticSearch - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-38-stockage-elasticsearch-event-sourcing-cqs/>Stockage ElasticSearch - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-39-stockage-elasticsearch-event-sourcing-cqrs/>Stockage ElasticSearch - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage In-Memory</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-40-stockage-in-memory-classique/>Stockage In-Memory - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-41-stockage-in-memory-cqs/>Stockage In-Memory - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-42-stockage-in-memory-cqrs/>Stockage In-Memory - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-43-stockage-in-memory-event-sourcing/>Stockage In-Memory - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-44-stockage-in-memory-event-sourcing-cqs/>Stockage In-Memory - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-45-stockage-in-memory-event-sourcing-cqrs/>Stockage In-Memory - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Composite piloté par Temporal</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-46-stockage-temporal-classique/>Stockage Temporal - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-47-stockage-temporal-cqs/>Stockage Temporal - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-48-stockage-temporal-cqrs/>Stockage Temporal - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-49-stockage-temporal-event-sourcing/>Stockage Temporal - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-50-stockage-temporal-event-sourcing-cqs/>Stockage Temporal - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-51-stockage-temporal-event-sourcing-cqrs/>Stockage Temporal - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Multi-sources</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-52-stockage-multi-sources-classique/>Stockage Multi-sources - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-53-stockage-multi-sources-cqs/>Stockage Multi-sources - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-54-stockage-multi-sources-cqrs/>Stockage Multi-sources - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-55-stockage-multi-sources-event-sourcing/>Stockage Multi-sources avec Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-56-stockage-multi-sources-strategies-avancees/>Stratégies Avancées de Réplication Multi-sources</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-57-stockage-multi-sources-resolution-conflits/>Résolution de Conflits Multi-sources</a></li></ul></div></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Techniques</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-58-gestion-donnees-validation/>Chapitre 58 : Gestion des Données et Validation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-59-pagination-performance/>Chapitre 59 : Pagination et Performance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-60-gestion-erreurs-observabilite/>Chapitre 60 : Gestion d'Erreurs et Observabilité</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-61-tests-qualite/>Chapitre 61 : Tests et Qualité</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Avancés</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-62-securite-autorisation/>Chapitre 62 : Sécurité et Autorisation - Protéger votre API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-63-frontend-integration/>Chapitre 63 : Frontend et Intégration - Connecter votre Interface Utilisateur</a></li></ul></div></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"><li class="list-inline-item mb-0"><a href=https://twitter.com/gplanchat alt=twitter rel="noopener noreferrer" target=_blank><div class="btn btn-icon btn-default border-0"><svg width="24" height="24" viewBox="0 0 24 24"><title>Twitter / X</title><path d="M.088.768l9.266 12.39L.029 23.231h2.1l8.163-8.819 6.6 8.819h7.142L14.242 10.145 22.921.768h-2.1L13.3 8.891 7.229.768zM3.174 2.314H6.455L20.942 21.685h-3.28z" fill="currentColor"/></svg></div></a></li></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/stockage/><span itemprop=name>Chapitres de Stockage</span>
</a><meta itemprop=position content='2'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/stockage/api/><span itemprop=name>Stockage API</span>
</a><meta itemprop=position content='3'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Chapitre 63 : Stockage API - Event Sourcing Seul</span>
<meta itemprop=position content='4'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-objectif-de-ce-chapitre>🎯 Objectif de ce Chapitre</a><ul><li><a href=#mon-problème--comment-avoir-un-audit-trail-complet-avec-les-apis-externes->Mon Problème : Comment Avoir un Audit Trail Complet avec les APIs Externes ?</a></li><li><a href=#stockage-api-event-sourcing--mon-guide-pratique>Stockage API Event Sourcing : Mon Guide Pratique</a></li></ul></li><li><a href=#quest-ce-que-le-stockage-api-event-sourcing->Qu&rsquo;est-ce que le Stockage API Event Sourcing ?</a><ul><li><a href=#le-concept-fondamental>Le Concept Fondamental</a></li><li><a href=#les-4-piliers-du-stockage-api-event-sourcing>Les 4 Piliers du Stockage API Event Sourcing</a></li></ul></li><li><a href=#comment-implémenter-le-stockage-api-event-sourcing>Comment Implémenter le Stockage API Event Sourcing</a><ul><li><a href=#1-créer-la-table-des-événements>1. <strong>Créer la Table des Événements</strong></a></li><li><a href=#2-créer-la-table-des-snapshots>2. <strong>Créer la Table des Snapshots</strong></a></li><li><a href=#3-créer-l>3. <strong>Créer l’Event Store</strong></a></li><li><a href=#4-créer-les-agrégats-event-sourcing>4. <strong>Créer les Agrégats Event Sourcing</strong></a></li><li><a href=#5-créer-les-projections>5. <strong>Créer les Projections</strong></a></li></ul></li><li><a href=#les-avantages-du-stockage-api-event-sourcing>Les Avantages du Stockage API Event Sourcing</a><ul><li><a href=#1-audit-trail-complet>1. <strong>Audit Trail Complet</strong></a></li><li><a href=#2-debugging-facilité>2. <strong>Debugging Facilité</strong></a></li><li><a href=#3-évolution-des-vues-métier>3. <strong>Évolution des Vues Métier</strong></a></li><li><a href=#4-intégrité-des-données>4. <strong>Intégrité des Données</strong></a></li></ul></li><li><a href=#les-inconvénients-du-stockage-api-event-sourcing>Les Inconvénients du Stockage API Event Sourcing</a><ul><li><a href=#1-complexité-technique>1. <strong>Complexité Technique</strong></a></li><li><a href=#2-performance-des-lectures>2. <strong>Performance des Lectures</strong></a></li><li><a href=#3-stockage-important>3. <strong>Stockage Important</strong></a></li></ul></li><li><a href=#les-pièges-à-éviter>Les Pièges à Éviter</a><ul><li><a href=#1-événements-trop-granulaires>1. <strong>Événements Trop Granulaires</strong></a></li><li><a href=#2-projections-synchrones>2. <strong>Projections Synchrones</strong></a></li><li><a href=#3-pas-de-snapshots>3. <strong>Pas de Snapshots</strong></a></li></ul></li><li><a href=#-implémentation-concrète-dans-le-projet-gyroscops-cloud>🏗️ Implémentation Concrète dans le Projet Gyroscops Cloud</a><ul><li><a href=#stockage-api-event-sourcing-appliqué-à-gyroscops-cloud>Stockage API Event Sourcing Appliqué à Gyroscops Cloud</a></li><li><a href=#références-aux-adr-du-projet-gyroscops-cloud>Références aux ADR du Projet Gyroscops Cloud</a></li></ul></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-objectif-de-ce-chapitre>🎯 Objectif de ce Chapitre</a><ul><li><a href=#mon-problème--comment-avoir-un-audit-trail-complet-avec-les-apis-externes->Mon Problème : Comment Avoir un Audit Trail Complet avec les APIs Externes ?</a></li><li><a href=#stockage-api-event-sourcing--mon-guide-pratique>Stockage API Event Sourcing : Mon Guide Pratique</a></li></ul></li><li><a href=#quest-ce-que-le-stockage-api-event-sourcing->Qu&rsquo;est-ce que le Stockage API Event Sourcing ?</a><ul><li><a href=#le-concept-fondamental>Le Concept Fondamental</a></li><li><a href=#les-4-piliers-du-stockage-api-event-sourcing>Les 4 Piliers du Stockage API Event Sourcing</a></li></ul></li><li><a href=#comment-implémenter-le-stockage-api-event-sourcing>Comment Implémenter le Stockage API Event Sourcing</a><ul><li><a href=#1-créer-la-table-des-événements>1. <strong>Créer la Table des Événements</strong></a></li><li><a href=#2-créer-la-table-des-snapshots>2. <strong>Créer la Table des Snapshots</strong></a></li><li><a href=#3-créer-l>3. <strong>Créer l’Event Store</strong></a></li><li><a href=#4-créer-les-agrégats-event-sourcing>4. <strong>Créer les Agrégats Event Sourcing</strong></a></li><li><a href=#5-créer-les-projections>5. <strong>Créer les Projections</strong></a></li></ul></li><li><a href=#les-avantages-du-stockage-api-event-sourcing>Les Avantages du Stockage API Event Sourcing</a><ul><li><a href=#1-audit-trail-complet>1. <strong>Audit Trail Complet</strong></a></li><li><a href=#2-debugging-facilité>2. <strong>Debugging Facilité</strong></a></li><li><a href=#3-évolution-des-vues-métier>3. <strong>Évolution des Vues Métier</strong></a></li><li><a href=#4-intégrité-des-données>4. <strong>Intégrité des Données</strong></a></li></ul></li><li><a href=#les-inconvénients-du-stockage-api-event-sourcing>Les Inconvénients du Stockage API Event Sourcing</a><ul><li><a href=#1-complexité-technique>1. <strong>Complexité Technique</strong></a></li><li><a href=#2-performance-des-lectures>2. <strong>Performance des Lectures</strong></a></li><li><a href=#3-stockage-important>3. <strong>Stockage Important</strong></a></li></ul></li><li><a href=#les-pièges-à-éviter>Les Pièges à Éviter</a><ul><li><a href=#1-événements-trop-granulaires>1. <strong>Événements Trop Granulaires</strong></a></li><li><a href=#2-projections-synchrones>2. <strong>Projections Synchrones</strong></a></li><li><a href=#3-pas-de-snapshots>3. <strong>Pas de Snapshots</strong></a></li></ul></li><li><a href=#-implémentation-concrète-dans-le-projet-gyroscops-cloud>🏗️ Implémentation Concrète dans le Projet Gyroscops Cloud</a><ul><li><a href=#stockage-api-event-sourcing-appliqué-à-gyroscops-cloud>Stockage API Event Sourcing Appliqué à Gyroscops Cloud</a></li><li><a href=#références-aux-adr-du-projet-gyroscops-cloud>Références aux ADR du Projet Gyroscops Cloud</a></li></ul></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">Chapitre 63 : Stockage API - Event Sourcing Seul
<span class="badge bg-default fs-6 mb-1 align-middle">DRAFT</span></h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h2 id=-objectif-de-ce-chapitre>🎯 Objectif de ce Chapitre <a href=#-objectif-de-ce-chapitre class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=mon-problème--comment-avoir-un-audit-trail-complet-avec-les-apis-externes->Mon Problème : Comment Avoir un Audit Trail Complet avec les APIs Externes ? <a href=#mon-probl%c3%a8me--comment-avoir-un-audit-trail-complet-avec-les-apis-externes- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce qui s&rsquo;est passé avec Gyroscops</strong> : J&rsquo;avais besoin d&rsquo;un audit trail complet pour les intégrations API. Qui a créé cet utilisateur ? Quand ? Pourquoi l&rsquo;API a-t-elle échoué ? J&rsquo;avais besoin de pouvoir reconstruire l&rsquo;état à n&rsquo;importe quel moment et de déboguer facilement les problèmes d&rsquo;intégration.</p><p><strong>Mais attendez&mldr;</strong> Comment stocker tous les événements d&rsquo;API ? Comment reconstruire l&rsquo;état ? Comment gérer les projections ? Comment intégrer avec API Platform ?</p><p><strong>Soudain, je réalisais que l&rsquo;Event Sourcing + API était parfait !</strong> Il me fallait une méthode pour stocker les événements comme source de vérité tout en intégrant les APIs externes.</p><h3 id=stockage-api-event-sourcing--mon-guide-pratique>Stockage API Event Sourcing : Mon Guide Pratique <a href=#stockage-api-event-sourcing--mon-guide-pratique class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le stockage API Event Sourcing m&rsquo;a permis de :</p><ul><li><strong>Auditer</strong> complètement les intégrations</li><li><strong>Déboguer</strong> facilement les problèmes d&rsquo;API</li><li><strong>Reconstruire</strong> l&rsquo;état des intégrations</li><li><strong>Évoluer</strong> les vues métier des APIs</li></ul><h2 id=quest-ce-que-le-stockage-api-event-sourcing->Qu&rsquo;est-ce que le Stockage API Event Sourcing ? <a href=#quest-ce-que-le-stockage-api-event-sourcing- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=le-concept-fondamental>Le Concept Fondamental <a href=#le-concept-fondamental class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le stockage API Event Sourcing combine l&rsquo;utilisation d&rsquo;APIs externes avec l&rsquo;Event Sourcing pour stocker les événements comme source de vérité. <strong>L&rsquo;idée</strong> : Au lieu de stocker l&rsquo;état final des APIs, on stocke tous les événements qui ont mené à cet état.</p><p><strong>Avec Gyroscops, voici comment j&rsquo;ai structuré le stockage API Event Sourcing</strong> :</p><h3 id=les-4-piliers-du-stockage-api-event-sourcing>Les 4 Piliers du Stockage API Event Sourcing <a href=#les-4-piliers-du-stockage-api-event-sourcing class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><h4 id=1-table-des-événements---source-de-vérité>1. <strong>Table des Événements</strong> - Source de vérité <a href=#1-table-des-%c3%a9v%c3%a9nements---source-de-v%c3%a9rit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai implémenté la table des événements avec Gyroscops</strong> :</p><p><strong>Structure de Base</strong> :</p><ul><li><code>event_id</code> : Identifiant unique de l&rsquo;événement</li><li><code>aggregate_id</code> : Identifiant de l&rsquo;agrégat</li><li><code>event_type</code> : Type d&rsquo;événement</li><li><code>event_data</code> : Données de l&rsquo;événement (JSON)</li><li><code>event_metadata</code> : Métadonnées (utilisateur, timestamp, etc.)</li><li><code>version</code> : Version de l&rsquo;agrégat</li><li><code>created_at</code> : Date de création</li></ul><p><strong>Exemples d&rsquo;événements</strong> :</p><ul><li><code>UserApiCreated</code></li><li><code>UserApiUpdated</code></li><li><code>UserApiEnabled</code></li><li><code>UserApiDisabled</code></li><li><code>UserApiDeleted</code></li></ul><h4 id=2-table-des-snapshots---optimisation-des-performances>2. <strong>Table des Snapshots</strong> - Optimisation des performances <a href=#2-table-des-snapshots---optimisation-des-performances class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai implémenté les snapshots avec Gyroscops</strong> :</p><p><strong>Structure de Base</strong> :</p><ul><li><code>aggregate_id</code> : Identifiant de l&rsquo;agrégat</li><li><code>version</code> : Version du snapshot</li><li><code>snapshot_data</code> : État de l&rsquo;agrégat (JSON)</li><li><code>created_at</code> : Date de création</li></ul><p><strong>Avantages</strong> :</p><ul><li>Reconstruction plus rapide</li><li>Moins d&rsquo;événements à charger</li><li>Performance optimisée</li></ul><h4 id=3-projections---vues-de-lecture-optimisées>3. <strong>Projections</strong> - Vues de lecture optimisées <a href=#3-projections---vues-de-lecture-optimis%c3%a9es class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai implémenté les projections avec Gyroscops</strong> :</p><p><strong>Types de Projections</strong> :</p><ul><li>Projections de lecture (pour l&rsquo;API)</li><li>Projections d&rsquo;audit (pour le debugging)</li><li>Projections d&rsquo;analytics (pour les rapports)</li></ul><p><strong>Exemples</strong> :</p><ul><li><code>UserApiProjection</code> (état actuel)</li><li><code>UserApiAuditProjection</code> (historique complet)</li><li><code>UserApiAnalyticsProjection</code> (statistiques)</li></ul><h4 id=4-event-store---gestion-des-événements>4. <strong>Event Store</strong> - Gestion des événements <a href=#4-event-store---gestion-des-%c3%a9v%c3%a9nements class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai implémenté l&rsquo;Event Store avec Gyroscops</strong> :</p><p><strong>Fonctionnalités</strong> :</p><ul><li>Sauvegarde des événements</li><li>Reconstruction des agrégats</li><li>Gestion des versions</li><li>Optimistic locking</li></ul><h2 id=comment-implémenter-le-stockage-api-event-sourcing>Comment Implémenter le Stockage API Event Sourcing <a href=#comment-impl%c3%a9menter-le-stockage-api-event-sourcing class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-créer-la-table-des-événements>1. <strong>Créer la Table des Événements</strong> <a href=#1-cr%c3%a9er-la-table-des-%c3%a9v%c3%a9nements class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai créé la table des événements :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- ✅ Table des événements API Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> api_event_store (
</span></span><span style=display:flex><span>    event_id UUID <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    aggregate_id UUID <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    event_type VARCHAR(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    event_data JSONB <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    event_metadata JSONB <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>version</span> INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    created_at <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>WITH</span> TIME <span style=color:#66d9ef>ZONE</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> NOW(),
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>INDEX</span> idx_aggregate_id (aggregate_id),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>INDEX</span> idx_event_type (event_type),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>INDEX</span> idx_created_at (created_at)
</span></span><span style=display:flex><span>);</span></span></code></pre></div><p><strong>Résultat</strong> : Table optimisée pour les événements d&rsquo;API.</p><h3 id=2-créer-la-table-des-snapshots>2. <strong>Créer la Table des Snapshots</strong> <a href=#2-cr%c3%a9er-la-table-des-snapshots class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai créé la table des snapshots :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- ✅ Table des snapshots API Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> api_snapshots (
</span></span><span style=display:flex><span>    aggregate_id UUID <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>version</span> INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    snapshot_data JSONB <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>    created_at <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>WITH</span> TIME <span style=color:#66d9ef>ZONE</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> NOW()
</span></span><span style=display:flex><span>);</span></span></code></pre></div><p><strong>Résultat</strong> : Table pour optimiser les performances.</p><h3 id=3-créer-l>3. <strong>Créer l&rsquo;Event Store</strong> <a href=#3-cr%c3%a9er-l class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai créé l&rsquo;Event Store :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Event Store API Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ApiEventStore</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>EventStoreInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Connection</span> $connection,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EventSerializer</span> $serializer
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>append</span>(<span style=color:#a6e22e>string</span> $aggregateId, <span style=color:#66d9ef>array</span> $events, <span style=color:#a6e22e>int</span> $expectedVersion)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beginTransaction</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Vérifier la version attendue
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $currentVersion <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCurrentVersion</span>($aggregateId);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ($currentVersion <span style=color:#f92672>!==</span> $expectedVersion) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ConcurrencyException</span>(<span style=color:#e6db74>&#39;Version mismatch&#39;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Insérer les événements
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>foreach</span> ($events <span style=color:#66d9ef>as</span> $event) {
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>insertEvent</span>($aggregateId, $event, $currentVersion <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>                $currentVersion<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commit</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rollback</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> $e;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEvents</span>(<span style=color:#a6e22e>string</span> $aggregateId, <span style=color:#a6e22e>int</span> $fromVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT event_type, event_data, event_metadata, version, created_at 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                FROM api_event_store 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE aggregate_id = ? AND version &gt; ? 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ORDER BY version ASC&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$aggregateId, $fromVersion]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $events <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> ($row <span style=color:#f92672>=</span> $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetch</span>()) {
</span></span><span style=display:flex><span>            $events[] <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>serializer</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>deserialize</span>(
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;event_type&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;event_data&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;event_metadata&#39;</span>]
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $events;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>insertEvent</span>(<span style=color:#a6e22e>string</span> $aggregateId, <span style=color:#a6e22e>DomainEvent</span> $event, <span style=color:#a6e22e>int</span> $version)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;INSERT INTO api_event_store (event_id, aggregate_id, event_type, event_data, event_metadata, version) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                VALUES (?, ?, ?, ?, ?, ?)&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Uuid</span><span style=color:#f92672>::</span><span style=color:#a6e22e>uuid4</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $aggregateId,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>json_encode</span>($event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toArray</span>()),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>json_encode</span>($event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMetadata</span>()),
</span></span><span style=display:flex><span>            $version
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Event Store robuste pour les APIs.</p><h3 id=4-créer-les-agrégats-event-sourcing>4. <strong>Créer les Agrégats Event Sourcing</strong> <a href=#4-cr%c3%a9er-les-agr%c3%a9gats-event-sourcing class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai créé les agrégats :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Agrégat User API Event Sourcing Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserApiAggregate</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $username;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $email;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $firstName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $lastName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $organizationId;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>array</span> $roles;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>bool</span> $enabled;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>bool</span> $emailVerified;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>\DateTimeImmutable</span> $createdAt;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $createdBy;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>int</span> $version <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>array</span> $uncommittedEvents <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>create</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $username,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $email,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $firstName,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $lastName,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>array</span> $roles,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $createdBy
</span></span><span style=display:flex><span>    )<span style=color:#f92672>:</span> <span style=color:#a6e22e>self</span> {
</span></span><span style=display:flex><span>        $aggregate <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>();
</span></span><span style=display:flex><span>        $aggregate<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserApiCreated</span>(
</span></span><span style=display:flex><span>            $id,
</span></span><span style=display:flex><span>            $username,
</span></span><span style=display:flex><span>            $email,
</span></span><span style=display:flex><span>            $firstName,
</span></span><span style=display:flex><span>            $lastName,
</span></span><span style=display:flex><span>            $organizationId,
</span></span><span style=display:flex><span>            $roles,
</span></span><span style=display:flex><span>            $createdBy
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $aggregate;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $username,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $email,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $firstName,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $lastName,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $updatedBy
</span></span><span style=display:flex><span>    )<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserApiUpdated</span>(
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            $username,
</span></span><span style=display:flex><span>            $email,
</span></span><span style=display:flex><span>            $firstName,
</span></span><span style=display:flex><span>            $lastName,
</span></span><span style=display:flex><span>            $updatedBy
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>enable</span>(<span style=color:#a6e22e>string</span> $enabledBy)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidOperationException</span>(<span style=color:#e6db74>&#39;User is already enabled&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserApiEnabled</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>, $enabledBy));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>disable</span>(<span style=color:#a6e22e>string</span> $disabledBy)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidOperationException</span>(<span style=color:#e6db74>&#39;User is already disabled&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserApiDisabled</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>, $disabledBy));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>delete</span>(<span style=color:#a6e22e>string</span> $deletedBy)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserApiDeleted</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>, $deletedBy));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUncommittedEvents</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uncommittedEvents</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>markEventsAsCommitted</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uncommittedEvents</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getVersion</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>int</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>DomainEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uncommittedEvents</span>[] <span style=color:#f92672>=</span> $event;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handle</span>($event);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handle</span>(<span style=color:#a6e22e>DomainEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> ($event<span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiCreated</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiCreated</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiUpdated</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiUpdated</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiEnabled</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiEnabled</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiDisabled</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiDisabled</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiDeleted</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiDeleted</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiCreated</span>(<span style=color:#a6e22e>UserApiCreated</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserId</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUsername</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEmail</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFirstName</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getLastName</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOrganizationId</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>roles</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRoles</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>emailVerified</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOccurredAt</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedBy</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiUpdated</span>(<span style=color:#a6e22e>UserApiUpdated</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUsername</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEmail</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFirstName</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span> <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getLastName</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiEnabled</span>(<span style=color:#a6e22e>UserApiEnabled</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiDisabled</span>(<span style=color:#a6e22e>UserApiDisabled</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiDeleted</span>(<span style=color:#a6e22e>UserApiDeleted</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>version</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Getters...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUsername</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>username</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEmail</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFirstName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getLastName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>lastName</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getOrganizationId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getRoles</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>roles</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isEnabled</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>enabled</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isEmailVerified</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>emailVerified</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCreatedAt</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>\DateTimeImmutable</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCreatedBy</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span>; }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Agrégat Event Sourcing pour les APIs.</p><h3 id=5-créer-les-projections>5. <strong>Créer les Projections</strong> <a href=#5-cr%c3%a9er-les-projections class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai créé les projections :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Projection User API Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserApiProjectionHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Connection</span> $connection
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handle</span>(<span style=color:#a6e22e>DomainEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> ($event<span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiCreated</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiCreated</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiUpdated</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiUpdated</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiEnabled</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiEnabled</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiDisabled</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiDisabled</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>UserApiDeleted</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handleUserApiDeleted</span>($event);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiCreated</span>(<span style=color:#a6e22e>UserApiCreated</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;INSERT INTO user_api_projections (id, username, email, first_name, last_name, organization_id, roles, enabled, email_verified, created_at, created_by) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserId</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUsername</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEmail</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFirstName</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getLastName</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOrganizationId</span>(),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>json_encode</span>($event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRoles</span>()),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOccurredAt</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedBy</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiUpdated</span>(<span style=color:#a6e22e>UserApiUpdated</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE user_api_projections SET username = ?, email = ?, first_name = ?, last_name = ?, updated_at = ? WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUsername</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEmail</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getFirstName</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getLastName</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOccurredAt</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserId</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiEnabled</span>(<span style=color:#a6e22e>UserApiEnabled</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE user_api_projections SET enabled = 1, updated_at = ? WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOccurredAt</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserId</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiDisabled</span>(<span style=color:#a6e22e>UserApiDisabled</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE user_api_projections SET enabled = 0, updated_at = ? WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOccurredAt</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserId</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleUserApiDeleted</span>(<span style=color:#a6e22e>UserApiDeleted</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE user_api_projections SET deleted = 1, deleted_at = ? WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOccurredAt</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserId</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Projection pour les vues de lecture.</p><h2 id=les-avantages-du-stockage-api-event-sourcing>Les Avantages du Stockage API Event Sourcing <a href=#les-avantages-du-stockage-api-event-sourcing class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-audit-trail-complet>1. <strong>Audit Trail Complet</strong> <a href=#1-audit-trail-complet class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing m&rsquo;a donné un audit trail complet :</p><ul><li>Historique complet des changements d&rsquo;API</li><li>Qui a fait quoi et quand</li><li>Raison de chaque changement</li><li>Traçabilité totale des intégrations</li></ul><p><strong>Résultat</strong> : Audit trail parfait pour les intégrations API.</p><h3 id=2-debugging-facilité>2. <strong>Debugging Facilité</strong> <a href=#2-debugging-facilit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing m&rsquo;a facilité le debugging :</p><ul><li>Reconstruction de l&rsquo;état à n&rsquo;importe quel moment</li><li>Compréhension des causes d&rsquo;erreur d&rsquo;API</li><li>Simulation de scénarios d&rsquo;intégration</li><li>Analyse des comportements d&rsquo;API</li></ul><p><strong>Résultat</strong> : Debugging des intégrations API simplifié.</p><h3 id=3-évolution-des-vues-métier>3. <strong>Évolution des Vues Métier</strong> <a href=#3-%c3%a9volution-des-vues-m%c3%a9tier class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing m&rsquo;a permis d&rsquo;évoluer les vues :</p><ul><li>Nouvelles projections sans migration</li><li>Vues personnalisées par contexte d&rsquo;API</li><li>Analytics avancées des intégrations</li><li>Rapports complexes sur les APIs</li></ul><p><strong>Résultat</strong> : Flexibilité maximale pour les vues d&rsquo;API.</p><h3 id=4-intégrité-des-données>4. <strong>Intégrité des Données</strong> <a href=#4-int%c3%a9grit%c3%a9-des-donn%c3%a9es class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing m&rsquo;a garanti l&rsquo;intégrité :</p><ul><li>Événements immutables</li><li>Versioning des agrégats</li><li>Optimistic locking</li><li>Cohérence garantie</li></ul><p><strong>Résultat</strong> : Intégrité des données d&rsquo;API assurée.</p><h2 id=les-inconvénients-du-stockage-api-event-sourcing>Les Inconvénients du Stockage API Event Sourcing <a href=#les-inconv%c3%a9nients-du-stockage-api-event-sourcing class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-complexité-technique>1. <strong>Complexité Technique</strong> <a href=#1-complexit%c3%a9-technique class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing a ajouté de la complexité :</p><ul><li>Courbe d&rsquo;apprentissage importante</li><li>Plus de code à maintenir</li><li>Concepts avancés</li><li>Debugging plus complexe</li></ul><p><strong>Résultat</strong> : Complexité technique élevée.</p><h3 id=2-performance-des-lectures>2. <strong>Performance des Lectures</strong> <a href=#2-performance-des-lectures class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing peut avoir des problèmes de performance :</p><ul><li>Reconstruction coûteuse</li><li>Requêtes complexes</li><li>Besoin de projections</li><li>Cache complexe</li></ul><p><strong>Résultat</strong> : Performance des lectures dégradée.</p><h3 id=3-stockage-important>3. <strong>Stockage Important</strong> <a href=#3-stockage-important class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Le stockage API Event Sourcing consomme plus d&rsquo;espace :</p><ul><li>Tous les événements stockés</li><li>Métadonnées importantes</li><li>Snapshots réguliers</li><li>Croissance continue</li></ul><p><strong>Résultat</strong> : Consommation d&rsquo;espace importante.</p><h2 id=les-pièges-à-éviter>Les Pièges à Éviter <a href=#les-pi%c3%a8ges-%c3%a0-%c3%a9viter class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-événements-trop-granulaires>1. <strong>Événements Trop Granulaires</strong> <a href=#1-%c3%a9v%c3%a9nements-trop-granulaires class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Un événement par propriété modifiée
<strong>✅ Bon</strong> : Un événement par action métier significative</p><p><strong>Pourquoi c&rsquo;est important ?</strong> Trop d&rsquo;événements rendent le système complexe.</p><h3 id=2-projections-synchrones>2. <strong>Projections Synchrones</strong> <a href=#2-projections-synchrones class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Projections mises à jour de façon synchrone
<strong>✅ Bon</strong> : Projections asynchrones avec Event Bus</p><p><strong>Pourquoi c&rsquo;est crucial ?</strong> Les projections synchrones tuent les performances.</p><h3 id=3-pas-de-snapshots>3. <strong>Pas de Snapshots</strong> <a href=#3-pas-de-snapshots class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Reconstruction complète à chaque fois
<strong>✅ Bon</strong> : Snapshots réguliers pour optimiser</p><p><strong>Pourquoi c&rsquo;est essentiel ?</strong> Sans snapshots, les performances se dégradent.</p><h2 id=-implémentation-concrète-dans-le-projet-gyroscops-cloud>🏗️ Implémentation Concrète dans le Projet Gyroscops Cloud <a href=#-impl%c3%a9mentation-concr%c3%a8te-dans-le-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=stockage-api-event-sourcing-appliqué-à-gyroscops-cloud>Stockage API Event Sourcing Appliqué à Gyroscops Cloud <a href=#stockage-api-event-sourcing-appliqu%c3%a9-%c3%a0-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le Gyroscops Cloud applique concrètement les principes du stockage API Event Sourcing à travers son architecture et ses ADR (Architecture Decision Records). Voici comment :</p><h4 id=configuration-api-event-store-gyroscops-cloud>Configuration API Event Store Gyroscops Cloud <a href=#configuration-api-event-store-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Configuration API Event Store Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HiveApiEventStoreConfiguration</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>configureApiEventStore</span>(<span style=color:#a6e22e>ContainerBuilder</span> $container)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Configuration de l&#39;Event Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>ApiEventStore</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Configuration des projections
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>UserApiProjectionHandler</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Configuration de l&#39;Event Bus
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>EventBus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=références-aux-adr-du-projet-gyroscops-cloud>Références aux ADR du Projet Gyroscops Cloud <a href=#r%c3%a9f%c3%a9rences-aux-adr-du-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Ce chapitre s&rsquo;appuie sur les Architecture Decision Records (ADR) suivants du Gyroscops Cloud :</p><ul><li><strong>HIVE008</strong> : Event Collaboration - Collaboration par événements</li><li><strong>HIVE009</strong> : Message Buses - Bus de messages</li><li><strong>HIVE015</strong> : API Repositories - Repositories d&rsquo;API</li><li><strong>HIVE025</strong> : Authorization System - Système d&rsquo;autorisation</li><li><strong>HIVE026</strong> : Keycloak Resource and Scope Management - Gestion des ressources Keycloak</li></ul><div class=chapter-navigation><h2 class=chapter-nav-title>🎯 Votre Prochaine Étape</h2><p class=chapter-nav-subtitle>Maintenant que vous comprenez les concepts de base et que j'ai partagé mon expérience avec Gyroscops, quel est votre contexte ?</p><div class=chapter-options>{<div class=chapter-option data-color=green><div class=chapter-option-header><div class=chapter-option-letter>A</div><div><h3 class=chapter-option-title>Je veux comprendre le stockage API Event Sourcing + CQS</h3><p class=chapter-option-subtitle>Vous voulez voir une approche Event Sourcing avec séparation des commandes et requêtes</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe expérimentée</li><li>Besoin d'optimiser les performances</li><li>Event Sourcing déjà en place</li><li>Séparation des responsabilités importante</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 30-40 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Stockage API - Event Sourcing + CQS
<span class=coming-soon-indicator>🚧</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}}
{<div class=chapter-option data-color=yellow><div class=chapter-option-header><div class=chapter-option-letter>B</div><div><h3 class=chapter-option-title>Je veux comprendre le stockage ElasticSearch</h3><p class=chapter-option-subtitle>Vous voulez voir comment optimiser la recherche</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe expérimentée</li><li>Besoin de recherche avancée</li><li>Analytics importantes</li><li>Performance de recherche critique</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 30-40 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Stockage ElasticSearch - Approche Classique
<span class=coming-soon-indicator>🚧</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}}
{<div class=chapter-option data-color=red><div class=chapter-option-header><div class=chapter-option-letter>C</div><div><h3 class=chapter-option-title>Je veux comprendre le stockage MongoDB</h3><p class=chapter-option-subtitle>Vous voulez voir comment gérer des données semi-structurées</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe expérimentée</li><li>Besoin de flexibilité du schéma</li><li>Données semi-structurées</li><li>Performance de lecture élevée</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 30-40 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Stockage MongoDB - Approche Classique
<span class=coming-soon-indicator>🚧</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}}</div></div><style>.chapter-navigation{margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;border-left:4px solid #3b82f6}.chapter-nav-title{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:#1e293b}.chapter-nav-subtitle{margin:0 0 1.5rem;color:#64748b;font-size:1rem;line-height:1.6}.chapter-options{display:flex;flex-direction:column;gap:1rem}.chapter-option{background:#fff;border-radius:8px;padding:1.25rem;border:1px solid #e2e8f0;transition:all .2s ease;position:relative;overflow:hidden}.chapter-option:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#3b82f6}.chapter-option::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--option-color,#6b7280);border-radius:0 2px 2px 0}.chapter-option-header{display:flex;align-items:center;margin-bottom:.75rem}.chapter-option-letter{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:50%;background:var(--option-color,#6b7280);color:#fff;font-weight:700;font-size:.875rem;margin-right:.75rem;flex-shrink:0}.chapter-option-title{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0;line-height:1.4}.chapter-option-subtitle{font-size:.875rem;color:#64748b;font-style:italic;margin:.25rem 0 0;line-height:1.4}.chapter-option-content{margin-left:2.75rem}.chapter-option-criteria{margin-bottom:.75rem}.chapter-option-criteria-title{font-size:.875rem;font-weight:600;color:#374151;margin:0 0 .5rem}.chapter-option-criteria-list{list-style:none;padding:0;margin:0}.chapter-option-criteria-list li{position:relative;padding-left:1.25rem;margin-bottom:.25rem;font-size:.875rem;color:#4b5563;line-height:1.4}.chapter-option-criteria-list li::before{content:'✓';position:absolute;left:0;color:#10b981;font-weight:600}.chapter-option-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1rem;padding-top:.75rem;border-top:1px solid #e5e7eb}.chapter-option-time{font-size:.875rem;color:#6b7280;font-weight:500}.chapter-option-link{display:inline-flex;align-items:center;padding:.5rem 1rem;background:var(--option-color,#6b7280);color:#fff!important;text-decoration:none!important;border-radius:6px;font-weight:600;font-size:.875rem;transition:all .2s ease;border:none;cursor:pointer}.chapter-option-link:hover{background:var(--option-color-dark,#4b5563);color:#fff!important;text-decoration:none!important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.chapter-option-link:visited{color:#fff!important;text-decoration:none!important}.chapter-option-link:focus{color:#fff!important;text-decoration:none!important;outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.chapter-option-link:active{color:#fff!important;text-decoration:none!important}.chapter-option-link::after{content:'→';margin-left:.5rem;transition:transform .2s ease;color:#fff!important}.chapter-option-link:hover::after{transform:translateX(2px);color:#fff!important}.chapter-navigation a{color:inherit;text-decoration:none}.chapter-navigation a:hover{color:inherit;text-decoration:none}.chapter-navigation a:visited{color:inherit;text-decoration:none}.chapter-navigation a:focus{color:inherit;text-decoration:none}.chapter-navigation a:active{color:inherit;text-decoration:none}.chapter-option[data-color=green]{--option-color:#10b981;--option-color-dark:#059669}.chapter-option[data-color=yellow]{--option-color:#f59e0b;--option-color-dark:#d97706}.chapter-option[data-color=red]{--option-color:#ef4444;--option-color-dark:#dc2626}.chapter-option[data-color=blue]{--option-color:#3b82f6;--option-color-dark:#2563eb}.chapter-option[data-color=purple]{--option-color:#8b5cf6;--option-color-dark:#7c3aed}.chapter-option[data-color=orange]{--option-color:#f97316;--option-color-dark:#ea580c}.chapter-option[data-color=teal]{--option-color:#14b8a6;--option-color-dark:#0d9488}.chapter-option[data-color=indigo]{--option-color:#6366f1;--option-color-dark:#4f46e5}.chapter-option[data-color=pink]{--option-color:#ec4899;--option-color-dark:#db2777}.chapter-option[data-color=cyan]{--option-color:#06b6d4;--option-color-dark:#0891b2}@media(max-width:768px){.chapter-navigation{padding:1rem}.chapter-option{padding:1rem}.chapter-option-content{margin-left:2.5rem}.chapter-option-footer{flex-direction:column;align-items:flex-start;gap:.75rem}.chapter-option-link{align-self:stretch;justify-content:center}}</style></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap"><div class="col-sm-6 pt-2 doc-next"><a href=/chapitres/avances/chapitre-63-frontend-integration/><div class="card h-100 my-1"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0"><i class="material-icons align-middle">navigate_before</i> Chapitre 63 : Frontend et Intégration - Connecter votre Interface Utilisateur</p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>© 2025 Grégory Planchat. Tous droits réservés.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci à nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-3"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class="text-decoration-none d-inline-block"><img src=/logo-kiboko-fr.svg alt=Kiboko width=120 height=60 style=display:block;max-width:120px;height:auto></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class="text-decoration-none d-inline-block"><img src=/logo-gyroscops.svg alt=Gyroscops width=120 height=60 style=display:block;max-width:120px;height:auto></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.js defer></script><script type=text/javascript src=http://localhost:1313/docs/js/bundle.js defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>