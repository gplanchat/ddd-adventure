<!doctype html><html lang=fr-fr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><title>Stockage Temporal - Approche Classique | DDD Adventure</title><meta name=robots content="noindex"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Impl√©mentation d'un stockage avec Temporal Workflows pour l'orchestration de processus m√©tier"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=http://localhost:1313/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=http://localhost:1313/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=http://localhost:1313/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=http://localhost:1313/site.webmanifest><meta property="og:title" content="Stockage Temporal - Approche Classique"><meta property="og:description" content="Impl√©mentation d'un stockage avec Temporal Workflows pour l'orchestration de processus m√©tier"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/chapitres/stockage/temporal/chapitre-46-stockage-temporal-classique/"><meta property="og:image" content="http://localhost:1313/opengraph/card-base-2_hu_d256a2bfbb92cb65.png"><meta property="article:section" content="chapitres"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/opengraph/card-base-2_hu_d256a2bfbb92cb65.png"><meta name=twitter:title content="Stockage Temporal - Approche Classique"><meta name=twitter:description content="Impl√©mentation d'un stockage avec Temporal Workflows pour l'orchestration de processus m√©tier"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=http://localhost:1313/docs/js/flexsearch.bundle.js></script><link rel=stylesheet href=/docs/scss/style.css crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Fondamentaux</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-02-impact-mapping/>Chapitre 2 : L'Impact Mapping - Aligner le Produit sur les Objectifs Business</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-03-atelier-event-storming/>Chapitre 3 : L'Atelier Event Storming - Guide Pratique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-04-example-mapping/>Chapitre 4 : L'Example Mapping - D√©tailer les R√®gles M√©tier</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-05-complexite-accidentelle-essentielle/>Chapitre 5 : Complexit√© Accidentelle vs Essentielle - Le Choix Architectural</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-06-granularite-choix-architecturaux/>Chapitre 6 : Granularit√© des Choix Architecturaux</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-07-modeles-riches-vs-anemiques/>Chapitre 7 : Mod√®les Riches vs Mod√®les An√©miques</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-08-architecture-evenementielle/>Chapitre 8 : Architecture √âv√©nementielle</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-09-repositories-persistance/>Chapitre 9 : Repositories et Persistance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-10-choix-type-stockage/>Chapitre 15 : Choix du Type de Stockage</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Optionnels</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-13-architecture-cqrs/>Chapitre 15 : Architecture CQRS avec API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-12-architecture-cqs/>Chapitre 15 : Architecture CQS - Command Query Separation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-11-event-sourcing/>Chapitre 15 : Event Sourcing - La Source de V√©rit√©</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-14-cqrs-event-sourcing-combines/>Chapitre 15 : CQRS + Event Sourcing Combin√©s</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-15-projections-event-sourcing/>Chapitre 15 : Projections Event Sourcing</a></li></ul></div></li><li class="sidebar-dropdown no-icon current active"><button class=btn>
Chapitres de Stockage</button><div class="sidebar-submenu d-block"><ul><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage SQL</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-16-stockage-sql-classique/>Chapitre 16 : Stockage SQL - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-17-stockage-sql-cqs/>Chapitre 17 : Stockage SQL - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-18-stockage-sql-cqrs/>Chapitre 18 : Stockage SQL - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-19-stockage-sql-event-sourcing/>Chapitre 19 : Stockage SQL - Event Sourcing Seul</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-20-stockage-sql-event-sourcing-cqs/>Chapitre 58 : Stockage SQL - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-21-stockage-sql-event-sourcing-cqrs/>Chapitre 59 : Stockage SQL - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage API</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-26-stockage-api-event-sourcing-cqs/>Chapitre 26 : Stockage API - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-27-stockage-api-event-sourcing-cqrs/>Chapitre 27 : Stockage API - Event Sourcing + CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-22-stockage-api-classique/>Chapitre 60 : Stockage API - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-23-stockage-api-cqs/>Chapitre 61 : Stockage API - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-24-stockage-api-cqrs/>Chapitre 62 : Stockage API - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-25-stockage-api-event-sourcing/>Chapitre 63 : Stockage API - Event Sourcing Seul</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage MongoDB</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-28-stockage-mongodb-classique/>Chapitre 28 : Stockage MongoDB - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-29-stockage-mongodb-cqs/>Chapitre 29 : Stockage MongoDB - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-30-stockage-mongodb-cqrs/>Chapitre 30 : Stockage MongoDB - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-31-stockage-mongodb-event-sourcing/>Chapitre 31 : Stockage MongoDB - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-32-stockage-mongodb-event-sourcing-cqs/>Stockage MongoDB - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-33-stockage-mongodb-event-sourcing-cqrs/>Stockage MongoDB - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage ElasticSearch</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-34-stockage-elasticsearch-classique/>Stockage ElasticSearch - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-35-stockage-elasticsearch-cqs/>Stockage ElasticSearch - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-36-stockage-elasticsearch-cqrs/>Stockage ElasticSearch - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-37-stockage-elasticsearch-event-sourcing/>Stockage ElasticSearch - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-38-stockage-elasticsearch-event-sourcing-cqs/>Stockage ElasticSearch - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-39-stockage-elasticsearch-event-sourcing-cqrs/>Stockage ElasticSearch - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage In-Memory</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-40-stockage-in-memory-classique/>Stockage In-Memory - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-41-stockage-in-memory-cqs/>Stockage In-Memory - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-42-stockage-in-memory-cqrs/>Stockage In-Memory - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-43-stockage-in-memory-event-sourcing/>Stockage In-Memory - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-44-stockage-in-memory-event-sourcing-cqs/>Stockage In-Memory - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-45-stockage-in-memory-event-sourcing-cqrs/>Stockage In-Memory - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon current active"><button class=btn>
Stockage Composite pilot√© par Temporal</button><div class="sidebar-submenu d-block"><ul><li class="current no-icon"><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-46-stockage-temporal-classique/>Stockage Temporal - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-47-stockage-temporal-cqs/>Stockage Temporal - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-48-stockage-temporal-cqrs/>Stockage Temporal - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-49-stockage-temporal-event-sourcing/>Stockage Temporal - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-50-stockage-temporal-event-sourcing-cqs/>Stockage Temporal - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-51-stockage-temporal-event-sourcing-cqrs/>Stockage Temporal - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Multi-sources</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-52-stockage-multi-sources-classique/>Stockage Multi-sources - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-53-stockage-multi-sources-cqs/>Stockage Multi-sources - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-54-stockage-multi-sources-cqrs/>Stockage Multi-sources - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-55-stockage-multi-sources-event-sourcing/>Stockage Multi-sources avec Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-56-stockage-multi-sources-strategies-avancees/>Strat√©gies Avanc√©es de R√©plication Multi-sources</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-57-stockage-multi-sources-resolution-conflits/>R√©solution de Conflits Multi-sources</a></li></ul></div></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Techniques</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-58-gestion-donnees-validation/>Chapitre 58 : Gestion des Donn√©es et Validation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-59-pagination-performance/>Chapitre 59 : Pagination et Performance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-60-gestion-erreurs-observabilite/>Chapitre 60 : Gestion d'Erreurs et Observabilit√©</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-61-tests-qualite/>Chapitre 61 : Tests et Qualit√©</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Avanc√©s</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-62-securite-autorisation/>Chapitre 62 : S√©curit√© et Autorisation - Prot√©ger votre API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-63-frontend-integration/>Chapitre 63 : Frontend et Int√©gration - Connecter votre Interface Utilisateur</a></li></ul></div></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/stockage/><span itemprop=name>Chapitres de Stockage</span>
</a><meta itemprop=position content='2'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/stockage/temporal/><span itemprop=name>Stockage Composite pilot√© par Temporal</span>
</a><meta itemprop=position content='3'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Stockage Temporal - Approche Classique</span>
<meta itemprop=position content='4'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-contexte-et-objectifs-pourquoi-temporal-pour-le-stockage-temporal-workflows-offre-une-approche-unique-pour-le-stockage-en-g√©rant-l√©tat-des-processus-m√©tier-complexes-de-mani√®re-durable-et-r√©siliente-cette-approche-est-particuli√®rement-adapt√©e-aux-workflows-qui-n√©cessitent-de-la-persistance-de-la-reprise-sur-panne-et-de-lorchestration-avantages-du-stockage-temporal--durabilit√©--√©tat-des-workflows-persist√©-automatiquement--r√©silience--reprise-automatique-apr√®s-panne--orchestration--gestion-complexe-des-processus-m√©tier--observabilit√©--visibilit√©-compl√®te-sur-lex√©cution--scalabilit√©--ex√©cution-distribu√©e-des-workflows-contexte-gyroscopsdans-notre-√©cosyst√®me-user--organization--workflow--cloud-resources--billing-temporal-est-particuli√®rement-pertinent-pour---workflows-de-provisioning--orchestration-des-ressources-cloud--processus-de-facturation--gestion-des-cycles-de-facturation--int√©grations-complexes--orchestration-des-int√©grations-api--processus-m√©tier-longs--workflows-qui-s√©talent-sur-plusieurs-jours--architecture-temporal-classique-structure-des-workflows-workflow-de-basephpphpnamespace-appworkflowpaymentuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowworkflowinterfaceinterface-paymentworkflowinterface----workflowmethod----public-function-processpaymentpaymentrequest-request-paymentresultactivityinterfaceinterface-paymentactivityinterface----activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult--------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult--------activitymethod----public-function-sendnotificationpaymentresult-result-voidclass-paymentworkflow-implements-paymentworkflowinterface----private-paymentactivityinterface-paymentactivity----public-function-__construct------------this-paymentactivity--workflownewactivitystubpaymentactivityinterfaceclass--------public-function-processpaymentpaymentrequest-request-paymentresult-------------validation-du-paiement--------validation--yield-this-paymentactivity-validatepaymentrequest----------------if-validation-isvalid-------------return-new-paymentresultfalse-validation-geterror-------------------------traitement-du-paiement--------charge--yield-this-paymentactivity-chargepaymentrequest----------------if-charge-issuccess-------------return-new-paymentresultfalse-charge-geterror-------------------------notification--------yield-this-paymentactivity-sendnotification------------new-paymentresulttrue-payment-processed-successfully------------------------return-new-paymentresulttrue-payment-processed-successfully-----activit√©s-de-persistancephpphpnamespace-appworkflowpaymentuse-temporalactivityactivityinterfaceuse-temporalactivityactivitymethoduse-appdomainpaymentpaymentrepositoryinterfaceuse-appdomainpaymentpaymentuse-psrlogloggerinterfaceclass-paymentactivity-implements-paymentactivityinterface----private-paymentrepositoryinterface-paymentrepository----private-loggerinterface-logger----public-function-__construct--------paymentrepositoryinterface-paymentrepository--------loggerinterface-logger-------------this-paymentrepository--paymentrepository--------this-logger--logger--------activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult------------try-------------this-logger-infovalidating-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------validation-m√©tier------------if-request-getamount--0-----------------return-new-validationresultfalse-invalid-amount------------------------------------if-emptyrequest-getcurrency-----------------return-new-validationresultfalse-currency-required-------------------------------------v√©rification-de-lorganisation------------if-this-paymentrepository-organizationexistsrequest-getorganizationid-----------------return-new-validationresultfalse-organization-not-found------------------------------------return-new-validationresulttrue---------------------catch-exception-e-------------this-logger-errorpayment-validation-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-validationresultfalse-e-getmessage----------------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult------------try-------------this-logger-infocharging-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------cr√©er-le-paiement------------payment--new-payment----------------request-getpaymentid----------------request-getorganizationid----------------request-getuserid----------------request-getamount----------------request-getcurrency----------------processing----------------request-getdescription----------------new-datetime-------------------------------------sauvegarder-le-paiement------------this-paymentrepository-savepayment-------------------------simuler-le-traitement-du-paiement-------------dans-un-vrai-syst√®me-ceci-appellerait-un-service-de-paiement------------this-simulatepaymentprocessingrequest-------------------------mettre-√†-jour-le-statut------------payment-markascompleted------------this-paymentrepository-savepayment------------------------return-new-chargeresulttrue-payment-charged-successfully---------------------catch-exception-e-------------this-logger-errorpayment-charging-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-chargeresultfalse-e-getmessage----------------activitymethod----public-function-sendnotificationpaymentresult-result-void------------try-------------this-logger-infosending-payment-notification-----------------success--result-issuccess----------------message--result-getmessage-------------------------------------envoyer-une-notification-email-webhook-etc------------this-sendemailnotificationresult------------this-sendwebhooknotificationresult---------------------catch-exception-e-------------this-logger-errornotification-sending-failed-----------------error--e-getmessage----------------------------private-function-simulatepaymentprocessingpaymentrequest-request-void-------------simuler-un-d√©lai-de-traitement--------sleep2-----------------simuler-une-√©chec-al√©atoire-5-de-chance--------if-rand1-100--5-------------throw-new-exceptionpayment-processing-failed----------------private-function-sendemailnotificationpaymentresult-result-void-------------impl√©mentation-de-lenvoi-demail--------private-function-sendwebhooknotificationpaymentresult-result-void-------------impl√©mentation-de-lenvoi-de-webhook-----flux-de-donn√©esmermaidgraph-td----aclient-request----btemporal-client----b----cworkflow-execution----c----dactivity-1-validation----d----eactivity-2-charging----e----factivity-3-notification----f----gworkflow-complete--------hpersistence-layer----ipayment-repository----i----jdatabase--------c----h----d----h----e----h----f----h--------ktemporal-server----lworkflow-state----l----mactivity-state----m----nevent-history--impl√©mentation-pratique-1-configuration-temporal-configuration-du-clientphpphpnamespace-appinfrastructuretemporaluse-temporalclientworkflowclientuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-temporaldataconverterdataconverteruse-temporaldataconverterjsondataconverterclass-temporalclientfactory----private-string-host----private-int-port----private-string-namespace----public-function-__constructstring-host--localhost-int-port--7233-string-namespace--default------------this-host--host--------this-port--port--------this-namespace--namespace--------public-function-createclient-workflowclientinterface------------dataconverter--new-dataconverter------------new-jsondataconverter----------------return-workflowclientcreate------------this-host----this-port----------------------------namespace--this-namespace----------------dataconverter--dataconverter----------------------------public-function-createworkflowoptions-workflowoptions------------return-workflowoptionsnew-------------withworkflowidpayment-workflow---uniqid-------------withworkflowexecutiontimeout300--5-minutes-------------withworkflowruntimeout300-------------withworkflowtasktimeout60-----service-de-workflowphpphpnamespace-appapplicationservicetemporaluse-appworkflowpaymentpaymentworkflowinterfaceuse-appworkflowpaymentpaymentrequestuse-appworkflowpaymentpaymentresultuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-psrlogloggerinterfaceclass-paymentworkflowservice----private-workflowclientinterface-workflowclient----private-loggerinterface-logger----public-function-__construct--------workflowclientinterface-workflowclient--------loggerinterface-logger-------------this-workflowclient--workflowclient--------this-logger--logger--------public-function-processpaymentpaymentrequest-request-paymentresult------------try-------------this-logger-infostarting-payment-workflow-----------------paymentid--request-getpaymentid----------------amount--request-getamount------------------------workflowoptions--workflowoptionsnew-----------------withworkflowidpayment---request-getpaymentid-----------------withworkflowexecutiontimeout300-----------------withworkflowruntimeout300-----------------withworkflowtasktimeout60------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowoptions------------------------result--workflow-processpaymentrequest------------this-logger-infopayment-workflow-completed-----------------paymentid--request-getpaymentid----------------success--result-issuccess------------------------return-result---------catch-exception-e-------------this-logger-errorpayment-workflow-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------throw-e----------------public-function-getworkflowstatusstring-workflowid-array------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------status--workflow-getstatus------------return-----------------workflowid--workflowid----------------status--status----------------isrunning--status--running----------------iscompleted--status--completed----------------isfailed--status--failed---------------------catch-exception-e-------------this-logger-errorfailed-to-get-workflow-status-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e----------------public-function-cancelworkflowstring-workflowid-void------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------workflow-cancel------------this-logger-infoworkflow-cancelled-----------------workflowid--workflowid---------------------catch-exception-e-------------this-logger-errorfailed-to-cancel-workflow-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e-------------2-repository-temporal-repository-avec-persistance-temporalphpphpnamespace-appinfrastructuretemporalrepositoryuse-appdomainpaymentpaymentuse-appdomainpaymentpaymentrepositoryinterfaceuse-appinfrastructuretemporaltemporalclientfactoryuse-psrlogloggerinterfaceclass-temporalpaymentrepository-implements-paymentrepositoryinterface----private-temporalclientfactory-temporalfactory----private-loggerinterface-logger----private-array-cache------public-function-__construct--------temporalclientfactory-temporalfactory--------loggerinterface-logger-------------this-temporalfactory--temporalfactory--------this-logger--logger--------public-function-savepayment-payment-void------------try-------------workflowid--payment---payment-getid-------------------------cr√©er-un-workflow-de-persistance------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions-------------------------ex√©cuter-le-workflow-de-persistance------------workflow-persistpaymentpayment-------------------------mettre-en-cache------------this-cachepayment-getid--payment------------------------this-logger-infopayment-persisted-via-temporal-----------------paymentid--payment-getid----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-persist-payment-via-temporal-----------------paymentid--payment-getid----------------error--e-getmessage------------------------------------throw-e----------------public-function-findbyidstring-id-payment-------------v√©rifier-le-cache-dabord--------if-issetthis-cacheid-------------return-this-cacheid------------------------try-------------workflowid--payment---id-------------------------r√©cup√©rer-depuis-temporal------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowid------------------------payment--workflow-getpaymentid------------------------if-payment-----------------this-cacheid--payment------------------------------------return-payment---------------------catch-exception-e-------------this-logger-errorfailed-to-retrieve-payment-from-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------return-null----------------public-function-findbyorganizationstring-organizationid-array------------try-------------workflowid--payment-search---organizationid-----uniqid-------------------------cr√©er-un-workflow-de-recherche------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------payments--workflow-searchbyorganizationorganizationid-------------------------mettre-en-cache------------foreach-payments-as-payment-----------------this-cachepayment-getid--payment------------------------------------return-payments---------------------catch-exception-e-------------this-logger-errorfailed-to-search-payments-via-temporal-----------------organizationid--organizationid----------------error--e-getmessage------------------------------------return-----------------public-function-deletestring-id-void------------try-------------workflowid--payment-delete---id-------------------------cr√©er-un-workflow-de-suppression------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions------------------------workflow-deletepaymentid-------------------------supprimer-du-cache------------unsetthis-cacheid------------------------this-logger-infopayment-deleted-via-temporal-----------------paymentid--id----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-delete-payment-via-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------throw-e----------------public-function-count-int------------try-------------workflowid--payment-count---uniqid-------------------------cr√©er-un-workflow-de-comptage------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------return-workflow-getpaymentcount---------------------catch-exception-e-------------this-logger-errorfailed-to-count-payments-via-temporal-----------------error--e-getmessage------------------------------------return-0-------------3-workflows-de-persistance-workflow-de-persistance-des-paiementsphpphpnamespace-appworkflowpersistenceuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowuse-appdomainpaymentpaymentworkflowinterfaceinterface-paymentpersistenceworkflowinterface----workflowmethod----public-function-persistpaymentpayment-payment-void--------workflowmethod----public-function-getpaymentstring-paymentid-payment--------workflowmethod----public-function-deletepaymentstring-paymentid-voidactivityinterfaceinterface-paymentpersistenceactivityinterface----activitymethod----public-function-savetodatabasepayment-payment-void--------activitymethod----public-function-loadfromdatabasestring-paymentid-payment--------activitymethod----public-function-deletefromdatabasestring-paymentid-voidclass-paymentpersistenceworkflow-implements-paymentpersistenceworkflowinterface----private-paymentpersistenceactivityinterface-persistenceactivity----public-function-__construct------------this-persistenceactivity--workflownewactivitystubpaymentpersistenceactivityinterfaceclass--------public-function-persistpaymentpayment-payment-void------------yield-this-persistenceactivity-savetodatabasepayment--------public-function-getpaymentstring-paymentid-payment------------return-yield-this-persistenceactivity-loadfromdatabasepaymentid--------public-function-deletepaymentstring-paymentid-void------------yield-this-persistenceactivity-deletefromdatabasepaymentid------tests-et-validation-tests-dphpphpnamespace-apptestsintegrationtemporaluse-appworkflowpaymentpaymentrequestuse-appapplicationservicetemporalpaymentworkflowserviceuse-appinfrastructuretemporaltemporalclientfactoryclass-temporalpaymentworkflowtest-extends-testcase----private-paymentworkflowservice-workflowservice----private-temporalclientfactory-temporalfactory----protected-function-setup-void------------this-temporalfactory--new-temporalclientfactorylocalhost-7233-test--------this-workflowservice--new-paymentworkflowservice------------this-temporalfactory-createclient------------this-createmockloggerinterfaceclass----------------public-function-testpaymentworkflowexecution-void------------request--new-paymentrequest------------payment-123------------org-456------------user-789------------10000------------eur------------test-payment------------------------result--this-workflowservice-processpaymentrequest----------------this-asserttrueresult-issuccess--------this-assertequalspayment-processed-successfully-result-getmessage--------public-function-testworkflowstatus-void------------request--new-paymentrequest------------payment-456------------org-789------------user-123------------20000------------usd------------test-payment-2------------------------this-workflowservice-processpaymentrequest----------------status--this-workflowservice-getworkflowstatuspayment-payment-456----------------this-assertarrayhaskeyworkflowid-status--------this-assertarrayhaskeystatus-status--------this-assertarrayhaskeyiscompleted-status------performance-et-optimisation-strat√©gies-d-1-configuration-des-timeoutsphppublic-function-createoptimizedworkflowoptions-workflowoptions----return-workflowoptionsnew---------withworkflowidpayment-workflow---uniqid---------withworkflowexecutiontimeout600--10-minutes---------withworkflowruntimeout600---------withworkflowtasktimeout120---------withretryoptions------------initialinterval--1s------------maximuminterval--60s------------backoffcoefficient--20------------maximumattempts--3---------2-cache-des-workflowsphppublic-function-getworkflowwithcachestring-workflowid-paymentworkflowinterface----if-issetthis-workflowcacheworkflowid---------return-this-workflowcacheworkflowid------------workflow--this-workflowclient-newworkflowstub--------paymentworkflowinterfaceclass--------workflowid------------this-workflowcacheworkflowid--workflow--------return-workflow-3-monitoring-et-observabilit√©phppublic-function-getworkflowmetrics-array----return---------activeworkflows--this-getactiveworkflowcount--------completedworkflows--this-getcompletedworkflowcount--------failedworkflows--this-getfailedworkflowcount--------averageexecutiontime--this-getaverageexecutiontime------crit√®res-d-quand-utiliser-temporal-classique--avantages--durabilit√©--√©tat-des-workflows-persist√©-automatiquement--r√©silience--reprise-automatique-apr√®s-panne--orchestration--gestion-complexe-des-processus-m√©tier--observabilit√©--visibilit√©-compl√®te-sur-lex√©cution--scalabilit√©--ex√©cution-distribu√©e-des-workflows--inconv√©nients--complexit√©--courbe-dapprentissage-importante--infrastructure--n√©cessite-un-serveur-temporal--latence--overhead-pour-les-op√©rations-simples--expertise--√©quipe-exp√©riment√©e-requise--crit√®res-d--processus-m√©tier-complexes--workflows-qui-n√©cessitent-de-lorchestration--r√©silience-critique--besoin-de-reprise-automatique-apr√®s-panne--processus-longs--workflows-qui-s√©talent-sur-plusieurs-jours--int√©grations-multiples--orchestration-de-plusieurs-services--√©quipe-exp√©riment√©e--ma√Ætrise-de-temporal-et-des-workflows--infrastructure-disponible--serveur-temporal-op√©rationnel--votre-prochaine-√©tapehahahugoshortcode77s0hbhbtemporal-classique-offre-une-approche-puissante-pour-l>üéØ <strong>Contexte et Objectifs</strong>### **Pourquoi Temporal pour le Stockage ?**Temporal Workflows offre une approche unique pour le stockage en g√©rant l‚Äô√©tat des processus m√©tier complexes de mani√®re durable et r√©siliente. Cette approche est particuli√®rement adapt√©e aux workflows qui n√©cessitent de la persistance, de la reprise sur panne et de l‚Äôorchestration.#### <strong>Avantages du Stockage Temporal</strong>- <strong>Durabilit√©</strong> : √âtat des workflows persist√© automatiquement- <strong>R√©silience</strong> : Reprise automatique apr√®s panne- <strong>Orchestration</strong> : Gestion complexe des processus m√©tier- <strong>Observabilit√©</strong> : Visibilit√© compl√®te sur l‚Äôex√©cution- <strong>Scalabilit√©</strong> : Ex√©cution distribu√©e des workflows### <strong>Contexte Gyroscops</strong>Dans notre √©cosyst√®me <strong>User ‚Üí Organization ‚Üí Workflow ‚Üí Cloud Resources ‚Üí Billing</strong>, Temporal est particuli√®rement pertinent pour :- <strong>Workflows de provisioning</strong> : Orchestration des ressources cloud- <strong>Processus de facturation</strong> : Gestion des cycles de facturation- <strong>Int√©grations complexes</strong> : Orchestration des int√©grations API- <strong>Processus m√©tier longs</strong> : Workflows qui s‚Äô√©talent sur plusieurs jours## üèóÔ∏è <strong>Architecture Temporal Classique</strong>### <strong>Structure des Workflows</strong>#### <strong>Workflow de Base</strong><code>php&lt;?phpnamespace App\Workflow\Payment;use Temporal\Workflow\WorkflowInterface;use Temporal\Workflow\WorkflowMethod;use Temporal\Workflow\ActivityInterface;use Temporal\Workflow\ActivityMethod;use Temporal\Workflow\Workflow;#[WorkflowInterface]interface PaymentWorkflowInterface{ #[WorkflowMethod] public function processPayment(PaymentRequest $request): PaymentResult;}#[ActivityInterface]interface PaymentActivityInterface{ #[ActivityMethod] public function validatePayment(PaymentRequest $request): ValidationResult; #[ActivityMethod] public function chargePayment(PaymentRequest $request): ChargeResult; #[ActivityMethod] public function sendNotification(PaymentResult $result): void;}class PaymentWorkflow implements PaymentWorkflowInterface{ private PaymentActivityInterface $paymentActivity; public function __construct() { $this->paymentActivity = Workflow::newActivityStub(PaymentActivityInterface::class); } public function processPayment(PaymentRequest $request): PaymentResult { // Validation du paiement $validation = yield $this->paymentActivity->validatePayment($request); if (!$validation->isValid()) { return new PaymentResult(false, $validation->getError()); } // Traitement du paiement $charge = yield $this->paymentActivity->chargePayment($request); if (!$charge->isSuccess()) { return new PaymentResult(false, $charge->getError()); } // Notification yield $this->paymentActivity->sendNotification( new PaymentResult(true, 'Payment processed successfully') ); return new PaymentResult(true, 'Payment processed successfully'); }}</code>#### <strong>Activit√©s de Persistance</strong><code>php&lt;?phpnamespace App\Workflow\Payment;use Temporal\Activity\ActivityInterface;use Temporal\Activity\ActivityMethod;use App\Domain\Payment\PaymentRepositoryInterface;use App\Domain\Payment\Payment;use Psr\Log\LoggerInterface;class PaymentActivity implements PaymentActivityInterface{ private PaymentRepositoryInterface $paymentRepository; private LoggerInterface $logger; public function __construct( PaymentRepositoryInterface $paymentRepository, LoggerInterface $logger ) { $this->paymentRepository = $paymentRepository; $this->logger = $logger; } #[ActivityMethod] public function validatePayment(PaymentRequest $request): ValidationResult { try { $this->logger->info('Validating payment', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); // Validation m√©tier if ($request->getAmount() &lt;= 0) { return new ValidationResult(false, 'Invalid amount'); } if (empty($request->getCurrency())) { return new ValidationResult(false, 'Currency required'); } // V√©rification de l'organisation if (!$this->paymentRepository->organizationExists($request->getOrganizationId())) { return new ValidationResult(false, 'Organization not found'); } return new ValidationResult(true); } catch (\Exception $e) { $this->logger->error('Payment validation failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); return new ValidationResult(false, $e->getMessage()); } } #[ActivityMethod] public function chargePayment(PaymentRequest $request): ChargeResult { try { $this->logger->info('Charging payment', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); // Cr√©er le paiement $payment = new Payment( $request->getPaymentId(), $request->getOrganizationId(), $request->getUserId(), $request->getAmount(), $request->getCurrency(), 'processing', $request->getDescription(), new \DateTime() ); // Sauvegarder le paiement $this->paymentRepository->save($payment); // Simuler le traitement du paiement // Dans un vrai syst√®me, ceci appellerait un service de paiement $this->simulatePaymentProcessing($request); // Mettre √† jour le statut $payment->markAsCompleted(); $this->paymentRepository->save($payment); return new ChargeResult(true, 'Payment charged successfully'); } catch (\Exception $e) { $this->logger->error('Payment charging failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); return new ChargeResult(false, $e->getMessage()); } } #[ActivityMethod] public function sendNotification(PaymentResult $result): void { try { $this->logger->info('Sending payment notification', [ 'success' => $result->isSuccess(), 'message' => $result->getMessage() ]); // Envoyer une notification (email, webhook, etc.) $this->sendEmailNotification($result); $this->sendWebhookNotification($result); } catch (\Exception $e) { $this->logger->error('Notification sending failed', [ 'error' => $e->getMessage() ]); } } private function simulatePaymentProcessing(PaymentRequest $request): void { // Simuler un d√©lai de traitement sleep(2); // Simuler une √©chec al√©atoire (5% de chance) if (rand(1, 100) &lt;= 5) { throw new \Exception('Payment processing failed'); } } private function sendEmailNotification(PaymentResult $result): void { // Impl√©mentation de l'envoi d'email } private function sendWebhookNotification(PaymentResult $result): void { // Impl√©mentation de l'envoi de webhook }}</code>### <strong>Flux de Donn√©es</strong><code>mermaidgraph TD A[Client Request] --> B[Temporal Client] B --> C[Workflow Execution] C --> D[Activity 1: Validation] D --> E[Activity 2: Charging] E --> F[Activity 3: Notification] F --> G[Workflow Complete] H[Persistence Layer] --> I[Payment Repository] I --> J[Database] C --> H D --> H E --> H F --> H K[Temporal Server] --> L[Workflow State] L --> M[Activity State] M --> N[Event History]</code>## üíª <strong>Impl√©mentation Pratique</strong>### <strong>1. Configuration Temporal</strong>#### <strong>Configuration du Client</strong><code>php&lt;?phpnamespace App\Infrastructure\Temporal;use Temporal\Client\WorkflowClient;use Temporal\Client\WorkflowClientInterface;use Temporal\Client\WorkflowOptions;use Temporal\DataConverter\DataConverter;use Temporal\DataConverter\JsonDataConverter;class TemporalClientFactory{ private string $host; private int $port; private string $namespace; public function __construct(string $host = 'localhost', int $port = 7233, string $namespace = 'default') { $this->host = $host; $this->port = $port; $this->namespace = $namespace; } public function createClient(): WorkflowClientInterface { $dataConverter = new DataConverter( new JsonDataConverter() ); return WorkflowClient::create( $this->host . ':' . $this->port, [ 'namespace' => $this->namespace, 'dataConverter' => $dataConverter, ] ); } public function createWorkflowOptions(): WorkflowOptions { return WorkflowOptions::new() ->withWorkflowId('payment-workflow-' . uniqid()) ->withWorkflowExecutionTimeout(300) // 5 minutes ->withWorkflowRunTimeout(300) ->withWorkflowTaskTimeout(60); }}</code>#### <strong>Service de Workflow</strong><code>php&lt;?phpnamespace App\Application\Service\Temporal;use App\Workflow\Payment\PaymentWorkflowInterface;use App\Workflow\Payment\PaymentRequest;use App\Workflow\Payment\PaymentResult;use Temporal\Client\WorkflowClientInterface;use Temporal\Client\WorkflowOptions;use Psr\Log\LoggerInterface;class PaymentWorkflowService{ private WorkflowClientInterface $workflowClient; private LoggerInterface $logger; public function __construct( WorkflowClientInterface $workflowClient, LoggerInterface $logger ) { $this->workflowClient = $workflowClient; $this->logger = $logger; } public function processPayment(PaymentRequest $request): PaymentResult { try { $this->logger->info('Starting payment workflow', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); $workflowOptions = WorkflowOptions::new() ->withWorkflowId('payment-' . $request->getPaymentId()) ->withWorkflowExecutionTimeout(300) ->withWorkflowRunTimeout(300) ->withWorkflowTaskTimeout(60); $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowOptions ); $result = $workflow->processPayment($request); $this->logger->info('Payment workflow completed', [ 'paymentId' => $request->getPaymentId(), 'success' => $result->isSuccess() ]); return $result; } catch (\Exception $e) { $this->logger->error('Payment workflow failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); throw $e; } } public function getWorkflowStatus(string $workflowId): array { try { $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $status = $workflow->getStatus(); return [ 'workflowId' => $workflowId, 'status' => $status, 'isRunning' => $status === 'RUNNING', 'isCompleted' => $status === 'COMPLETED', 'isFailed' => $status === 'FAILED' ]; } catch (\Exception $e) { $this->logger->error('Failed to get workflow status', [ 'workflowId' => $workflowId, 'error' => $e->getMessage() ]); throw $e; } } public function cancelWorkflow(string $workflowId): void { try { $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $workflow->cancel(); $this->logger->info('Workflow cancelled', [ 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to cancel workflow', [ 'workflowId' => $workflowId, 'error' => $e->getMessage() ]); throw $e; } }}</code>### <strong>2. Repository Temporal</strong>#### <strong>Repository avec Persistance Temporal</strong><code>php&lt;?phpnamespace App\Infrastructure\Temporal\Repository;use App\Domain\Payment\Payment;use App\Domain\Payment\PaymentRepositoryInterface;use App\Infrastructure\Temporal\TemporalClientFactory;use Psr\Log\LoggerInterface;class TemporalPaymentRepository implements PaymentRepositoryInterface{ private TemporalClientFactory $temporalFactory; private LoggerInterface $logger; private array $cache = []; public function __construct( TemporalClientFactory $temporalFactory, LoggerInterface $logger ) { $this->temporalFactory = $temporalFactory; $this->logger = $logger; } public function save(Payment $payment): void { try { $workflowId = 'payment-' . $payment->getId(); // Cr√©er un workflow de persistance $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowOptions); // Ex√©cuter le workflow de persistance $workflow->persistPayment($payment); // Mettre en cache $this->cache[$payment->getId()] = $payment; $this->logger->info('Payment persisted via Temporal', [ 'paymentId' => $payment->getId(), 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to persist payment via Temporal', [ 'paymentId' => $payment->getId(), 'error' => $e->getMessage() ]); throw $e; } } public function findById(string $id): ?Payment { // V√©rifier le cache d'abord if (isset($this->cache[$id])) { return $this->cache[$id]; } try { $workflowId = 'payment-' . $id; // R√©cup√©rer depuis Temporal $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowId); $payment = $workflow->getPayment($id); if ($payment) { $this->cache[$id] = $payment; } return $payment; } catch (\Exception $e) { $this->logger->error('Failed to retrieve payment from Temporal', [ 'paymentId' => $id, 'error' => $e->getMessage() ]); return null; } } public function findByOrganization(string $organizationId): array { try { $workflowId = 'payment-search-' . $organizationId . '-' . uniqid(); // Cr√©er un workflow de recherche $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentSearchWorkflowInterface::class, $workflowOptions); $payments = $workflow->searchByOrganization($organizationId); // Mettre en cache foreach ($payments as $payment) { $this->cache[$payment->getId()] = $payment; } return $payments; } catch (\Exception $e) { $this->logger->error('Failed to search payments via Temporal', [ 'organizationId' => $organizationId, 'error' => $e->getMessage() ]); return []; } } public function delete(string $id): void { try { $workflowId = 'payment-delete-' . $id; // Cr√©er un workflow de suppression $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowOptions); $workflow->deletePayment($id); // Supprimer du cache unset($this->cache[$id]); $this->logger->info('Payment deleted via Temporal', [ 'paymentId' => $id, 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to delete payment via Temporal', [ 'paymentId' => $id, 'error' => $e->getMessage() ]); throw $e; } } public function count(): int { try { $workflowId = 'payment-count-' . uniqid(); // Cr√©er un workflow de comptage $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentSearchWorkflowInterface::class, $workflowOptions); return $workflow->getPaymentCount(); } catch (\Exception $e) { $this->logger->error('Failed to count payments via Temporal', [ 'error' => $e->getMessage() ]); return 0; } }}</code>### <strong>3. Workflows de Persistance</strong>#### <strong>Workflow de Persistance des Paiements</strong><code>php&lt;?phpnamespace App\Workflow\Persistence;use Temporal\Workflow\WorkflowInterface;use Temporal\Workflow\WorkflowMethod;use Temporal\Workflow\ActivityInterface;use Temporal\Workflow\ActivityMethod;use Temporal\Workflow\Workflow;use App\Domain\Payment\Payment;#[WorkflowInterface]interface PaymentPersistenceWorkflowInterface{ #[WorkflowMethod] public function persistPayment(Payment $payment): void; #[WorkflowMethod] public function getPayment(string $paymentId): ?Payment; #[WorkflowMethod] public function deletePayment(string $paymentId): void;}#[ActivityInterface]interface PaymentPersistenceActivityInterface{ #[ActivityMethod] public function saveToDatabase(Payment $payment): void; #[ActivityMethod] public function loadFromDatabase(string $paymentId): ?Payment; #[ActivityMethod] public function deleteFromDatabase(string $paymentId): void;}class PaymentPersistenceWorkflow implements PaymentPersistenceWorkflowInterface{ private PaymentPersistenceActivityInterface $persistenceActivity; public function __construct() { $this->persistenceActivity = Workflow::newActivityStub(PaymentPersistenceActivityInterface::class); } public function persistPayment(Payment $payment): void { yield $this->persistenceActivity->saveToDatabase($payment); } public function getPayment(string $paymentId): ?Payment { return yield $this->persistenceActivity->loadFromDatabase($paymentId); } public function deletePayment(string $paymentId): void { yield $this->persistenceActivity->deleteFromDatabase($paymentId); }}</code>## üß™ <strong>Tests et Validation</strong>### <strong>Tests d‚ÄôInt√©gration Temporal</strong><code>php&lt;?phpnamespace App\Tests\Integration\Temporal;use App\Workflow\Payment\PaymentRequest;use App\Application\Service\Temporal\PaymentWorkflowService;use App\Infrastructure\Temporal\TemporalClientFactory;class TemporalPaymentWorkflowTest extends TestCase{ private PaymentWorkflowService $workflowService; private TemporalClientFactory $temporalFactory; protected function setUp(): void { $this->temporalFactory = new TemporalClientFactory('localhost', 7233, 'test'); $this->workflowService = new PaymentWorkflowService( $this->temporalFactory->createClient(), $this->createMock(LoggerInterface::class) ); } public function testPaymentWorkflowExecution(): void { $request = new PaymentRequest( 'payment-123', 'org-456', 'user-789', 100.00, 'EUR', 'Test payment' ); $result = $this->workflowService->processPayment($request); $this->assertTrue($result->isSuccess()); $this->assertEquals('Payment processed successfully', $result->getMessage()); } public function testWorkflowStatus(): void { $request = new PaymentRequest( 'payment-456', 'org-789', 'user-123', 200.00, 'USD', 'Test payment 2' ); $this->workflowService->processPayment($request); $status = $this->workflowService->getWorkflowStatus('payment-payment-456'); $this->assertArrayHasKey('workflowId', $status); $this->assertArrayHasKey('status', $status); $this->assertArrayHasKey('isCompleted', $status); }}</code>## üìä <strong>Performance et Optimisation</strong>### <strong>Strat√©gies d‚ÄôOptimisation Temporal</strong>#### <strong>1. Configuration des Timeouts</strong><code>phppublic function createOptimizedWorkflowOptions(): WorkflowOptions{ return WorkflowOptions::new() ->withWorkflowId('payment-workflow-' . uniqid()) ->withWorkflowExecutionTimeout(600) // 10 minutes ->withWorkflowRunTimeout(600) ->withWorkflowTaskTimeout(120) ->withRetryOptions([ 'initialInterval' => '1s', 'maximumInterval' => '60s', 'backoffCoefficient' => 2.0, 'maximumAttempts' => 3 ]);}</code>#### <strong>2. Cache des Workflows</strong><code>phppublic function getWorkflowWithCache(string $workflowId): PaymentWorkflowInterface{ if (isset($this->workflowCache[$workflowId])) { return $this->workflowCache[$workflowId]; } $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $this->workflowCache[$workflowId] = $workflow; return $workflow;}</code>#### <strong>3. Monitoring et Observabilit√©</strong><code>phppublic function getWorkflowMetrics(): array{ return [ 'activeWorkflows' => $this->getActiveWorkflowCount(), 'completedWorkflows' => $this->getCompletedWorkflowCount(), 'failedWorkflows' => $this->getFailedWorkflowCount(), 'averageExecutionTime' => $this->getAverageExecutionTime() ];}</code>## üéØ <strong>Crit√®res d‚ÄôAdoption</strong>### <strong>Quand Utiliser Temporal Classique</strong>#### <strong>‚úÖ Avantages</strong>- <strong>Durabilit√©</strong> : √âtat des workflows persist√© automatiquement- <strong>R√©silience</strong> : Reprise automatique apr√®s panne- <strong>Orchestration</strong> : Gestion complexe des processus m√©tier- <strong>Observabilit√©</strong> : Visibilit√© compl√®te sur l‚Äôex√©cution- <strong>Scalabilit√©</strong> : Ex√©cution distribu√©e des workflows#### <strong>‚ùå Inconv√©nients</strong>- <strong>Complexit√©</strong> : Courbe d‚Äôapprentissage importante- <strong>Infrastructure</strong> : N√©cessite un serveur Temporal- <strong>Latence</strong> : Overhead pour les op√©rations simples- <strong>Expertise</strong> : √âquipe exp√©riment√©e requise#### <strong>üéØ Crit√®res d‚ÄôAdoption</strong>- <strong>Processus m√©tier complexes</strong> : Workflows qui n√©cessitent de l‚Äôorchestration- <strong>R√©silience critique</strong> : Besoin de reprise automatique apr√®s panne- <strong>Processus longs</strong> : Workflows qui s‚Äô√©talent sur plusieurs jours- <strong>Int√©grations multiples</strong> : Orchestration de plusieurs services- <strong>√âquipe exp√©riment√©e</strong> : Ma√Ætrise de Temporal et des workflows- <strong>Infrastructure disponible</strong> : Serveur Temporal op√©rationnel## üöÄ <strong>Votre Prochaine √âtape</strong>HAHAHUGOSHORTCODE77s0HBHB‚Äî<em>Temporal classique offre une approche puissante pour l‚Äôorchestration de processus m√©tier complexes, parfaitement adapt√©e aux besoins de workflows de Gyroscops.</em></a></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-contexte-et-objectifs-pourquoi-temporal-pour-le-stockage-temporal-workflows-offre-une-approche-unique-pour-le-stockage-en-g√©rant-l√©tat-des-processus-m√©tier-complexes-de-mani√®re-durable-et-r√©siliente-cette-approche-est-particuli√®rement-adapt√©e-aux-workflows-qui-n√©cessitent-de-la-persistance-de-la-reprise-sur-panne-et-de-lorchestration-avantages-du-stockage-temporal--durabilit√©--√©tat-des-workflows-persist√©-automatiquement--r√©silience--reprise-automatique-apr√®s-panne--orchestration--gestion-complexe-des-processus-m√©tier--observabilit√©--visibilit√©-compl√®te-sur-lex√©cution--scalabilit√©--ex√©cution-distribu√©e-des-workflows-contexte-gyroscopsdans-notre-√©cosyst√®me-user--organization--workflow--cloud-resources--billing-temporal-est-particuli√®rement-pertinent-pour---workflows-de-provisioning--orchestration-des-ressources-cloud--processus-de-facturation--gestion-des-cycles-de-facturation--int√©grations-complexes--orchestration-des-int√©grations-api--processus-m√©tier-longs--workflows-qui-s√©talent-sur-plusieurs-jours--architecture-temporal-classique-structure-des-workflows-workflow-de-basephpphpnamespace-appworkflowpaymentuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowworkflowinterfaceinterface-paymentworkflowinterface----workflowmethod----public-function-processpaymentpaymentrequest-request-paymentresultactivityinterfaceinterface-paymentactivityinterface----activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult--------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult--------activitymethod----public-function-sendnotificationpaymentresult-result-voidclass-paymentworkflow-implements-paymentworkflowinterface----private-paymentactivityinterface-paymentactivity----public-function-__construct------------this-paymentactivity--workflownewactivitystubpaymentactivityinterfaceclass--------public-function-processpaymentpaymentrequest-request-paymentresult-------------validation-du-paiement--------validation--yield-this-paymentactivity-validatepaymentrequest----------------if-validation-isvalid-------------return-new-paymentresultfalse-validation-geterror-------------------------traitement-du-paiement--------charge--yield-this-paymentactivity-chargepaymentrequest----------------if-charge-issuccess-------------return-new-paymentresultfalse-charge-geterror-------------------------notification--------yield-this-paymentactivity-sendnotification------------new-paymentresulttrue-payment-processed-successfully------------------------return-new-paymentresulttrue-payment-processed-successfully-----activit√©s-de-persistancephpphpnamespace-appworkflowpaymentuse-temporalactivityactivityinterfaceuse-temporalactivityactivitymethoduse-appdomainpaymentpaymentrepositoryinterfaceuse-appdomainpaymentpaymentuse-psrlogloggerinterfaceclass-paymentactivity-implements-paymentactivityinterface----private-paymentrepositoryinterface-paymentrepository----private-loggerinterface-logger----public-function-__construct--------paymentrepositoryinterface-paymentrepository--------loggerinterface-logger-------------this-paymentrepository--paymentrepository--------this-logger--logger--------activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult------------try-------------this-logger-infovalidating-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------validation-m√©tier------------if-request-getamount--0-----------------return-new-validationresultfalse-invalid-amount------------------------------------if-emptyrequest-getcurrency-----------------return-new-validationresultfalse-currency-required-------------------------------------v√©rification-de-lorganisation------------if-this-paymentrepository-organizationexistsrequest-getorganizationid-----------------return-new-validationresultfalse-organization-not-found------------------------------------return-new-validationresulttrue---------------------catch-exception-e-------------this-logger-errorpayment-validation-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-validationresultfalse-e-getmessage----------------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult------------try-------------this-logger-infocharging-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------cr√©er-le-paiement------------payment--new-payment----------------request-getpaymentid----------------request-getorganizationid----------------request-getuserid----------------request-getamount----------------request-getcurrency----------------processing----------------request-getdescription----------------new-datetime-------------------------------------sauvegarder-le-paiement------------this-paymentrepository-savepayment-------------------------simuler-le-traitement-du-paiement-------------dans-un-vrai-syst√®me-ceci-appellerait-un-service-de-paiement------------this-simulatepaymentprocessingrequest-------------------------mettre-√†-jour-le-statut------------payment-markascompleted------------this-paymentrepository-savepayment------------------------return-new-chargeresulttrue-payment-charged-successfully---------------------catch-exception-e-------------this-logger-errorpayment-charging-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-chargeresultfalse-e-getmessage----------------activitymethod----public-function-sendnotificationpaymentresult-result-void------------try-------------this-logger-infosending-payment-notification-----------------success--result-issuccess----------------message--result-getmessage-------------------------------------envoyer-une-notification-email-webhook-etc------------this-sendemailnotificationresult------------this-sendwebhooknotificationresult---------------------catch-exception-e-------------this-logger-errornotification-sending-failed-----------------error--e-getmessage----------------------------private-function-simulatepaymentprocessingpaymentrequest-request-void-------------simuler-un-d√©lai-de-traitement--------sleep2-----------------simuler-une-√©chec-al√©atoire-5-de-chance--------if-rand1-100--5-------------throw-new-exceptionpayment-processing-failed----------------private-function-sendemailnotificationpaymentresult-result-void-------------impl√©mentation-de-lenvoi-demail--------private-function-sendwebhooknotificationpaymentresult-result-void-------------impl√©mentation-de-lenvoi-de-webhook-----flux-de-donn√©esmermaidgraph-td----aclient-request----btemporal-client----b----cworkflow-execution----c----dactivity-1-validation----d----eactivity-2-charging----e----factivity-3-notification----f----gworkflow-complete--------hpersistence-layer----ipayment-repository----i----jdatabase--------c----h----d----h----e----h----f----h--------ktemporal-server----lworkflow-state----l----mactivity-state----m----nevent-history--impl√©mentation-pratique-1-configuration-temporal-configuration-du-clientphpphpnamespace-appinfrastructuretemporaluse-temporalclientworkflowclientuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-temporaldataconverterdataconverteruse-temporaldataconverterjsondataconverterclass-temporalclientfactory----private-string-host----private-int-port----private-string-namespace----public-function-__constructstring-host--localhost-int-port--7233-string-namespace--default------------this-host--host--------this-port--port--------this-namespace--namespace--------public-function-createclient-workflowclientinterface------------dataconverter--new-dataconverter------------new-jsondataconverter----------------return-workflowclientcreate------------this-host----this-port----------------------------namespace--this-namespace----------------dataconverter--dataconverter----------------------------public-function-createworkflowoptions-workflowoptions------------return-workflowoptionsnew-------------withworkflowidpayment-workflow---uniqid-------------withworkflowexecutiontimeout300--5-minutes-------------withworkflowruntimeout300-------------withworkflowtasktimeout60-----service-de-workflowphpphpnamespace-appapplicationservicetemporaluse-appworkflowpaymentpaymentworkflowinterfaceuse-appworkflowpaymentpaymentrequestuse-appworkflowpaymentpaymentresultuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-psrlogloggerinterfaceclass-paymentworkflowservice----private-workflowclientinterface-workflowclient----private-loggerinterface-logger----public-function-__construct--------workflowclientinterface-workflowclient--------loggerinterface-logger-------------this-workflowclient--workflowclient--------this-logger--logger--------public-function-processpaymentpaymentrequest-request-paymentresult------------try-------------this-logger-infostarting-payment-workflow-----------------paymentid--request-getpaymentid----------------amount--request-getamount------------------------workflowoptions--workflowoptionsnew-----------------withworkflowidpayment---request-getpaymentid-----------------withworkflowexecutiontimeout300-----------------withworkflowruntimeout300-----------------withworkflowtasktimeout60------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowoptions------------------------result--workflow-processpaymentrequest------------this-logger-infopayment-workflow-completed-----------------paymentid--request-getpaymentid----------------success--result-issuccess------------------------return-result---------catch-exception-e-------------this-logger-errorpayment-workflow-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------throw-e----------------public-function-getworkflowstatusstring-workflowid-array------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------status--workflow-getstatus------------return-----------------workflowid--workflowid----------------status--status----------------isrunning--status--running----------------iscompleted--status--completed----------------isfailed--status--failed---------------------catch-exception-e-------------this-logger-errorfailed-to-get-workflow-status-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e----------------public-function-cancelworkflowstring-workflowid-void------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------workflow-cancel------------this-logger-infoworkflow-cancelled-----------------workflowid--workflowid---------------------catch-exception-e-------------this-logger-errorfailed-to-cancel-workflow-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e-------------2-repository-temporal-repository-avec-persistance-temporalphpphpnamespace-appinfrastructuretemporalrepositoryuse-appdomainpaymentpaymentuse-appdomainpaymentpaymentrepositoryinterfaceuse-appinfrastructuretemporaltemporalclientfactoryuse-psrlogloggerinterfaceclass-temporalpaymentrepository-implements-paymentrepositoryinterface----private-temporalclientfactory-temporalfactory----private-loggerinterface-logger----private-array-cache------public-function-__construct--------temporalclientfactory-temporalfactory--------loggerinterface-logger-------------this-temporalfactory--temporalfactory--------this-logger--logger--------public-function-savepayment-payment-void------------try-------------workflowid--payment---payment-getid-------------------------cr√©er-un-workflow-de-persistance------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions-------------------------ex√©cuter-le-workflow-de-persistance------------workflow-persistpaymentpayment-------------------------mettre-en-cache------------this-cachepayment-getid--payment------------------------this-logger-infopayment-persisted-via-temporal-----------------paymentid--payment-getid----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-persist-payment-via-temporal-----------------paymentid--payment-getid----------------error--e-getmessage------------------------------------throw-e----------------public-function-findbyidstring-id-payment-------------v√©rifier-le-cache-dabord--------if-issetthis-cacheid-------------return-this-cacheid------------------------try-------------workflowid--payment---id-------------------------r√©cup√©rer-depuis-temporal------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowid------------------------payment--workflow-getpaymentid------------------------if-payment-----------------this-cacheid--payment------------------------------------return-payment---------------------catch-exception-e-------------this-logger-errorfailed-to-retrieve-payment-from-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------return-null----------------public-function-findbyorganizationstring-organizationid-array------------try-------------workflowid--payment-search---organizationid-----uniqid-------------------------cr√©er-un-workflow-de-recherche------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------payments--workflow-searchbyorganizationorganizationid-------------------------mettre-en-cache------------foreach-payments-as-payment-----------------this-cachepayment-getid--payment------------------------------------return-payments---------------------catch-exception-e-------------this-logger-errorfailed-to-search-payments-via-temporal-----------------organizationid--organizationid----------------error--e-getmessage------------------------------------return-----------------public-function-deletestring-id-void------------try-------------workflowid--payment-delete---id-------------------------cr√©er-un-workflow-de-suppression------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions------------------------workflow-deletepaymentid-------------------------supprimer-du-cache------------unsetthis-cacheid------------------------this-logger-infopayment-deleted-via-temporal-----------------paymentid--id----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-delete-payment-via-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------throw-e----------------public-function-count-int------------try-------------workflowid--payment-count---uniqid-------------------------cr√©er-un-workflow-de-comptage------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------return-workflow-getpaymentcount---------------------catch-exception-e-------------this-logger-errorfailed-to-count-payments-via-temporal-----------------error--e-getmessage------------------------------------return-0-------------3-workflows-de-persistance-workflow-de-persistance-des-paiementsphpphpnamespace-appworkflowpersistenceuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowuse-appdomainpaymentpaymentworkflowinterfaceinterface-paymentpersistenceworkflowinterface----workflowmethod----public-function-persistpaymentpayment-payment-void--------workflowmethod----public-function-getpaymentstring-paymentid-payment--------workflowmethod----public-function-deletepaymentstring-paymentid-voidactivityinterfaceinterface-paymentpersistenceactivityinterface----activitymethod----public-function-savetodatabasepayment-payment-void--------activitymethod----public-function-loadfromdatabasestring-paymentid-payment--------activitymethod----public-function-deletefromdatabasestring-paymentid-voidclass-paymentpersistenceworkflow-implements-paymentpersistenceworkflowinterface----private-paymentpersistenceactivityinterface-persistenceactivity----public-function-__construct------------this-persistenceactivity--workflownewactivitystubpaymentpersistenceactivityinterfaceclass--------public-function-persistpaymentpayment-payment-void------------yield-this-persistenceactivity-savetodatabasepayment--------public-function-getpaymentstring-paymentid-payment------------return-yield-this-persistenceactivity-loadfromdatabasepaymentid--------public-function-deletepaymentstring-paymentid-void------------yield-this-persistenceactivity-deletefromdatabasepaymentid------tests-et-validation-tests-dphpphpnamespace-apptestsintegrationtemporaluse-appworkflowpaymentpaymentrequestuse-appapplicationservicetemporalpaymentworkflowserviceuse-appinfrastructuretemporaltemporalclientfactoryclass-temporalpaymentworkflowtest-extends-testcase----private-paymentworkflowservice-workflowservice----private-temporalclientfactory-temporalfactory----protected-function-setup-void------------this-temporalfactory--new-temporalclientfactorylocalhost-7233-test--------this-workflowservice--new-paymentworkflowservice------------this-temporalfactory-createclient------------this-createmockloggerinterfaceclass----------------public-function-testpaymentworkflowexecution-void------------request--new-paymentrequest------------payment-123------------org-456------------user-789------------10000------------eur------------test-payment------------------------result--this-workflowservice-processpaymentrequest----------------this-asserttrueresult-issuccess--------this-assertequalspayment-processed-successfully-result-getmessage--------public-function-testworkflowstatus-void------------request--new-paymentrequest------------payment-456------------org-789------------user-123------------20000------------usd------------test-payment-2------------------------this-workflowservice-processpaymentrequest----------------status--this-workflowservice-getworkflowstatuspayment-payment-456----------------this-assertarrayhaskeyworkflowid-status--------this-assertarrayhaskeystatus-status--------this-assertarrayhaskeyiscompleted-status------performance-et-optimisation-strat√©gies-d-1-configuration-des-timeoutsphppublic-function-createoptimizedworkflowoptions-workflowoptions----return-workflowoptionsnew---------withworkflowidpayment-workflow---uniqid---------withworkflowexecutiontimeout600--10-minutes---------withworkflowruntimeout600---------withworkflowtasktimeout120---------withretryoptions------------initialinterval--1s------------maximuminterval--60s------------backoffcoefficient--20------------maximumattempts--3---------2-cache-des-workflowsphppublic-function-getworkflowwithcachestring-workflowid-paymentworkflowinterface----if-issetthis-workflowcacheworkflowid---------return-this-workflowcacheworkflowid------------workflow--this-workflowclient-newworkflowstub--------paymentworkflowinterfaceclass--------workflowid------------this-workflowcacheworkflowid--workflow--------return-workflow-3-monitoring-et-observabilit√©phppublic-function-getworkflowmetrics-array----return---------activeworkflows--this-getactiveworkflowcount--------completedworkflows--this-getcompletedworkflowcount--------failedworkflows--this-getfailedworkflowcount--------averageexecutiontime--this-getaverageexecutiontime------crit√®res-d-quand-utiliser-temporal-classique--avantages--durabilit√©--√©tat-des-workflows-persist√©-automatiquement--r√©silience--reprise-automatique-apr√®s-panne--orchestration--gestion-complexe-des-processus-m√©tier--observabilit√©--visibilit√©-compl√®te-sur-lex√©cution--scalabilit√©--ex√©cution-distribu√©e-des-workflows--inconv√©nients--complexit√©--courbe-dapprentissage-importante--infrastructure--n√©cessite-un-serveur-temporal--latence--overhead-pour-les-op√©rations-simples--expertise--√©quipe-exp√©riment√©e-requise--crit√®res-d--processus-m√©tier-complexes--workflows-qui-n√©cessitent-de-lorchestration--r√©silience-critique--besoin-de-reprise-automatique-apr√®s-panne--processus-longs--workflows-qui-s√©talent-sur-plusieurs-jours--int√©grations-multiples--orchestration-de-plusieurs-services--√©quipe-exp√©riment√©e--ma√Ætrise-de-temporal-et-des-workflows--infrastructure-disponible--serveur-temporal-op√©rationnel--votre-prochaine-√©tapehahahugoshortcode77s0hbhbtemporal-classique-offre-une-approche-puissante-pour-l>üéØ <strong>Contexte et Objectifs</strong>### **Pourquoi Temporal pour le Stockage ?**Temporal Workflows offre une approche unique pour le stockage en g√©rant l‚Äô√©tat des processus m√©tier complexes de mani√®re durable et r√©siliente. Cette approche est particuli√®rement adapt√©e aux workflows qui n√©cessitent de la persistance, de la reprise sur panne et de l‚Äôorchestration.#### <strong>Avantages du Stockage Temporal</strong>- <strong>Durabilit√©</strong> : √âtat des workflows persist√© automatiquement- <strong>R√©silience</strong> : Reprise automatique apr√®s panne- <strong>Orchestration</strong> : Gestion complexe des processus m√©tier- <strong>Observabilit√©</strong> : Visibilit√© compl√®te sur l‚Äôex√©cution- <strong>Scalabilit√©</strong> : Ex√©cution distribu√©e des workflows### <strong>Contexte Gyroscops</strong>Dans notre √©cosyst√®me <strong>User ‚Üí Organization ‚Üí Workflow ‚Üí Cloud Resources ‚Üí Billing</strong>, Temporal est particuli√®rement pertinent pour :- <strong>Workflows de provisioning</strong> : Orchestration des ressources cloud- <strong>Processus de facturation</strong> : Gestion des cycles de facturation- <strong>Int√©grations complexes</strong> : Orchestration des int√©grations API- <strong>Processus m√©tier longs</strong> : Workflows qui s‚Äô√©talent sur plusieurs jours## üèóÔ∏è <strong>Architecture Temporal Classique</strong>### <strong>Structure des Workflows</strong>#### <strong>Workflow de Base</strong><code>php&lt;?phpnamespace App\Workflow\Payment;use Temporal\Workflow\WorkflowInterface;use Temporal\Workflow\WorkflowMethod;use Temporal\Workflow\ActivityInterface;use Temporal\Workflow\ActivityMethod;use Temporal\Workflow\Workflow;#[WorkflowInterface]interface PaymentWorkflowInterface{ #[WorkflowMethod] public function processPayment(PaymentRequest $request): PaymentResult;}#[ActivityInterface]interface PaymentActivityInterface{ #[ActivityMethod] public function validatePayment(PaymentRequest $request): ValidationResult; #[ActivityMethod] public function chargePayment(PaymentRequest $request): ChargeResult; #[ActivityMethod] public function sendNotification(PaymentResult $result): void;}class PaymentWorkflow implements PaymentWorkflowInterface{ private PaymentActivityInterface $paymentActivity; public function __construct() { $this->paymentActivity = Workflow::newActivityStub(PaymentActivityInterface::class); } public function processPayment(PaymentRequest $request): PaymentResult { // Validation du paiement $validation = yield $this->paymentActivity->validatePayment($request); if (!$validation->isValid()) { return new PaymentResult(false, $validation->getError()); } // Traitement du paiement $charge = yield $this->paymentActivity->chargePayment($request); if (!$charge->isSuccess()) { return new PaymentResult(false, $charge->getError()); } // Notification yield $this->paymentActivity->sendNotification( new PaymentResult(true, 'Payment processed successfully') ); return new PaymentResult(true, 'Payment processed successfully'); }}</code>#### <strong>Activit√©s de Persistance</strong><code>php&lt;?phpnamespace App\Workflow\Payment;use Temporal\Activity\ActivityInterface;use Temporal\Activity\ActivityMethod;use App\Domain\Payment\PaymentRepositoryInterface;use App\Domain\Payment\Payment;use Psr\Log\LoggerInterface;class PaymentActivity implements PaymentActivityInterface{ private PaymentRepositoryInterface $paymentRepository; private LoggerInterface $logger; public function __construct( PaymentRepositoryInterface $paymentRepository, LoggerInterface $logger ) { $this->paymentRepository = $paymentRepository; $this->logger = $logger; } #[ActivityMethod] public function validatePayment(PaymentRequest $request): ValidationResult { try { $this->logger->info('Validating payment', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); // Validation m√©tier if ($request->getAmount() &lt;= 0) { return new ValidationResult(false, 'Invalid amount'); } if (empty($request->getCurrency())) { return new ValidationResult(false, 'Currency required'); } // V√©rification de l'organisation if (!$this->paymentRepository->organizationExists($request->getOrganizationId())) { return new ValidationResult(false, 'Organization not found'); } return new ValidationResult(true); } catch (\Exception $e) { $this->logger->error('Payment validation failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); return new ValidationResult(false, $e->getMessage()); } } #[ActivityMethod] public function chargePayment(PaymentRequest $request): ChargeResult { try { $this->logger->info('Charging payment', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); // Cr√©er le paiement $payment = new Payment( $request->getPaymentId(), $request->getOrganizationId(), $request->getUserId(), $request->getAmount(), $request->getCurrency(), 'processing', $request->getDescription(), new \DateTime() ); // Sauvegarder le paiement $this->paymentRepository->save($payment); // Simuler le traitement du paiement // Dans un vrai syst√®me, ceci appellerait un service de paiement $this->simulatePaymentProcessing($request); // Mettre √† jour le statut $payment->markAsCompleted(); $this->paymentRepository->save($payment); return new ChargeResult(true, 'Payment charged successfully'); } catch (\Exception $e) { $this->logger->error('Payment charging failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); return new ChargeResult(false, $e->getMessage()); } } #[ActivityMethod] public function sendNotification(PaymentResult $result): void { try { $this->logger->info('Sending payment notification', [ 'success' => $result->isSuccess(), 'message' => $result->getMessage() ]); // Envoyer une notification (email, webhook, etc.) $this->sendEmailNotification($result); $this->sendWebhookNotification($result); } catch (\Exception $e) { $this->logger->error('Notification sending failed', [ 'error' => $e->getMessage() ]); } } private function simulatePaymentProcessing(PaymentRequest $request): void { // Simuler un d√©lai de traitement sleep(2); // Simuler une √©chec al√©atoire (5% de chance) if (rand(1, 100) &lt;= 5) { throw new \Exception('Payment processing failed'); } } private function sendEmailNotification(PaymentResult $result): void { // Impl√©mentation de l'envoi d'email } private function sendWebhookNotification(PaymentResult $result): void { // Impl√©mentation de l'envoi de webhook }}</code>### <strong>Flux de Donn√©es</strong><code>mermaidgraph TD A[Client Request] --> B[Temporal Client] B --> C[Workflow Execution] C --> D[Activity 1: Validation] D --> E[Activity 2: Charging] E --> F[Activity 3: Notification] F --> G[Workflow Complete] H[Persistence Layer] --> I[Payment Repository] I --> J[Database] C --> H D --> H E --> H F --> H K[Temporal Server] --> L[Workflow State] L --> M[Activity State] M --> N[Event History]</code>## üíª <strong>Impl√©mentation Pratique</strong>### <strong>1. Configuration Temporal</strong>#### <strong>Configuration du Client</strong><code>php&lt;?phpnamespace App\Infrastructure\Temporal;use Temporal\Client\WorkflowClient;use Temporal\Client\WorkflowClientInterface;use Temporal\Client\WorkflowOptions;use Temporal\DataConverter\DataConverter;use Temporal\DataConverter\JsonDataConverter;class TemporalClientFactory{ private string $host; private int $port; private string $namespace; public function __construct(string $host = 'localhost', int $port = 7233, string $namespace = 'default') { $this->host = $host; $this->port = $port; $this->namespace = $namespace; } public function createClient(): WorkflowClientInterface { $dataConverter = new DataConverter( new JsonDataConverter() ); return WorkflowClient::create( $this->host . ':' . $this->port, [ 'namespace' => $this->namespace, 'dataConverter' => $dataConverter, ] ); } public function createWorkflowOptions(): WorkflowOptions { return WorkflowOptions::new() ->withWorkflowId('payment-workflow-' . uniqid()) ->withWorkflowExecutionTimeout(300) // 5 minutes ->withWorkflowRunTimeout(300) ->withWorkflowTaskTimeout(60); }}</code>#### <strong>Service de Workflow</strong><code>php&lt;?phpnamespace App\Application\Service\Temporal;use App\Workflow\Payment\PaymentWorkflowInterface;use App\Workflow\Payment\PaymentRequest;use App\Workflow\Payment\PaymentResult;use Temporal\Client\WorkflowClientInterface;use Temporal\Client\WorkflowOptions;use Psr\Log\LoggerInterface;class PaymentWorkflowService{ private WorkflowClientInterface $workflowClient; private LoggerInterface $logger; public function __construct( WorkflowClientInterface $workflowClient, LoggerInterface $logger ) { $this->workflowClient = $workflowClient; $this->logger = $logger; } public function processPayment(PaymentRequest $request): PaymentResult { try { $this->logger->info('Starting payment workflow', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); $workflowOptions = WorkflowOptions::new() ->withWorkflowId('payment-' . $request->getPaymentId()) ->withWorkflowExecutionTimeout(300) ->withWorkflowRunTimeout(300) ->withWorkflowTaskTimeout(60); $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowOptions ); $result = $workflow->processPayment($request); $this->logger->info('Payment workflow completed', [ 'paymentId' => $request->getPaymentId(), 'success' => $result->isSuccess() ]); return $result; } catch (\Exception $e) { $this->logger->error('Payment workflow failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); throw $e; } } public function getWorkflowStatus(string $workflowId): array { try { $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $status = $workflow->getStatus(); return [ 'workflowId' => $workflowId, 'status' => $status, 'isRunning' => $status === 'RUNNING', 'isCompleted' => $status === 'COMPLETED', 'isFailed' => $status === 'FAILED' ]; } catch (\Exception $e) { $this->logger->error('Failed to get workflow status', [ 'workflowId' => $workflowId, 'error' => $e->getMessage() ]); throw $e; } } public function cancelWorkflow(string $workflowId): void { try { $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $workflow->cancel(); $this->logger->info('Workflow cancelled', [ 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to cancel workflow', [ 'workflowId' => $workflowId, 'error' => $e->getMessage() ]); throw $e; } }}</code>### <strong>2. Repository Temporal</strong>#### <strong>Repository avec Persistance Temporal</strong><code>php&lt;?phpnamespace App\Infrastructure\Temporal\Repository;use App\Domain\Payment\Payment;use App\Domain\Payment\PaymentRepositoryInterface;use App\Infrastructure\Temporal\TemporalClientFactory;use Psr\Log\LoggerInterface;class TemporalPaymentRepository implements PaymentRepositoryInterface{ private TemporalClientFactory $temporalFactory; private LoggerInterface $logger; private array $cache = []; public function __construct( TemporalClientFactory $temporalFactory, LoggerInterface $logger ) { $this->temporalFactory = $temporalFactory; $this->logger = $logger; } public function save(Payment $payment): void { try { $workflowId = 'payment-' . $payment->getId(); // Cr√©er un workflow de persistance $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowOptions); // Ex√©cuter le workflow de persistance $workflow->persistPayment($payment); // Mettre en cache $this->cache[$payment->getId()] = $payment; $this->logger->info('Payment persisted via Temporal', [ 'paymentId' => $payment->getId(), 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to persist payment via Temporal', [ 'paymentId' => $payment->getId(), 'error' => $e->getMessage() ]); throw $e; } } public function findById(string $id): ?Payment { // V√©rifier le cache d'abord if (isset($this->cache[$id])) { return $this->cache[$id]; } try { $workflowId = 'payment-' . $id; // R√©cup√©rer depuis Temporal $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowId); $payment = $workflow->getPayment($id); if ($payment) { $this->cache[$id] = $payment; } return $payment; } catch (\Exception $e) { $this->logger->error('Failed to retrieve payment from Temporal', [ 'paymentId' => $id, 'error' => $e->getMessage() ]); return null; } } public function findByOrganization(string $organizationId): array { try { $workflowId = 'payment-search-' . $organizationId . '-' . uniqid(); // Cr√©er un workflow de recherche $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentSearchWorkflowInterface::class, $workflowOptions); $payments = $workflow->searchByOrganization($organizationId); // Mettre en cache foreach ($payments as $payment) { $this->cache[$payment->getId()] = $payment; } return $payments; } catch (\Exception $e) { $this->logger->error('Failed to search payments via Temporal', [ 'organizationId' => $organizationId, 'error' => $e->getMessage() ]); return []; } } public function delete(string $id): void { try { $workflowId = 'payment-delete-' . $id; // Cr√©er un workflow de suppression $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowOptions); $workflow->deletePayment($id); // Supprimer du cache unset($this->cache[$id]); $this->logger->info('Payment deleted via Temporal', [ 'paymentId' => $id, 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to delete payment via Temporal', [ 'paymentId' => $id, 'error' => $e->getMessage() ]); throw $e; } } public function count(): int { try { $workflowId = 'payment-count-' . uniqid(); // Cr√©er un workflow de comptage $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentSearchWorkflowInterface::class, $workflowOptions); return $workflow->getPaymentCount(); } catch (\Exception $e) { $this->logger->error('Failed to count payments via Temporal', [ 'error' => $e->getMessage() ]); return 0; } }}</code>### <strong>3. Workflows de Persistance</strong>#### <strong>Workflow de Persistance des Paiements</strong><code>php&lt;?phpnamespace App\Workflow\Persistence;use Temporal\Workflow\WorkflowInterface;use Temporal\Workflow\WorkflowMethod;use Temporal\Workflow\ActivityInterface;use Temporal\Workflow\ActivityMethod;use Temporal\Workflow\Workflow;use App\Domain\Payment\Payment;#[WorkflowInterface]interface PaymentPersistenceWorkflowInterface{ #[WorkflowMethod] public function persistPayment(Payment $payment): void; #[WorkflowMethod] public function getPayment(string $paymentId): ?Payment; #[WorkflowMethod] public function deletePayment(string $paymentId): void;}#[ActivityInterface]interface PaymentPersistenceActivityInterface{ #[ActivityMethod] public function saveToDatabase(Payment $payment): void; #[ActivityMethod] public function loadFromDatabase(string $paymentId): ?Payment; #[ActivityMethod] public function deleteFromDatabase(string $paymentId): void;}class PaymentPersistenceWorkflow implements PaymentPersistenceWorkflowInterface{ private PaymentPersistenceActivityInterface $persistenceActivity; public function __construct() { $this->persistenceActivity = Workflow::newActivityStub(PaymentPersistenceActivityInterface::class); } public function persistPayment(Payment $payment): void { yield $this->persistenceActivity->saveToDatabase($payment); } public function getPayment(string $paymentId): ?Payment { return yield $this->persistenceActivity->loadFromDatabase($paymentId); } public function deletePayment(string $paymentId): void { yield $this->persistenceActivity->deleteFromDatabase($paymentId); }}</code>## üß™ <strong>Tests et Validation</strong>### <strong>Tests d‚ÄôInt√©gration Temporal</strong><code>php&lt;?phpnamespace App\Tests\Integration\Temporal;use App\Workflow\Payment\PaymentRequest;use App\Application\Service\Temporal\PaymentWorkflowService;use App\Infrastructure\Temporal\TemporalClientFactory;class TemporalPaymentWorkflowTest extends TestCase{ private PaymentWorkflowService $workflowService; private TemporalClientFactory $temporalFactory; protected function setUp(): void { $this->temporalFactory = new TemporalClientFactory('localhost', 7233, 'test'); $this->workflowService = new PaymentWorkflowService( $this->temporalFactory->createClient(), $this->createMock(LoggerInterface::class) ); } public function testPaymentWorkflowExecution(): void { $request = new PaymentRequest( 'payment-123', 'org-456', 'user-789', 100.00, 'EUR', 'Test payment' ); $result = $this->workflowService->processPayment($request); $this->assertTrue($result->isSuccess()); $this->assertEquals('Payment processed successfully', $result->getMessage()); } public function testWorkflowStatus(): void { $request = new PaymentRequest( 'payment-456', 'org-789', 'user-123', 200.00, 'USD', 'Test payment 2' ); $this->workflowService->processPayment($request); $status = $this->workflowService->getWorkflowStatus('payment-payment-456'); $this->assertArrayHasKey('workflowId', $status); $this->assertArrayHasKey('status', $status); $this->assertArrayHasKey('isCompleted', $status); }}</code>## üìä <strong>Performance et Optimisation</strong>### <strong>Strat√©gies d‚ÄôOptimisation Temporal</strong>#### <strong>1. Configuration des Timeouts</strong><code>phppublic function createOptimizedWorkflowOptions(): WorkflowOptions{ return WorkflowOptions::new() ->withWorkflowId('payment-workflow-' . uniqid()) ->withWorkflowExecutionTimeout(600) // 10 minutes ->withWorkflowRunTimeout(600) ->withWorkflowTaskTimeout(120) ->withRetryOptions([ 'initialInterval' => '1s', 'maximumInterval' => '60s', 'backoffCoefficient' => 2.0, 'maximumAttempts' => 3 ]);}</code>#### <strong>2. Cache des Workflows</strong><code>phppublic function getWorkflowWithCache(string $workflowId): PaymentWorkflowInterface{ if (isset($this->workflowCache[$workflowId])) { return $this->workflowCache[$workflowId]; } $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $this->workflowCache[$workflowId] = $workflow; return $workflow;}</code>#### <strong>3. Monitoring et Observabilit√©</strong><code>phppublic function getWorkflowMetrics(): array{ return [ 'activeWorkflows' => $this->getActiveWorkflowCount(), 'completedWorkflows' => $this->getCompletedWorkflowCount(), 'failedWorkflows' => $this->getFailedWorkflowCount(), 'averageExecutionTime' => $this->getAverageExecutionTime() ];}</code>## üéØ <strong>Crit√®res d‚ÄôAdoption</strong>### <strong>Quand Utiliser Temporal Classique</strong>#### <strong>‚úÖ Avantages</strong>- <strong>Durabilit√©</strong> : √âtat des workflows persist√© automatiquement- <strong>R√©silience</strong> : Reprise automatique apr√®s panne- <strong>Orchestration</strong> : Gestion complexe des processus m√©tier- <strong>Observabilit√©</strong> : Visibilit√© compl√®te sur l‚Äôex√©cution- <strong>Scalabilit√©</strong> : Ex√©cution distribu√©e des workflows#### <strong>‚ùå Inconv√©nients</strong>- <strong>Complexit√©</strong> : Courbe d‚Äôapprentissage importante- <strong>Infrastructure</strong> : N√©cessite un serveur Temporal- <strong>Latence</strong> : Overhead pour les op√©rations simples- <strong>Expertise</strong> : √âquipe exp√©riment√©e requise#### <strong>üéØ Crit√®res d‚ÄôAdoption</strong>- <strong>Processus m√©tier complexes</strong> : Workflows qui n√©cessitent de l‚Äôorchestration- <strong>R√©silience critique</strong> : Besoin de reprise automatique apr√®s panne- <strong>Processus longs</strong> : Workflows qui s‚Äô√©talent sur plusieurs jours- <strong>Int√©grations multiples</strong> : Orchestration de plusieurs services- <strong>√âquipe exp√©riment√©e</strong> : Ma√Ætrise de Temporal et des workflows- <strong>Infrastructure disponible</strong> : Serveur Temporal op√©rationnel## üöÄ <strong>Votre Prochaine √âtape</strong>HAHAHUGOSHORTCODE77s0HBHB‚Äî<em>Temporal classique offre une approche puissante pour l‚Äôorchestration de processus m√©tier complexes, parfaitement adapt√©e aux besoins de workflows de Gyroscops.</em></a></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">Stockage Temporal - Approche Classique
<span class="badge bg-default fs-6 mb-1 align-middle">DRAFT</span></h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h2 id=-contexte-et-objectifs-pourquoi-temporal-pour-le-stockage-temporal-workflows-offre-une-approche-unique-pour-le-stockage-en-g√©rant-l√©tat-des-processus-m√©tier-complexes-de-mani√®re-durable-et-r√©siliente-cette-approche-est-particuli√®rement-adapt√©e-aux-workflows-qui-n√©cessitent-de-la-persistance-de-la-reprise-sur-panne-et-de-lorchestration-avantages-du-stockage-temporal--durabilit√©--√©tat-des-workflows-persist√©-automatiquement--r√©silience--reprise-automatique-apr√®s-panne--orchestration--gestion-complexe-des-processus-m√©tier--observabilit√©--visibilit√©-compl√®te-sur-lex√©cution--scalabilit√©--ex√©cution-distribu√©e-des-workflows-contexte-gyroscopsdans-notre-√©cosyst√®me-user--organization--workflow--cloud-resources--billing-temporal-est-particuli√®rement-pertinent-pour---workflows-de-provisioning--orchestration-des-ressources-cloud--processus-de-facturation--gestion-des-cycles-de-facturation--int√©grations-complexes--orchestration-des-int√©grations-api--processus-m√©tier-longs--workflows-qui-s√©talent-sur-plusieurs-jours--architecture-temporal-classique-structure-des-workflows-workflow-de-basephpphpnamespace-appworkflowpaymentuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowworkflowinterfaceinterface-paymentworkflowinterface----workflowmethod----public-function-processpaymentpaymentrequest-request-paymentresultactivityinterfaceinterface-paymentactivityinterface----activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult--------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult--------activitymethod----public-function-sendnotificationpaymentresult-result-voidclass-paymentworkflow-implements-paymentworkflowinterface----private-paymentactivityinterface-paymentactivity----public-function-__construct------------this-paymentactivity--workflownewactivitystubpaymentactivityinterfaceclass--------public-function-processpaymentpaymentrequest-request-paymentresult-------------validation-du-paiement--------validation--yield-this-paymentactivity-validatepaymentrequest----------------if-validation-isvalid-------------return-new-paymentresultfalse-validation-geterror-------------------------traitement-du-paiement--------charge--yield-this-paymentactivity-chargepaymentrequest----------------if-charge-issuccess-------------return-new-paymentresultfalse-charge-geterror-------------------------notification--------yield-this-paymentactivity-sendnotification------------new-paymentresulttrue-payment-processed-successfully------------------------return-new-paymentresulttrue-payment-processed-successfully-----activit√©s-de-persistancephpphpnamespace-appworkflowpaymentuse-temporalactivityactivityinterfaceuse-temporalactivityactivitymethoduse-appdomainpaymentpaymentrepositoryinterfaceuse-appdomainpaymentpaymentuse-psrlogloggerinterfaceclass-paymentactivity-implements-paymentactivityinterface----private-paymentrepositoryinterface-paymentrepository----private-loggerinterface-logger----public-function-__construct--------paymentrepositoryinterface-paymentrepository--------loggerinterface-logger-------------this-paymentrepository--paymentrepository--------this-logger--logger--------activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult------------try-------------this-logger-infovalidating-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------validation-m√©tier------------if-request-getamount--0-----------------return-new-validationresultfalse-invalid-amount------------------------------------if-emptyrequest-getcurrency-----------------return-new-validationresultfalse-currency-required-------------------------------------v√©rification-de-lorganisation------------if-this-paymentrepository-organizationexistsrequest-getorganizationid-----------------return-new-validationresultfalse-organization-not-found------------------------------------return-new-validationresulttrue---------------------catch-exception-e-------------this-logger-errorpayment-validation-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-validationresultfalse-e-getmessage----------------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult------------try-------------this-logger-infocharging-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------cr√©er-le-paiement------------payment--new-payment----------------request-getpaymentid----------------request-getorganizationid----------------request-getuserid----------------request-getamount----------------request-getcurrency----------------processing----------------request-getdescription----------------new-datetime-------------------------------------sauvegarder-le-paiement------------this-paymentrepository-savepayment-------------------------simuler-le-traitement-du-paiement-------------dans-un-vrai-syst√®me-ceci-appellerait-un-service-de-paiement------------this-simulatepaymentprocessingrequest-------------------------mettre-√†-jour-le-statut------------payment-markascompleted------------this-paymentrepository-savepayment------------------------return-new-chargeresulttrue-payment-charged-successfully---------------------catch-exception-e-------------this-logger-errorpayment-charging-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-chargeresultfalse-e-getmessage----------------activitymethod----public-function-sendnotificationpaymentresult-result-void------------try-------------this-logger-infosending-payment-notification-----------------success--result-issuccess----------------message--result-getmessage-------------------------------------envoyer-une-notification-email-webhook-etc------------this-sendemailnotificationresult------------this-sendwebhooknotificationresult---------------------catch-exception-e-------------this-logger-errornotification-sending-failed-----------------error--e-getmessage----------------------------private-function-simulatepaymentprocessingpaymentrequest-request-void-------------simuler-un-d√©lai-de-traitement--------sleep2-----------------simuler-une-√©chec-al√©atoire-5-de-chance--------if-rand1-100--5-------------throw-new-exceptionpayment-processing-failed----------------private-function-sendemailnotificationpaymentresult-result-void-------------impl√©mentation-de-lenvoi-demail--------private-function-sendwebhooknotificationpaymentresult-result-void-------------impl√©mentation-de-lenvoi-de-webhook-----flux-de-donn√©esmermaidgraph-td----aclient-request----btemporal-client----b----cworkflow-execution----c----dactivity-1-validation----d----eactivity-2-charging----e----factivity-3-notification----f----gworkflow-complete--------hpersistence-layer----ipayment-repository----i----jdatabase--------c----h----d----h----e----h----f----h--------ktemporal-server----lworkflow-state----l----mactivity-state----m----nevent-history--impl√©mentation-pratique-1-configuration-temporal-configuration-du-clientphpphpnamespace-appinfrastructuretemporaluse-temporalclientworkflowclientuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-temporaldataconverterdataconverteruse-temporaldataconverterjsondataconverterclass-temporalclientfactory----private-string-host----private-int-port----private-string-namespace----public-function-__constructstring-host--localhost-int-port--7233-string-namespace--default------------this-host--host--------this-port--port--------this-namespace--namespace--------public-function-createclient-workflowclientinterface------------dataconverter--new-dataconverter------------new-jsondataconverter----------------return-workflowclientcreate------------this-host----this-port----------------------------namespace--this-namespace----------------dataconverter--dataconverter----------------------------public-function-createworkflowoptions-workflowoptions------------return-workflowoptionsnew-------------withworkflowidpayment-workflow---uniqid-------------withworkflowexecutiontimeout300--5-minutes-------------withworkflowruntimeout300-------------withworkflowtasktimeout60-----service-de-workflowphpphpnamespace-appapplicationservicetemporaluse-appworkflowpaymentpaymentworkflowinterfaceuse-appworkflowpaymentpaymentrequestuse-appworkflowpaymentpaymentresultuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-psrlogloggerinterfaceclass-paymentworkflowservice----private-workflowclientinterface-workflowclient----private-loggerinterface-logger----public-function-__construct--------workflowclientinterface-workflowclient--------loggerinterface-logger-------------this-workflowclient--workflowclient--------this-logger--logger--------public-function-processpaymentpaymentrequest-request-paymentresult------------try-------------this-logger-infostarting-payment-workflow-----------------paymentid--request-getpaymentid----------------amount--request-getamount------------------------workflowoptions--workflowoptionsnew-----------------withworkflowidpayment---request-getpaymentid-----------------withworkflowexecutiontimeout300-----------------withworkflowruntimeout300-----------------withworkflowtasktimeout60------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowoptions------------------------result--workflow-processpaymentrequest------------this-logger-infopayment-workflow-completed-----------------paymentid--request-getpaymentid----------------success--result-issuccess------------------------return-result---------catch-exception-e-------------this-logger-errorpayment-workflow-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------throw-e----------------public-function-getworkflowstatusstring-workflowid-array------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------status--workflow-getstatus------------return-----------------workflowid--workflowid----------------status--status----------------isrunning--status--running----------------iscompleted--status--completed----------------isfailed--status--failed---------------------catch-exception-e-------------this-logger-errorfailed-to-get-workflow-status-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e----------------public-function-cancelworkflowstring-workflowid-void------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------workflow-cancel------------this-logger-infoworkflow-cancelled-----------------workflowid--workflowid---------------------catch-exception-e-------------this-logger-errorfailed-to-cancel-workflow-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e-------------2-repository-temporal-repository-avec-persistance-temporalphpphpnamespace-appinfrastructuretemporalrepositoryuse-appdomainpaymentpaymentuse-appdomainpaymentpaymentrepositoryinterfaceuse-appinfrastructuretemporaltemporalclientfactoryuse-psrlogloggerinterfaceclass-temporalpaymentrepository-implements-paymentrepositoryinterface----private-temporalclientfactory-temporalfactory----private-loggerinterface-logger----private-array-cache------public-function-__construct--------temporalclientfactory-temporalfactory--------loggerinterface-logger-------------this-temporalfactory--temporalfactory--------this-logger--logger--------public-function-savepayment-payment-void------------try-------------workflowid--payment---payment-getid-------------------------cr√©er-un-workflow-de-persistance------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions-------------------------ex√©cuter-le-workflow-de-persistance------------workflow-persistpaymentpayment-------------------------mettre-en-cache------------this-cachepayment-getid--payment------------------------this-logger-infopayment-persisted-via-temporal-----------------paymentid--payment-getid----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-persist-payment-via-temporal-----------------paymentid--payment-getid----------------error--e-getmessage------------------------------------throw-e----------------public-function-findbyidstring-id-payment-------------v√©rifier-le-cache-dabord--------if-issetthis-cacheid-------------return-this-cacheid------------------------try-------------workflowid--payment---id-------------------------r√©cup√©rer-depuis-temporal------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowid------------------------payment--workflow-getpaymentid------------------------if-payment-----------------this-cacheid--payment------------------------------------return-payment---------------------catch-exception-e-------------this-logger-errorfailed-to-retrieve-payment-from-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------return-null----------------public-function-findbyorganizationstring-organizationid-array------------try-------------workflowid--payment-search---organizationid-----uniqid-------------------------cr√©er-un-workflow-de-recherche------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------payments--workflow-searchbyorganizationorganizationid-------------------------mettre-en-cache------------foreach-payments-as-payment-----------------this-cachepayment-getid--payment------------------------------------return-payments---------------------catch-exception-e-------------this-logger-errorfailed-to-search-payments-via-temporal-----------------organizationid--organizationid----------------error--e-getmessage------------------------------------return-----------------public-function-deletestring-id-void------------try-------------workflowid--payment-delete---id-------------------------cr√©er-un-workflow-de-suppression------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions------------------------workflow-deletepaymentid-------------------------supprimer-du-cache------------unsetthis-cacheid------------------------this-logger-infopayment-deleted-via-temporal-----------------paymentid--id----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-delete-payment-via-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------throw-e----------------public-function-count-int------------try-------------workflowid--payment-count---uniqid-------------------------cr√©er-un-workflow-de-comptage------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------return-workflow-getpaymentcount---------------------catch-exception-e-------------this-logger-errorfailed-to-count-payments-via-temporal-----------------error--e-getmessage------------------------------------return-0-------------3-workflows-de-persistance-workflow-de-persistance-des-paiementsphpphpnamespace-appworkflowpersistenceuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowuse-appdomainpaymentpaymentworkflowinterfaceinterface-paymentpersistenceworkflowinterface----workflowmethod----public-function-persistpaymentpayment-payment-void--------workflowmethod----public-function-getpaymentstring-paymentid-payment--------workflowmethod----public-function-deletepaymentstring-paymentid-voidactivityinterfaceinterface-paymentpersistenceactivityinterface----activitymethod----public-function-savetodatabasepayment-payment-void--------activitymethod----public-function-loadfromdatabasestring-paymentid-payment--------activitymethod----public-function-deletefromdatabasestring-paymentid-voidclass-paymentpersistenceworkflow-implements-paymentpersistenceworkflowinterface----private-paymentpersistenceactivityinterface-persistenceactivity----public-function-__construct------------this-persistenceactivity--workflownewactivitystubpaymentpersistenceactivityinterfaceclass--------public-function-persistpaymentpayment-payment-void------------yield-this-persistenceactivity-savetodatabasepayment--------public-function-getpaymentstring-paymentid-payment------------return-yield-this-persistenceactivity-loadfromdatabasepaymentid--------public-function-deletepaymentstring-paymentid-void------------yield-this-persistenceactivity-deletefromdatabasepaymentid------tests-et-validation-tests-dphpphpnamespace-apptestsintegrationtemporaluse-appworkflowpaymentpaymentrequestuse-appapplicationservicetemporalpaymentworkflowserviceuse-appinfrastructuretemporaltemporalclientfactoryclass-temporalpaymentworkflowtest-extends-testcase----private-paymentworkflowservice-workflowservice----private-temporalclientfactory-temporalfactory----protected-function-setup-void------------this-temporalfactory--new-temporalclientfactorylocalhost-7233-test--------this-workflowservice--new-paymentworkflowservice------------this-temporalfactory-createclient------------this-createmockloggerinterfaceclass----------------public-function-testpaymentworkflowexecution-void------------request--new-paymentrequest------------payment-123------------org-456------------user-789------------10000------------eur------------test-payment------------------------result--this-workflowservice-processpaymentrequest----------------this-asserttrueresult-issuccess--------this-assertequalspayment-processed-successfully-result-getmessage--------public-function-testworkflowstatus-void------------request--new-paymentrequest------------payment-456------------org-789------------user-123------------20000------------usd------------test-payment-2------------------------this-workflowservice-processpaymentrequest----------------status--this-workflowservice-getworkflowstatuspayment-payment-456----------------this-assertarrayhaskeyworkflowid-status--------this-assertarrayhaskeystatus-status--------this-assertarrayhaskeyiscompleted-status------performance-et-optimisation-strat√©gies-d-1-configuration-des-timeoutsphppublic-function-createoptimizedworkflowoptions-workflowoptions----return-workflowoptionsnew---------withworkflowidpayment-workflow---uniqid---------withworkflowexecutiontimeout600--10-minutes---------withworkflowruntimeout600---------withworkflowtasktimeout120---------withretryoptions------------initialinterval--1s------------maximuminterval--60s------------backoffcoefficient--20------------maximumattempts--3---------2-cache-des-workflowsphppublic-function-getworkflowwithcachestring-workflowid-paymentworkflowinterface----if-issetthis-workflowcacheworkflowid---------return-this-workflowcacheworkflowid------------workflow--this-workflowclient-newworkflowstub--------paymentworkflowinterfaceclass--------workflowid------------this-workflowcacheworkflowid--workflow--------return-workflow-3-monitoring-et-observabilit√©phppublic-function-getworkflowmetrics-array----return---------activeworkflows--this-getactiveworkflowcount--------completedworkflows--this-getcompletedworkflowcount--------failedworkflows--this-getfailedworkflowcount--------averageexecutiontime--this-getaverageexecutiontime------crit√®res-d-quand-utiliser-temporal-classique--avantages--durabilit√©--√©tat-des-workflows-persist√©-automatiquement--r√©silience--reprise-automatique-apr√®s-panne--orchestration--gestion-complexe-des-processus-m√©tier--observabilit√©--visibilit√©-compl√®te-sur-lex√©cution--scalabilit√©--ex√©cution-distribu√©e-des-workflows--inconv√©nients--complexit√©--courbe-dapprentissage-importante--infrastructure--n√©cessite-un-serveur-temporal--latence--overhead-pour-les-op√©rations-simples--expertise--√©quipe-exp√©riment√©e-requise--crit√®res-d--processus-m√©tier-complexes--workflows-qui-n√©cessitent-de-lorchestration--r√©silience-critique--besoin-de-reprise-automatique-apr√®s-panne--processus-longs--workflows-qui-s√©talent-sur-plusieurs-jours--int√©grations-multiples--orchestration-de-plusieurs-services--√©quipe-exp√©riment√©e--ma√Ætrise-de-temporal-et-des-workflows--infrastructure-disponible--serveur-temporal-op√©rationnel--votre-prochaine-√©tapehahahugoshortcode77s0hbhbtemporal-classique-offre-une-approche-puissante-pour-l>üéØ <strong>Contexte et Objectifs</strong>### **Pourquoi Temporal pour le Stockage ?**Temporal Workflows offre une approche unique pour le stockage en g√©rant l&rsquo;√©tat des processus m√©tier complexes de mani√®re durable et r√©siliente. Cette approche est particuli√®rement adapt√©e aux workflows qui n√©cessitent de la persistance, de la reprise sur panne et de l&rsquo;orchestration.#### <strong>Avantages du Stockage Temporal</strong>- <strong>Durabilit√©</strong> : √âtat des workflows persist√© automatiquement- <strong>R√©silience</strong> : Reprise automatique apr√®s panne- <strong>Orchestration</strong> : Gestion complexe des processus m√©tier- <strong>Observabilit√©</strong> : Visibilit√© compl√®te sur l&rsquo;ex√©cution- <strong>Scalabilit√©</strong> : Ex√©cution distribu√©e des workflows### <strong>Contexte Gyroscops</strong>Dans notre √©cosyst√®me <strong>User ‚Üí Organization ‚Üí Workflow ‚Üí Cloud Resources ‚Üí Billing</strong>, Temporal est particuli√®rement pertinent pour :- <strong>Workflows de provisioning</strong> : Orchestration des ressources cloud- <strong>Processus de facturation</strong> : Gestion des cycles de facturation- <strong>Int√©grations complexes</strong> : Orchestration des int√©grations API- <strong>Processus m√©tier longs</strong> : Workflows qui s&rsquo;√©talent sur plusieurs jours## üèóÔ∏è <strong>Architecture Temporal Classique</strong>### <strong>Structure des Workflows</strong>#### <strong>Workflow de Base</strong><code>php&lt;?phpnamespace App\Workflow\Payment;use Temporal\Workflow\WorkflowInterface;use Temporal\Workflow\WorkflowMethod;use Temporal\Workflow\ActivityInterface;use Temporal\Workflow\ActivityMethod;use Temporal\Workflow\Workflow;#[WorkflowInterface]interface PaymentWorkflowInterface{ #[WorkflowMethod] public function processPayment(PaymentRequest $request): PaymentResult;}#[ActivityInterface]interface PaymentActivityInterface{ #[ActivityMethod] public function validatePayment(PaymentRequest $request): ValidationResult; #[ActivityMethod] public function chargePayment(PaymentRequest $request): ChargeResult; #[ActivityMethod] public function sendNotification(PaymentResult $result): void;}class PaymentWorkflow implements PaymentWorkflowInterface{ private PaymentActivityInterface $paymentActivity; public function __construct() { $this->paymentActivity = Workflow::newActivityStub(PaymentActivityInterface::class); } public function processPayment(PaymentRequest $request): PaymentResult { // Validation du paiement $validation = yield $this->paymentActivity->validatePayment($request); if (!$validation->isValid()) { return new PaymentResult(false, $validation->getError()); } // Traitement du paiement $charge = yield $this->paymentActivity->chargePayment($request); if (!$charge->isSuccess()) { return new PaymentResult(false, $charge->getError()); } // Notification yield $this->paymentActivity->sendNotification( new PaymentResult(true, 'Payment processed successfully') ); return new PaymentResult(true, 'Payment processed successfully'); }}</code>#### <strong>Activit√©s de Persistance</strong><code>php&lt;?phpnamespace App\Workflow\Payment;use Temporal\Activity\ActivityInterface;use Temporal\Activity\ActivityMethod;use App\Domain\Payment\PaymentRepositoryInterface;use App\Domain\Payment\Payment;use Psr\Log\LoggerInterface;class PaymentActivity implements PaymentActivityInterface{ private PaymentRepositoryInterface $paymentRepository; private LoggerInterface $logger; public function __construct( PaymentRepositoryInterface $paymentRepository, LoggerInterface $logger ) { $this->paymentRepository = $paymentRepository; $this->logger = $logger; } #[ActivityMethod] public function validatePayment(PaymentRequest $request): ValidationResult { try { $this->logger->info('Validating payment', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); // Validation m√©tier if ($request->getAmount() &lt;= 0) { return new ValidationResult(false, 'Invalid amount'); } if (empty($request->getCurrency())) { return new ValidationResult(false, 'Currency required'); } // V√©rification de l'organisation if (!$this->paymentRepository->organizationExists($request->getOrganizationId())) { return new ValidationResult(false, 'Organization not found'); } return new ValidationResult(true); } catch (\Exception $e) { $this->logger->error('Payment validation failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); return new ValidationResult(false, $e->getMessage()); } } #[ActivityMethod] public function chargePayment(PaymentRequest $request): ChargeResult { try { $this->logger->info('Charging payment', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); // Cr√©er le paiement $payment = new Payment( $request->getPaymentId(), $request->getOrganizationId(), $request->getUserId(), $request->getAmount(), $request->getCurrency(), 'processing', $request->getDescription(), new \DateTime() ); // Sauvegarder le paiement $this->paymentRepository->save($payment); // Simuler le traitement du paiement // Dans un vrai syst√®me, ceci appellerait un service de paiement $this->simulatePaymentProcessing($request); // Mettre √† jour le statut $payment->markAsCompleted(); $this->paymentRepository->save($payment); return new ChargeResult(true, 'Payment charged successfully'); } catch (\Exception $e) { $this->logger->error('Payment charging failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); return new ChargeResult(false, $e->getMessage()); } } #[ActivityMethod] public function sendNotification(PaymentResult $result): void { try { $this->logger->info('Sending payment notification', [ 'success' => $result->isSuccess(), 'message' => $result->getMessage() ]); // Envoyer une notification (email, webhook, etc.) $this->sendEmailNotification($result); $this->sendWebhookNotification($result); } catch (\Exception $e) { $this->logger->error('Notification sending failed', [ 'error' => $e->getMessage() ]); } } private function simulatePaymentProcessing(PaymentRequest $request): void { // Simuler un d√©lai de traitement sleep(2); // Simuler une √©chec al√©atoire (5% de chance) if (rand(1, 100) &lt;= 5) { throw new \Exception('Payment processing failed'); } } private function sendEmailNotification(PaymentResult $result): void { // Impl√©mentation de l'envoi d'email } private function sendWebhookNotification(PaymentResult $result): void { // Impl√©mentation de l'envoi de webhook }}</code>### <strong>Flux de Donn√©es</strong><code>mermaidgraph TD A[Client Request] --> B[Temporal Client] B --> C[Workflow Execution] C --> D[Activity 1: Validation] D --> E[Activity 2: Charging] E --> F[Activity 3: Notification] F --> G[Workflow Complete] H[Persistence Layer] --> I[Payment Repository] I --> J[Database] C --> H D --> H E --> H F --> H K[Temporal Server] --> L[Workflow State] L --> M[Activity State] M --> N[Event History]</code>## üíª <strong>Impl√©mentation Pratique</strong>### <strong>1. Configuration Temporal</strong>#### <strong>Configuration du Client</strong><code>php&lt;?phpnamespace App\Infrastructure\Temporal;use Temporal\Client\WorkflowClient;use Temporal\Client\WorkflowClientInterface;use Temporal\Client\WorkflowOptions;use Temporal\DataConverter\DataConverter;use Temporal\DataConverter\JsonDataConverter;class TemporalClientFactory{ private string $host; private int $port; private string $namespace; public function __construct(string $host = 'localhost', int $port = 7233, string $namespace = 'default') { $this->host = $host; $this->port = $port; $this->namespace = $namespace; } public function createClient(): WorkflowClientInterface { $dataConverter = new DataConverter( new JsonDataConverter() ); return WorkflowClient::create( $this->host . ':' . $this->port, [ 'namespace' => $this->namespace, 'dataConverter' => $dataConverter, ] ); } public function createWorkflowOptions(): WorkflowOptions { return WorkflowOptions::new() ->withWorkflowId('payment-workflow-' . uniqid()) ->withWorkflowExecutionTimeout(300) // 5 minutes ->withWorkflowRunTimeout(300) ->withWorkflowTaskTimeout(60); }}</code>#### <strong>Service de Workflow</strong><code>php&lt;?phpnamespace App\Application\Service\Temporal;use App\Workflow\Payment\PaymentWorkflowInterface;use App\Workflow\Payment\PaymentRequest;use App\Workflow\Payment\PaymentResult;use Temporal\Client\WorkflowClientInterface;use Temporal\Client\WorkflowOptions;use Psr\Log\LoggerInterface;class PaymentWorkflowService{ private WorkflowClientInterface $workflowClient; private LoggerInterface $logger; public function __construct( WorkflowClientInterface $workflowClient, LoggerInterface $logger ) { $this->workflowClient = $workflowClient; $this->logger = $logger; } public function processPayment(PaymentRequest $request): PaymentResult { try { $this->logger->info('Starting payment workflow', [ 'paymentId' => $request->getPaymentId(), 'amount' => $request->getAmount() ]); $workflowOptions = WorkflowOptions::new() ->withWorkflowId('payment-' . $request->getPaymentId()) ->withWorkflowExecutionTimeout(300) ->withWorkflowRunTimeout(300) ->withWorkflowTaskTimeout(60); $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowOptions ); $result = $workflow->processPayment($request); $this->logger->info('Payment workflow completed', [ 'paymentId' => $request->getPaymentId(), 'success' => $result->isSuccess() ]); return $result; } catch (\Exception $e) { $this->logger->error('Payment workflow failed', [ 'paymentId' => $request->getPaymentId(), 'error' => $e->getMessage() ]); throw $e; } } public function getWorkflowStatus(string $workflowId): array { try { $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $status = $workflow->getStatus(); return [ 'workflowId' => $workflowId, 'status' => $status, 'isRunning' => $status === 'RUNNING', 'isCompleted' => $status === 'COMPLETED', 'isFailed' => $status === 'FAILED' ]; } catch (\Exception $e) { $this->logger->error('Failed to get workflow status', [ 'workflowId' => $workflowId, 'error' => $e->getMessage() ]); throw $e; } } public function cancelWorkflow(string $workflowId): void { try { $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $workflow->cancel(); $this->logger->info('Workflow cancelled', [ 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to cancel workflow', [ 'workflowId' => $workflowId, 'error' => $e->getMessage() ]); throw $e; } }}</code>### <strong>2. Repository Temporal</strong>#### <strong>Repository avec Persistance Temporal</strong><code>php&lt;?phpnamespace App\Infrastructure\Temporal\Repository;use App\Domain\Payment\Payment;use App\Domain\Payment\PaymentRepositoryInterface;use App\Infrastructure\Temporal\TemporalClientFactory;use Psr\Log\LoggerInterface;class TemporalPaymentRepository implements PaymentRepositoryInterface{ private TemporalClientFactory $temporalFactory; private LoggerInterface $logger; private array $cache = []; public function __construct( TemporalClientFactory $temporalFactory, LoggerInterface $logger ) { $this->temporalFactory = $temporalFactory; $this->logger = $logger; } public function save(Payment $payment): void { try { $workflowId = 'payment-' . $payment->getId(); // Cr√©er un workflow de persistance $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowOptions); // Ex√©cuter le workflow de persistance $workflow->persistPayment($payment); // Mettre en cache $this->cache[$payment->getId()] = $payment; $this->logger->info('Payment persisted via Temporal', [ 'paymentId' => $payment->getId(), 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to persist payment via Temporal', [ 'paymentId' => $payment->getId(), 'error' => $e->getMessage() ]); throw $e; } } public function findById(string $id): ?Payment { // V√©rifier le cache d'abord if (isset($this->cache[$id])) { return $this->cache[$id]; } try { $workflowId = 'payment-' . $id; // R√©cup√©rer depuis Temporal $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowId); $payment = $workflow->getPayment($id); if ($payment) { $this->cache[$id] = $payment; } return $payment; } catch (\Exception $e) { $this->logger->error('Failed to retrieve payment from Temporal', [ 'paymentId' => $id, 'error' => $e->getMessage() ]); return null; } } public function findByOrganization(string $organizationId): array { try { $workflowId = 'payment-search-' . $organizationId . '-' . uniqid(); // Cr√©er un workflow de recherche $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentSearchWorkflowInterface::class, $workflowOptions); $payments = $workflow->searchByOrganization($organizationId); // Mettre en cache foreach ($payments as $payment) { $this->cache[$payment->getId()] = $payment; } return $payments; } catch (\Exception $e) { $this->logger->error('Failed to search payments via Temporal', [ 'organizationId' => $organizationId, 'error' => $e->getMessage() ]); return []; } } public function delete(string $id): void { try { $workflowId = 'payment-delete-' . $id; // Cr√©er un workflow de suppression $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentPersistenceWorkflowInterface::class, $workflowOptions); $workflow->deletePayment($id); // Supprimer du cache unset($this->cache[$id]); $this->logger->info('Payment deleted via Temporal', [ 'paymentId' => $id, 'workflowId' => $workflowId ]); } catch (\Exception $e) { $this->logger->error('Failed to delete payment via Temporal', [ 'paymentId' => $id, 'error' => $e->getMessage() ]); throw $e; } } public function count(): int { try { $workflowId = 'payment-count-' . uniqid(); // Cr√©er un workflow de comptage $workflowOptions = $this->temporalFactory->createWorkflowOptions() ->withWorkflowId($workflowId); $workflow = $this->temporalFactory->createClient() ->newWorkflowStub(PaymentSearchWorkflowInterface::class, $workflowOptions); return $workflow->getPaymentCount(); } catch (\Exception $e) { $this->logger->error('Failed to count payments via Temporal', [ 'error' => $e->getMessage() ]); return 0; } }}</code>### <strong>3. Workflows de Persistance</strong>#### <strong>Workflow de Persistance des Paiements</strong><code>php&lt;?phpnamespace App\Workflow\Persistence;use Temporal\Workflow\WorkflowInterface;use Temporal\Workflow\WorkflowMethod;use Temporal\Workflow\ActivityInterface;use Temporal\Workflow\ActivityMethod;use Temporal\Workflow\Workflow;use App\Domain\Payment\Payment;#[WorkflowInterface]interface PaymentPersistenceWorkflowInterface{ #[WorkflowMethod] public function persistPayment(Payment $payment): void; #[WorkflowMethod] public function getPayment(string $paymentId): ?Payment; #[WorkflowMethod] public function deletePayment(string $paymentId): void;}#[ActivityInterface]interface PaymentPersistenceActivityInterface{ #[ActivityMethod] public function saveToDatabase(Payment $payment): void; #[ActivityMethod] public function loadFromDatabase(string $paymentId): ?Payment; #[ActivityMethod] public function deleteFromDatabase(string $paymentId): void;}class PaymentPersistenceWorkflow implements PaymentPersistenceWorkflowInterface{ private PaymentPersistenceActivityInterface $persistenceActivity; public function __construct() { $this->persistenceActivity = Workflow::newActivityStub(PaymentPersistenceActivityInterface::class); } public function persistPayment(Payment $payment): void { yield $this->persistenceActivity->saveToDatabase($payment); } public function getPayment(string $paymentId): ?Payment { return yield $this->persistenceActivity->loadFromDatabase($paymentId); } public function deletePayment(string $paymentId): void { yield $this->persistenceActivity->deleteFromDatabase($paymentId); }}</code>## üß™ <strong>Tests et Validation</strong>### <strong>Tests d&rsquo;Int√©gration Temporal</strong><code>php&lt;?phpnamespace App\Tests\Integration\Temporal;use App\Workflow\Payment\PaymentRequest;use App\Application\Service\Temporal\PaymentWorkflowService;use App\Infrastructure\Temporal\TemporalClientFactory;class TemporalPaymentWorkflowTest extends TestCase{ private PaymentWorkflowService $workflowService; private TemporalClientFactory $temporalFactory; protected function setUp(): void { $this->temporalFactory = new TemporalClientFactory('localhost', 7233, 'test'); $this->workflowService = new PaymentWorkflowService( $this->temporalFactory->createClient(), $this->createMock(LoggerInterface::class) ); } public function testPaymentWorkflowExecution(): void { $request = new PaymentRequest( 'payment-123', 'org-456', 'user-789', 100.00, 'EUR', 'Test payment' ); $result = $this->workflowService->processPayment($request); $this->assertTrue($result->isSuccess()); $this->assertEquals('Payment processed successfully', $result->getMessage()); } public function testWorkflowStatus(): void { $request = new PaymentRequest( 'payment-456', 'org-789', 'user-123', 200.00, 'USD', 'Test payment 2' ); $this->workflowService->processPayment($request); $status = $this->workflowService->getWorkflowStatus('payment-payment-456'); $this->assertArrayHasKey('workflowId', $status); $this->assertArrayHasKey('status', $status); $this->assertArrayHasKey('isCompleted', $status); }}</code>## üìä <strong>Performance et Optimisation</strong>### <strong>Strat√©gies d&rsquo;Optimisation Temporal</strong>#### <strong>1. Configuration des Timeouts</strong><code>phppublic function createOptimizedWorkflowOptions(): WorkflowOptions{ return WorkflowOptions::new() ->withWorkflowId('payment-workflow-' . uniqid()) ->withWorkflowExecutionTimeout(600) // 10 minutes ->withWorkflowRunTimeout(600) ->withWorkflowTaskTimeout(120) ->withRetryOptions([ 'initialInterval' => '1s', 'maximumInterval' => '60s', 'backoffCoefficient' => 2.0, 'maximumAttempts' => 3 ]);}</code>#### <strong>2. Cache des Workflows</strong><code>phppublic function getWorkflowWithCache(string $workflowId): PaymentWorkflowInterface{ if (isset($this->workflowCache[$workflowId])) { return $this->workflowCache[$workflowId]; } $workflow = $this->workflowClient->newWorkflowStub( PaymentWorkflowInterface::class, $workflowId ); $this->workflowCache[$workflowId] = $workflow; return $workflow;}</code>#### <strong>3. Monitoring et Observabilit√©</strong><code>phppublic function getWorkflowMetrics(): array{ return [ 'activeWorkflows' => $this->getActiveWorkflowCount(), 'completedWorkflows' => $this->getCompletedWorkflowCount(), 'failedWorkflows' => $this->getFailedWorkflowCount(), 'averageExecutionTime' => $this->getAverageExecutionTime() ];}</code>## üéØ <strong>Crit√®res d&rsquo;Adoption</strong>### <strong>Quand Utiliser Temporal Classique</strong>#### <strong>‚úÖ Avantages</strong>- <strong>Durabilit√©</strong> : √âtat des workflows persist√© automatiquement- <strong>R√©silience</strong> : Reprise automatique apr√®s panne- <strong>Orchestration</strong> : Gestion complexe des processus m√©tier- <strong>Observabilit√©</strong> : Visibilit√© compl√®te sur l&rsquo;ex√©cution- <strong>Scalabilit√©</strong> : Ex√©cution distribu√©e des workflows#### <strong>‚ùå Inconv√©nients</strong>- <strong>Complexit√©</strong> : Courbe d&rsquo;apprentissage importante- <strong>Infrastructure</strong> : N√©cessite un serveur Temporal- <strong>Latence</strong> : Overhead pour les op√©rations simples- <strong>Expertise</strong> : √âquipe exp√©riment√©e requise#### <strong>üéØ Crit√®res d&rsquo;Adoption</strong>- <strong>Processus m√©tier complexes</strong> : Workflows qui n√©cessitent de l&rsquo;orchestration- <strong>R√©silience critique</strong> : Besoin de reprise automatique apr√®s panne- <strong>Processus longs</strong> : Workflows qui s&rsquo;√©talent sur plusieurs jours- <strong>Int√©grations multiples</strong> : Orchestration de plusieurs services- <strong>√âquipe exp√©riment√©e</strong> : Ma√Ætrise de Temporal et des workflows- <strong>Infrastructure disponible</strong> : Serveur Temporal op√©rationnel## üöÄ <strong>Votre Prochaine √âtape</strong><div class=chapter-navigation><h2 class=chapter-nav-title>üéØ Votre Prochaine √âtape</h2><p class=chapter-nav-subtitle>Maintenant que vous comprenez les concepts de base et que j'ai partag√© mon exp√©rience avec Gyroscops, quel est votre contexte ?</p><div class=chapter-options><div class=chapter-option data-color=green data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>A</div><div><h3 class=chapter-option-title>Je veux voir l'approche CQS avec Temporal</h3><p class=chapter-option-subtitle>Vous voulez comprendre la s√©paration des responsabilit√©s avec Temporal</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>Performance critique</li><li>√âquipe exp√©riment√©e</li><li>Architecture complexe</li><li>Scalabilit√©</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 40-50 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Stockage Temporal - CQS
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=yellow data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>B</div><div><h3 class=chapter-option-title>Je veux explorer les autres types de stockage</h3><p class=chapter-option-subtitle>Vous voulez voir les alternatives √† Temporal</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>Comparaison n√©cessaire</li><li>Choix de stockage</li><li>Architecture √† d√©finir</li><li>Performance √† optimiser</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 30-40 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Choix du Type de Stockage
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=blue><div class=chapter-option-header><div class=chapter-option-letter>C</div><div><h3 class=chapter-option-title>Je veux voir des exemples concrets</h3><p class=chapter-option-subtitle>Vous voulez comprendre les impl√©mentations pratiques</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>D√©veloppeur exp√©riment√©</li><li>Besoin d'exemples pratiques</li><li>Impl√©mentation √† faire</li><li>Code √† √©crire</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è Variable</span>
<a href=/examples/ class=chapter-option-link>Exemples et Impl√©mentations</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=purple><div class=chapter-option-header><div class=chapter-option-letter>D</div><div><h3 class=chapter-option-title>Je veux revenir aux fondamentaux</h3><p class=chapter-option-subtitle>Vous voulez comprendre les concepts de base</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>D√©veloppeur d√©butant</li><li>Besoin de comprendre les concepts</li><li>Projet √† structurer</li><li>√âquipe √† former</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 45-60 minutes</span>
<a href=/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/ class=chapter-option-link>Introduction au Domain-Driven Design et Event Storming</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style></div></div><style>.chapter-navigation{margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;border-left:4px solid #3b82f6}.chapter-nav-title{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:#1e293b}.chapter-nav-subtitle{margin:0 0 1.5rem;color:#64748b;font-size:1rem;line-height:1.6}.chapter-options{display:flex;flex-direction:column;gap:1rem}.chapter-option{background:#fff;border-radius:8px;padding:1.25rem;border:1px solid #e2e8f0;transition:all .2s ease;position:relative;overflow:hidden}.chapter-option:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#3b82f6}.chapter-option::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--option-color,#6b7280);border-radius:0 2px 2px 0}.chapter-option-header{display:flex;align-items:center;margin-bottom:.75rem}.chapter-option-letter{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:50%;background:var(--option-color,#6b7280);color:#fff;font-weight:700;font-size:.875rem;margin-right:.75rem;flex-shrink:0}.chapter-option-title{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0;line-height:1.4}.chapter-option-subtitle{font-size:.875rem;color:#64748b;font-style:italic;margin:.25rem 0 0;line-height:1.4}.chapter-option-content{margin-left:2.75rem}.chapter-option-criteria{margin-bottom:.75rem}.chapter-option-criteria-title{font-size:.875rem;font-weight:600;color:#374151;margin:0 0 .5rem}.chapter-option-criteria-list{list-style:none;padding:0;margin:0}.chapter-option-criteria-list li{position:relative;padding-left:1.25rem;margin-bottom:.25rem;font-size:.875rem;color:#4b5563;line-height:1.4}.chapter-option-criteria-list li::before{content:'‚úì';position:absolute;left:0;color:#10b981;font-weight:600}.chapter-option-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1rem;padding-top:.75rem;border-top:1px solid #e5e7eb}.chapter-option-time{font-size:.875rem;color:#6b7280;font-weight:500}.chapter-option-link{display:inline-flex;align-items:center;padding:.5rem 1rem;background:var(--option-color,#6b7280);color:#fff!important;text-decoration:none!important;border-radius:6px;font-weight:600;font-size:.875rem;transition:all .2s ease;border:none;cursor:pointer}.chapter-option-link:hover{background:var(--option-color-dark,#4b5563);color:#fff!important;text-decoration:none!important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.chapter-option-link:visited{color:#fff!important;text-decoration:none!important}.chapter-option-link:focus{color:#fff!important;text-decoration:none!important;outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.chapter-option-link:active{color:#fff!important;text-decoration:none!important}.chapter-option-link::after{content:'‚Üí';margin-left:.5rem;transition:transform .2s ease;color:#fff!important}.chapter-option-link:hover::after{transform:translateX(2px);color:#fff!important}.chapter-navigation a{color:inherit;text-decoration:none}.chapter-navigation a:hover{color:inherit;text-decoration:none}.chapter-navigation a:visited{color:inherit;text-decoration:none}.chapter-navigation a:focus{color:inherit;text-decoration:none}.chapter-navigation a:active{color:inherit;text-decoration:none}.chapter-option[data-color=green]{--option-color:#10b981;--option-color-dark:#059669}.chapter-option[data-color=yellow]{--option-color:#f59e0b;--option-color-dark:#d97706}.chapter-option[data-color=red]{--option-color:#ef4444;--option-color-dark:#dc2626}.chapter-option[data-color=blue]{--option-color:#3b82f6;--option-color-dark:#2563eb}.chapter-option[data-color=purple]{--option-color:#8b5cf6;--option-color-dark:#7c3aed}.chapter-option[data-color=orange]{--option-color:#f97316;--option-color-dark:#ea580c}.chapter-option[data-color=teal]{--option-color:#14b8a6;--option-color-dark:#0d9488}.chapter-option[data-color=indigo]{--option-color:#6366f1;--option-color-dark:#4f46e5}.chapter-option[data-color=pink]{--option-color:#ec4899;--option-color-dark:#db2777}.chapter-option[data-color=cyan]{--option-color:#06b6d4;--option-color-dark:#0891b2}@media(max-width:768px){.chapter-navigation{padding:1rem}.chapter-option{padding:1rem}.chapter-option-content{margin-left:2.5rem}.chapter-option-footer{flex-direction:column;align-items:flex-start;gap:.75rem}.chapter-option-link{align-self:stretch;justify-content:center}}</style>&mdash;<em>Temporal classique offre une approche puissante pour l&rsquo;orchestration de processus m√©tier complexes, parfaitement adapt√©e aux besoins de workflows de Gyroscops.</em> <a href=#-contexte-et-objectifs-pourquoi-temporal-pour-le-stockage-temporal-workflows-offre-une-approche-unique-pour-le-stockage-en-g%c3%a9rant-l%c3%a9tat-des-processus-m%c3%a9tier-complexes-de-mani%c3%a8re-durable-et-r%c3%a9siliente-cette-approche-est-particuli%c3%a8rement-adapt%c3%a9e-aux-workflows-qui-n%c3%a9cessitent-de-la-persistance-de-la-reprise-sur-panne-et-de-lorchestration-avantages-du-stockage-temporal--durabilit%c3%a9--%c3%a9tat-des-workflows-persist%c3%a9-automatiquement--r%c3%a9silience--reprise-automatique-apr%c3%a8s-panne--orchestration--gestion-complexe-des-processus-m%c3%a9tier--observabilit%c3%a9--visibilit%c3%a9-compl%c3%a8te-sur-lex%c3%a9cution--scalabilit%c3%a9--ex%c3%a9cution-distribu%c3%a9e-des-workflows-contexte-gyroscopsdans-notre-%c3%a9cosyst%c3%a8me-user--organization--workflow--cloud-resources--billing-temporal-est-particuli%c3%a8rement-pertinent-pour---workflows-de-provisioning--orchestration-des-ressources-cloud--processus-de-facturation--gestion-des-cycles-de-facturation--int%c3%a9grations-complexes--orchestration-des-int%c3%a9grations-api--processus-m%c3%a9tier-longs--workflows-qui-s%c3%a9talent-sur-plusieurs-jours--architecture-temporal-classique-structure-des-workflows-workflow-de-basephpphpnamespace-appworkflowpaymentuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowworkflowinterfaceinterface-paymentworkflowinterface----workflowmethod----public-function-processpaymentpaymentrequest-request-paymentresultactivityinterfaceinterface-paymentactivityinterface----activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult--------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult--------activitymethod----public-function-sendnotificationpaymentresult-result-voidclass-paymentworkflow-implements-paymentworkflowinterface----private-paymentactivityinterface-paymentactivity----public-function-__construct------------this-paymentactivity--workflownewactivitystubpaymentactivityinterfaceclass--------public-function-processpaymentpaymentrequest-request-paymentresult-------------validation-du-paiement--------validation--yield-this-paymentactivity-validatepaymentrequest----------------if-validation-isvalid-------------return-new-paymentresultfalse-validation-geterror-------------------------traitement-du-paiement--------charge--yield-this-paymentactivity-chargepaymentrequest----------------if-charge-issuccess-------------return-new-paymentresultfalse-charge-geterror-------------------------notification--------yield-this-paymentactivity-sendnotification------------new-paymentresulttrue-payment-processed-successfully------------------------return-new-paymentresulttrue-payment-processed-successfully-----activit%c3%a9s-de-persistancephpphpnamespace-appworkflowpaymentuse-temporalactivityactivityinterfaceuse-temporalactivityactivitymethoduse-appdomainpaymentpaymentrepositoryinterfaceuse-appdomainpaymentpaymentuse-psrlogloggerinterfaceclass-paymentactivity-implements-paymentactivityinterface----private-paymentrepositoryinterface-paymentrepository----private-loggerinterface-logger----public-function-__construct--------paymentrepositoryinterface-paymentrepository--------loggerinterface-logger-------------this-paymentrepository--paymentrepository--------this-logger--logger--------activitymethod----public-function-validatepaymentpaymentrequest-request-validationresult------------try-------------this-logger-infovalidating-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------validation-m%c3%a9tier------------if-request-getamount--0-----------------return-new-validationresultfalse-invalid-amount------------------------------------if-emptyrequest-getcurrency-----------------return-new-validationresultfalse-currency-required-------------------------------------v%c3%a9rification-de-lorganisation------------if-this-paymentrepository-organizationexistsrequest-getorganizationid-----------------return-new-validationresultfalse-organization-not-found------------------------------------return-new-validationresulttrue---------------------catch-exception-e-------------this-logger-errorpayment-validation-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-validationresultfalse-e-getmessage----------------activitymethod----public-function-chargepaymentpaymentrequest-request-chargeresult------------try-------------this-logger-infocharging-payment-----------------paymentid--request-getpaymentid----------------amount--request-getamount-------------------------------------cr%c3%a9er-le-paiement------------payment--new-payment----------------request-getpaymentid----------------request-getorganizationid----------------request-getuserid----------------request-getamount----------------request-getcurrency----------------processing----------------request-getdescription----------------new-datetime-------------------------------------sauvegarder-le-paiement------------this-paymentrepository-savepayment-------------------------simuler-le-traitement-du-paiement-------------dans-un-vrai-syst%c3%a8me-ceci-appellerait-un-service-de-paiement------------this-simulatepaymentprocessingrequest-------------------------mettre-%c3%a0-jour-le-statut------------payment-markascompleted------------this-paymentrepository-savepayment------------------------return-new-chargeresulttrue-payment-charged-successfully---------------------catch-exception-e-------------this-logger-errorpayment-charging-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------------------return-new-chargeresultfalse-e-getmessage----------------activitymethod----public-function-sendnotificationpaymentresult-result-void------------try-------------this-logger-infosending-payment-notification-----------------success--result-issuccess----------------message--result-getmessage-------------------------------------envoyer-une-notification-email-webhook-etc------------this-sendemailnotificationresult------------this-sendwebhooknotificationresult---------------------catch-exception-e-------------this-logger-errornotification-sending-failed-----------------error--e-getmessage----------------------------private-function-simulatepaymentprocessingpaymentrequest-request-void-------------simuler-un-d%c3%a9lai-de-traitement--------sleep2-----------------simuler-une-%c3%a9chec-al%c3%a9atoire-5-de-chance--------if-rand1-100--5-------------throw-new-exceptionpayment-processing-failed----------------private-function-sendemailnotificationpaymentresult-result-void-------------impl%c3%a9mentation-de-lenvoi-demail--------private-function-sendwebhooknotificationpaymentresult-result-void-------------impl%c3%a9mentation-de-lenvoi-de-webhook-----flux-de-donn%c3%a9esmermaidgraph-td----aclient-request----btemporal-client----b----cworkflow-execution----c----dactivity-1-validation----d----eactivity-2-charging----e----factivity-3-notification----f----gworkflow-complete--------hpersistence-layer----ipayment-repository----i----jdatabase--------c----h----d----h----e----h----f----h--------ktemporal-server----lworkflow-state----l----mactivity-state----m----nevent-history--impl%c3%a9mentation-pratique-1-configuration-temporal-configuration-du-clientphpphpnamespace-appinfrastructuretemporaluse-temporalclientworkflowclientuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-temporaldataconverterdataconverteruse-temporaldataconverterjsondataconverterclass-temporalclientfactory----private-string-host----private-int-port----private-string-namespace----public-function-__constructstring-host--localhost-int-port--7233-string-namespace--default------------this-host--host--------this-port--port--------this-namespace--namespace--------public-function-createclient-workflowclientinterface------------dataconverter--new-dataconverter------------new-jsondataconverter----------------return-workflowclientcreate------------this-host----this-port----------------------------namespace--this-namespace----------------dataconverter--dataconverter----------------------------public-function-createworkflowoptions-workflowoptions------------return-workflowoptionsnew-------------withworkflowidpayment-workflow---uniqid-------------withworkflowexecutiontimeout300--5-minutes-------------withworkflowruntimeout300-------------withworkflowtasktimeout60-----service-de-workflowphpphpnamespace-appapplicationservicetemporaluse-appworkflowpaymentpaymentworkflowinterfaceuse-appworkflowpaymentpaymentrequestuse-appworkflowpaymentpaymentresultuse-temporalclientworkflowclientinterfaceuse-temporalclientworkflowoptionsuse-psrlogloggerinterfaceclass-paymentworkflowservice----private-workflowclientinterface-workflowclient----private-loggerinterface-logger----public-function-__construct--------workflowclientinterface-workflowclient--------loggerinterface-logger-------------this-workflowclient--workflowclient--------this-logger--logger--------public-function-processpaymentpaymentrequest-request-paymentresult------------try-------------this-logger-infostarting-payment-workflow-----------------paymentid--request-getpaymentid----------------amount--request-getamount------------------------workflowoptions--workflowoptionsnew-----------------withworkflowidpayment---request-getpaymentid-----------------withworkflowexecutiontimeout300-----------------withworkflowruntimeout300-----------------withworkflowtasktimeout60------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowoptions------------------------result--workflow-processpaymentrequest------------this-logger-infopayment-workflow-completed-----------------paymentid--request-getpaymentid----------------success--result-issuccess------------------------return-result---------catch-exception-e-------------this-logger-errorpayment-workflow-failed-----------------paymentid--request-getpaymentid----------------error--e-getmessage------------------------throw-e----------------public-function-getworkflowstatusstring-workflowid-array------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------status--workflow-getstatus------------return-----------------workflowid--workflowid----------------status--status----------------isrunning--status--running----------------iscompleted--status--completed----------------isfailed--status--failed---------------------catch-exception-e-------------this-logger-errorfailed-to-get-workflow-status-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e----------------public-function-cancelworkflowstring-workflowid-void------------try-------------workflow--this-workflowclient-newworkflowstub----------------paymentworkflowinterfaceclass----------------workflowid------------------------workflow-cancel------------this-logger-infoworkflow-cancelled-----------------workflowid--workflowid---------------------catch-exception-e-------------this-logger-errorfailed-to-cancel-workflow-----------------workflowid--workflowid----------------error--e-getmessage------------------------throw-e-------------2-repository-temporal-repository-avec-persistance-temporalphpphpnamespace-appinfrastructuretemporalrepositoryuse-appdomainpaymentpaymentuse-appdomainpaymentpaymentrepositoryinterfaceuse-appinfrastructuretemporaltemporalclientfactoryuse-psrlogloggerinterfaceclass-temporalpaymentrepository-implements-paymentrepositoryinterface----private-temporalclientfactory-temporalfactory----private-loggerinterface-logger----private-array-cache------public-function-__construct--------temporalclientfactory-temporalfactory--------loggerinterface-logger-------------this-temporalfactory--temporalfactory--------this-logger--logger--------public-function-savepayment-payment-void------------try-------------workflowid--payment---payment-getid-------------------------cr%c3%a9er-un-workflow-de-persistance------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions-------------------------ex%c3%a9cuter-le-workflow-de-persistance------------workflow-persistpaymentpayment-------------------------mettre-en-cache------------this-cachepayment-getid--payment------------------------this-logger-infopayment-persisted-via-temporal-----------------paymentid--payment-getid----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-persist-payment-via-temporal-----------------paymentid--payment-getid----------------error--e-getmessage------------------------------------throw-e----------------public-function-findbyidstring-id-payment-------------v%c3%a9rifier-le-cache-dabord--------if-issetthis-cacheid-------------return-this-cacheid------------------------try-------------workflowid--payment---id-------------------------r%c3%a9cup%c3%a9rer-depuis-temporal------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowid------------------------payment--workflow-getpaymentid------------------------if-payment-----------------this-cacheid--payment------------------------------------return-payment---------------------catch-exception-e-------------this-logger-errorfailed-to-retrieve-payment-from-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------return-null----------------public-function-findbyorganizationstring-organizationid-array------------try-------------workflowid--payment-search---organizationid-----uniqid-------------------------cr%c3%a9er-un-workflow-de-recherche------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------payments--workflow-searchbyorganizationorganizationid-------------------------mettre-en-cache------------foreach-payments-as-payment-----------------this-cachepayment-getid--payment------------------------------------return-payments---------------------catch-exception-e-------------this-logger-errorfailed-to-search-payments-via-temporal-----------------organizationid--organizationid----------------error--e-getmessage------------------------------------return-----------------public-function-deletestring-id-void------------try-------------workflowid--payment-delete---id-------------------------cr%c3%a9er-un-workflow-de-suppression------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentpersistenceworkflowinterfaceclass-workflowoptions------------------------workflow-deletepaymentid-------------------------supprimer-du-cache------------unsetthis-cacheid------------------------this-logger-infopayment-deleted-via-temporal-----------------paymentid--id----------------workflowid--workflowid---------------------------------catch-exception-e-------------this-logger-errorfailed-to-delete-payment-via-temporal-----------------paymentid--id----------------error--e-getmessage------------------------------------throw-e----------------public-function-count-int------------try-------------workflowid--payment-count---uniqid-------------------------cr%c3%a9er-un-workflow-de-comptage------------workflowoptions--this-temporalfactory-createworkflowoptions-----------------withworkflowidworkflowid------------------------workflow--this-temporalfactory-createclient-----------------newworkflowstubpaymentsearchworkflowinterfaceclass-workflowoptions------------------------return-workflow-getpaymentcount---------------------catch-exception-e-------------this-logger-errorfailed-to-count-payments-via-temporal-----------------error--e-getmessage------------------------------------return-0-------------3-workflows-de-persistance-workflow-de-persistance-des-paiementsphpphpnamespace-appworkflowpersistenceuse-temporalworkflowworkflowinterfaceuse-temporalworkflowworkflowmethoduse-temporalworkflowactivityinterfaceuse-temporalworkflowactivitymethoduse-temporalworkflowworkflowuse-appdomainpaymentpaymentworkflowinterfaceinterface-paymentpersistenceworkflowinterface----workflowmethod----public-function-persistpaymentpayment-payment-void--------workflowmethod----public-function-getpaymentstring-paymentid-payment--------workflowmethod----public-function-deletepaymentstring-paymentid-voidactivityinterfaceinterface-paymentpersistenceactivityinterface----activitymethod----public-function-savetodatabasepayment-payment-void--------activitymethod----public-function-loadfromdatabasestring-paymentid-payment--------activitymethod----public-function-deletefromdatabasestring-paymentid-voidclass-paymentpersistenceworkflow-implements-paymentpersistenceworkflowinterface----private-paymentpersistenceactivityinterface-persistenceactivity----public-function-__construct------------this-persistenceactivity--workflownewactivitystubpaymentpersistenceactivityinterfaceclass--------public-function-persistpaymentpayment-payment-void------------yield-this-persistenceactivity-savetodatabasepayment--------public-function-getpaymentstring-paymentid-payment------------return-yield-this-persistenceactivity-loadfromdatabasepaymentid--------public-function-deletepaymentstring-paymentid-void------------yield-this-persistenceactivity-deletefromdatabasepaymentid------tests-et-validation-tests-dphpphpnamespace-apptestsintegrationtemporaluse-appworkflowpaymentpaymentrequestuse-appapplicationservicetemporalpaymentworkflowserviceuse-appinfrastructuretemporaltemporalclientfactoryclass-temporalpaymentworkflowtest-extends-testcase----private-paymentworkflowservice-workflowservice----private-temporalclientfactory-temporalfactory----protected-function-setup-void------------this-temporalfactory--new-temporalclientfactorylocalhost-7233-test--------this-workflowservice--new-paymentworkflowservice------------this-temporalfactory-createclient------------this-createmockloggerinterfaceclass----------------public-function-testpaymentworkflowexecution-void------------request--new-paymentrequest------------payment-123------------org-456------------user-789------------10000------------eur------------test-payment------------------------result--this-workflowservice-processpaymentrequest----------------this-asserttrueresult-issuccess--------this-assertequalspayment-processed-successfully-result-getmessage--------public-function-testworkflowstatus-void------------request--new-paymentrequest------------payment-456------------org-789------------user-123------------20000------------usd------------test-payment-2------------------------this-workflowservice-processpaymentrequest----------------status--this-workflowservice-getworkflowstatuspayment-payment-456----------------this-assertarrayhaskeyworkflowid-status--------this-assertarrayhaskeystatus-status--------this-assertarrayhaskeyiscompleted-status------performance-et-optimisation-strat%c3%a9gies-d-1-configuration-des-timeoutsphppublic-function-createoptimizedworkflowoptions-workflowoptions----return-workflowoptionsnew---------withworkflowidpayment-workflow---uniqid---------withworkflowexecutiontimeout600--10-minutes---------withworkflowruntimeout600---------withworkflowtasktimeout120---------withretryoptions------------initialinterval--1s------------maximuminterval--60s------------backoffcoefficient--20------------maximumattempts--3---------2-cache-des-workflowsphppublic-function-getworkflowwithcachestring-workflowid-paymentworkflowinterface----if-issetthis-workflowcacheworkflowid---------return-this-workflowcacheworkflowid------------workflow--this-workflowclient-newworkflowstub--------paymentworkflowinterfaceclass--------workflowid------------this-workflowcacheworkflowid--workflow--------return-workflow-3-monitoring-et-observabilit%c3%a9phppublic-function-getworkflowmetrics-array----return---------activeworkflows--this-getactiveworkflowcount--------completedworkflows--this-getcompletedworkflowcount--------failedworkflows--this-getfailedworkflowcount--------averageexecutiontime--this-getaverageexecutiontime------crit%c3%a8res-d-quand-utiliser-temporal-classique--avantages--durabilit%c3%a9--%c3%a9tat-des-workflows-persist%c3%a9-automatiquement--r%c3%a9silience--reprise-automatique-apr%c3%a8s-panne--orchestration--gestion-complexe-des-processus-m%c3%a9tier--observabilit%c3%a9--visibilit%c3%a9-compl%c3%a8te-sur-lex%c3%a9cution--scalabilit%c3%a9--ex%c3%a9cution-distribu%c3%a9e-des-workflows--inconv%c3%a9nients--complexit%c3%a9--courbe-dapprentissage-importante--infrastructure--n%c3%a9cessite-un-serveur-temporal--latence--overhead-pour-les-op%c3%a9rations-simples--expertise--%c3%a9quipe-exp%c3%a9riment%c3%a9e-requise--crit%c3%a8res-d--processus-m%c3%a9tier-complexes--workflows-qui-n%c3%a9cessitent-de-lorchestration--r%c3%a9silience-critique--besoin-de-reprise-automatique-apr%c3%a8s-panne--processus-longs--workflows-qui-s%c3%a9talent-sur-plusieurs-jours--int%c3%a9grations-multiples--orchestration-de-plusieurs-services--%c3%a9quipe-exp%c3%a9riment%c3%a9e--ma%c3%aetrise-de-temporal-et-des-workflows--infrastructure-disponible--serveur-temporal-op%c3%a9rationnel--votre-prochaine-%c3%a9tapehahahugoshortcode77s0hbhbtemporal-classique-offre-une-approche-puissante-pour-l class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap"><div class="col-sm-6 pt-2 doc-next"><a href=/chapitres/stockage/in-memory/chapitre-45-stockage-in-memory-event-sourcing-cqrs/><div class="card h-100 my-1"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0"><i class="material-icons align-middle">navigate_before</i> Stockage In-Memory - Event Sourcing + CQRS</p></div></div></a></div><div class="col-sm-6 pt-2 doc-prev"><a class=ms-auto href=/chapitres/stockage/temporal/chapitre-47-stockage-temporal-cqs/><div class="card h-100 my-1 text-end"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0">Stockage Temporal - CQS <i class="material-icons align-middle">navigate_next</i></p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>¬© 2025 Gr√©gory Planchat. Tous droits r√©serv√©s.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci √† nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-2"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Kiboko</span></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Gyroscops</span></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.js defer></script><script type=text/javascript src=http://localhost:1313/docs/js/bundle.js defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>