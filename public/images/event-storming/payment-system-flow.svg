<svg viewBox="0 0 2000 1400" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto; background-color: #f8f9fa;">
  <!-- Titre -->
  <text x="1000" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Tableau Event Storming - Système de Paiement
  </text>
  
  <!-- Légende -->
  <g transform="translate(50, 50)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2c3e50">Légende :</text>
    
    <rect x="0" y="8" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="35" y="48" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Événement</text>
    
    <rect x="80" y="8" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="115" y="48" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Commande</text>
    
    <rect x="160" y="8" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="195" y="48" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Agrégat</text>
    
    <rect x="240" y="8" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="260" y="32" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#2c3e50" font-weight="bold">Acteur</text>
    
    <rect x="290" y="8" width="70" height="70" rx="2" fill="#90EE90" stroke="#7BC87A" stroke-width="2" filter="url(#shadow)"/>
    <text x="325" y="48" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Données</text>
    
    <rect x="370" y="8" width="70" height="70" rx="2" fill="#FFB6C1" stroke="#FF8FA3" stroke-width="2" filter="url(#shadow)"/>
    <text x="405" y="48" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Syst. Ext.</text>
    
    <rect x="450" y="8" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="485" y="48" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Règle</text>
  </g>
  
  <!-- Ligne de temps -->
  <line x1="50" y1="170" x2="1950" y2="170" stroke="#CBD5E0" stroke-width="2" stroke-dasharray="8,4"/>
  <text x="1000" y="163" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#718096" font-style="italic">
    ← Flux temporel : de gauche à droite →
  </text>
  
  <!-- NIVEAU TEMPOREL 0 : ProcessPayment → PaymentRequested (Point de départ) -->
  <g transform="translate(80, 220)">
    <!-- Read Model (Données) - carré -->
    <rect x="0" y="0" width="70" height="70" rx="2" fill="#90EE90" stroke="#7BC87A" stroke-width="2" filter="url(#shadow)"/>
    <text x="35" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Panier</text>
    <text x="35" y="47" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#2c3e50">Items</text>
    <text x="35" y="58" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#2c3e50">Total</text>
    
    <!-- Acteur (à droite des read models, centré verticalement) -->
    <rect x="85" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="105" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Customer</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="140" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Process</text>
    <text x="175" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, aligné en haut) -->
    <rect x="225" y="-37.5" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="1.5" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Événement - carré (centre) -->
    <rect x="310" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="345" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="345" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Requested</text>
    
    <!-- Règle métier - carré (à droite de l'événement) -->
    <rect x="395" y="0" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="430" y="30" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Montant</text>
    <text x="430" y="43" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">&gt; 0</text>
    <text x="430" y="56" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#fff">Pending</text>
  </g>
  
  <!-- NIVEAU TEMPOREL 1 : Chemins alternatifs après PaymentRequested -->
  
  <!-- 1A: ValidatePayment → PaymentValidated (succès) -->
  <g transform="translate(600, 220)">
    <!-- Acteur (à gauche, centré verticalement) -->
    <rect x="0" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="20" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">System</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="55" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Validate</text>
    <text x="90" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, en haut) -->
    <rect x="140" y="-37.5" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="1.5" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Système Externe - carré (à gauche de l'événement, en bas) -->
    <rect x="140" y="37.5" width="70" height="70" rx="2" fill="#FFB6C1" stroke="#FF8FA3" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="67.5" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    <text x="175" y="81.5" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Gateway</text>
    
    <!-- Événement - carré (centre) -->
    <rect x="225" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="260" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Validated</text>
  </g>
  
  <!-- 1B: PaymentRejected (refus par passerelle) -->
  <g transform="translate(600, 390)">
    <!-- Acteur (Payment Gateway agissant automatiquement) -->
    <rect x="0" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="20" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Gateway</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="55" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Reject</text>
    <text x="90" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, en haut) -->
    <rect x="140" y="-37.5" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="1.5" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Système Externe - carré (à gauche de l'événement, en bas) -->
    <rect x="140" y="37.5" width="70" height="70" rx="2" fill="#FFB6C1" stroke="#FF8FA3" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="67.5" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    <text x="175" y="81.5" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Gateway</text>
    
    <!-- Événement - carré (orange, comme tous les événements) -->
    <rect x="225" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="260" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Rejected</text>
    
    <!-- Règle métier - carré -->
    <rect x="310" y="0" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="345" y="30" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Fonds</text>
    <text x="345" y="43" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">insuffisants</text>
  </g>
  
  <!-- 1C: AbandonPayment → PaymentAbandoned -->
  <g transform="translate(600, 560)">
    <!-- Acteur (à gauche, centré verticalement) -->
    <rect x="0" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="20" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Customer</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="55" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Abandon</text>
    <text x="90" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, centré verticalement) -->
    <rect x="140" y="0" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="39" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Événement - carré (orange, comme tous les événements) -->
    <rect x="225" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="260" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Abandoned</text>
    
    <!-- Règle métier - carré -->
    <rect x="310" y="0" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="345" y="30" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Timeout</text>
    <text x="345" y="43" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">ou</text>
    <text x="345" y="56" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Annulation</text>
  </g>
  
  <!-- 1D: CancelPayment → PaymentCancelled (annulation précoce) -->
  <g transform="translate(600, 730)">
    <!-- Acteur (à gauche, centré verticalement) -->
    <rect x="0" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="20" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Admin</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="55" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Cancel</text>
    <text x="90" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, centré verticalement) -->
    <rect x="140" y="0" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="39" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Événement - carré (orange, comme tous les événements) -->
    <rect x="225" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="260" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Cancelled</text>
    
    <!-- Règle métier - carré -->
    <rect x="310" y="0" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="345" y="30" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Avant</text>
    <text x="345" y="43" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">capture</text>
  </g>
  
  <!-- NIVEAU TEMPOREL 2 : Après PaymentValidated -->
  
  <!-- 2A: CapturePayment → PaymentCaptured -->
  <g transform="translate(1010, 220)">
    <!-- Read Models multiples (alignés verticalement) -->
    <rect x="0" y="0" width="70" height="70" rx="2" fill="#90EE90" stroke="#7BC87A" stroke-width="2" filter="url(#shadow)"/>
    <text x="35" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Account</text>
    <text x="35" y="47" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#2c3e50">Balance</text>
    
    <rect x="0" y="80" width="70" height="70" rx="2" fill="#90EE90" stroke="#7BC87A" stroke-width="2" filter="url(#shadow)"/>
    <text x="35" y="113" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Order</text>
    <text x="35" y="127" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#2c3e50">Details</text>
    
    <!-- Acteur (à droite des read models, centré verticalement) -->
    <rect x="85" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="105" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">System</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="140" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Capture</text>
    <text x="175" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, en haut) -->
    <rect x="225" y="-37.5" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="1.5" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Système Externe - carré (à gauche de l'événement, en bas) -->
    <rect x="225" y="37.5" width="70" height="70" rx="2" fill="#FFB6C1" stroke="#FF8FA3" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="67.5" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    <text x="260" y="81.5" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2c3e50" font-weight="bold">Gateway</text>
    
    <!-- Événement - carré (centre) -->
    <rect x="310" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="345" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="345" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Captured</text>
    
    <!-- Règle métier - carré -->
    <rect x="395" y="0" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="430" y="30" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Funds</text>
    <text x="430" y="43" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Available</text>
  </g>
  
  <!-- NIVEAU TEMPOREL 3 : Après PaymentCaptured -->
  
  <!-- 3A: RefundPayment → PaymentRefunded -->
  <g transform="translate(1540, 220)">
    <!-- Acteur (à gauche, centré verticalement) -->
    <rect x="0" y="15" width="40" height="40" rx="2" fill="#FFEB99" stroke="#F0C14B" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="20" y="39" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2c3e50" font-weight="bold">Admin</text>
    
    <!-- Commande - carré (à droite de l'acteur) -->
    <rect x="55" y="0" width="70" height="70" rx="2" fill="#4A90E2" stroke="#3A7BC8" stroke-width="2" filter="url(#shadow)"/>
    <text x="90" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Refund</text>
    <text x="90" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    
    <!-- Agrégat - carré (à gauche de l'événement, centré verticalement) -->
    <rect x="140" y="0" width="70" height="70" rx="2" fill="#FFD166" stroke="#F0C14B" stroke-width="2" filter="url(#shadow)"/>
    <text x="175" y="39" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#2c3e50" font-weight="bold">Payment</text>
    
    <!-- Événement - carré (centre) -->
    <rect x="225" y="0" width="70" height="70" rx="2" fill="#FF8C42" stroke="#E67935" stroke-width="2" filter="url(#shadow)"/>
    <text x="260" y="33" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Payment</text>
    <text x="260" y="47" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#fff" font-weight="bold">Refunded</text>
    
    <!-- Règle métier - carré -->
    <rect x="310" y="0" width="70" height="70" rx="2" fill="#DDA0DD" stroke="#C97FC9" stroke-width="2" filter="url(#shadow)"/>
    <text x="345" y="30" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">Within</text>
    <text x="345" y="43" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#fff" font-weight="bold">30 days</text>
  </g>
  
  <!-- Définitions pour les effets et marqueurs -->
  <defs>
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.25"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#718096"/>
    </marker>
  </defs>
  
  <!-- Flèches avec courbes de Bézier -->
  
  <!-- De PaymentRequested (fin à x=460, y=255) vers ValidatePayment (début à x=655, y=255) -->
  <path d="M 460 255 C 520 255, 595 255, 655 255" 
        stroke="#718096" stroke-width="2" fill="none" 
        marker-end="url(#arrow)" stroke-dasharray="4,4"/>
  
  <!-- De PaymentRequested (x=460, y=255) vers PaymentRejected acteur Gateway (x=655, y=425) -->
  <path d="M 460 255 
           C 500 255, 520 280, 540 320
           C 570 370, 600 390, 640 410" 
        stroke="#718096" stroke-width="2" fill="none" 
        marker-end="url(#arrow)" stroke-dasharray="4,4"/>
  
  <!-- De PaymentRequested (x=460, y=255) vers AbandonPayment (x=655, y=595) -->
  <path d="M 460 255 
           C 490 255, 500 300, 500 360
           C 500 480, 530 540, 605 580" 
        stroke="#718096" stroke-width="2" fill="none" 
        marker-end="url(#arrow)" stroke-dasharray="4,4"/>
  
  <!-- De PaymentRequested (x=460, y=255) vers CancelPayment (x=655, y=765) -->
  <path d="M 460 255 
           C 490 255, 495 320, 490 420
           C 485 580, 510 680, 595 750" 
        stroke="#718096" stroke-width="2" fill="none" 
        marker-end="url(#arrow)" stroke-dasharray="4,4"/>
  
  <!-- De PaymentValidated (fin à x=895, y=255) vers CapturePayment (début à x=1150, y=255) -->
  <path d="M 895 255 C 980 255, 1070 255, 1150 255" 
        stroke="#718096" stroke-width="2" fill="none" 
        marker-end="url(#arrow)" stroke-dasharray="4,4"/>
  
  <!-- De PaymentCaptured (fin à x=1390, y=255) vers RefundPayment (début à x=1595, y=255) -->
  <path d="M 1390 255 C 1460 255, 1535 255, 1595 255" 
        stroke="#718096" stroke-width="2" fill="none" 
        marker-end="url(#arrow)" stroke-dasharray="4,4"/>
  
  <!-- Annotations -->
  <g transform="translate(100, 900)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      Organisation temporelle Event Storming :
    </text>
    <text x="0" y="25" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Le temps se modélise HORIZONTALEMENT de gauche à droite
    </text>
    <text x="0" y="45" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Les groupes qui se suivent temporellement sont placés de gauche à droite
    </text>
    <text x="0" y="65" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Les groupes qui peuvent survenir en parallèle sont répartis VERTICALEMENT au même niveau horizontal
    </text>
    <text x="0" y="85" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Un groupe ne peut jamais être à droite d'un autre qu'il ne peut pas suivre temporellement
    </text>
    <text x="0" y="120" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
      Flux du système de paiement :
    </text>
    <text x="0" y="145" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • <tspan font-weight="bold" fill="#FF8C42">Niveau 0</tspan> : ProcessPayment → PaymentRequested (point de départ)
    </text>
    <text x="0" y="165" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • <tspan font-weight="bold" fill="#FF8C42">Niveau 1</tspan> : 4 chemins parallèles possibles (Validated, Rejected, Abandoned, Cancelled)
    </text>
    <text x="0" y="185" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • <tspan font-weight="bold" fill="#FF8C42">Niveau 2</tspan> : CapturePayment → PaymentCaptured (après validation)
    </text>
    <text x="0" y="205" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • <tspan font-weight="bold" fill="#FF8C42">Niveau 3</tspan> : RefundPayment → PaymentRefunded (après capture)
    </text>
    <text x="0" y="240" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
      Ordre des post-its dans chaque groupe (de gauche à droite) :
    </text>
    <text x="0" y="265" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Read Models (vert clair) - données nécessaires à la décision
    </text>
    <text x="0" y="285" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Acteur (jaune clair, 40×40 px) - qui déclenche la commande
    </text>
    <text x="0" y="305" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Commande (bleu, 70×70 px) - action à exécuter
    </text>
    <text x="0" y="325" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Agrégat (jaune, 70×70 px) et Système Externe (rose, 70×70 px) - à gauche de l'événement
    </text>
    <text x="0" y="345" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Événement (orange, 70×70 px) - ce qui s'est passé (centre du groupe)
    </text>
    <text x="0" y="365" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Règle métier (violet, 70×70 px) - contraintes et règles
    </text>
    <text x="0" y="385" font-family="Arial, sans-serif" font-size="11" fill="#555">
      • Événements : Toujours <tspan fill="#FF8C42" font-weight="bold">orange</tspan> (quelque soit le contexte : succès, échec, abandon, etc.)
    </text>
    <text x="0" y="415" font-family="Arial, sans-serif" font-size="10" fill="#718096" font-style="italic">
      Source : https://jordanchapuy.com/posts/2021/10/une-introduction-a-levent-storming/
    </text>
  </g>
</svg>
