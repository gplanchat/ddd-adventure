<!doctype html><html lang=fr-fr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><title>Stockage SQL CQRS - Exemple Concret | DDD Adventure</title><meta name=robots content="noindex"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ImplÃ©mentation concrÃ¨te du pattern CQRS (Command Query Responsibility Segregation) avec Doctrine"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=//localhost:1313/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=//localhost:1313/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=//localhost:1313/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=//localhost:1313/site.webmanifest><meta property="og:title" content="Stockage SQL CQRS - Exemple Concret"><meta property="og:description" content="ImplÃ©mentation concrÃ¨te du pattern CQRS (Command Query Responsibility Segregation) avec Doctrine"><meta property="og:type" content="article"><meta property="og:url" content="//localhost:1313/examples/stockage-sql-cqrs/"><meta property="og:image" content="//localhost:1313/opengraph/card-base-2_hu_94a004c9b3c52a1c.png"><meta property="article:section" content="examples"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//localhost:1313/opengraph/card-base-2_hu_94a004c9b3c52a1c.png"><meta name=twitter:title content="Stockage SQL CQRS - Exemple Concret"><meta name=twitter:description content="ImplÃ©mentation concrÃ¨te du pattern CQRS (Command Query Responsibility Segregation) avec Doctrine"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=//localhost:1313/docs/js/flexsearch.bundle.js></script><link rel=stylesheet href=/docs/scss/style.css crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li><a class=sidebar-root-link href=//localhost:1313/examples/stockage-patterns/patterns-implementation/>Patterns d'ImplÃ©mentation pour le Stockage</a></li><li><a class=sidebar-root-link href=//localhost:1313/examples/stockage-sql-classique/>Stockage SQL Classique - Exemple Concret</a></li><li><a class=sidebar-root-link href=//localhost:1313/examples/stockage-patterns/vue-densemble/>Patterns de Stockage - Comparaison des Approches</a></li><li><a class=sidebar-root-link href=//localhost:1313/examples/stockage-sql-cqs/>Stockage SQL CQS - Exemple Concret</a></li><li class=current><a class=sidebar-root-link href=//localhost:1313/examples/stockage-sql-cqrs/>Stockage SQL CQRS - Exemple Concret</a></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/examples/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Stockage SQL CQRS - Exemple Concret</span>
<meta itemprop=position content='2'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-contexte-de-l>ğŸ¯ <strong>Contexte de lâ€™Exemple</strong></a><ul><li><a href=#domaine-mÃ©tier--gestion-des-paiements-avec-cqrs><strong>Domaine MÃ©tier : Gestion des Paiements avec CQRS</strong></a></li></ul></li><li><a href=#-structure-du-projet>ğŸ“ <strong>Structure du Projet</strong></a></li><li><a href=#-implÃ©mentation>ğŸ—ï¸ <strong>ImplÃ©mentation</strong></a><ul><li><a href=#1-entitÃ©-command-cÃ´tÃ©-Ã©criture><strong>1. EntitÃ© Command (CÃ´tÃ© Ã‰criture)</strong></a></li><li><a href=#2-entitÃ©-query-cÃ´tÃ©-lecture><strong>2. EntitÃ© Query (CÃ´tÃ© Lecture)</strong></a></li><li><a href=#3-interface-command-repository><strong>3. Interface Command Repository</strong></a></li><li><a href=#4-interface-query-repository><strong>4. Interface Query Repository</strong></a></li><li><a href=#5-implÃ©mentation-command-repository><strong>5. ImplÃ©mentation Command Repository</strong></a></li><li><a href=#6-implÃ©mentation-query-repository><strong>6. ImplÃ©mentation Query Repository</strong></a></li><li><a href=#7-event-handler-pour-la-synchronisation><strong>7. Event Handler pour la Synchronisation</strong></a></li></ul></li><li><a href=#-tests>ğŸ§ª <strong>Tests</strong></a><ul><li><a href=#test-command-repository><strong>Test Command Repository</strong></a></li></ul></li><li><a href=#-utilisation-dans-api-platform>ğŸš€ <strong>Utilisation dans API Platform</strong></a><ul><li><a href=#configuration-des-services><strong>Configuration des Services</strong></a></li><li><a href=#api-resource-avec-cqrs><strong>API Resource avec CQRS</strong></a></li></ul></li><li><a href=#-points-clÃ©s-de-cette-implÃ©mentation>ğŸ¯ <strong>Points ClÃ©s de cette ImplÃ©mentation</strong></a><ul><li><a href=#1-modÃ¨les-distincts><strong>1. ModÃ¨les Distincts</strong></a></li><li><a href=#2-performance-maximale><strong>2. Performance Maximale</strong></a></li><li><a href=#3-complexitÃ©-gÃ©rÃ©e><strong>3. ComplexitÃ© GÃ©rÃ©e</strong></a></li><li><a href=#4-synchronisation><strong>4. Synchronisation</strong></a></li></ul></li><li><a href=#-avantages-du-pattern-cqrs>ğŸ’¡ <strong>Avantages du Pattern CQRS</strong></a><ul><li><a href=#-performance-exceptionnelle><strong>âœ… Performance Exceptionnelle</strong></a></li><li><a href=#-scalabilitÃ©><strong>âœ… ScalabilitÃ©</strong></a></li><li><a href=#-flexibilitÃ©><strong>âœ… FlexibilitÃ©</strong></a></li><li><a href=#-complexitÃ©-maÃ®trisÃ©e><strong>âœ… ComplexitÃ© MaÃ®trisÃ©e</strong></a></li></ul></li><li><a href=#-inconvÃ©nients-du-pattern-cqrs>âš ï¸ <strong>InconvÃ©nients du Pattern CQRS</strong></a><ul><li><a href=#-complexitÃ©><strong>âŒ ComplexitÃ©</strong></a></li><li><a href=#-synchronisation><strong>âŒ Synchronisation</strong></a></li><li><a href=#-overhead><strong>âŒ Overhead</strong></a></li></ul></li><li><a href=#-votre-prochaine-Ã©tape>ğŸ¯ <strong>Votre Prochaine Ã‰tape</strong></a></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-contexte-de-l>ğŸ¯ <strong>Contexte de lâ€™Exemple</strong></a><ul><li><a href=#domaine-mÃ©tier--gestion-des-paiements-avec-cqrs><strong>Domaine MÃ©tier : Gestion des Paiements avec CQRS</strong></a></li></ul></li><li><a href=#-structure-du-projet>ğŸ“ <strong>Structure du Projet</strong></a></li><li><a href=#-implÃ©mentation>ğŸ—ï¸ <strong>ImplÃ©mentation</strong></a><ul><li><a href=#1-entitÃ©-command-cÃ´tÃ©-Ã©criture><strong>1. EntitÃ© Command (CÃ´tÃ© Ã‰criture)</strong></a></li><li><a href=#2-entitÃ©-query-cÃ´tÃ©-lecture><strong>2. EntitÃ© Query (CÃ´tÃ© Lecture)</strong></a></li><li><a href=#3-interface-command-repository><strong>3. Interface Command Repository</strong></a></li><li><a href=#4-interface-query-repository><strong>4. Interface Query Repository</strong></a></li><li><a href=#5-implÃ©mentation-command-repository><strong>5. ImplÃ©mentation Command Repository</strong></a></li><li><a href=#6-implÃ©mentation-query-repository><strong>6. ImplÃ©mentation Query Repository</strong></a></li><li><a href=#7-event-handler-pour-la-synchronisation><strong>7. Event Handler pour la Synchronisation</strong></a></li></ul></li><li><a href=#-tests>ğŸ§ª <strong>Tests</strong></a><ul><li><a href=#test-command-repository><strong>Test Command Repository</strong></a></li></ul></li><li><a href=#-utilisation-dans-api-platform>ğŸš€ <strong>Utilisation dans API Platform</strong></a><ul><li><a href=#configuration-des-services><strong>Configuration des Services</strong></a></li><li><a href=#api-resource-avec-cqrs><strong>API Resource avec CQRS</strong></a></li></ul></li><li><a href=#-points-clÃ©s-de-cette-implÃ©mentation>ğŸ¯ <strong>Points ClÃ©s de cette ImplÃ©mentation</strong></a><ul><li><a href=#1-modÃ¨les-distincts><strong>1. ModÃ¨les Distincts</strong></a></li><li><a href=#2-performance-maximale><strong>2. Performance Maximale</strong></a></li><li><a href=#3-complexitÃ©-gÃ©rÃ©e><strong>3. ComplexitÃ© GÃ©rÃ©e</strong></a></li><li><a href=#4-synchronisation><strong>4. Synchronisation</strong></a></li></ul></li><li><a href=#-avantages-du-pattern-cqrs>ğŸ’¡ <strong>Avantages du Pattern CQRS</strong></a><ul><li><a href=#-performance-exceptionnelle><strong>âœ… Performance Exceptionnelle</strong></a></li><li><a href=#-scalabilitÃ©><strong>âœ… ScalabilitÃ©</strong></a></li><li><a href=#-flexibilitÃ©><strong>âœ… FlexibilitÃ©</strong></a></li><li><a href=#-complexitÃ©-maÃ®trisÃ©e><strong>âœ… ComplexitÃ© MaÃ®trisÃ©e</strong></a></li></ul></li><li><a href=#-inconvÃ©nients-du-pattern-cqrs>âš ï¸ <strong>InconvÃ©nients du Pattern CQRS</strong></a><ul><li><a href=#-complexitÃ©><strong>âŒ ComplexitÃ©</strong></a></li><li><a href=#-synchronisation><strong>âŒ Synchronisation</strong></a></li><li><a href=#-overhead><strong>âŒ Overhead</strong></a></li></ul></li><li><a href=#-votre-prochaine-Ã©tape>ğŸ¯ <strong>Votre Prochaine Ã‰tape</strong></a></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">Stockage SQL CQRS - Exemple Concret</h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h2 id=-contexte-de-l>ğŸ¯ <strong>Contexte de l&rsquo;Exemple</strong> <a href=#-contexte-de-l class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><p>Cet exemple montre l&rsquo;implÃ©mentation du pattern <strong>CQRS (Command Query Responsibility Segregation)</strong> pour gÃ©rer des modÃ¨les de donnÃ©es distincts pour les commandes et les requÃªtes dans l&rsquo;Ã©cosystÃ¨me Gyroscops. C&rsquo;est l&rsquo;approche la plus avancÃ©e pour les systÃ¨mes complexes.</p><h3 id=domaine-mÃ©tier--gestion-des-paiements-avec-cqrs><strong>Domaine MÃ©tier : Gestion des Paiements avec CQRS</strong> <a href=#domaine-m%c3%a9tier--gestion-des-paiements-avec-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Command Side</strong> : ModÃ¨le d&rsquo;Ã©criture optimisÃ© pour les validations et la cohÃ©rence</li><li><strong>Query Side</strong> : ModÃ¨le de lecture optimisÃ© pour les performances et l&rsquo;affichage</li><li><strong>Synchronisation</strong> : MÃ©canisme de synchronisation entre les deux cÃ´tÃ©s</li></ul><h2 id=-structure-du-projet>ğŸ“ <strong>Structure du Projet</strong> <a href=#-structure-du-projet class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><pre tabindex=0><code>src/
â”œâ”€â”€ Domain/
â”‚   â””â”€â”€ Payment/
â”‚       â”œâ”€â”€ Command/
â”‚       â”‚   â”œâ”€â”€ Entity/
â”‚       â”‚   â”‚   â””â”€â”€ PaymentCommand.php
â”‚       â”‚   â””â”€â”€ Repository/
â”‚       â”‚       â””â”€â”€ PaymentCommandRepositoryInterface.php
â”‚       â”œâ”€â”€ Query/
â”‚       â”‚   â”œâ”€â”€ Entity/
â”‚       â”‚   â”‚   â””â”€â”€ PaymentQuery.php
â”‚       â”‚   â””â”€â”€ Repository/
â”‚       â”‚       â””â”€â”€ PaymentQueryRepositoryInterface.php
â”‚       â””â”€â”€ Event/
â”‚           â””â”€â”€ PaymentEvent.php
â”œâ”€â”€ Infrastructure/
â”‚   â””â”€â”€ Payment/
â”‚       â”œâ”€â”€ Command/
â”‚       â”‚   â””â”€â”€ Repository/
â”‚       â”‚       â””â”€â”€ DoctrinePaymentCommandRepository.php
â”‚       â”œâ”€â”€ Query/
â”‚       â”‚   â””â”€â”€ Repository/
â”‚       â”‚       â””â”€â”€ DoctrinePaymentQueryRepository.php
â”‚       â””â”€â”€ Event/
â”‚           â””â”€â”€ PaymentEventHandler.php
â””â”€â”€ Tests/
    â””â”€â”€ Infrastructure/
        â””â”€â”€ Payment/
            â”œâ”€â”€ Command/
            â”‚   â””â”€â”€ Repository/
            â”‚       â””â”€â”€ DoctrinePaymentCommandRepositoryTest.php
            â””â”€â”€ Query/
                â””â”€â”€ Repository/
                    â””â”€â”€ DoctrinePaymentQueryRepositoryTest.php</code></pre><h2 id=-implÃ©mentation>ğŸ—ï¸ <strong>ImplÃ©mentation</strong> <a href=#-impl%c3%a9mentation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-entitÃ©-command-cÃ´tÃ©-Ã©criture><strong>1. EntitÃ© Command (CÃ´tÃ© Ã‰criture)</strong> <a href=#1-entit%c3%a9-command-c%c3%b4t%c3%a9-%c3%a9criture class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Entity</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentId</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\Amount</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\Currency</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentStatus</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>DateTimeImmutable</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentCommand</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Amount</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Currency</span> $currency,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentStatus</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>DateTimeImmutable</span> $createdAt,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>DateTimeImmutable</span> $paidAt <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $validationErrors <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentId</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Amount</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCurrency</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Currency</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatus</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentStatus</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCreatedAt</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>DateTimeImmutable</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPaidAt</span>()<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>DateTimeImmutable</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paidAt</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getValidationErrors</span>()<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validationErrors</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>markAsPaid</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\InvalidArgumentException</span>(<span style=color:#e6db74>&#39;Only pending payments can be marked as paid&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PAID</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paidAt</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DateTimeImmutable</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>markAsFailed</span>(<span style=color:#a6e22e>string</span> $reason)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FAILED</span>;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validationErrors</span> <span style=color:#f92672>=</span> $reason;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validate</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>bool</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validationErrors</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>() <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validationErrors</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Amount must be positive&#39;</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span> <span style=color:#f92672>&amp;&amp;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paidAt</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validationErrors</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Pending payment cannot have paid date&#39;</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=2-entitÃ©-query-cÃ´tÃ©-lecture><strong>2. EntitÃ© Query (CÃ´tÃ© Lecture)</strong> <a href=#2-entit%c3%a9-query-c%c3%b4t%c3%a9-lecture class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Entity</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentId</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\Amount</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\Currency</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentStatus</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>DateTimeImmutable</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentQuery</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Amount</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Currency</span> $currency,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentStatus</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>DateTimeImmutable</span> $createdAt,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>DateTimeImmutable</span> $paidAt <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $displayName <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $statusLabel <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $formattedAmount <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>displayName</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>generateDisplayName</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>statusLabel</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>generateStatusLabel</span>();
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>formattedAmount</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>generateFormattedAmount</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentId</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Amount</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCurrency</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Currency</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatus</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentStatus</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCreatedAt</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>DateTimeImmutable</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPaidAt</span>()<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>DateTimeImmutable</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paidAt</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getDisplayName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>displayName</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatusLabel</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>statusLabel</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getFormattedAmount</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>formattedAmount</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generateDisplayName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sprintf</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;Payment %s - %s %s&#39;</span>,
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>(),
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>formattedAmount</span>,
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>statusLabel</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generateStatusLabel</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>match</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;pending&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;En attente&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;paid&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;PayÃ©&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;failed&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Ã‰chec&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;cancelled&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;AnnulÃ©&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Inconnu&#39;</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generateFormattedAmount</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sprintf</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;%.2f %s&#39;</span>,
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>() <span style=color:#f92672>/</span> <span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>()
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=3-interface-command-repository><strong>3. Interface Command Repository</strong> <a href=#3-interface-command-repository class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Repository</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Entity\PaymentCommand</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>PaymentCommandRepositoryInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>PaymentCommand</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>PaymentCommand</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>delete</span>(<span style=color:#a6e22e>PaymentCommand</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>PaymentCommand</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=4-interface-query-repository><strong>4. Interface Query Repository</strong> <a href=#4-interface-query-repository class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Repository</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Entity\PaymentQuery</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentStatus</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>PaymentQueryRepositoryInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>PaymentQuery</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span> $status)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findRecent</span>(<span style=color:#a6e22e>int</span> $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findPending</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findPaid</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>search</span>(<span style=color:#a6e22e>string</span> $query)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatistics</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=5-implÃ©mentation-command-repository><strong>5. ImplÃ©mentation Command Repository</strong> <a href=#5-impl%c3%a9mentation-command-repository class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Infrastructure\Payment\Command\Repository</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Entity\PaymentCommand</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Repository\PaymentCommandRepositoryInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Doctrine\ORM\EntityManagerInterface</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DoctrinePaymentCommandRepository</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>PaymentCommandRepositoryInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EntityManagerInterface</span> $entityManager
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>PaymentCommand</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>persist</span>($payment);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>PaymentCommand</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>merge</span>($payment);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>delete</span>(<span style=color:#a6e22e>PaymentCommand</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>remove</span>($payment);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>PaymentCommand</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRepository</span>(<span style=color:#a6e22e>PaymentCommand</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=6-implÃ©mentation-query-repository><strong>6. ImplÃ©mentation Query Repository</strong> <a href=#6-impl%c3%a9mentation-query-repository class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Infrastructure\Payment\Query\Repository</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Entity\PaymentQuery</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Repository\PaymentQueryRepositoryInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentStatus</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Doctrine\ORM\EntityManagerInterface</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DoctrinePaymentQueryRepository</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>PaymentQueryRepositoryInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EntityManagerInterface</span> $entityManager
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>PaymentQuery</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRepository</span>(<span style=color:#a6e22e>PaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span> $status)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createQueryBuilder</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>select</span>(<span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>PaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>where</span>(<span style=color:#e6db74>&#39;p.status = :status&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setParameter</span>(<span style=color:#e6db74>&#39;status&#39;</span>, $status<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>())
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>orderBy</span>(<span style=color:#e6db74>&#39;p.createdAt&#39;</span>, <span style=color:#e6db74>&#39;DESC&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getQuery</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findRecent</span>(<span style=color:#a6e22e>int</span> $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createQueryBuilder</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>select</span>(<span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>PaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>orderBy</span>(<span style=color:#e6db74>&#39;p.createdAt&#39;</span>, <span style=color:#e6db74>&#39;DESC&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setMaxResults</span>($limit)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getQuery</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findPending</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findPaid</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PAID</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>search</span>(<span style=color:#a6e22e>string</span> $query)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createQueryBuilder</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>select</span>(<span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>PaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>where</span>(<span style=color:#e6db74>&#39;p.displayName LIKE :query OR p.formattedAmount LIKE :query&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setParameter</span>(<span style=color:#e6db74>&#39;query&#39;</span>, <span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#f92672>.</span> $query <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;%&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>orderBy</span>(<span style=color:#e6db74>&#39;p.createdAt&#39;</span>, <span style=color:#e6db74>&#39;DESC&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getQuery</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatistics</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $qb <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createQueryBuilder</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stats <span style=color:#f92672>=</span> $qb
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>select</span>(<span style=color:#e6db74>&#39;p.status, COUNT(p.id) as count, SUM(p.amount) as total&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>PaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, <span style=color:#e6db74>&#39;p&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>groupBy</span>(<span style=color:#e6db74>&#39;p.status&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getQuery</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>array_reduce</span>($stats, <span style=color:#66d9ef>function</span> ($carry, $stat) {
</span></span><span style=display:flex><span>            $carry[$stat[<span style=color:#e6db74>&#39;status&#39;</span>]] <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;count&#39;</span> <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>int</span>) $stat[<span style=color:#e6db74>&#39;count&#39;</span>],
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;total&#39;</span> <span style=color:#f92672>=&gt;</span> (<span style=color:#a6e22e>int</span>) $stat[<span style=color:#e6db74>&#39;total&#39;</span>]
</span></span><span style=display:flex><span>            ];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $carry;
</span></span><span style=display:flex><span>        }, []);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=7-event-handler-pour-la-synchronisation><strong>7. Event Handler pour la Synchronisation</strong> <a href=#7-event-handler-pour-la-synchronisation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Infrastructure\Payment\Event</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Entity\PaymentCommand</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Entity\PaymentQuery</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Repository\PaymentQueryRepositoryInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Doctrine\ORM\EntityManagerInterface</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentEventHandler</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentQueryRepositoryInterface</span> $queryRepository,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EntityManagerInterface</span> $entityManager
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onPaymentCreated</span>(<span style=color:#a6e22e>PaymentCommand</span> $paymentCommand)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $paymentQuery <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentQuery</span>(
</span></span><span style=display:flex><span>            $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>            $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>(),
</span></span><span style=display:flex><span>            $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCurrency</span>(),
</span></span><span style=display:flex><span>            $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStatus</span>(),
</span></span><span style=display:flex><span>            $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedAt</span>(),
</span></span><span style=display:flex><span>            $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPaidAt</span>()
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>persist</span>($paymentQuery);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onPaymentUpdated</span>(<span style=color:#a6e22e>PaymentCommand</span> $paymentCommand)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $paymentQuery <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>($paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>());
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($paymentQuery) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Mise Ã  jour des champs calculÃ©s
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $paymentQuery <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentQuery</span>(
</span></span><span style=display:flex><span>                $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>                $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>(),
</span></span><span style=display:flex><span>                $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCurrency</span>(),
</span></span><span style=display:flex><span>                $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStatus</span>(),
</span></span><span style=display:flex><span>                $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedAt</span>(),
</span></span><span style=display:flex><span>                $paymentCommand<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPaidAt</span>()
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>merge</span>($paymentQuery);
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=-tests>ğŸ§ª <strong>Tests</strong> <a href=#-tests class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=test-command-repository><strong>Test Command Repository</strong> <a href=#test-command-repository class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Tests\Infrastructure\Payment\Command\Repository</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Entity\PaymentCommand</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\Amount</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\Currency</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentId</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\ValueObject\PaymentStatus</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Infrastructure\Payment\Command\Repository\DoctrinePaymentCommandRepository</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>DateTimeImmutable</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Doctrine\ORM\EntityManagerInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PHPUnit\Framework\TestCase</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DoctrinePaymentCommandRepositoryTest</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>TestCase</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>DoctrinePaymentCommandRepository</span> $repository;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EntityManagerInterface</span> $entityManager;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setUp</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createMock</span>(<span style=color:#a6e22e>EntityManagerInterface</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>repository</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DoctrinePaymentCommandRepository</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>testSavePaymentCommand</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Arrange
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $paymentCommand <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentCommand</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentId</span><span style=color:#f92672>::</span><span style=color:#a6e22e>generate</span>(),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Amount</span>(<span style=color:#ae81ff>10000</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Currency</span>(<span style=color:#e6db74>&#39;EUR&#39;</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DateTimeImmutable</span>()
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Expect
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expects</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>())
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>method</span>(<span style=color:#e6db74>&#39;persist&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>with</span>($paymentCommand);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expects</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>())
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>method</span>(<span style=color:#e6db74>&#39;flush&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Act
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>repository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($paymentCommand);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>testUpdatePaymentCommand</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Arrange
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $paymentCommand <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentCommand</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentId</span><span style=color:#f92672>::</span><span style=color:#a6e22e>generate</span>(),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Amount</span>(<span style=color:#ae81ff>10000</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Currency</span>(<span style=color:#e6db74>&#39;EUR&#39;</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DateTimeImmutable</span>()
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Expect
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expects</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>())
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>method</span>(<span style=color:#e6db74>&#39;merge&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>with</span>($paymentCommand);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>entityManager</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expects</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>())
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>method</span>(<span style=color:#e6db74>&#39;flush&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Act
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>repository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>update</span>($paymentCommand);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=-utilisation-dans-api-platform>ğŸš€ <strong>Utilisation dans API Platform</strong> <a href=#-utilisation-dans-api-platform class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=configuration-des-services><strong>Configuration des Services</strong> <a href=#configuration-des-services class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># config/services.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>App\Domain\Payment\Command\Repository\PaymentCommandRepositoryInterface</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>App\Infrastructure\Payment\Command\Repository\DoctrinePaymentCommandRepository</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>App\Domain\Payment\Query\Repository\PaymentQueryRepositoryInterface</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>App\Infrastructure\Payment\Query\Repository\DoctrinePaymentQueryRepository</span></span></span></code></pre></div><h3 id=api-resource-avec-cqrs><strong>API Resource avec CQRS</strong> <a href=#api-resource-avec-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>App\Api\Resource</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\ApiResource</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Get</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\Post</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ApiPlatform\Metadata\GetCollection</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Entity\PaymentCommand</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Entity\PaymentQuery</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Command\Repository\PaymentCommandRepositoryInterface</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>App\Domain\Payment\Query\Repository\PaymentQueryRepositoryInterface</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[ApiResource(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>operations</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Get</span>(),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Post</span>(),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GetCollection</span>(),
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentResource</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentCommandRepositoryInterface</span> $commandRepository,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentQueryRepositoryInterface</span> $queryRepository
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>PaymentQuery</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>($id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>post</span>(<span style=color:#a6e22e>PaymentCommand</span> $paymentCommand)<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentCommand</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($paymentCommand);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $paymentCommand;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCollection</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findRecent</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=-points-clÃ©s-de-cette-implÃ©mentation>ğŸ¯ <strong>Points ClÃ©s de cette ImplÃ©mentation</strong> <a href=#-points-cl%c3%a9s-de-cette-impl%c3%a9mentation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-modÃ¨les-distincts><strong>1. ModÃ¨les Distincts</strong> <a href=#1-mod%c3%a8les-distincts class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Command</strong> : OptimisÃ© pour la validation et la cohÃ©rence</li><li><strong>Query</strong> : OptimisÃ© pour l&rsquo;affichage et les performances</li><li><strong>Synchronisation</strong> : MÃ©canisme de synchronisation entre les deux</li></ul><h3 id=2-performance-maximale><strong>2. Performance Maximale</strong> <a href=#2-performance-maximale class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>RequÃªtes spÃ©cialisÃ©es</strong> : Chaque modÃ¨le a ses requÃªtes optimisÃ©es</li><li><strong>Index spÃ©cialisÃ©s</strong> : Index diffÃ©rents pour commandes et requÃªtes</li><li><strong>Cache possible</strong> : Cache indÃ©pendant sur chaque cÃ´tÃ©</li></ul><h3 id=3-complexitÃ©-gÃ©rÃ©e><strong>3. ComplexitÃ© GÃ©rÃ©e</strong> <a href=#3-complexit%c3%a9-g%c3%a9r%c3%a9e class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>SÃ©paration claire</strong> : ResponsabilitÃ©s bien dÃ©finies</li><li><strong>Tests spÃ©cialisÃ©s</strong> : Tests indÃ©pendants pour chaque cÃ´tÃ©</li><li><strong>Ã‰volutivitÃ©</strong> : Ã‰volution indÃ©pendante des modÃ¨les</li></ul><h3 id=4-synchronisation><strong>4. Synchronisation</strong> <a href=#4-synchronisation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li><strong>Event-driven</strong> : Synchronisation basÃ©e sur les Ã©vÃ©nements</li><li><strong>CohÃ©rence</strong> : Garantie de cohÃ©rence entre les modÃ¨les</li><li><strong>Performance</strong> : Synchronisation asynchrone possible</li></ul><h2 id=-avantages-du-pattern-cqrs>ğŸ’¡ <strong>Avantages du Pattern CQRS</strong> <a href=#-avantages-du-pattern-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=-performance-exceptionnelle><strong>âœ… Performance Exceptionnelle</strong> <a href=#-performance-exceptionnelle class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>ModÃ¨les optimisÃ©s pour chaque cas d&rsquo;usage</li><li>RequÃªtes spÃ©cialisÃ©es et performantes</li><li>Cache indÃ©pendant sur chaque cÃ´tÃ©</li></ul><h3 id=-scalabilitÃ©><strong>âœ… ScalabilitÃ©</strong> <a href=#-scalabilit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Scaling indÃ©pendant des commandes et requÃªtes</li><li>Optimisation spÃ©cifique par type d&rsquo;opÃ©ration</li><li>PossibilitÃ© de distribution</li></ul><h3 id=-flexibilitÃ©><strong>âœ… FlexibilitÃ©</strong> <a href=#-flexibilit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Ã‰volution indÃ©pendante des modÃ¨les</li><li>Technologies diffÃ©rentes possibles</li><li>Optimisations spÃ©cialisÃ©es</li></ul><h3 id=-complexitÃ©-maÃ®trisÃ©e><strong>âœ… ComplexitÃ© MaÃ®trisÃ©e</strong> <a href=#-complexit%c3%a9-ma%c3%aetris%c3%a9e class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>SÃ©paration claire des responsabilitÃ©s</li><li>Tests plus ciblÃ©s</li><li>Maintenance facilitÃ©e</li></ul><h2 id=-inconvÃ©nients-du-pattern-cqrs>âš ï¸ <strong>InconvÃ©nients du Pattern CQRS</strong> <a href=#-inconv%c3%a9nients-du-pattern-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=-complexitÃ©><strong>âŒ ComplexitÃ©</strong> <a href=#-complexit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Plus complexe Ã  implÃ©menter et maintenir</li><li>Courbe d&rsquo;apprentissage importante</li><li>Plus de code Ã  gÃ©rer</li></ul><h3 id=-synchronisation><strong>âŒ Synchronisation</strong> <a href=#-synchronisation class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>NÃ©cessitÃ© de synchroniser les modÃ¨les</li><li>Risque d&rsquo;incohÃ©rence temporaire</li><li>ComplexitÃ© de la gestion des Ã©vÃ©nements</li></ul><h3 id=-overhead><strong>âŒ Overhead</strong> <a href=#-overhead class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><ul><li>Plus de ressources nÃ©cessaires</li><li>Plus de code Ã  tester</li><li>Plus de maintenance</li></ul><h2 id=-votre-prochaine-Ã©tape>ğŸ¯ <strong>Votre Prochaine Ã‰tape</strong> <a href=#-votre-prochaine-%c3%a9tape class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><div class=chapter-navigation><h2 class=chapter-nav-title>ğŸ¯ Votre Prochaine Ã‰tape</h2><p class=chapter-nav-subtitle>Maintenant que vous comprenez les concepts de base et que j'ai partagÃ© mon expÃ©rience avec Gyroscops, quel est votre contexte ?</p><div class=chapter-options><div class=chapter-option data-color=green><div class=chapter-option-header><div class=chapter-option-letter>A</div><div><h3 class=chapter-option-title>Je veux comparer les patterns</h3><p class=chapter-option-subtitle>Vous voulez comprendre les diffÃ©rences entre les approches</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>CritÃ¨res d'adoption :</h4><ul class=chapter-option-criteria-list><li>Choix architectural</li><li>Ã‰quipe technique</li><li>Performance Ã  optimiser</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>â±ï¸ 20-30 minutes</span>
<a href=/examples/stockage-patterns/ class=chapter-option-link>Patterns de Stockage</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=yellow><div class=chapter-option-header><div class=chapter-option-letter>B</div><div><h3 class=chapter-option-title>Je veux voir l'implÃ©mentation CQS</h3><p class=chapter-option-subtitle>Vous voulez comprendre l'approche intermÃ©diaire</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>CritÃ¨res d'adoption :</h4><ul class=chapter-option-criteria-list><li>Performance importante</li><li>Ã‰quipe expÃ©rimentÃ©e</li><li>Optimisation des lectures</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>â±ï¸ 35-45 minutes</span>
<a href=/examples/stockage-sql-cqs/ class=chapter-option-link>Stockage SQL CQS</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=blue><div class=chapter-option-header><div class=chapter-option-letter>C</div><div><h3 class=chapter-option-title>Je veux revenir aux exemples</h3><p class=chapter-option-subtitle>Vous voulez voir la vue d'ensemble des exemples</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>CritÃ¨res d'adoption :</h4><ul class=chapter-option-criteria-list><li>Besoin de vue d'ensemble</li><li>Choix d'exemple Ã  faire</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>â±ï¸ 5-10 minutes</span>
<a href=/examples/ class=chapter-option-link>Exemples et ImplÃ©mentations</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style><div class=chapter-option data-color=purple><div class=chapter-option-header><div class=chapter-option-letter>D</div><div><h3 class=chapter-option-title>Je veux voir l'implÃ©mentation classique</h3><p class=chapter-option-subtitle>Vous voulez comprendre l'approche la plus simple</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>CritÃ¨res d'adoption :</h4><ul class=chapter-option-criteria-list><li>DÃ©butant</li><li>Application simple</li><li>Ã‰quipe junior</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>â±ï¸ 30-40 minutes</span>
<a href=/examples/stockage-sql-classique/ class=chapter-option-link>Stockage SQL Classique</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style></div></div><style>.chapter-navigation{margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;border-left:4px solid #3b82f6}.chapter-nav-title{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:#1e293b}.chapter-nav-subtitle{margin:0 0 1.5rem;color:#64748b;font-size:1rem;line-height:1.6}.chapter-options{display:flex;flex-direction:column;gap:1rem}.chapter-option{background:#fff;border-radius:8px;padding:1.25rem;border:1px solid #e2e8f0;transition:all .2s ease;position:relative;overflow:hidden}.chapter-option:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#3b82f6}.chapter-option::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--option-color,#6b7280);border-radius:0 2px 2px 0}.chapter-option-header{display:flex;align-items:center;margin-bottom:.75rem}.chapter-option-letter{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:50%;background:var(--option-color,#6b7280);color:#fff;font-weight:700;font-size:.875rem;margin-right:.75rem;flex-shrink:0}.chapter-option-title{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0;line-height:1.4}.chapter-option-subtitle{font-size:.875rem;color:#64748b;font-style:italic;margin:.25rem 0 0;line-height:1.4}.chapter-option-content{margin-left:2.75rem}.chapter-option-criteria{margin-bottom:.75rem}.chapter-option-criteria-title{font-size:.875rem;font-weight:600;color:#374151;margin:0 0 .5rem}.chapter-option-criteria-list{list-style:none;padding:0;margin:0}.chapter-option-criteria-list li{position:relative;padding-left:1.25rem;margin-bottom:.25rem;font-size:.875rem;color:#4b5563;line-height:1.4}.chapter-option-criteria-list li::before{content:'âœ“';position:absolute;left:0;color:#10b981;font-weight:600}.chapter-option-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1rem;padding-top:.75rem;border-top:1px solid #e5e7eb}.chapter-option-time{font-size:.875rem;color:#6b7280;font-weight:500}.chapter-option-link{display:inline-flex;align-items:center;padding:.5rem 1rem;background:var(--option-color,#6b7280);color:#fff!important;text-decoration:none!important;border-radius:6px;font-weight:600;font-size:.875rem;transition:all .2s ease;border:none;cursor:pointer}.chapter-option-link:hover{background:var(--option-color-dark,#4b5563);color:#fff!important;text-decoration:none!important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.chapter-option-link:visited{color:#fff!important;text-decoration:none!important}.chapter-option-link:focus{color:#fff!important;text-decoration:none!important;outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.chapter-option-link:active{color:#fff!important;text-decoration:none!important}.chapter-option-link::after{content:'â†’';margin-left:.5rem;transition:transform .2s ease;color:#fff!important}.chapter-option-link:hover::after{transform:translateX(2px);color:#fff!important}.chapter-navigation a{color:inherit;text-decoration:none}.chapter-navigation a:hover{color:inherit;text-decoration:none}.chapter-navigation a:visited{color:inherit;text-decoration:none}.chapter-navigation a:focus{color:inherit;text-decoration:none}.chapter-navigation a:active{color:inherit;text-decoration:none}.chapter-option[data-color=green]{--option-color:#10b981;--option-color-dark:#059669}.chapter-option[data-color=yellow]{--option-color:#f59e0b;--option-color-dark:#d97706}.chapter-option[data-color=red]{--option-color:#ef4444;--option-color-dark:#dc2626}.chapter-option[data-color=blue]{--option-color:#3b82f6;--option-color-dark:#2563eb}.chapter-option[data-color=purple]{--option-color:#8b5cf6;--option-color-dark:#7c3aed}.chapter-option[data-color=orange]{--option-color:#f97316;--option-color-dark:#ea580c}.chapter-option[data-color=teal]{--option-color:#14b8a6;--option-color-dark:#0d9488}.chapter-option[data-color=indigo]{--option-color:#6366f1;--option-color-dark:#4f46e5}.chapter-option[data-color=pink]{--option-color:#ec4899;--option-color-dark:#db2777}.chapter-option[data-color=cyan]{--option-color:#06b6d4;--option-color-dark:#0891b2}@media(max-width:768px){.chapter-navigation{padding:1rem}.chapter-option{padding:1rem}.chapter-option-content{margin-left:2.5rem}.chapter-option-footer{flex-direction:column;align-items:flex-start;gap:.75rem}.chapter-option-link{align-self:stretch;justify-content:center}}</style><hr><p><em>Cet exemple est tirÃ© de l&rsquo;expÃ©rience Gyroscops et adaptÃ© pour Ãªtre rÃ©utilisable dans vos projets.</em></p></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap"><div class="col-sm-6 pt-2 doc-next"><a href=/examples/stockage-sql-cqs/><div class="card h-100 my-1"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0"><i class="material-icons align-middle">navigate_before</i> Stockage SQL CQS - Exemple Concret</p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>Â© 2025 GrÃ©gory Planchat. Tous droits rÃ©servÃ©s.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci Ã  nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-2"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Kiboko</span></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Gyroscops</span></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.js defer></script><script type=text/javascript src=//localhost:1313/docs/js/bundle.js defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>