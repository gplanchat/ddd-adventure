<!doctype html><html lang=fr-fr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><title>Chapitre 15 : Architecture CQRS avec API Platform | DDD Adventure</title><meta name=robots content="noindex"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ma√Ætriser CQRS complet pour une s√©paration optimale entre commandes et requ√™tes"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=http://localhost:1313/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=http://localhost:1313/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=http://localhost:1313/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=http://localhost:1313/site.webmanifest><meta property="og:title" content="Chapitre 15 : Architecture CQRS avec API Platform"><meta property="og:description" content="Ma√Ætriser CQRS complet pour une s√©paration optimale entre commandes et requ√™tes"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/chapitres/optionnels/chapitre-13-architecture-cqrs/"><meta property="og:image" content="http://localhost:1313/opengraph/card-base-2_hu_22452459af335cb9.png"><meta property="article:section" content="chapitres"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/opengraph/card-base-2_hu_22452459af335cb9.png"><meta name=twitter:title content="Chapitre 15 : Architecture CQRS avec API Platform"><meta name=twitter:description content="Ma√Ætriser CQRS complet pour une s√©paration optimale entre commandes et requ√™tes"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=http://localhost:1313/docs/js/flexsearch.bundle.js></script><link rel=stylesheet href=/docs/scss/style.css crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Fondamentaux</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-02-impact-mapping/>Chapitre 2 : L'Impact Mapping - Aligner le Produit sur les Objectifs Business</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-03-atelier-event-storming/>Chapitre 3 : L'Atelier Event Storming - Guide Pratique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-04-example-mapping/>Chapitre 4 : L'Example Mapping - D√©tailer les R√®gles M√©tier</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-05-complexite-accidentelle-essentielle/>Chapitre 5 : Complexit√© Accidentelle vs Essentielle - Le Choix Architectural</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-06-granularite-choix-architecturaux/>Chapitre 6 : Granularit√© des Choix Architecturaux</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-07-modeles-riches-vs-anemiques/>Chapitre 7 : Mod√®les Riches vs Mod√®les An√©miques</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-08-architecture-evenementielle/>Chapitre 8 : Architecture √âv√©nementielle</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-09-repositories-persistance/>Chapitre 9 : Repositories et Persistance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-10-choix-type-stockage/>Chapitre 15 : Choix du Type de Stockage</a></li></ul></div></li><li class="sidebar-dropdown no-icon current active"><button class=btn>
Chapitres Optionnels</button><div class="sidebar-submenu d-block"><ul><li class="current no-icon"><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-13-architecture-cqrs/>Chapitre 15 : Architecture CQRS avec API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-12-architecture-cqs/>Chapitre 15 : Architecture CQS - Command Query Separation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-11-event-sourcing/>Chapitre 15 : Event Sourcing - La Source de V√©rit√©</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-14-cqrs-event-sourcing-combines/>Chapitre 15 : CQRS + Event Sourcing Combin√©s</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-15-projections-event-sourcing/>Chapitre 15 : Projections Event Sourcing</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres de Stockage</button><div class=sidebar-submenu><ul><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage SQL</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-16-stockage-sql-classique/>Chapitre 16 : Stockage SQL - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-17-stockage-sql-cqs/>Chapitre 17 : Stockage SQL - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-18-stockage-sql-cqrs/>Chapitre 18 : Stockage SQL - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-19-stockage-sql-event-sourcing/>Chapitre 19 : Stockage SQL - Event Sourcing Seul</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-20-stockage-sql-event-sourcing-cqs/>Chapitre 58 : Stockage SQL - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-21-stockage-sql-event-sourcing-cqrs/>Chapitre 59 : Stockage SQL - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage API</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-26-stockage-api-event-sourcing-cqs/>Chapitre 26 : Stockage API - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-27-stockage-api-event-sourcing-cqrs/>Chapitre 27 : Stockage API - Event Sourcing + CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-22-stockage-api-classique/>Chapitre 60 : Stockage API - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-23-stockage-api-cqs/>Chapitre 61 : Stockage API - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-24-stockage-api-cqrs/>Chapitre 62 : Stockage API - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-25-stockage-api-event-sourcing/>Chapitre 63 : Stockage API - Event Sourcing Seul</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage MongoDB</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-28-stockage-mongodb-classique/>Chapitre 28 : Stockage MongoDB - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-29-stockage-mongodb-cqs/>Chapitre 29 : Stockage MongoDB - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-30-stockage-mongodb-cqrs/>Chapitre 30 : Stockage MongoDB - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-31-stockage-mongodb-event-sourcing/>Chapitre 31 : Stockage MongoDB - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-32-stockage-mongodb-event-sourcing-cqs/>Stockage MongoDB - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-33-stockage-mongodb-event-sourcing-cqrs/>Stockage MongoDB - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage ElasticSearch</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-34-stockage-elasticsearch-classique/>Stockage ElasticSearch - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-35-stockage-elasticsearch-cqs/>Stockage ElasticSearch - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-36-stockage-elasticsearch-cqrs/>Stockage ElasticSearch - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-37-stockage-elasticsearch-event-sourcing/>Stockage ElasticSearch - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-38-stockage-elasticsearch-event-sourcing-cqs/>Stockage ElasticSearch - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-39-stockage-elasticsearch-event-sourcing-cqrs/>Stockage ElasticSearch - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage In-Memory</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-40-stockage-in-memory-classique/>Stockage In-Memory - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-41-stockage-in-memory-cqs/>Stockage In-Memory - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-42-stockage-in-memory-cqrs/>Stockage In-Memory - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-43-stockage-in-memory-event-sourcing/>Stockage In-Memory - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-44-stockage-in-memory-event-sourcing-cqs/>Stockage In-Memory - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-45-stockage-in-memory-event-sourcing-cqrs/>Stockage In-Memory - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Composite pilot√© par Temporal</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-46-stockage-temporal-classique/>Stockage Temporal - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-47-stockage-temporal-cqs/>Stockage Temporal - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-48-stockage-temporal-cqrs/>Stockage Temporal - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-49-stockage-temporal-event-sourcing/>Stockage Temporal - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-50-stockage-temporal-event-sourcing-cqs/>Stockage Temporal - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-51-stockage-temporal-event-sourcing-cqrs/>Stockage Temporal - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Multi-sources</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-52-stockage-multi-sources-classique/>Stockage Multi-sources - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-53-stockage-multi-sources-cqs/>Stockage Multi-sources - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-54-stockage-multi-sources-cqrs/>Stockage Multi-sources - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-55-stockage-multi-sources-event-sourcing/>Stockage Multi-sources avec Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-56-stockage-multi-sources-strategies-avancees/>Strat√©gies Avanc√©es de R√©plication Multi-sources</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-57-stockage-multi-sources-resolution-conflits/>R√©solution de Conflits Multi-sources</a></li></ul></div></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Techniques</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-58-gestion-donnees-validation/>Chapitre 58 : Gestion des Donn√©es et Validation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-59-pagination-performance/>Chapitre 59 : Pagination et Performance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-60-gestion-erreurs-observabilite/>Chapitre 60 : Gestion d'Erreurs et Observabilit√©</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-61-tests-qualite/>Chapitre 61 : Tests et Qualit√©</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Avanc√©s</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-62-securite-autorisation/>Chapitre 62 : S√©curit√© et Autorisation - Prot√©ger votre API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-63-frontend-integration/>Chapitre 63 : Frontend et Int√©gration - Connecter votre Interface Utilisateur</a></li></ul></div></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/optionnels/><span itemprop=name>Chapitres Optionnels</span>
</a><meta itemprop=position content='2'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Chapitre 15 : Architecture CQRS avec API Platform</span>
<meta itemprop=position content='3'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-objectif-de-ce-chapitre>üéØ Objectif de ce Chapitre</a><ul><li><a href=#mon-probl√®me--comment-optimiser-compl√®tement-les-lectures-et-les-√©critures->Mon Probl√®me : Comment Optimiser Compl√®tement les Lectures et les √âcritures ?</a></li><li><a href=#cqrs--mon-guide-complet>CQRS : Mon Guide Complet</a></li></ul></li><li><a href=#quest-ce-que-cqrs->Qu&rsquo;est-ce que CQRS ?</a><ul><li><a href=#le-concept-fondamental>Le Concept Fondamental</a></li><li><a href=#les-4-piliers-de-cqrs>Les 4 Piliers de CQRS</a></li></ul></li><li><a href=#comment-impl√©menter-cqrs>Comment Impl√©menter CQRS</a><ul><li><a href=#1-cr√©er-les-mod√®les-de-commande>1. <strong>Cr√©er les Mod√®les de Commande</strong></a></li><li><a href=#2-cr√©er-les-mod√®les-de-requ√™te>2. <strong>Cr√©er les Mod√®les de Requ√™te</strong></a></li><li><a href=#3-impl√©menter-les-repositories>3. <strong>Impl√©menter les Repositories</strong></a></li><li><a href=#4-cr√©er-les-projections>4. <strong>Cr√©er les Projections</strong></a></li></ul></li><li><a href=#les-avantages-de-cqrs>Les Avantages de CQRS</a><ul><li><a href=#1-performance-optimale>1. <strong>Performance Optimale</strong></a></li><li><a href=#2-scalabilit√©>2. <strong>Scalabilit√©</strong></a></li><li><a href=#3-flexibilit√©>3. <strong>Flexibilit√©</strong></a></li><li><a href=#4-s√©curit√©>4. <strong>S√©curit√©</strong></a></li></ul></li><li><a href=#les-inconv√©nients-de-cqrs>Les Inconv√©nients de CQRS</a><ul><li><a href=#1-complexit√©-tr√®s-√©lev√©e>1. <strong>Complexit√© Tr√®s √âlev√©e</strong></a></li><li><a href=#2-coh√©rence-√©ventuelle>2. <strong>Coh√©rence √âventuelle</strong></a></li><li><a href=#3-duplication-de-code>3. <strong>Duplication de Code</strong></a></li><li><a href=#4-co√ªt-de-d√©veloppement>4. <strong>Co√ªt de D√©veloppement</strong></a></li></ul></li><li><a href=#les-pi√®ges-√†-√©viter>Les Pi√®ges √† √âviter</a><ul><li><a href=#1-cqrs-pr√©matur√©>1. <strong>CQRS Pr√©matur√©</strong></a></li><li><a href=#2-synchronisation-mal-g√©r√©e>2. <strong>Synchronisation Mal G√©r√©e</strong></a></li><li><a href=#3-mod√®les-trop-similaires>3. <strong>Mod√®les Trop Similaires</strong></a></li><li><a href=#4-tests-insuffisants>4. <strong>Tests Insuffisants</strong></a></li></ul></li><li><a href=#l√©volution-vers-cqrs>L&rsquo;√âvolution vers CQRS</a><ul><li><a href=#phase-1--architecture-monolithique>Phase 1 : Architecture Monolithique</a></li><li><a href=#phase-2--introduction-de-cqs>Phase 2 : Introduction de CQS</a></li><li><a href=#phase-3--cqrs-complet>Phase 3 : CQRS Complet</a></li></ul></li><li><a href=#-impl√©mentation-concr√®te-dans-le-projet-gyroscops-cloud>üèóÔ∏è Impl√©mentation Concr√®te dans le Projet Gyroscops Cloud</a><ul><li><a href=#cqrs-appliqu√©-√†-gyroscops-cloud>CQRS Appliqu√© √† Gyroscops Cloud</a></li><li><a href=#r√©f√©rences-aux-adr-du-projet-gyroscops-cloud>R√©f√©rences aux ADR du Projet Gyroscops Cloud</a></li></ul></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-objectif-de-ce-chapitre>üéØ Objectif de ce Chapitre</a><ul><li><a href=#mon-probl√®me--comment-optimiser-compl√®tement-les-lectures-et-les-√©critures->Mon Probl√®me : Comment Optimiser Compl√®tement les Lectures et les √âcritures ?</a></li><li><a href=#cqrs--mon-guide-complet>CQRS : Mon Guide Complet</a></li></ul></li><li><a href=#quest-ce-que-cqrs->Qu&rsquo;est-ce que CQRS ?</a><ul><li><a href=#le-concept-fondamental>Le Concept Fondamental</a></li><li><a href=#les-4-piliers-de-cqrs>Les 4 Piliers de CQRS</a></li></ul></li><li><a href=#comment-impl√©menter-cqrs>Comment Impl√©menter CQRS</a><ul><li><a href=#1-cr√©er-les-mod√®les-de-commande>1. <strong>Cr√©er les Mod√®les de Commande</strong></a></li><li><a href=#2-cr√©er-les-mod√®les-de-requ√™te>2. <strong>Cr√©er les Mod√®les de Requ√™te</strong></a></li><li><a href=#3-impl√©menter-les-repositories>3. <strong>Impl√©menter les Repositories</strong></a></li><li><a href=#4-cr√©er-les-projections>4. <strong>Cr√©er les Projections</strong></a></li></ul></li><li><a href=#les-avantages-de-cqrs>Les Avantages de CQRS</a><ul><li><a href=#1-performance-optimale>1. <strong>Performance Optimale</strong></a></li><li><a href=#2-scalabilit√©>2. <strong>Scalabilit√©</strong></a></li><li><a href=#3-flexibilit√©>3. <strong>Flexibilit√©</strong></a></li><li><a href=#4-s√©curit√©>4. <strong>S√©curit√©</strong></a></li></ul></li><li><a href=#les-inconv√©nients-de-cqrs>Les Inconv√©nients de CQRS</a><ul><li><a href=#1-complexit√©-tr√®s-√©lev√©e>1. <strong>Complexit√© Tr√®s √âlev√©e</strong></a></li><li><a href=#2-coh√©rence-√©ventuelle>2. <strong>Coh√©rence √âventuelle</strong></a></li><li><a href=#3-duplication-de-code>3. <strong>Duplication de Code</strong></a></li><li><a href=#4-co√ªt-de-d√©veloppement>4. <strong>Co√ªt de D√©veloppement</strong></a></li></ul></li><li><a href=#les-pi√®ges-√†-√©viter>Les Pi√®ges √† √âviter</a><ul><li><a href=#1-cqrs-pr√©matur√©>1. <strong>CQRS Pr√©matur√©</strong></a></li><li><a href=#2-synchronisation-mal-g√©r√©e>2. <strong>Synchronisation Mal G√©r√©e</strong></a></li><li><a href=#3-mod√®les-trop-similaires>3. <strong>Mod√®les Trop Similaires</strong></a></li><li><a href=#4-tests-insuffisants>4. <strong>Tests Insuffisants</strong></a></li></ul></li><li><a href=#l√©volution-vers-cqrs>L&rsquo;√âvolution vers CQRS</a><ul><li><a href=#phase-1--architecture-monolithique>Phase 1 : Architecture Monolithique</a></li><li><a href=#phase-2--introduction-de-cqs>Phase 2 : Introduction de CQS</a></li><li><a href=#phase-3--cqrs-complet>Phase 3 : CQRS Complet</a></li></ul></li><li><a href=#-impl√©mentation-concr√®te-dans-le-projet-gyroscops-cloud>üèóÔ∏è Impl√©mentation Concr√®te dans le Projet Gyroscops Cloud</a><ul><li><a href=#cqrs-appliqu√©-√†-gyroscops-cloud>CQRS Appliqu√© √† Gyroscops Cloud</a></li><li><a href=#r√©f√©rences-aux-adr-du-projet-gyroscops-cloud>R√©f√©rences aux ADR du Projet Gyroscops Cloud</a></li></ul></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">Chapitre 15 : Architecture CQRS avec API Platform
<span class="badge bg-default fs-6 mb-1 align-middle">DRAFT</span></h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h2 id=-objectif-de-ce-chapitre>üéØ Objectif de ce Chapitre <a href=#-objectif-de-ce-chapitre class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=mon-probl√®me--comment-optimiser-compl√®tement-les-lectures-et-les-√©critures->Mon Probl√®me : Comment Optimiser Compl√®tement les Lectures et les √âcritures ? <a href=#mon-probl%c3%a8me--comment-optimiser-compl%c3%a8tement-les-lectures-et-les-%c3%a9critures- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce qui s&rsquo;est pass√© avec Gyroscops</strong> : J&rsquo;avais CQS qui fonctionnait bien, mais j&rsquo;avais encore des probl√®mes. Les requ√™tes √©taient lentes √† cause des jointures complexes, et les commandes √©taient bloqu√©es par les verrous de lecture. J&rsquo;avais besoin d&rsquo;une s√©paration compl√®te.</p><p><strong>Mais attendez&mldr;</strong> Comment avoir des mod√®les de lecture et d&rsquo;√©criture compl√®tement diff√©rents ? Comment synchroniser les donn√©es ? Comment g√©rer la coh√©rence ?</p><p><strong>Soudain, je r√©alisais que CQRS √©tait la solution !</strong> Il me fallait une architecture compl√®te avec des mod√®les s√©par√©s.</p><h3 id=cqrs--mon-guide-complet>CQRS : Mon Guide Complet <a href=#cqrs--mon-guide-complet class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>CQRS m&rsquo;a permis de :</p><ul><li><strong>Optimiser</strong> compl√®tement les lectures et √©critures</li><li><strong>S√©parer</strong> les mod√®les de donn√©es</li><li><strong>Am√©liorer</strong> les performances</li><li><strong>Scaler</strong> ind√©pendamment</li></ul><h2 id=quest-ce-que-cqrs->Qu&rsquo;est-ce que CQRS ? <a href=#quest-ce-que-cqrs- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=le-concept-fondamental>Le Concept Fondamental <a href=#le-concept-fondamental class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>CQRS (Command Query Responsibility Segregation) consiste √† s√©parer compl√®tement les mod√®les de lecture et d&rsquo;√©criture. <strong>L&rsquo;id√©e</strong> : Avoir des mod√®les de donn√©es optimis√©s pour chaque usage, avec des bases de donn√©es et des structures diff√©rentes.</p><p><strong>Avec Gyroscops, voici comment j&rsquo;ai structur√© CQRS</strong> :</p><h3 id=les-4-piliers-de-cqrs>Les 4 Piliers de CQRS <a href=#les-4-piliers-de-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><h4 id=1-mod√®les-de-commande---optimis√©s-pour-l√©criture>1. <strong>Mod√®les de Commande</strong> - Optimis√©s pour l&rsquo;√©criture <a href=#1-mod%c3%a8les-de-commande---optimis%c3%a9s-pour-l%c3%a9criture class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai impl√©ment√© les mod√®les de commande avec Gyroscops</strong> :</p><p><strong>Mod√®les Normaux</strong> :</p><ul><li>Structure optimis√©e pour les √©critures</li><li>Validation m√©tier</li><li>Invariants d&rsquo;agr√©gat</li><li>√âv√©nements de domaine</li></ul><p><strong>Exemples</strong> :</p><ul><li><code>Payment</code> (agr√©gat)</li><li><code>User</code> (agr√©gat)</li><li><code>Organization</code> (agr√©gat)</li></ul><h4 id=2-mod√®les-de-requ√™te---optimis√©s-pour-la-lecture>2. <strong>Mod√®les de Requ√™te</strong> - Optimis√©s pour la lecture <a href=#2-mod%c3%a8les-de-requ%c3%aate---optimis%c3%a9s-pour-la-lecture class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai impl√©ment√© les mod√®les de requ√™te avec Gyroscops</strong> :</p><p><strong>Mod√®les D√©normalis√©s</strong> :</p><ul><li>Structure optimis√©e pour les lectures</li><li>Donn√©es pr√©-calcul√©es</li><li>Vues sp√©cialis√©es</li><li>Pas de logique m√©tier</li></ul><p><strong>Exemples</strong> :</p><ul><li><code>PaymentView</code></li><li><code>UserProfile</code></li><li><code>OrganizationSummary</code></li></ul><h4 id=3-synchronisation---maintenir-la-coh√©rence>3. <strong>Synchronisation</strong> - Maintenir la coh√©rence <a href=#3-synchronisation---maintenir-la-coh%c3%a9rence class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai impl√©ment√© la synchronisation avec Gyroscops</strong> :</p><p><strong>Event Sourcing</strong> :</p><ul><li>√âv√©nements comme source de v√©rit√©</li><li>Projections pour les vues</li><li>Synchronisation asynchrone</li><li>Coh√©rence √©ventuelle</li></ul><h4 id=4-api-platform---exposer-les-deux-c√¥t√©s>4. <strong>API Platform</strong> - Exposer les deux c√¥t√©s <a href=#4-api-platform---exposer-les-deux-c%c3%b4t%c3%a9s class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai int√©gr√© API Platform avec Gyroscops</strong> :</p><p><strong>Ressources S√©par√©es</strong> :</p><ul><li>Ressources de commande</li><li>Ressources de requ√™te</li><li>Endpoints sp√©cialis√©s</li><li>Documentation s√©par√©e</li></ul><h2 id=comment-impl√©menter-cqrs>Comment Impl√©menter CQRS <a href=#comment-impl%c3%a9menter-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-cr√©er-les-mod√®les-de-commande>1. <strong>Cr√©er les Mod√®les de Commande</strong> <a href=#1-cr%c3%a9er-les-mod%c3%a8les-de-commande class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai cr√©√© les mod√®les de commande :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Mod√®les de Commande Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Payment</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentId</span> $id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>OrganizationId</span> $organizationId;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $customerName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>string</span> $customerEmail;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Price</span> $amount;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentStatus</span> $status;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>\DateTimeImmutable</span> $createdAt;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>UserId</span> $createdBy;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>array</span> $uncommittedEvents <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PaymentId</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>OrganizationId</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>string</span> $customerEmail,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Price</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PaymentStatus</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>\DateTimeImmutable</span> $createdAt,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>UserId</span> $createdBy
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> $id;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span> <span style=color:#f92672>=</span> $organizationId;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span> <span style=color:#f92672>=</span> $customerName;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span> <span style=color:#f92672>=</span> $customerEmail;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span> <span style=color:#f92672>=</span> $amount;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> $status;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span> <span style=color:#f92672>=</span> $createdAt;
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span> <span style=color:#f92672>=</span> $createdBy;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processPayment</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidPaymentStatusException</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PROCESSING</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>raiseEvent</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentProcessingStarted</span>(
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\DateTimeImmutable</span>()
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>completePayment</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PROCESSING</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidPaymentStatusException</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>COMPLETED</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>raiseEvent</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentCompleted</span>(
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\DateTimeImmutable</span>()
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>failPayment</span>(<span style=color:#a6e22e>string</span> $reason)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PROCESSING</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidPaymentStatusException</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FAILED</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>raiseEvent</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentFailed</span>(
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            $reason,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\DateTimeImmutable</span>()
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>raiseEvent</span>(<span style=color:#a6e22e>DomainEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uncommittedEvents</span>[] <span style=color:#f92672>=</span> $event;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUncommittedEvents</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uncommittedEvents</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>markEventsAsCommitted</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>uncommittedEvents</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Getters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentId</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getOrganizationId</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>OrganizationId</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCustomerName</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCustomerEmail</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Price</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatus</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentStatus</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCreatedAt</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>\DateTimeImmutable</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCreatedBy</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>UserId</span> { <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span>; }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>R√©sultat</strong> : Mod√®les de commande optimis√©s pour l&rsquo;√©criture.</p><h3 id=2-cr√©er-les-mod√®les-de-requ√™te>2. <strong>Cr√©er les Mod√®les de Requ√™te</strong> <a href=#2-cr%c3%a9er-les-mod%c3%a8les-de-requ%c3%aate class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai cr√©√© les mod√®les de requ√™te :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Mod√®les de Requ√™te Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentView</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $organizationName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $customerEmail,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $currency,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $createdAt,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $createdBy,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $createdByName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $processedAt,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $failedAt,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>string</span> $failureReason
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>toArray</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;organization_id&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;organization_name&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationName</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;customer_name&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;customer_email&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;amount&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;currency&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;status&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;created_at&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;created_by&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;created_by_name&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdByName</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;processed_at&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>processedAt</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;failed_at&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>failedAt</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;failure_reason&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>failureReason</span>
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentSummary</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $createdAt
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>toArray</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;id&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;customer_name&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;amount&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;status&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>status</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;created_at&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span>
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentStatistics</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>int</span> $totalPayments,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>int</span> $pendingPayments,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>int</span> $completedPayments,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>int</span> $failedPayments,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $totalAmount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>string</span> $averageAmount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>array</span> $statusDistribution,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>readonly</span> <span style=color:#66d9ef>array</span> $monthlyTrends
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>toArray</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;total_payments&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>totalPayments</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;pending_payments&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>pendingPayments</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;completed_payments&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>completedPayments</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;failed_payments&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>failedPayments</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;total_amount&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>totalAmount</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;average_amount&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>averageAmount</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;status_distribution&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>statusDistribution</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;monthly_trends&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>monthlyTrends</span>
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>R√©sultat</strong> : Mod√®les de requ√™te optimis√©s pour la lecture.</p><h3 id=3-impl√©menter-les-repositories>3. <strong>Impl√©menter les Repositories</strong> <a href=#3-impl%c3%a9menter-les-repositories class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai impl√©ment√© les repositories :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Repositories CQRS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentCommandRepository</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Connection</span> $connection,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EventStore</span> $eventStore,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>Payment</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>beginTransaction</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Sauvegarder l&#39;agr√©gat
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>saveAggregate</span>($payment);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Sauvegarder les √©v√©nements
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventStore</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>append</span>(
</span></span><span style=display:flex><span>                $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>                $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUncommittedEvents</span>(),
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCurrentVersion</span>($payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>())
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>markEventsAsCommitted</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commit</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment saved successfully&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>rollBack</span>();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to save payment&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> $e;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>PaymentId</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Payment</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $events <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventStore</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEvents</span>($id<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>empty</span>($events)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Payment</span><span style=color:#f92672>::</span><span style=color:#a6e22e>fromEvents</span>($events);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>saveAggregate</span>(<span style=color:#a6e22e>Payment</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;INSERT INTO payment_aggregates 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                (id, organization_id, customer_name, customer_email, amount, currency, status, created_at, created_by, version) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ON DUPLICATE KEY UPDATE 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                organization_id = VALUES(organization_id),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                customer_name = VALUES(customer_name),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                customer_email = VALUES(customer_email),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                amount = VALUES(amount),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                currency = VALUES(currency),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                status = VALUES(status),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                version = VALUES(version)&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOrganizationId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCustomerName</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCustomerEmail</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCurrency</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStatus</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedAt</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedBy</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getNextVersion</span>($payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>())
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentQueryRepository</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Connection</span> $connection,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>PaymentView</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT p.*, o.name as organization_name, u.first_name, u.last_name 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                FROM payment_views p
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                LEFT JOIN organizations o ON p.organization_id = o.id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                LEFT JOIN users u ON p.created_by = u.id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE p.id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$id]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $row <span style=color:#f92672>=</span> $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetchAssociative</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$row) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentView</span>(
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;id&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;organization_id&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;organization_name&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;customer_name&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;customer_email&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;amount&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;currency&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;status&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;created_at&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;created_by&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;first_name&#39;</span>] <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#f92672>.</span> $row[<span style=color:#e6db74>&#39;last_name&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;processed_at&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;failed_at&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;failure_reason&#39;</span>]
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findByOrganization</span>(<span style=color:#a6e22e>string</span> $organizationId, <span style=color:#a6e22e>int</span> $page <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>int</span> $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $offset <span style=color:#f92672>=</span> ($page <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> $limit;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT p.*, o.name as organization_name, u.first_name, u.last_name 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                FROM payment_views p
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                LEFT JOIN organizations o ON p.organization_id = o.id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                LEFT JOIN users u ON p.created_by = u.id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE p.organization_id = ?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ORDER BY p.created_at DESC
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                LIMIT ? OFFSET ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$organizationId, $limit, $offset]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payments <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> ($row <span style=color:#f92672>=</span> $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetchAssociative</span>()) {
</span></span><span style=display:flex><span>            $payments[] <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentView</span>(
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;id&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;organization_id&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;organization_name&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;customer_name&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;customer_email&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;amount&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;currency&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;status&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;created_at&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;created_by&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;first_name&#39;</span>] <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#f92672>.</span> $row[<span style=color:#e6db74>&#39;last_name&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;processed_at&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;failed_at&#39;</span>],
</span></span><span style=display:flex><span>                $row[<span style=color:#e6db74>&#39;failure_reason&#39;</span>]
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $payments;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getStatistics</span>(<span style=color:#a6e22e>string</span> $organizationId)<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentStatistics</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    COUNT(*) as total_payments,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    SUM(CASE WHEN status = &#34;pending&#34; THEN 1 ELSE 0 END) as pending_payments,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    SUM(CASE WHEN status = &#34;completed&#34; THEN 1 ELSE 0 END) as completed_payments,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    SUM(CASE WHEN status = &#34;failed&#34; THEN 1 ELSE 0 END) as failed_payments,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    SUM(amount) as total_amount,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    AVG(amount) as average_amount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                FROM payment_views 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE organization_id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$organizationId]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $row <span style=color:#f92672>=</span> $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetchAssociative</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentStatistics</span>(
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>int</span>) $row[<span style=color:#e6db74>&#39;total_payments&#39;</span>],
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>int</span>) $row[<span style=color:#e6db74>&#39;pending_payments&#39;</span>],
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>int</span>) $row[<span style=color:#e6db74>&#39;completed_payments&#39;</span>],
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>int</span>) $row[<span style=color:#e6db74>&#39;failed_payments&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;total_amount&#39;</span>],
</span></span><span style=display:flex><span>            $row[<span style=color:#e6db74>&#39;average_amount&#39;</span>],
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStatusDistribution</span>($organizationId),
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMonthlyTrends</span>($organizationId)
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>R√©sultat</strong> : Repositories sp√©cialis√©s pour chaque c√¥t√©.</p><h3 id=4-cr√©er-les-projections>4. <strong>Cr√©er les Projections</strong> <a href=#4-cr%c3%a9er-les-projections class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai cr√©√© les projections :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Projections CQRS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentProjection</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Connection</span> $connection,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handle</span>(<span style=color:#a6e22e>DomainEvent</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>match</span> ($event<span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentCreated</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handlePaymentCreated</span>($event),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentProcessingStarted</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handlePaymentProcessingStarted</span>($event),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentCompleted</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handlePaymentCompleted</span>($event),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentFailed</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>handlePaymentFailed</span>($event),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>warning</span>(<span style=color:#e6db74>&#39;Unknown event type&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;event_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($event)
</span></span><span style=display:flex><span>            ])
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handlePaymentCreated</span>(<span style=color:#a6e22e>PaymentCreated</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;INSERT INTO payment_views 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                (id, organization_id, customer_name, customer_email, amount, currency, status, created_at, created_by) 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCurrency</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdAt</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment view created&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handlePaymentProcessingStarted</span>(<span style=color:#a6e22e>PaymentProcessingStarted</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE payment_views 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                SET status = ?, processed_at = ? 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PROCESSING</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>startedAt</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment view updated - processing started&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handlePaymentCompleted</span>(<span style=color:#a6e22e>PaymentCompleted</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE payment_views 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                SET status = ?, processed_at = ? 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>COMPLETED</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>completedAt</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment view updated - completed&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handlePaymentFailed</span>(<span style=color:#a6e22e>PaymentFailed</span> $event)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UPDATE payment_views 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                SET status = ?, failed_at = ?, failure_reason = ? 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                WHERE id = ?&#39;</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $stmt <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connection</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($sql);
</span></span><span style=display:flex><span>        $stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FAILED</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>failedAt</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d H:i:s&#39;</span>),
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>reason</span>,
</span></span><span style=display:flex><span>            $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment view updated - failed&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;reason&#39;</span> <span style=color:#f92672>=&gt;</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>reason</span>
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>R√©sultat</strong> : Projections qui maintiennent les vues de lecture.</p><h2 id=les-avantages-de-cqrs>Les Avantages de CQRS <a href=#les-avantages-de-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-performance-optimale>1. <strong>Performance Optimale</strong> <a href=#1-performance-optimale class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS m&rsquo;a donn√© une performance optimale :</p><ul><li>Mod√®les optimis√©s pour chaque usage</li><li>Requ√™tes sp√©cialis√©es</li><li>Indexation adapt√©e</li><li>Cache sp√©cialis√©</li></ul><p><strong>R√©sultat</strong> : Performances maximales.</p><h3 id=2-scalabilit√©>2. <strong>Scalabilit√©</strong> <a href=#2-scalabilit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS m&rsquo;a permis de scaler :</p><ul><li>Scaling ind√©pendant des lectures et √©critures</li><li>Bases de donn√©es s√©par√©es</li><li>Load balancing sp√©cialis√©</li><li>R√©plication adapt√©e</li></ul><p><strong>R√©sultat</strong> : Scalabilit√© maximale.</p><h3 id=3-flexibilit√©>3. <strong>Flexibilit√©</strong> <a href=#3-flexibilit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS m&rsquo;a donn√© de la flexibilit√© :</p><ul><li>√âvolution ind√©pendante des mod√®les</li><li>Technologies diff√©rentes</li><li>Optimisations sp√©cialis√©es</li><li>Maintenance facilit√©e</li></ul><p><strong>R√©sultat</strong> : Flexibilit√© maximale.</p><h3 id=4-s√©curit√©>4. <strong>S√©curit√©</strong> <a href=#4-s%c3%a9curit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS m&rsquo;a am√©lior√© la s√©curit√© :</p><ul><li>Permissions diff√©rentes</li><li>Acc√®s s√©par√©s</li><li>Audit sp√©cialis√©</li><li>Isolation des donn√©es</li></ul><p><strong>R√©sultat</strong> : S√©curit√© renforc√©e.</p><h2 id=les-inconv√©nients-de-cqrs>Les Inconv√©nients de CQRS <a href=#les-inconv%c3%a9nients-de-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-complexit√©-tr√®s-√©lev√©e>1. <strong>Complexit√© Tr√®s √âlev√©e</strong> <a href=#1-complexit%c3%a9-tr%c3%a8s-%c3%a9lev%c3%a9e class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS a ajout√© une complexit√© tr√®s √©lev√©e :</p><ul><li>Deux mod√®les √† maintenir</li><li>Synchronisation complexe</li><li>Debugging difficile</li><li>Courbe d&rsquo;apprentissage importante</li></ul><p><strong>R√©sultat</strong> : Architecture tr√®s complexe.</p><h3 id=2-coh√©rence-√©ventuelle>2. <strong>Coh√©rence √âventuelle</strong> <a href=#2-coh%c3%a9rence-%c3%a9ventuelle class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS introduit la coh√©rence √©ventuelle :</p><ul><li>Donn√©es pas toujours synchronis√©es</li><li>Latence de synchronisation</li><li>Gestion des conflits</li><li>Tests complexes</li></ul><p><strong>R√©sultat</strong> : Coh√©rence √©ventuelle √† g√©rer.</p><h3 id=3-duplication-de-code>3. <strong>Duplication de Code</strong> <a href=#3-duplication-de-code class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS cr√©e beaucoup de duplication :</p><ul><li>Logique dupliqu√©e</li><li>Validation dupliqu√©e</li><li>Mapping dupliqu√©</li><li>Maintenance double</li></ul><p><strong>R√©sultat</strong> : Code dupliqu√© √† maintenir.</p><h3 id=4-co√ªt-de-d√©veloppement>4. <strong>Co√ªt de D√©veloppement</strong> <a href=#4-co%c3%bbt-de-d%c3%a9veloppement class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQRS augmente le co√ªt de d√©veloppement :</p><ul><li>Plus de code √† √©crire</li><li>Plus de tests</li><li>Plus de maintenance</li><li>Plus de formation</li></ul><p><strong>R√©sultat</strong> : Co√ªt de d√©veloppement plus √©lev√©.</p><h2 id=les-pi√®ges-√†-√©viter>Les Pi√®ges √† √âviter <a href=#les-pi%c3%a8ges-%c3%a0-%c3%a9viter class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-cqrs-pr√©matur√©>1. <strong>CQRS Pr√©matur√©</strong> <a href=#1-cqrs-pr%c3%a9matur%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>‚ùå Mauvais</strong> : CQRS pour des besoins simples
<strong>‚úÖ Bon</strong> : CQRS seulement quand n√©cessaire</p><p><strong>Pourquoi c&rsquo;est important ?</strong> CQRS ajoute de la complexit√© inutile.</p><h3 id=2-synchronisation-mal-g√©r√©e>2. <strong>Synchronisation Mal G√©r√©e</strong> <a href=#2-synchronisation-mal-g%c3%a9r%c3%a9e class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>‚ùå Mauvais</strong> : Pas de plan de synchronisation
<strong>‚úÖ Bon</strong> : Synchronisation bien planifi√©e</p><p><strong>Pourquoi c&rsquo;est crucial ?</strong> La synchronisation est critique pour CQRS.</p><h3 id=3-mod√®les-trop-similaires>3. <strong>Mod√®les Trop Similaires</strong> <a href=#3-mod%c3%a8les-trop-similaires class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>‚ùå Mauvais</strong> : Mod√®les de commande et requ√™te identiques
<strong>‚úÖ Bon</strong> : Mod√®les optimis√©s pour chaque usage</p><p><strong>Pourquoi c&rsquo;est essentiel ?</strong> CQRS perd son sens si les mod√®les sont identiques.</p><h3 id=4-tests-insuffisants>4. <strong>Tests Insuffisants</strong> <a href=#4-tests-insuffisants class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>‚ùå Mauvais</strong> : Pas de tests de synchronisation
<strong>‚úÖ Bon</strong> : Tests complets de synchronisation</p><p><strong>Pourquoi c&rsquo;est la cl√© ?</strong> Les tests sont critiques pour CQRS.</p><h2 id=l√©volution-vers-cqrs>L&rsquo;√âvolution vers CQRS <a href=#l%c3%a9volution-vers-cqrs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=phase-1--architecture-monolithique>Phase 1 : Architecture Monolithique <a href=#phase-1--architecture-monolithique class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Au d√©but, j&rsquo;avais une architecture monolithique :</p><ul><li>Un mod√®le pour tout</li><li>Performance non optimale</li><li>Scaling limit√©</li><li>Maintenance difficile</li></ul><p><strong>R√©sultat</strong> : D√©veloppement rapide, performance limit√©e.</p><h3 id=phase-2--introduction-de-cqs>Phase 2 : Introduction de CQS <a href=#phase-2--introduction-de-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai introduit CQS :</p><ul><li>S√©paration des commandes et requ√™tes</li><li>Performance am√©lior√©e</li><li>Tests simplifi√©s</li><li>Maintenance facilit√©e</li></ul><p><strong>R√©sultat</strong> : Architecture plus claire, performance am√©lior√©e.</p><h3 id=phase-3--cqrs-complet>Phase 3 : CQRS Complet <a href=#phase-3--cqrs-complet class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Maintenant, j&rsquo;ai un CQRS complet :</p><ul><li>Mod√®les s√©par√©s et optimis√©s</li><li>Performance maximale</li><li>Scalabilit√© maximale</li><li>Flexibilit√© maximale</li></ul><p><strong>R√©sultat</strong> : Architecture optimale mais complexe.</p><h2 id=-impl√©mentation-concr√®te-dans-le-projet-gyroscops-cloud>üèóÔ∏è Impl√©mentation Concr√®te dans le Projet Gyroscops Cloud <a href=#-impl%c3%a9mentation-concr%c3%a8te-dans-le-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=cqrs-appliqu√©-√†-gyroscops-cloud>CQRS Appliqu√© √† Gyroscops Cloud <a href=#cqrs-appliqu%c3%a9-%c3%a0-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le Gyroscops Cloud applique concr√®tement les principes de CQRS √† travers son architecture et ses ADR (Architecture Decision Records). Voici comment :</p><h4 id=configuration-cqrs-gyroscops-cloud>Configuration CQRS Gyroscops Cloud <a href=#configuration-cqrs-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ Configuration CQRS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HiveCQRSConfiguration</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>configureServices</span>(<span style=color:#a6e22e>ContainerBuilder</span> $container)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Command Side
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentCommandRepository</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentCommandService</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Query Side
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentQueryRepository</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentQueryService</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Projections
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Event Handlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentEventHandler</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addTag</span>(<span style=color:#e6db74>&#39;event.handler&#39;</span>, [<span style=color:#e6db74>&#39;event&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>PaymentCreated</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h4 id=api-platform-cqrs-gyroscops-cloud>API Platform CQRS Gyroscops Cloud <a href=#api-platform-cqrs-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ‚úÖ API Platform CQRS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e>#[ApiResource(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>operations</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Post</span>(<span style=color:#a6e22e>uriTemplate</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/payments&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>uriTemplate</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/payments/{id}&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>uriTemplate</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/payments/{id}&#39;</span>)
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>processor</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentCommandProcessor</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>
</span></span><span style=display:flex><span>)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentCommand</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $customerEmail,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $currency,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $createdBy
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[ApiResource(
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>operations</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>uriTemplate</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/payment-views/{id}&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GetCollection</span>(<span style=color:#a6e22e>uriTemplate</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/payment-views&#39;</span>)
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>provider</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentViewProvider</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>
</span></span><span style=display:flex><span>)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentView</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $id,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $organizationName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $customerName,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $customerEmail,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $amount,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $currency,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $createdAt,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $createdBy,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>string</span> $createdByName
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=r√©f√©rences-aux-adr-du-projet-gyroscops-cloud>R√©f√©rences aux ADR du Projet Gyroscops Cloud <a href=#r%c3%a9f%c3%a9rences-aux-adr-du-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Ce chapitre s&rsquo;appuie sur les Architecture Decision Records (ADR) suivants du Gyroscops Cloud :</p><ul><li><strong>HIVE006</strong> : Query Models for API Platform - Mod√®les de requ√™te</li><li><strong>HIVE007</strong> : Command Models for API Platform - Mod√®les de commande</li><li><strong>HIVE008</strong> : Event Collaboration - Collaboration bas√©e sur les √©v√©nements</li><li><strong>HIVE009</strong> : Message Buses - Bus de messages pour CQRS</li><li><strong>HIVE040</strong> : Enhanced Models with Property Access Patterns - Mod√®les enrichis pour CQRS</li><li><strong>HIVE041</strong> : Cross-Cutting Concerns Architecture - Architecture des pr√©occupations transversales</li></ul><div class=chapter-navigation><h2 class=chapter-nav-title>üéØ Votre Prochaine √âtape</h2><p class=chapter-nav-subtitle>Maintenant que vous comprenez les concepts de base et que j'ai partag√© mon exp√©rience avec Gyroscops, quel est votre contexte ?</p><div class=chapter-options><div class=chapter-option data-color=blue><div class=chapter-option-header><div class=chapter-option-letter>A</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres fondamentaux</h3><p class=chapter-option-subtitle>Vous voulez revoir les bases de DDD et Event Storming</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>√âquipe junior ou interm√©diaire</li><li>Besoin de revoir les bases</li><li>Compr√©hension des concepts</li><li>Fondations solides</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 30-45 minutes</span>
<a href=/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/ class=chapter-option-link>Introduction Event Storming DDD</a></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}<div class=chapter-option data-color=green><div class=chapter-option-header><div class=chapter-option-letter>B</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres de stockage</h3><p class=chapter-option-subtitle>Vous voulez voir comment impl√©menter la persistance selon diff√©rents patterns</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>√âquipe exp√©riment√©e</li><li>Besoin de comprendre la persistance</li><li>Patterns de stockage √† choisir</li><li>Impl√©mentation √† faire</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 30-45 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Stockage SQL - Approche Classique
<span class=coming-soon-indicator>üöß</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}<div class=chapter-option data-color=yellow data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>C</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres techniques</h3><p class=chapter-option-subtitle>Vous voulez voir les aspects techniques d'affinement</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>√âquipe exp√©riment√©e</li><li>Besoin de comprendre les aspects techniques</li><li>Qualit√© et performance importantes</li><li>Bonnes pratiques √† appliquer</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 25-35 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Gestion des Donn√©es et Validation
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}<div class=chapter-option data-color=red data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>D</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres avanc√©s</h3><p class=chapter-option-subtitle>Vous voulez voir la s√©curit√© et le frontend</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Crit√®res d'adoption :</h4><ul class=chapter-option-criteria-list><li>√âquipe exp√©riment√©e</li><li>Besoin de comprendre la s√©curit√© et le frontend</li><li>Int√©gration importante</li><li>Bonnes pratiques √† appliquer</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>‚è±Ô∏è 25-35 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">S√©curit√© et Autorisation
<span class=draft-indicator>üìù</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}</div></div><style>.chapter-navigation{margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;border-left:4px solid #3b82f6}.chapter-nav-title{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:#1e293b}.chapter-nav-subtitle{margin:0 0 1.5rem;color:#64748b;font-size:1rem;line-height:1.6}.chapter-options{display:flex;flex-direction:column;gap:1rem}.chapter-option{background:#fff;border-radius:8px;padding:1.25rem;border:1px solid #e2e8f0;transition:all .2s ease;position:relative;overflow:hidden}.chapter-option:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#3b82f6}.chapter-option::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--option-color,#6b7280);border-radius:0 2px 2px 0}.chapter-option-header{display:flex;align-items:center;margin-bottom:.75rem}.chapter-option-letter{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:50%;background:var(--option-color,#6b7280);color:#fff;font-weight:700;font-size:.875rem;margin-right:.75rem;flex-shrink:0}.chapter-option-title{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0;line-height:1.4}.chapter-option-subtitle{font-size:.875rem;color:#64748b;font-style:italic;margin:.25rem 0 0;line-height:1.4}.chapter-option-content{margin-left:2.75rem}.chapter-option-criteria{margin-bottom:.75rem}.chapter-option-criteria-title{font-size:.875rem;font-weight:600;color:#374151;margin:0 0 .5rem}.chapter-option-criteria-list{list-style:none;padding:0;margin:0}.chapter-option-criteria-list li{position:relative;padding-left:1.25rem;margin-bottom:.25rem;font-size:.875rem;color:#4b5563;line-height:1.4}.chapter-option-criteria-list li::before{content:'‚úì';position:absolute;left:0;color:#10b981;font-weight:600}.chapter-option-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1rem;padding-top:.75rem;border-top:1px solid #e5e7eb}.chapter-option-time{font-size:.875rem;color:#6b7280;font-weight:500}.chapter-option-link{display:inline-flex;align-items:center;padding:.5rem 1rem;background:var(--option-color,#6b7280);color:#fff!important;text-decoration:none!important;border-radius:6px;font-weight:600;font-size:.875rem;transition:all .2s ease;border:none;cursor:pointer}.chapter-option-link:hover{background:var(--option-color-dark,#4b5563);color:#fff!important;text-decoration:none!important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.chapter-option-link:visited{color:#fff!important;text-decoration:none!important}.chapter-option-link:focus{color:#fff!important;text-decoration:none!important;outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.chapter-option-link:active{color:#fff!important;text-decoration:none!important}.chapter-option-link::after{content:'‚Üí';margin-left:.5rem;transition:transform .2s ease;color:#fff!important}.chapter-option-link:hover::after{transform:translateX(2px);color:#fff!important}.chapter-navigation a{color:inherit;text-decoration:none}.chapter-navigation a:hover{color:inherit;text-decoration:none}.chapter-navigation a:visited{color:inherit;text-decoration:none}.chapter-navigation a:focus{color:inherit;text-decoration:none}.chapter-navigation a:active{color:inherit;text-decoration:none}.chapter-option[data-color=green]{--option-color:#10b981;--option-color-dark:#059669}.chapter-option[data-color=yellow]{--option-color:#f59e0b;--option-color-dark:#d97706}.chapter-option[data-color=red]{--option-color:#ef4444;--option-color-dark:#dc2626}.chapter-option[data-color=blue]{--option-color:#3b82f6;--option-color-dark:#2563eb}.chapter-option[data-color=purple]{--option-color:#8b5cf6;--option-color-dark:#7c3aed}.chapter-option[data-color=orange]{--option-color:#f97316;--option-color-dark:#ea580c}.chapter-option[data-color=teal]{--option-color:#14b8a6;--option-color-dark:#0d9488}.chapter-option[data-color=indigo]{--option-color:#6366f1;--option-color-dark:#4f46e5}.chapter-option[data-color=pink]{--option-color:#ec4899;--option-color-dark:#db2777}.chapter-option[data-color=cyan]{--option-color:#06b6d4;--option-color-dark:#0891b2}@media(max-width:768px){.chapter-navigation{padding:1rem}.chapter-option{padding:1rem}.chapter-option-content{margin-left:2.5rem}.chapter-option-footer{flex-direction:column;align-items:flex-start;gap:.75rem}.chapter-option-link{align-self:stretch;justify-content:center}}</style></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap"><div class="col-sm-6 pt-2 doc-next"><a href=/chapitres/fondamentaux/chapitre-09-repositories-persistance/><div class="card h-100 my-1"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0"><i class="material-icons align-middle">navigate_before</i> Chapitre 9 : Repositories et Persistance</p></div></div></a></div><div class="col-sm-6 pt-2 doc-prev"><a class=ms-auto href=/chapitres/optionnels/chapitre-12-architecture-cqs/><div class="card h-100 my-1 text-end"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0">Chapitre 15 : Architecture CQS - Command Query Separation <i class="material-icons align-middle">navigate_next</i></p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>¬© 2025 Gr√©gory Planchat. Tous droits r√©serv√©s.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci √† nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-2"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Kiboko</span></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Gyroscops</span></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.js defer></script><script type=text/javascript src=http://localhost:1313/docs/js/bundle.js defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>