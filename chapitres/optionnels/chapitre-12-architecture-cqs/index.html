<!doctype html><html lang=fr-fr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><title>Chapitre 15 : Architecture CQS - Command Query Separation | DDD Adventure</title><meta name=robots content="noindex"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Séparer les commandes des requêtes pour une architecture plus claire et performante"><meta name=keywords content="Documentation,Hugo,Hugo Theme,Bootstrap"><meta name=author content="Colin Wilson - Lotus Labs"><meta name=email content="support@aigis.uk"><meta name=website content="https://lotusdocs.dev"><meta name=Version content="v0.1.0"><link rel=icon href=http://localhost:1313/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=http://localhost:1313/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=http://localhost:1313/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=http://localhost:1313/site.webmanifest><meta property="og:title" content="Chapitre 15 : Architecture CQS - Command Query Separation"><meta property="og:description" content="Séparer les commandes des requêtes pour une architecture plus claire et performante"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/chapitres/optionnels/chapitre-12-architecture-cqs/"><meta property="og:image" content="http://localhost:1313/opengraph/card-base-2_hu_d4ad050e6983a9fb.png"><meta property="article:section" content="chapitres"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/opengraph/card-base-2_hu_d4ad050e6983a9fb.png"><meta name=twitter:title content="Chapitre 15 : Architecture CQS - Command Query Separation"><meta name=twitter:description content="Séparer les commandes des requêtes pour une architecture plus claire et performante"><link rel=alternate type=application/atom+xml title="Atom feed for DDD Adventure" href=/index.xml><script type=text/javascript src=http://localhost:1313/docs/js/flexsearch.bundle.js></script><link rel=stylesheet href=/docs/scss/style.css crossorigin=anonymous></head><body><div class=content><div class="page-wrapper toggled"><nav id=sidebar class=sidebar-wrapper><div class=sidebar-brand><a href=/ aria-label=HomePage alt=HomePage><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></a></div><div class=sidebar-content style="height:calc(100% - 131px)"><ul class=sidebar-menu><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Fondamentaux</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-01-introduction-event-storming-ddd/>Chapitre 1 : Introduction au Domain-Driven Design et Event Storming</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-02-impact-mapping/>Chapitre 2 : L'Impact Mapping - Aligner le Produit sur les Objectifs Business</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-03-atelier-event-storming/>Chapitre 3 : L'Atelier Event Storming - Guide Pratique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-04-example-mapping/>Chapitre 4 : L'Example Mapping - Détailer les Règles Métier</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-05-complexite-accidentelle-essentielle/>Chapitre 5 : Complexité Accidentelle vs Essentielle - Le Choix Architectural</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-06-granularite-choix-architecturaux/>Chapitre 6 : Granularité des Choix Architecturaux</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-07-modeles-riches-vs-anemiques/>Chapitre 7 : Modèles Riches vs Modèles Anémiques</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-08-architecture-evenementielle/>Chapitre 8 : Architecture Événementielle</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-09-repositories-persistance/>Chapitre 9 : Repositories et Persistance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/fondamentaux/chapitre-10-choix-type-stockage/>Chapitre 15 : Choix du Type de Stockage</a></li></ul></div></li><li class="sidebar-dropdown no-icon current active"><button class=btn>
Chapitres Optionnels</button><div class="sidebar-submenu d-block"><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-13-architecture-cqrs/>Chapitre 15 : Architecture CQRS avec API Platform</a></li><li class="current no-icon"><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-12-architecture-cqs/>Chapitre 15 : Architecture CQS - Command Query Separation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-11-event-sourcing/>Chapitre 15 : Event Sourcing - La Source de Vérité</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-14-cqrs-event-sourcing-combines/>Chapitre 15 : CQRS + Event Sourcing Combinés</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/optionnels/chapitre-15-projections-event-sourcing/>Chapitre 15 : Projections Event Sourcing</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres de Stockage</button><div class=sidebar-submenu><ul><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage SQL</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-16-stockage-sql-classique/>Chapitre 16 : Stockage SQL - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-17-stockage-sql-cqs/>Chapitre 17 : Stockage SQL - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-18-stockage-sql-cqrs/>Chapitre 18 : Stockage SQL - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-19-stockage-sql-event-sourcing/>Chapitre 19 : Stockage SQL - Event Sourcing Seul</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-20-stockage-sql-event-sourcing-cqs/>Chapitre 58 : Stockage SQL - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/sql/chapitre-21-stockage-sql-event-sourcing-cqrs/>Chapitre 59 : Stockage SQL - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage API</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-26-stockage-api-event-sourcing-cqs/>Chapitre 26 : Stockage API - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-27-stockage-api-event-sourcing-cqrs/>Chapitre 27 : Stockage API - Event Sourcing + CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-22-stockage-api-classique/>Chapitre 60 : Stockage API - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-23-stockage-api-cqs/>Chapitre 61 : Stockage API - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-24-stockage-api-cqrs/>Chapitre 62 : Stockage API - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/api/chapitre-25-stockage-api-event-sourcing/>Chapitre 63 : Stockage API - Event Sourcing Seul</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage MongoDB</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-28-stockage-mongodb-classique/>Chapitre 28 : Stockage MongoDB - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-29-stockage-mongodb-cqs/>Chapitre 29 : Stockage MongoDB - Approche CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-30-stockage-mongodb-cqrs/>Chapitre 30 : Stockage MongoDB - Approche CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-31-stockage-mongodb-event-sourcing/>Chapitre 31 : Stockage MongoDB - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-32-stockage-mongodb-event-sourcing-cqs/>Stockage MongoDB - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/mongodb/chapitre-33-stockage-mongodb-event-sourcing-cqrs/>Stockage MongoDB - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage ElasticSearch</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-34-stockage-elasticsearch-classique/>Stockage ElasticSearch - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-35-stockage-elasticsearch-cqs/>Stockage ElasticSearch - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-36-stockage-elasticsearch-cqrs/>Stockage ElasticSearch - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-37-stockage-elasticsearch-event-sourcing/>Stockage ElasticSearch - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-38-stockage-elasticsearch-event-sourcing-cqs/>Stockage ElasticSearch - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/elasticsearch/chapitre-39-stockage-elasticsearch-event-sourcing-cqrs/>Stockage ElasticSearch - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage In-Memory</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-40-stockage-in-memory-classique/>Stockage In-Memory - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-41-stockage-in-memory-cqs/>Stockage In-Memory - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-42-stockage-in-memory-cqrs/>Stockage In-Memory - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-43-stockage-in-memory-event-sourcing/>Stockage In-Memory - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-44-stockage-in-memory-event-sourcing-cqs/>Stockage In-Memory - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/in-memory/chapitre-45-stockage-in-memory-event-sourcing-cqrs/>Stockage In-Memory - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Composite piloté par Temporal</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-46-stockage-temporal-classique/>Stockage Temporal - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-47-stockage-temporal-cqs/>Stockage Temporal - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-48-stockage-temporal-cqrs/>Stockage Temporal - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-49-stockage-temporal-event-sourcing/>Stockage Temporal - Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-50-stockage-temporal-event-sourcing-cqs/>Stockage Temporal - Event Sourcing + CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/temporal/chapitre-51-stockage-temporal-event-sourcing-cqrs/>Stockage Temporal - Event Sourcing + CQRS</a></li></ul></div></li><li class="sidebar-dropdown nested no-icon"><button class=btn>
Stockage Multi-sources</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-52-stockage-multi-sources-classique/>Stockage Multi-sources - Approche Classique</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-53-stockage-multi-sources-cqs/>Stockage Multi-sources - CQS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-54-stockage-multi-sources-cqrs/>Stockage Multi-sources - CQRS</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-55-stockage-multi-sources-event-sourcing/>Stockage Multi-sources avec Event Sourcing</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-56-stockage-multi-sources-strategies-avancees/>Stratégies Avancées de Réplication Multi-sources</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/stockage/multi-sources/chapitre-57-stockage-multi-sources-resolution-conflits/>Résolution de Conflits Multi-sources</a></li></ul></div></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Techniques</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-58-gestion-donnees-validation/>Chapitre 58 : Gestion des Données et Validation</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-59-pagination-performance/>Chapitre 59 : Pagination et Performance</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-60-gestion-erreurs-observabilite/>Chapitre 60 : Gestion d'Erreurs et Observabilité</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/techniques/chapitre-61-tests-qualite/>Chapitre 61 : Tests et Qualité</a></li></ul></div></li><li class="sidebar-dropdown no-icon"><button class=btn>
Chapitres Avancés</button><div class=sidebar-submenu><ul><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-62-securite-autorisation/>Chapitre 62 : Sécurité et Autorisation - Protéger votre API Platform</a></li><li class=no-icon><a class=sidebar-nested-link href=http://localhost:1313/chapitres/avances/chapitre-63-frontend-integration/>Chapitre 63 : Frontend et Intégration - Connecter votre Interface Utilisateur</a></li></ul></div></li></ul></div><ul class="sidebar-footer list-unstyled mb-0"></ul></nav><main class="page-content bg-transparent"><div id=top-header class="top-header d-print-none"><div class="header-bar d-flex justify-content-between"><div class="d-flex align-items-center"><a href=/ class="logo-icon me-3" aria-label=HomePage alt=HomePage><div class=small><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div><div class=big><svg id="Layer_1" viewBox="0 0 250 250"><path d="m143 39.5c-18 0-18 18-18 18s0-18-18-18H22c-2.76.0-5 2.24-5 5v143c0 2.76 2.24 5 5 5h76c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h76c2.76.0 5-2.24 5-5V44.5c0-2.76-2.24-5-5-5h-85zM206 163c0 1.38-1.12 2.5-2.5 2.5H143c-18 0-18 18-18 18s0-18-18-18H46.5c-1.38.0-2.5-1.12-2.5-2.5V69c0-1.38 1.12-2.5 2.5-2.5H98c7.2.0 8.64 11.52 8.93 16.13.07 1.05.95 1.87 2 1.87h32.14c1.06.0 1.94-.82 2-1.87.29-4.61 1.73-16.13 8.93-16.13h51.5c1.38.0 2.5 1.12 2.5 2.5v94z" style="fill:#06f"/></svg></div></a><button id=close-sidebar class="btn btn-icon btn-soft">
<span class="material-icons size-20 menu-icon align-middle">menu</span>
</button>
<button id=flexsearch-button class="ms-3 btn btn-soft" data-bs-toggle=collapse data-bs-target=#FlexSearchCollapse aria-expanded=false aria-controls=FlexSearchCollapse>
<span class="material-icons size-20 menu-icon align-middle">search</span>
<span class="flexsearch-button-placeholder ms-1 me-2 d-none d-sm-block">Search</span><div class="d-none d-sm-block"><span class=flexsearch-button-keys><kbd class=flexsearch-button-cmd-key><svg width="44" height="15"><path d="M2.118 11.5A1.519 1.519.0 011 11.042 1.583 1.583.0 011 8.815a1.519 1.519.0 011.113-.458h.715V6.643h-.71A1.519 1.519.0 011 6.185 1.519 1.519.0 01.547 5.071 1.519 1.519.0 011 3.958 1.519 1.519.0 012.118 3.5a1.519 1.519.0 011.114.458A1.519 1.519.0 013.69 5.071v.715H5.4V5.071A1.564 1.564.0 016.976 3.5 1.564 1.564.0 018.547 5.071 1.564 1.564.0 016.976 6.643H6.261V8.357h.715a1.575 1.575.0 011.113 2.685 1.583 1.583.0 01-2.227.0A1.519 1.519.0 015.4 9.929V9.214H3.69v.715a1.519 1.519.0 01-.458 1.113A1.519 1.519.0 012.118 11.5zm0-.857a.714.714.0 00.715-.714V9.214H2.118a.715.715.0 100 1.429zm4.858.0a.715.715.0 100-1.429H6.261v.715a.714.714.0 00.715.714zM3.69 8.357H5.4V6.643H3.69zM2.118 5.786h.715V5.071a.714.714.0 00-.715-.714.715.715.0 00-.5 1.22A.686.686.0 002.118 5.786zm4.143.0h.715a.715.715.0 00.5-1.22.715.715.0 00-1.22.5z" fill="currentColor"/><path d="M12.4 11.475H11.344l3.879-7.95h1.056z" fill="currentColor"/><path d="M25.073 5.384l-.864.576a2.121 2.121.0 00-1.786-.923 2.207 2.207.0 00-2.266 2.326 2.206 2.206.0 002.266 2.325 2.1 2.1.0 001.782-.918l.84.617a3.108 3.108.0 01-2.622 1.293 3.217 3.217.0 01-3.349-3.317 3.217 3.217.0 013.349-3.317A3.046 3.046.0 0125.073 5.384z" fill="currentColor"/><path d="M30.993 5.142h-2.07v5.419H27.891V5.142h-2.07V4.164h5.172z" fill="currentColor"/><path d="M34.67 4.164c1.471.0 2.266.658 2.266 1.851.0 1.087-.832 1.809-2.134 1.855l2.107 2.691h-1.28L33.591 7.87H33.07v2.691H32.038v-6.4zm-1.6.969v1.8h1.572c.832.0 1.22-.3 1.22-.918s-.411-.882-1.22-.882z" fill="currentColor"/><path d="M42.883 10.561H38.31v-6.4h1.033V9.583h3.54z" fill="currentColor"/></svg>
</kbd><kbd class=flexsearch-button-key><svg width="15" height="15"><path d="M5.926 12.279H4.41L9.073 2.721H10.59z" fill="currentColor"/></svg></kbd></span></div></button></div><div class="d-flex align-items-center"><ul class="list-unstyled mb-0"></ul></div></div><div class=collapse id=FlexSearchCollapse><div class=flexsearch-container><div class=flexsearch-keymap><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd>
<kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd>
<span class=flexsearch-key-label>to navigate</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd>
<span class=flexsearch-key-label>to select</span></li><li><kbd class=flexsearch-button-cmd-key><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd>
<span class=flexsearch-key-label>to close</span></li></div><form class="flexsearch position-relative flex-grow-1 ms-2 me-2"><div class="d-flex flex-row"><input id=flexsearch class=form-control type=search placeholder=Search aria-label=Search autocomplete=off>
<button id=hideFlexsearch type=button class="ms-2 btn btn-soft">
cancel</button></div><div id=suggestions class="shadow rounded-1 d-none"></div></form></div></div></div><div class=container-fluid><div class=layout-spacing><div class="d-md-flex justify-content-between align-items-center"><nav aria-label=breadcrumb class="d-inline-block pb-2 mt-1 mt-sm-0"><ul id=breadcrumbs class="breadcrumb bg-transparent mb-0" itemscope itemtype=https://schema.org/BreadcrumbList><li class="breadcrumb-item text-capitalize active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/><i class="material-icons size-20 align-text-bottom" itemprop=name>Home</i>
</a><meta itemprop=position content='1'></li><li class="breadcrumb-item text-capitalize" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=/chapitres/optionnels/><span itemprop=name>Chapitres Optionnels</span>
</a><meta itemprop=position content='2'></li><li class="breadcrumb-item text-capitalize active" itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Chapitre 15 : Architecture CQS - Command Query Separation</span>
<meta itemprop=position content='3'></li></ul></nav></div><div class="row flex-xl-nowrap"><div class="docs-toc col-xl-3 d-xl-block"><toc><div class="fw-bold text-uppercase mb-2">On this page</div><nav id=TableOfContents><ul><li><a href=#-objectif-de-ce-chapitre>🎯 Objectif de ce Chapitre</a><ul><li><a href=#mon-problème--comment-séparer-les-opérations-de-lecture-et-décriture->Mon Problème : Comment Séparer les Opérations de Lecture et d&rsquo;Écriture ?</a></li><li><a href=#cqs--mon-guide-pratique>CQS : Mon Guide Pratique</a></li></ul></li><li><a href=#quest-ce-que-cqs->Qu&rsquo;est-ce que CQS ?</a><ul><li><a href=#le-concept-fondamental>Le Concept Fondamental</a></li><li><a href=#les-2-piliers-de-cqs>Les 2 Piliers de CQS</a></li></ul></li><li><a href=#comment-implémenter-cqs>Comment Implémenter CQS</a><ul><li><a href=#1-séparer-les-interfaces>1. <strong>Séparer les Interfaces</strong></a></li><li><a href=#2-implémenter-les-commandes>2. <strong>Implémenter les Commandes</strong></a></li><li><a href=#3-implémenter-les-requêtes>3. <strong>Implémenter les Requêtes</strong></a></li><li><a href=#4-créer-les-contrôleurs-api>4. <strong>Créer les Contrôleurs API</strong></a></li></ul></li><li><a href=#les-avantages-de-cqs>Les Avantages de CQS</a><ul><li><a href=#1-clarté-du-code>1. <strong>Clarté du Code</strong></a></li><li><a href=#2-optimisation-des-performances>2. <strong>Optimisation des Performances</strong></a></li><li><a href=#3-tests-simplifiés>3. <strong>Tests Simplifiés</strong></a></li><li><a href=#4-évolutivité>4. <strong>Évolutivité</strong></a></li></ul></li><li><a href=#les-inconvénients-de-cqs>Les Inconvénients de CQS</a><ul><li><a href=#1-complexité-accrue>1. <strong>Complexité Accrue</strong></a></li><li><a href=#2-duplication-de-code>2. <strong>Duplication de Code</strong></a></li><li><a href=#3-performance-d>3. <strong>Performance d’Écriture</strong></a></li><li><a href=#4-gestion-des-transactions>4. <strong>Gestion des Transactions</strong></a></li></ul></li><li><a href=#les-pièges-à-éviter>Les Pièges à Éviter</a><ul><li><a href=#1-mélanger-commandes-et-requêtes>1. <strong>Mélanger Commandes et Requêtes</strong></a></li><li><a href=#2-ignorer-les-effets-de-bord>2. <strong>Ignorer les Effets de Bord</strong></a></li><li><a href=#3-duplication-excessive>3. <strong>Duplication Excessive</strong></a></li><li><a href=#4-transactions-mal-gérées>4. <strong>Transactions Mal Gérées</strong></a></li></ul></li><li><a href=#lévolution-vers-cqs>L&rsquo;Évolution vers CQS</a><ul><li><a href=#phase-1--architecture-monolithique>Phase 1 : Architecture Monolithique</a></li><li><a href=#phase-2--introduction-de-cqs>Phase 2 : Introduction de CQS</a></li><li><a href=#phase-3--cqs-complet>Phase 3 : CQS Complet</a></li></ul></li><li><a href=#-implémentation-concrète-dans-le-projet-gyroscops-cloud>🏗️ Implémentation Concrète dans le Projet Gyroscops Cloud</a><ul><li><a href=#cqs-appliqué-à-gyroscops-cloud>CQS Appliqué à Gyroscops Cloud</a></li><li><a href=#références-aux-adr-du-projet-gyroscops-cloud>Références aux ADR du Projet Gyroscops Cloud</a></li></ul></li></ul></nav></toc></div><div class="docs-toc-mobile d-print-none d-xl-none"><button id=toc-dropdown-btn class="btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown data-bs-offset=0,0 aria-expanded=false>
Table of Contents</button><nav id=toc-mobile><ul class=dropdown-menu><li><a href=#-objectif-de-ce-chapitre>🎯 Objectif de ce Chapitre</a><ul><li><a href=#mon-problème--comment-séparer-les-opérations-de-lecture-et-décriture->Mon Problème : Comment Séparer les Opérations de Lecture et d&rsquo;Écriture ?</a></li><li><a href=#cqs--mon-guide-pratique>CQS : Mon Guide Pratique</a></li></ul></li><li><a href=#quest-ce-que-cqs->Qu&rsquo;est-ce que CQS ?</a><ul><li><a href=#le-concept-fondamental>Le Concept Fondamental</a></li><li><a href=#les-2-piliers-de-cqs>Les 2 Piliers de CQS</a></li></ul></li><li><a href=#comment-implémenter-cqs>Comment Implémenter CQS</a><ul><li><a href=#1-séparer-les-interfaces>1. <strong>Séparer les Interfaces</strong></a></li><li><a href=#2-implémenter-les-commandes>2. <strong>Implémenter les Commandes</strong></a></li><li><a href=#3-implémenter-les-requêtes>3. <strong>Implémenter les Requêtes</strong></a></li><li><a href=#4-créer-les-contrôleurs-api>4. <strong>Créer les Contrôleurs API</strong></a></li></ul></li><li><a href=#les-avantages-de-cqs>Les Avantages de CQS</a><ul><li><a href=#1-clarté-du-code>1. <strong>Clarté du Code</strong></a></li><li><a href=#2-optimisation-des-performances>2. <strong>Optimisation des Performances</strong></a></li><li><a href=#3-tests-simplifiés>3. <strong>Tests Simplifiés</strong></a></li><li><a href=#4-évolutivité>4. <strong>Évolutivité</strong></a></li></ul></li><li><a href=#les-inconvénients-de-cqs>Les Inconvénients de CQS</a><ul><li><a href=#1-complexité-accrue>1. <strong>Complexité Accrue</strong></a></li><li><a href=#2-duplication-de-code>2. <strong>Duplication de Code</strong></a></li><li><a href=#3-performance-d>3. <strong>Performance d’Écriture</strong></a></li><li><a href=#4-gestion-des-transactions>4. <strong>Gestion des Transactions</strong></a></li></ul></li><li><a href=#les-pièges-à-éviter>Les Pièges à Éviter</a><ul><li><a href=#1-mélanger-commandes-et-requêtes>1. <strong>Mélanger Commandes et Requêtes</strong></a></li><li><a href=#2-ignorer-les-effets-de-bord>2. <strong>Ignorer les Effets de Bord</strong></a></li><li><a href=#3-duplication-excessive>3. <strong>Duplication Excessive</strong></a></li><li><a href=#4-transactions-mal-gérées>4. <strong>Transactions Mal Gérées</strong></a></li></ul></li><li><a href=#lévolution-vers-cqs>L&rsquo;Évolution vers CQS</a><ul><li><a href=#phase-1--architecture-monolithique>Phase 1 : Architecture Monolithique</a></li><li><a href=#phase-2--introduction-de-cqs>Phase 2 : Introduction de CQS</a></li><li><a href=#phase-3--cqs-complet>Phase 3 : CQS Complet</a></li></ul></li><li><a href=#-implémentation-concrète-dans-le-projet-gyroscops-cloud>🏗️ Implémentation Concrète dans le Projet Gyroscops Cloud</a><ul><li><a href=#cqs-appliqué-à-gyroscops-cloud>CQS Appliqué à Gyroscops Cloud</a></li><li><a href=#références-aux-adr-du-projet-gyroscops-cloud>Références aux ADR du Projet Gyroscops Cloud</a></li></ul></li></ul></nav></div><div class="docs-content col-12 col-xl-9 mt-0"><div class="mb-0 d-flex"><h1 class="content-title mb-0">Chapitre 15 : Architecture CQS - Command Query Separation
<span class="badge bg-default fs-6 mb-1 align-middle">DRAFT</span></h1></div><div id=content class=main-content><div data-prismjs-copy data-prismjs-copy-success data-prismjs-copy-error><h2 id=-objectif-de-ce-chapitre>🎯 Objectif de ce Chapitre <a href=#-objectif-de-ce-chapitre class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=mon-problème--comment-séparer-les-opérations-de-lecture-et-décriture->Mon Problème : Comment Séparer les Opérations de Lecture et d&rsquo;Écriture ? <a href=#mon-probl%c3%a8me--comment-s%c3%a9parer-les-op%c3%a9rations-de-lecture-et-d%c3%a9criture- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Voici ce qui s&rsquo;est passé avec Gyroscops</strong> : J&rsquo;avais des méthodes qui faisaient tout : elles lisaient des données, les modifiaient, et retournaient des résultats. C&rsquo;était pratique au début, mais ça devenait un cauchemar pour les tests, la performance et la maintenance.</p><p><strong>Mais attendez&mldr;</strong> Comment séparer proprement les commandes (qui modifient l&rsquo;état) des requêtes (qui lisent l&rsquo;état) ? Comment éviter les effets de bord ? Comment optimiser les performances ?</p><p><strong>Soudain, je réalisais que CQS était la solution !</strong> Il me fallait une approche structurée pour séparer les responsabilités.</p><h3 id=cqs--mon-guide-pratique>CQS : Mon Guide Pratique <a href=#cqs--mon-guide-pratique class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>CQS m&rsquo;a permis de :</p><ul><li><strong>Séparer</strong> clairement les responsabilités</li><li><strong>Optimiser</strong> les performances de lecture</li><li><strong>Simplifier</strong> les tests</li><li><strong>Améliorer</strong> la maintenabilité</li></ul><h2 id=quest-ce-que-cqs->Qu&rsquo;est-ce que CQS ? <a href=#quest-ce-que-cqs- class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=le-concept-fondamental>Le Concept Fondamental <a href=#le-concept-fondamental class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>CQS (Command Query Separation) consiste à séparer les opérations en deux catégories : les <strong>Commandes</strong> (qui modifient l&rsquo;état) et les <strong>Requêtes</strong> (qui lisent l&rsquo;état). <strong>L&rsquo;idée</strong> : Une méthode ne peut pas faire les deux à la fois.</p><p><strong>Avec Gyroscops, voici comment j&rsquo;ai structuré CQS</strong> :</p><h3 id=les-2-piliers-de-cqs>Les 2 Piliers de CQS <a href=#les-2-piliers-de-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><h4 id=1-commandes---modifier-létat-sans-retourner-de-valeur>1. <strong>Commandes</strong> - Modifier l&rsquo;état sans retourner de valeur <a href=#1-commandes---modifier-l%c3%a9tat-sans-retourner-de-valeur class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai implémenté les commandes avec Gyroscops</strong> :</p><p><strong>Commandes Pures</strong> :</p><ul><li>Modifient l&rsquo;état de l&rsquo;application</li><li>Ne retournent pas de valeur (void)</li><li>Peuvent avoir des effets de bord</li><li>Sont idempotentes quand possible</li></ul><p><strong>Exemples</strong> :</p><ul><li><code>createPayment()</code></li><li><code>updateUser()</code></li><li><code>deleteOrder()</code></li><li><code>processPayment()</code></li></ul><h4 id=2-requêtes---lire-létat-sans-le-modifier>2. <strong>Requêtes</strong> - Lire l&rsquo;état sans le modifier <a href=#2-requ%c3%aates---lire-l%c3%a9tat-sans-le-modifier class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><p><strong>Voici comment j&rsquo;ai implémenté les requêtes avec Gyroscops</strong> :</p><p><strong>Requêtes Pures</strong> :</p><ul><li>Lisent l&rsquo;état de l&rsquo;application</li><li>Retournent une valeur</li><li>N&rsquo;ont pas d&rsquo;effets de bord</li><li>Sont idempotentes</li></ul><p><strong>Exemples</strong> :</p><ul><li><code>getPayment(id)</code></li><li><code>findUsersByOrganization()</code></li><li><code>getOrderHistory()</code></li><li><code>calculateTotal()</code></li></ul><h2 id=comment-implémenter-cqs>Comment Implémenter CQS <a href=#comment-impl%c3%a9menter-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-séparer-les-interfaces>1. <strong>Séparer les Interfaces</strong> <a href=#1-s%c3%a9parer-les-interfaces class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai séparé les interfaces :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Interfaces CQS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>PaymentCommandRepositoryInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>Payment</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>Payment</span> $payment)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>delete</span>(<span style=color:#a6e22e>PaymentId</span> $id)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processPayment</span>(<span style=color:#a6e22e>PaymentId</span> $id)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>PaymentQueryRepositoryInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findById</span>(<span style=color:#a6e22e>PaymentId</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Payment</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findByOrganization</span>(<span style=color:#a6e22e>OrganizationId</span> $organizationId)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span> $status)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>findByDateRange</span>(<span style=color:#a6e22e>\DateTimeImmutable</span> $start, <span style=color:#a6e22e>\DateTimeImmutable</span> $end)<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>countByOrganization</span>(<span style=color:#a6e22e>OrganizationId</span> $organizationId)<span style=color:#f92672>:</span> <span style=color:#a6e22e>int</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Interfaces claires et séparées.</p><h3 id=2-implémenter-les-commandes>2. <strong>Implémenter les Commandes</strong> <a href=#2-impl%c3%a9menter-les-commandes class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai implémenté les commandes :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Commandes Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentCommandService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentCommandRepositoryInterface</span> $commandRepository,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>EventBus</span> $eventBus,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createPayment</span>(<span style=color:#a6e22e>CreatePaymentCommand</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Creating payment&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;organization_id&#39;</span> <span style=color:#f92672>=&gt;</span> $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;amount&#39;</span> <span style=color:#f92672>=&gt;</span> $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Payment</span>(
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>,
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\DateTimeImmutable</span>(),
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>($payment);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventBus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>publish</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentCreated</span>(
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getOrganizationId</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCustomerName</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCustomerEmail</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAmount</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCreatedAt</span>(),
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span>
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment created successfully&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updatePayment</span>(<span style=color:#a6e22e>UpdatePaymentCommand</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Updating payment&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$payment) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentNotFoundException</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>updateCustomerInfo</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>, $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>);
</span></span><span style=display:flex><span>        $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>updateAmount</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>update</span>($payment);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventBus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>publish</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentUpdated</span>(
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUpdatedAt</span>(),
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>updatedBy</span>
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment updated successfully&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processPayment</span>(<span style=color:#a6e22e>ProcessPaymentCommand</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Processing payment&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payment <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$payment) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentNotFoundException</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStatus</span>() <span style=color:#f92672>!==</span> <span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidPaymentStatusException</span>($payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStatus</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>processPayment</span>($command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>eventBus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>publish</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentProcessed</span>(
</span></span><span style=display:flex><span>            $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\DateTimeImmutable</span>(),
</span></span><span style=display:flex><span>            $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>processedBy</span>
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Payment processed successfully&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getId</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Commandes claires et sans retour de valeur.</p><h3 id=3-implémenter-les-requêtes>3. <strong>Implémenter les Requêtes</strong> <a href=#3-impl%c3%a9menter-les-requ%c3%aates class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai implémenté les requêtes :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Requêtes Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentQueryService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentQueryRepositoryInterface</span> $queryRepository,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPayment</span>(<span style=color:#a6e22e>PaymentId</span> $id)<span style=color:#f92672>:</span> <span style=color:#f92672>?</span><span style=color:#a6e22e>Payment</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#39;Getting payment&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $id<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>($id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPaymentsByOrganization</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>OrganizationId</span> $organizationId,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>int</span> $page <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>int</span> $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>    )<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaginatedResult</span> {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#39;Getting payments by organization&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;organization_id&#39;</span> <span style=color:#f92672>=&gt;</span> $organizationId<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>(),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;page&#39;</span> <span style=color:#f92672>=&gt;</span> $page,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;limit&#39;</span> <span style=color:#f92672>=&gt;</span> $limit
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payments <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByOrganization</span>($organizationId);
</span></span><span style=display:flex><span>        $total <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>countByOrganization</span>($organizationId);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaginatedResult</span>(
</span></span><span style=display:flex><span>            $payments,
</span></span><span style=display:flex><span>            $page,
</span></span><span style=display:flex><span>            $limit,
</span></span><span style=display:flex><span>            $total
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPaymentsByStatus</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PaymentStatus</span> $status,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>int</span> $page <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>int</span> $limit <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>    )<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaginatedResult</span> {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#39;Getting payments by status&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;status&#39;</span> <span style=color:#f92672>=&gt;</span> $status<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;page&#39;</span> <span style=color:#f92672>=&gt;</span> $page,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;limit&#39;</span> <span style=color:#f92672>=&gt;</span> $limit
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $payments <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByStatus</span>($status);
</span></span><span style=display:flex><span>        $total <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>($payments);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaginatedResult</span>(
</span></span><span style=display:flex><span>            $payments,
</span></span><span style=display:flex><span>            $page,
</span></span><span style=display:flex><span>            $limit,
</span></span><span style=display:flex><span>            $total
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPaymentStatistics</span>(<span style=color:#a6e22e>OrganizationId</span> $organizationId)<span style=color:#f92672>:</span> <span style=color:#a6e22e>PaymentStatistics</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#39;Getting payment statistics&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;organization_id&#39;</span> <span style=color:#f92672>=&gt;</span> $organizationId<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $totalPayments <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>countByOrganization</span>($organizationId);
</span></span><span style=display:flex><span>        $pendingPayments <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>PENDING</span>));
</span></span><span style=display:flex><span>        $completedPayments <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>COMPLETED</span>));
</span></span><span style=display:flex><span>        $failedPayments <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryRepository</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByStatus</span>(<span style=color:#a6e22e>PaymentStatus</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FAILED</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentStatistics</span>(
</span></span><span style=display:flex><span>            $totalPayments,
</span></span><span style=display:flex><span>            $pendingPayments,
</span></span><span style=display:flex><span>            $completedPayments,
</span></span><span style=display:flex><span>            $failedPayments
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Requêtes optimisées et sans effets de bord.</p><h3 id=4-créer-les-contrôleurs-api>4. <strong>Créer les Contrôleurs API</strong> <a href=#4-cr%c3%a9er-les-contr%c3%b4leurs-api class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai créé les contrôleurs :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Contrôleurs CQS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentCommandController</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentCommandService</span> $commandService,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[Route(&#39;/api/payments&#39;, methods: [&#39;POST&#39;])]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createPayment</span>(<span style=color:#a6e22e>CreatePaymentRequest</span> $request)<span style=color:#f92672>:</span> <span style=color:#a6e22e>JsonResponse</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            $command <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CreatePaymentCommand</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>PaymentId</span><span style=color:#f92672>::</span><span style=color:#a6e22e>generate</span>(),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>OrganizationId</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>),
</span></span><span style=display:flex><span>                $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>,
</span></span><span style=display:flex><span>                $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>,
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Price</span>(<span style=color:#a6e22e>BigDecimal</span><span style=color:#f92672>::</span><span style=color:#a6e22e>of</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>), <span style=color:#a6e22e>Currencies</span><span style=color:#f92672>::</span><span style=color:#a6e22e>from</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>)),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserId</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createdBy</span>)
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createPayment</span>($command);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Payment created successfully&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toString</span>()
</span></span><span style=display:flex><span>            ], <span style=color:#ae81ff>201</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to create payment&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Failed to create payment&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ], <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[Route(&#39;/api/payments/{id}&#39;, methods: [&#39;PUT&#39;])]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updatePayment</span>(<span style=color:#a6e22e>string</span> $id, <span style=color:#a6e22e>UpdatePaymentRequest</span> $request)<span style=color:#f92672>:</span> <span style=color:#a6e22e>JsonResponse</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            $command <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UpdatePaymentCommand</span>(
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentId</span>($id),
</span></span><span style=display:flex><span>                $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerName</span>,
</span></span><span style=display:flex><span>                $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>customerEmail</span>,
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Price</span>(<span style=color:#a6e22e>BigDecimal</span><span style=color:#f92672>::</span><span style=color:#a6e22e>of</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>amount</span>), <span style=color:#a6e22e>Currencies</span><span style=color:#f92672>::</span><span style=color:#a6e22e>from</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span>)),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UserId</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>updatedBy</span>)
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>updatePayment</span>($command);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Payment updated successfully&#39;</span>
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to update payment&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $id,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Failed to update payment&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ], <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PaymentQueryController</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentQueryService</span> $queryService,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[Route(&#39;/api/payments/{id}&#39;, methods: [&#39;GET&#39;])]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPayment</span>(<span style=color:#a6e22e>string</span> $id)<span style=color:#f92672>:</span> <span style=color:#a6e22e>JsonResponse</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            $payment <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPayment</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PaymentId</span>($id));
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$payment) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Payment not found&#39;</span>
</span></span><span style=display:flex><span>                ], <span style=color:#ae81ff>404</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;data&#39;</span> <span style=color:#f92672>=&gt;</span> $payment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toArray</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to get payment&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;payment_id&#39;</span> <span style=color:#f92672>=&gt;</span> $id,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Failed to get payment&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ], <span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[Route(&#39;/api/payments&#39;, methods: [&#39;GET&#39;])]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getPayments</span>(<span style=color:#a6e22e>Request</span> $request)<span style=color:#f92672>:</span> <span style=color:#a6e22e>JsonResponse</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            $organizationId <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>OrganizationId</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;organization_id&#39;</span>));
</span></span><span style=display:flex><span>            $page <span style=color:#f92672>=</span> (<span style=color:#a6e22e>int</span>) $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;page&#39;</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>            $limit <span style=color:#f92672>=</span> (<span style=color:#a6e22e>int</span>) $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>query</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;limit&#39;</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $result <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPaymentsByOrganization</span>($organizationId, $page, $limit);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;data&#39;</span> <span style=color:#f92672>=&gt;</span> $result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getData</span>(),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;pagination&#39;</span> <span style=color:#f92672>=&gt;</span> $result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPagination</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to get payments&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JsonResponse</span>([
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;success&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;message&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Failed to get payments&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ], <span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Résultat</strong> : Contrôleurs séparés et spécialisés.</p><h2 id=les-avantages-de-cqs>Les Avantages de CQS <a href=#les-avantages-de-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-clarté-du-code>1. <strong>Clarté du Code</strong> <a href=#1-clart%c3%a9-du-code class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS m&rsquo;a donné une clarté du code :</p><ul><li>Séparation claire des responsabilités</li><li>Code plus lisible</li><li>Intention explicite</li><li>Maintenance facilitée</li></ul><p><strong>Résultat</strong> : Code plus maintenable et compréhensible.</p><h3 id=2-optimisation-des-performances>2. <strong>Optimisation des Performances</strong> <a href=#2-optimisation-des-performances class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS m&rsquo;a permis d&rsquo;optimiser les performances :</p><ul><li>Requêtes optimisées pour la lecture</li><li>Commandes optimisées pour l&rsquo;écriture</li><li>Cache spécialisé</li><li>Indexation adaptée</li></ul><p><strong>Résultat</strong> : Performances améliorées.</p><h3 id=3-tests-simplifiés>3. <strong>Tests Simplifiés</strong> <a href=#3-tests-simplifi%c3%a9s class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS a simplifié les tests :</p><ul><li>Tests de commandes isolés</li><li>Tests de requêtes isolés</li><li>Mocks plus simples</li><li>Couverture de test améliorée</li></ul><p><strong>Résultat</strong> : Tests plus fiables et maintenables.</p><h3 id=4-évolutivité>4. <strong>Évolutivité</strong> <a href=#4-%c3%a9volutivit%c3%a9 class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS m&rsquo;a donné de l&rsquo;évolutivité :</p><ul><li>Évolution indépendante des commandes et requêtes</li><li>Ajout de nouvelles fonctionnalités</li><li>Refactoring facilité</li><li>Architecture modulaire</li></ul><p><strong>Résultat</strong> : Évolution facilitée.</p><h2 id=les-inconvénients-de-cqs>Les Inconvénients de CQS <a href=#les-inconv%c3%a9nients-de-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-complexité-accrue>1. <strong>Complexité Accrue</strong> <a href=#1-complexit%c3%a9-accrue class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS a ajouté de la complexité :</p><ul><li>Plus de classes et interfaces</li><li>Séparation à maintenir</li><li>Coordination nécessaire</li><li>Courbe d&rsquo;apprentissage</li></ul><p><strong>Résultat</strong> : Architecture plus complexe.</p><h3 id=2-duplication-de-code>2. <strong>Duplication de Code</strong> <a href=#2-duplication-de-code class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS peut créer de la duplication :</p><ul><li>Logique similaire dans commandes et requêtes</li><li>Validation dupliquée</li><li>Mapping dupliqué</li><li>Maintenance de deux côtés</li></ul><p><strong>Résultat</strong> : Code dupliqué à maintenir.</p><h3 id=3-performance-d>3. <strong>Performance d&rsquo;Écriture</strong> <a href=#3-performance-d class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS peut impacter les écritures :</p><ul><li>Plus d&rsquo;appels de méthodes</li><li>Validation multiple</li><li>Coordination des services</li><li>Latence accrue</li></ul><p><strong>Résultat</strong> : Performance d&rsquo;écriture potentiellement dégradée.</p><h3 id=4-gestion-des-transactions>4. <strong>Gestion des Transactions</strong> <a href=#4-gestion-des-transactions class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : CQS complique les transactions :</p><ul><li>Transactions distribuées</li><li>Coordination des commandes</li><li>Rollback complexe</li><li>Gestion des erreurs</li></ul><p><strong>Résultat</strong> : Gestion des transactions plus complexe.</p><h2 id=les-pièges-à-éviter>Les Pièges à Éviter <a href=#les-pi%c3%a8ges-%c3%a0-%c3%a9viter class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=1-mélanger-commandes-et-requêtes>1. <strong>Mélanger Commandes et Requêtes</strong> <a href=#1-m%c3%a9langer-commandes-et-requ%c3%aates class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Une méthode qui modifie et retourne
<strong>✅ Bon</strong> : Séparation claire des responsabilités</p><p><strong>Pourquoi c&rsquo;est important ?</strong> CQS perd son sens si on mélange.</p><h3 id=2-ignorer-les-effets-de-bord>2. <strong>Ignorer les Effets de Bord</strong> <a href=#2-ignorer-les-effets-de-bord class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Requêtes avec effets de bord
<strong>✅ Bon</strong> : Requêtes pures</p><p><strong>Pourquoi c&rsquo;est crucial ?</strong> Les effets de bord cassent CQS.</p><h3 id=3-duplication-excessive>3. <strong>Duplication Excessive</strong> <a href=#3-duplication-excessive class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Code dupliqué partout
<strong>✅ Bon</strong> : Extraction des parties communes</p><p><strong>Pourquoi c&rsquo;est essentiel ?</strong> La duplication complique la maintenance.</p><h3 id=4-transactions-mal-gérées>4. <strong>Transactions Mal Gérées</strong> <a href=#4-transactions-mal-g%c3%a9r%c3%a9es class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>❌ Mauvais</strong> : Pas de gestion des transactions
<strong>✅ Bon</strong> : Transactions bien définies</p><p><strong>Pourquoi c&rsquo;est la clé ?</strong> Les transactions sont critiques pour la cohérence.</p><h2 id=lévolution-vers-cqs>L&rsquo;Évolution vers CQS <a href=#l%c3%a9volution-vers-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=phase-1--architecture-monolithique>Phase 1 : Architecture Monolithique <a href=#phase-1--architecture-monolithique class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Au début, j&rsquo;avais une architecture monolithique :</p><ul><li>Méthodes qui font tout</li><li>Pas de séparation</li><li>Tests difficiles</li><li>Performance non optimale</li></ul><p><strong>Résultat</strong> : Développement rapide, maintenance difficile.</p><h3 id=phase-2--introduction-de-cqs>Phase 2 : Introduction de CQS <a href=#phase-2--introduction-de-cqs class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : J&rsquo;ai introduit CQS :</p><ul><li>Séparation des commandes et requêtes</li><li>Interfaces spécialisées</li><li>Tests simplifiés</li><li>Performance améliorée</li></ul><p><strong>Résultat</strong> : Architecture plus claire, maintenance facilitée.</p><h3 id=phase-3--cqs-complet>Phase 3 : CQS Complet <a href=#phase-3--cqs-complet class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p><strong>Avec Gyroscops</strong> : Maintenant, j&rsquo;ai un CQS complet :</p><ul><li>Séparation claire des responsabilités</li><li>Optimisation des performances</li><li>Tests robustes</li><li>Architecture modulaire</li></ul><p><strong>Résultat</strong> : Architecture claire et performante.</p><h2 id=-implémentation-concrète-dans-le-projet-gyroscops-cloud>🏗️ Implémentation Concrète dans le Projet Gyroscops Cloud <a href=#-impl%c3%a9mentation-concr%c3%a8te-dans-le-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h2><h3 id=cqs-appliqué-à-gyroscops-cloud>CQS Appliqué à Gyroscops Cloud <a href=#cqs-appliqu%c3%a9-%c3%a0-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Le Gyroscops Cloud applique concrètement les principes de CQS à travers son architecture et ses ADR (Architecture Decision Records). Voici comment :</p><h4 id=services-cqs-gyroscops-cloud>Services CQS Gyroscops Cloud <a href=#services-cqs-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Services CQS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HiveCQSService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__construct</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentCommandService</span> $commandService,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PaymentQueryService</span> $queryService,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LoggerInterface</span> $logger
</span></span><span style=display:flex><span>    ) {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>executeCommand</span>(<span style=color:#a6e22e>CommandInterface</span> $command)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Executing command&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;command_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($command)
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>match</span> (<span style=color:#a6e22e>get_class</span>($command)) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>CreatePaymentCommand</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createPayment</span>($command),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>UpdatePaymentCommand</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>updatePayment</span>($command),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ProcessPaymentCommand</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>commandService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>processPayment</span>($command),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UnknownCommandException</span>(<span style=color:#a6e22e>get_class</span>($command))
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Command executed successfully&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;command_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($command)
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Command execution failed&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;command_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($command),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> $e;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>executeQuery</span>(<span style=color:#a6e22e>QueryInterface</span> $query)<span style=color:#f92672>:</span> <span style=color:#a6e22e>mixed</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Executing query&#39;</span>, [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;query_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($query)
</span></span><span style=display:flex><span>        ]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            $result <span style=color:#f92672>=</span> <span style=color:#a6e22e>match</span> (<span style=color:#a6e22e>get_class</span>($query)) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>GetPaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPayment</span>($query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>paymentId</span>),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>GetPaymentsByOrganizationQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPaymentsByOrganization</span>(
</span></span><span style=display:flex><span>                    $query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>,
</span></span><span style=display:flex><span>                    $query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>page</span>,
</span></span><span style=display:flex><span>                    $query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>limit</span>
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>GetPaymentStatisticsQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryService</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPaymentStatistics</span>($query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>organizationId</span>),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UnknownQueryException</span>(<span style=color:#a6e22e>get_class</span>($query))
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Query executed successfully&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;query_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($query)
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $result;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>\Exception</span> $e) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>logger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Query execution failed&#39;</span>, [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;query_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>get_class</span>($query),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;error&#39;</span> <span style=color:#f92672>=&gt;</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>()
</span></span><span style=display:flex><span>            ]);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> $e;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h4 id=configuration-cqs-gyroscops-cloud>Configuration CQS Gyroscops Cloud <a href=#configuration-cqs-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// ✅ Configuration CQS Gyroscops Cloud (Projet Gyroscops Cloud)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HiveCQSConfiguration</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>configureServices</span>(<span style=color:#a6e22e>ContainerBuilder</span> $container)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Command Services
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentCommandService</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Query Services
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>PaymentQueryService</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// CQS Service
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>HiveCQSService</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAutowired</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setPublic</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Command Handlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>CreatePaymentCommandHandler</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addTag</span>(<span style=color:#e6db74>&#39;command.handler&#39;</span>, [<span style=color:#e6db74>&#39;command&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>CreatePaymentCommand</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>]);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Query Handlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $container<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>GetPaymentQueryHandler</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addTag</span>(<span style=color:#e6db74>&#39;query.handler&#39;</span>, [<span style=color:#e6db74>&#39;query&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>GetPaymentQuery</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=références-aux-adr-du-projet-gyroscops-cloud>Références aux ADR du Projet Gyroscops Cloud <a href=#r%c3%a9f%c3%a9rences-aux-adr-du-projet-gyroscops-cloud class=anchor aria-hidden=true><i class="material-icons align-middle">link</i></a></h3><p>Ce chapitre s&rsquo;appuie sur les Architecture Decision Records (ADR) suivants du Gyroscops Cloud :</p><ul><li><strong>HIVE006</strong> : Query Models for API Platform - Modèles de requête</li><li><strong>HIVE007</strong> : Command Models for API Platform - Modèles de commande</li><li><strong>HIVE040</strong> : Enhanced Models with Property Access Patterns - Modèles enrichis pour CQS</li><li><strong>HIVE041</strong> : Cross-Cutting Concerns Architecture - Architecture des préoccupations transversales</li></ul><div class=chapter-navigation><h2 class=chapter-nav-title>🎯 Votre Prochaine Étape</h2><p class=chapter-nav-subtitle>Maintenant que vous comprenez les concepts de base et que j'ai partagé mon expérience avec Gyroscops, quel est votre contexte ?</p><div class=chapter-options><div class=chapter-option data-color=green><div class=chapter-option-header><div class=chapter-option-letter>A</div><div><h3 class=chapter-option-title>Je veux comprendre CQRS complet</h3><p class=chapter-option-subtitle>Vous voulez voir la séparation complète entre commandes et requêtes</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe très expérimentée</li><li>Besoin de CQRS complet</li><li>Complexité très élevée</li><li>Performance critique</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 30-45 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Architecture CQRS avec API Platform
<span class=coming-soon-indicator>🚧</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}<div class=chapter-option data-color=yellow><div class=chapter-option-header><div class=chapter-option-letter>B</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres de stockage</h3><p class=chapter-option-subtitle>Vous voulez voir comment implémenter la persistance selon différents patterns</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe expérimentée</li><li>Besoin de comprendre la persistance</li><li>Patterns de stockage à choisir</li><li>Implémentation à faire</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 30-45 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Stockage SQL - Approche Classique
<span class=coming-soon-indicator>🚧</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}<div class=chapter-option data-color=red data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>C</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres techniques</h3><p class=chapter-option-subtitle>Vous voulez voir les aspects techniques d'affinement</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe expérimentée</li><li>Besoin de comprendre les aspects techniques</li><li>Qualité et performance importantes</li><li>Bonnes pratiques à appliquer</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 25-35 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Gestion des Données et Validation
<span class=draft-indicator>📝</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}<div class=chapter-option data-color=blue data-draft=true><div class=chapter-option-header><div class=chapter-option-letter>D</div><div><h3 class=chapter-option-title>Je veux comprendre les chapitres avancés</h3><p class=chapter-option-subtitle>Vous voulez voir la sécurité et le frontend</p></div></div><div class=chapter-option-content><div class=chapter-option-criteria><h4 class=chapter-option-criteria-title>Critères d'adoption :</h4><ul class=chapter-option-criteria-list><li>Équipe expérimentée</li><li>Besoin de comprendre la sécurité et le frontend</li><li>Intégration importante</li><li>Bonnes pratiques à appliquer</li></ul></div><div class=chapter-option-footer><span class=chapter-option-time>⏱️ 25-35 minutes</span>
<span class="chapter-option-link chapter-option-link-disabled">Sécurité et Autorisation
<span class=draft-indicator>📝</span></span></div></div></div><style>.chapter-option-link-disabled{background:#9ca3af!important;color:#6b7280!important;cursor:not-allowed!important;opacity:.7}.chapter-option-link-disabled:hover{background:#9ca3af!important;color:#6b7280!important;transform:none!important;box-shadow:none!important}.chapter-option-link-disabled::after{display:none!important}.chapter-option[data-draft=true]{opacity:.8;border-style:dashed;border-color:#d1d5db}.chapter-option[data-draft=true] .chapter-option-letter{background:#9ca3af}.chapter-option[data-draft=true] .chapter-option-title{color:#6b7280}.chapter-option[data-draft=true] .chapter-option-subtitle{color:#9ca3af}.draft-indicator,.coming-soon-indicator{margin-left:.5rem;font-size:.875rem}.chapter-option[data-draft=true]{animation:draft-pulse 2s ease-in-out infinite}@keyframes draft-pulse{0%,100%{opacity:.8}50%{opacity:.6}}</style>}</div></div><style>.chapter-navigation{margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;border-left:4px solid #3b82f6}.chapter-nav-title{margin:0 0 .5rem;font-size:1.5rem;font-weight:700;color:#1e293b}.chapter-nav-subtitle{margin:0 0 1.5rem;color:#64748b;font-size:1rem;line-height:1.6}.chapter-options{display:flex;flex-direction:column;gap:1rem}.chapter-option{background:#fff;border-radius:8px;padding:1.25rem;border:1px solid #e2e8f0;transition:all .2s ease;position:relative;overflow:hidden}.chapter-option:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);border-color:#3b82f6}.chapter-option::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--option-color,#6b7280);border-radius:0 2px 2px 0}.chapter-option-header{display:flex;align-items:center;margin-bottom:.75rem}.chapter-option-letter{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:50%;background:var(--option-color,#6b7280);color:#fff;font-weight:700;font-size:.875rem;margin-right:.75rem;flex-shrink:0}.chapter-option-title{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0;line-height:1.4}.chapter-option-subtitle{font-size:.875rem;color:#64748b;font-style:italic;margin:.25rem 0 0;line-height:1.4}.chapter-option-content{margin-left:2.75rem}.chapter-option-criteria{margin-bottom:.75rem}.chapter-option-criteria-title{font-size:.875rem;font-weight:600;color:#374151;margin:0 0 .5rem}.chapter-option-criteria-list{list-style:none;padding:0;margin:0}.chapter-option-criteria-list li{position:relative;padding-left:1.25rem;margin-bottom:.25rem;font-size:.875rem;color:#4b5563;line-height:1.4}.chapter-option-criteria-list li::before{content:'✓';position:absolute;left:0;color:#10b981;font-weight:600}.chapter-option-footer{display:flex;justify-content:space-between;align-items:center;margin-top:1rem;padding-top:.75rem;border-top:1px solid #e5e7eb}.chapter-option-time{font-size:.875rem;color:#6b7280;font-weight:500}.chapter-option-link{display:inline-flex;align-items:center;padding:.5rem 1rem;background:var(--option-color,#6b7280);color:#fff!important;text-decoration:none!important;border-radius:6px;font-weight:600;font-size:.875rem;transition:all .2s ease;border:none;cursor:pointer}.chapter-option-link:hover{background:var(--option-color-dark,#4b5563);color:#fff!important;text-decoration:none!important;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.chapter-option-link:visited{color:#fff!important;text-decoration:none!important}.chapter-option-link:focus{color:#fff!important;text-decoration:none!important;outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.chapter-option-link:active{color:#fff!important;text-decoration:none!important}.chapter-option-link::after{content:'→';margin-left:.5rem;transition:transform .2s ease;color:#fff!important}.chapter-option-link:hover::after{transform:translateX(2px);color:#fff!important}.chapter-navigation a{color:inherit;text-decoration:none}.chapter-navigation a:hover{color:inherit;text-decoration:none}.chapter-navigation a:visited{color:inherit;text-decoration:none}.chapter-navigation a:focus{color:inherit;text-decoration:none}.chapter-navigation a:active{color:inherit;text-decoration:none}.chapter-option[data-color=green]{--option-color:#10b981;--option-color-dark:#059669}.chapter-option[data-color=yellow]{--option-color:#f59e0b;--option-color-dark:#d97706}.chapter-option[data-color=red]{--option-color:#ef4444;--option-color-dark:#dc2626}.chapter-option[data-color=blue]{--option-color:#3b82f6;--option-color-dark:#2563eb}.chapter-option[data-color=purple]{--option-color:#8b5cf6;--option-color-dark:#7c3aed}.chapter-option[data-color=orange]{--option-color:#f97316;--option-color-dark:#ea580c}.chapter-option[data-color=teal]{--option-color:#14b8a6;--option-color-dark:#0d9488}.chapter-option[data-color=indigo]{--option-color:#6366f1;--option-color-dark:#4f46e5}.chapter-option[data-color=pink]{--option-color:#ec4899;--option-color-dark:#db2777}.chapter-option[data-color=cyan]{--option-color:#06b6d4;--option-color-dark:#0891b2}@media(max-width:768px){.chapter-navigation{padding:1rem}.chapter-option{padding:1rem}.chapter-option-content{margin-left:2.5rem}.chapter-option-footer{flex-direction:column;align-items:flex-start;gap:.75rem}.chapter-option-link{align-self:stretch;justify-content:center}}</style></div></div><div><hr class=doc-hr><div id=doc-nav class=d-print-none><div class="row flex-xl-nowrap"><div class="col-sm-6 pt-2 doc-next"><a href=/chapitres/optionnels/chapitre-13-architecture-cqrs/><div class="card h-100 my-1"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0"><i class="material-icons align-middle">navigate_before</i> Chapitre 15 : Architecture CQRS avec API Platform</p></div></div></a></div><div class="col-sm-6 pt-2 doc-prev"><a class=ms-auto href=/chapitres/fondamentaux/chapitre-10-choix-type-stockage/><div class="card h-100 my-1 text-end"><div class="card-body py-2"><p class="card-title fs-5 fw-semibold lh-base mb-0">Chapitre 15 : Choix du Type de Stockage <i class="material-icons align-middle">navigate_next</i></p></div></div></a></div></div></div></div></div></div></div></div><footer class="shadow py-3 d-print-none"><div class=container-fluid><div class="row align-items-center"><div class=col><div class="text-sm-start text-center mx-md-2"><p class=mb-0>© 2025 Grégory Planchat. Tous droits réservés.</p></div></div></div><div class="row mt-3 pt-3 border-top"><div class=col-12><div class=text-center><h6 class="text-muted mb-2">Nos Sponsors</h6><p class="text-muted small mb-2">Merci à nos partenaires qui soutiennent cette initiative</p><div class="d-flex justify-content-center align-items-center flex-wrap gap-2"><div class=sponsor-item><a href=https://kiboko.fr target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Kiboko</span></a></div><div class=sponsor-item><a href=https://gyroscops.com target=_blank rel="noopener noreferrer" class=text-decoration-none><span class="badge bg-light text-dark border px-2 py-1 small">Gyroscops</span></a></div></div></div></div></div></div></footer></main></div></div><button onclick=topFunction() id=back-to-top aria-label="Back to Top Button" class="back-to-top fs-5"><svg width="24" height="24"><path d="M12 10.224l-6.3 6.3-1.38-1.372L12 7.472l7.68 7.68-1.38 1.376z" style="fill:#fff"/></svg></button>
<script src=/docs/js/bootstrap.js defer></script><script type=text/javascript src=http://localhost:1313/docs/js/bundle.js defer></script><script type=module>
    var suggestions = document.getElementById('suggestions');
    var search = document.getElementById('flexsearch');

    const flexsearchContainer = document.getElementById('FlexSearchCollapse');

    const hideFlexsearchBtn = document.getElementById('hideFlexsearch');

    const configObject = { toggle: false }
    const flexsearchContainerCollapse = new Collapse(flexsearchContainer, configObject) 

    if (search !== null) {
        document.addEventListener('keydown', inputFocus);
        flexsearchContainer.addEventListener('shown.bs.collapse', function () {
            search.focus();
        });
        
        var topHeader = document.getElementById("top-header");
        document.addEventListener('click', function(elem) {
            if (!flexsearchContainer.contains(elem.target) && !topHeader.contains(elem.target))
                flexsearchContainerCollapse.hide();
        });
    }

    hideFlexsearchBtn.addEventListener('click', () =>{
        flexsearchContainerCollapse.hide()
    })

    function inputFocus(e) {
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            flexsearchContainerCollapse.toggle();
        }
        if (e.key === 'Escape' ) {
            search.blur();
            
            flexsearchContainerCollapse.hide();
        }
    };

    document.addEventListener('click', function(event) {

    var isClickInsideElement = suggestions.contains(event.target);

    if (!isClickInsideElement) {
        suggestions.classList.add('d-none');
    }

    });

    


    document.addEventListener('keydown',suggestionFocus);

    function suggestionFocus(e) {
    const suggestionsHidden = suggestions.classList.contains('d-none');
    if (suggestionsHidden) return;

    const focusableSuggestions= [...suggestions.querySelectorAll('a')];
    if (focusableSuggestions.length === 0) return;

    const index = focusableSuggestions.indexOf(document.activeElement);

    if (e.key === "ArrowUp") {
        e.preventDefault();
        const nextIndex = index > 0 ? index - 1 : 0;
        focusableSuggestions[nextIndex].focus();
    }
    else if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextIndex= index + 1 < focusableSuggestions.length ? index + 1 : index;
        focusableSuggestions[nextIndex].focus();
    }

    }

    


    (function(){

    var index = new FlexSearch.Document({
        
        tokenize: "forward",
        minlength:  0 ,
        cache:  100 ,
        optimize:  true ,
        document: {
        id: 'id',
        store: [
            "href", "title", "description"
        ],
        index: ["title", "description", "content"]
        }
    });


    


    
    


    

    

    search.addEventListener('input', show_results, true);

    function show_results(){
        const maxResult =  5 ;
        const minlength =  0 ;
        var searchQuery = sanitizeHTML(this.value);
        var results = index.search(searchQuery, {limit: maxResult, enrich: true});

        
        const flatResults = new Map(); 
        for (const result of results.flatMap(r => r.result)) {
        if (flatResults.has(result.doc.href)) continue;
        flatResults.set(result.doc.href, result.doc);
        }

        suggestions.innerHTML = "";
        suggestions.classList.remove('d-none');

        
        if (searchQuery.length < minlength) {
            const minCharMessage = document.createElement('div')
            minCharMessage.innerHTML = `Please type at least <strong>${minlength}</strong> characters`
            minCharMessage.classList.add("suggestion__no-results");
            suggestions.appendChild(minCharMessage);
            return;
        } else {
            
            if (flatResults.size === 0 && searchQuery) {
                const noResultsMessage = document.createElement('div')
                noResultsMessage.innerHTML = "No results for" + ` "<strong>${searchQuery}</strong>"`
                noResultsMessage.classList.add("suggestion__no-results");
                suggestions.appendChild(noResultsMessage);
                return;
            }
        }

        
        for(const [href, doc] of flatResults) {
            const entry = document.createElement('div');
            suggestions.appendChild(entry);

            const a = document.createElement('a');
            a.href = href;
            entry.appendChild(a);

            const title = document.createElement('span');
            title.textContent = doc.title;
            title.classList.add("suggestion__title");
            a.appendChild(title);

            const description = document.createElement('span');
            description.textContent = doc.description;
            description.classList.add("suggestion__description");
            a.appendChild(description);

            suggestions.appendChild(entry);

            if(suggestions.childElementCount == maxResult) break;
        }
    }
    }());
</script></body></html>