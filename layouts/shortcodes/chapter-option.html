{{/*
Shortcode pour afficher une option de navigation vers un chapitre
Usage: {{< chapter-option 
  letter="A" 
  color="green" 
  title="Titre de l'option" 
  subtitle="Sous-titre explicatif"
  criteria="Crit√®re 1,Crit√®re 2,Crit√®re 3"
  time="30-40 minutes"
  chapter="16"
  chapter-title="Titre du Chapitre"
  chapter-url="/chapitres/fondamentaux/chapitre-16-titre/"
>}}
*/}}

{{ $chapterNumber := .Get "chapter" }}
{{ $chapterUrl := .Get "chapter-url" }}
{{ $chapterTitle := .Get "chapter-title" }}

{{/* V√©rifier si le chapitre existe et s'il est en draft */}}
{{ $isDraft := false }}
{{ $chapterExists := false }}

{{ if $chapterUrl }}
  {{ $chapterPath := "" }}
  
  {{/* G√©rer les diff√©rents types d'URLs */}}
  {{ if strings.HasPrefix $chapterUrl "/chapitres/" }}
    {{/* URL de chapitre standard */}}
    {{ $chapterPath = strings.TrimPrefix "/chapitres/" $chapterUrl }}
    {{ $chapterPath = strings.TrimSuffix "/" $chapterPath }}
    {{ if eq $chapterPath "" }}
      {{/* URL /chapitres/ pointe vers content/chapitres/_index.md */}}
      {{ $chapterPath = "content/chapitres/_index.md" }}
    {{ else }}
      {{ $chapterPath = printf "content/chapitres/%s.md" $chapterPath }}
    {{ end }}
  {{ else if strings.HasPrefix $chapterUrl "/" }}
    {{/* URL de page sp√©ciale (/, /concept/, /examples/, etc.) */}}
    {{ $chapterPath = strings.TrimPrefix "/" $chapterUrl }}
    {{ $chapterPath = strings.TrimSuffix "/" $chapterPath }}
    {{ if eq $chapterPath "" }}
      {{ $chapterPath = "content/_index.md" }}
    {{ else }}
      {{ $chapterPath = printf "content/%s/_index.md" $chapterPath }}
    {{ end }}
  {{ end }}
  
  {{/* V√©rifier si le fichier existe */}}
  {{ if and $chapterPath (fileExists $chapterPath) }}
    {{ $chapterExists = true }}
    {{ $chapterContent := readFile $chapterPath }}
    
    {{/* V√©rifier si la page est marqu√©e comme draft */}}
    {{ if or (strings.Contains $chapterContent "draft: true") (strings.Contains $chapterContent "draft = true") }}
      {{ $isDraft = true }}
    {{ end }}
  {{ end }}
{{ end }}

<div class="chapter-option" data-color="{{ .Get "color" | default "blue" }}" {{ if $isDraft }}data-draft="true"{{ end }}>
  <div class="chapter-option-header">
    <div class="chapter-option-letter">{{ .Get "letter" | default "A" }}</div>
    <div>
      <h3 class="chapter-option-title">{{ .Get "title" | default "Option" }}</h3>
      <p class="chapter-option-subtitle">{{ .Get "subtitle" | default "" }}</p>
    </div>
  </div>
  
  <div class="chapter-option-content">
    {{ if .Get "criteria" }}
    <div class="chapter-option-criteria">
      <h4 class="chapter-option-criteria-title">Crit√®res d'adoption :</h4>
      <ul class="chapter-option-criteria-list">
        {{ range split (.Get "criteria") "," }}
        <li>{{ trim . " " }}</li>
        {{ end }}
      </ul>
    </div>
    {{ end }}
    
    <div class="chapter-option-footer">
      <span class="chapter-option-time">‚è±Ô∏è {{ .Get "time" | default "Variable" }}</span>
      
      {{ if $isDraft }}
        {{/* Bouton d√©sactiv√© pour les chapitres en draft */}}
        <span class="chapter-option-link chapter-option-link-disabled">
          {{ $chapterTitle | default "Chapitre en cours de r√©daction" }}
          <span class="draft-indicator">üìù</span>
        </span>
      {{ else if $chapterExists }}
        {{/* Bouton actif pour les chapitres disponibles */}}
        <a href="{{ $chapterUrl }}" class="chapter-option-link">
          {{ $chapterTitle | default "Voir le chapitre" }}
        </a>
      {{ else }}
        {{/* Bouton d√©sactiv√© pour les chapitres inexistants */}}
        <span class="chapter-option-link chapter-option-link-disabled">
          {{ $chapterTitle | default "Chapitre √† venir" }}
          <span class="coming-soon-indicator">üöß</span>
        </span>
      {{ end }}
    </div>
  </div>
</div>

<style>
/* Styles pour les boutons d√©sactiv√©s */
.chapter-option-link-disabled {
  background: #9ca3af !important;
  color: #6b7280 !important;
  cursor: not-allowed !important;
  opacity: 0.7;
}

.chapter-option-link-disabled:hover {
  background: #9ca3af !important;
  color: #6b7280 !important;
  transform: none !important;
  box-shadow: none !important;
}

.chapter-option-link-disabled::after {
  display: none !important;
}

/* Styles pour les chapitres en draft */
.chapter-option[data-draft="true"] {
  opacity: 0.8;
  border-style: dashed;
  border-color: #d1d5db;
}

.chapter-option[data-draft="true"] .chapter-option-letter {
  background: #9ca3af;
}

.chapter-option[data-draft="true"] .chapter-option-title {
  color: #6b7280;
}

.chapter-option[data-draft="true"] .chapter-option-subtitle {
  color: #9ca3af;
}

/* Indicateurs visuels */
.draft-indicator,
.coming-soon-indicator {
  margin-left: 0.5rem;
  font-size: 0.875rem;
}

/* Animation pour les chapitres en draft */
.chapter-option[data-draft="true"] {
  animation: draft-pulse 2s ease-in-out infinite;
}

@keyframes draft-pulse {
  0%, 100% {
    opacity: 0.8;
  }
  50% {
    opacity: 0.6;
  }
}
</style>