{{ $sectionTitle := .Scratch.Get "sectionTitle" }}
{{ with (index .Site.Data.landing $sectionTitle) }}
{{ if eq .enable true }}
<!-- Features Start -->
<section id="{{ $sectionTitle }}">
    <div class="container mt-100 mt-60">
        <div class="row justify-content-center">
            <div class="col-12 text-center">
                <div class="section-title">
                    {{ with .title }}
                        <h4 class="title fw-bold mb-4">{{ . }}</h4>
                    {{ end }}
                    {{ with .subtitle }}
                        <p class="text-muted para-desc mb-4 pb-2 mx-auto">{{ . | markdownify }}</p>
                    {{ end }}
                </div>
            </div><!--end col-->
        </div><!--end row-->

        <div class="row">
            <div class="col-lg-12">
                <div class="row">
                    {{ range .items }}
                        {{ $isDraft := false }}
                        {{ $page := .Site.GetPage .ctaLink.url }}
                        {{ if not $page }}
                            {{/* Essayer de trouver la page avec différentes méthodes */}}
                            {{ $page = .Site.GetPage "page" .ctaLink.url }}
                        {{ end }}
                        {{ if not $page }}
                            {{/* Essayer de trouver par section */}}
                            {{ $page = .Site.GetPage "section" .ctaLink.url }}
                        {{ end }}
                        {{ if $page }}
                            {{ $isDraft = $page.Draft }}
                        {{ else }}
                            {{/* Vérifier si c'est une page concept qui existe */}}
                            {{ if hasPrefix .ctaLink.url "/concept/" }}
                                {{ $isDraft = false }}
                            {{ else if eq .ctaLink.url "/chapitres/" }}
                                {{/* Page d'overview des chapitres - accessible */}}
                                {{ $isDraft = false }}
                            {{ else if hasPrefix .ctaLink.url "/chapitres/" }}
                                {{/* Pour les chapitres individuels, vérifier s'ils existent vraiment */}}
                                {{ $isDraft = true }}
                            {{ else }}
                                {{ $isDraft = true }}
                            {{ end }}
                        {{ end }}
                        
                        <div class="col-md-4 col-12">
                            <div class="d-flex features feature-primary p-3 {{ if $isDraft }}feature-draft{{ end }}">
                                <div class="{{ if .icon }}icon{{ else }}no-icon{{ end }} text-center rounded-3 text-primary me-3 {{ if $isDraft }}icon-draft{{ end }}">
                                    <i class="material-icons align-middle h4 mb-0">{{ .icon }}</i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="title {{ if $isDraft }}title-draft{{ end }}">{{ .title }}</h4>
                                    <p class="text-muted para mb-0 {{ if $isDraft }}para-draft{{ end }}">{{ .description | markdownify }}</p>
                                    {{ with .ctaLink }}
                                    <div class="mt-2">
                                        {{ if $isDraft }}
                                            <span class="mt-3 h6 text-muted cta-disabled">
                                                {{ .text | markdownify }} 
                                                <i class="material-icons align-top">edit_note</i>
                                                <small class="d-block text-muted">En cours de rédaction</small>
                                            </span>
                                        {{ else }}
                                            <a href="{{ .url }}" class="mt-3 h6 text-primary">{{ .text | markdownify }} <i class="material-icons align-top">chevron_right</i></a>
                                        {{ end }}
                                    </div>
                                    {{ end }}
                                </div>
                            </div>
                        </div>
                        <!--end col-->
                    {{ end }}
                </div>
                <!--end row-->
            </div>
            <!--end col-->
        </div>
        <!--end row-->
    </div>
    <!--end container-->
</section>
<!-- features End -->
{{ end }}
{{ end }}

